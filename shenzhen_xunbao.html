
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鹏城民间艺术小传人：非遗寻宝记</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }
        
        .pengzi-chat {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .game-card {
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .treasure-box {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .modal {
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-purple-50 to-pink-100 min-h-screen">
    
    <!-- 游戏容器 -->
    <div id="gameContainer" class="max-w-4xl mx-auto p-4">
        
        <!-- 开场场景 -->
        <div id="introScene" class="scene">
            <div class="bg-white rounded-xl shadow-xl p-8 text-center">
                <div class="mb-6">
                    <div class="w-32 h-32 mx-auto bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center mb-4">
                        <div class="text-4xl">🦀</div>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">鹏城民间艺术小传人</h1>
                    <h2 class="text-xl text-purple-600 mb-4">非遗寻宝记</h2>
                </div>
                
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-6">
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-white text-gray-800 rounded-full w-16 h-16 flex items-center justify-center text-2xl mb-2">🦀</div>
                        <p class="text-sm font-medium">鹏仔</p>
                    </div>
                    <div class="bg-white/20 rounded-lg p-4 text-left">
                        <p class="mb-3">你好，未来的文化守护者！</p>
                        <p class="mb-3">我是你的智能助手鹏仔，一只来自深圳湾红树林的招潮蟹。</p>
                        <p>让我们一起乘坐时光机，寻找并传承即将失落的"鹏城七艺"吧！</p>
                    </div>
                </div>
                
                <div class="skyline mb-6">
                    <div class="flex justify-center items-end space-x-2">
                        <div class="w-8 h-16 bg-gray-600 rounded-t"></div>
                        <div class="w-12 h-24 bg-blue-600 rounded-t"></div>
                        <div class="w-10 h-20 bg-purple-600 rounded-t"></div>
                        <div class="w-14 h-28 bg-gray-700 rounded-t"></div>
                        <div class="w-8 h-16 bg-green-600 rounded-t"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">深圳天际线</p>
                </div>
                
                <button onclick="startGame()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-full font-medium hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                    开始非遗寻宝之旅
                </button>
            </div>
        </div>
        
        <!-- 课前测试场景 -->
        <div id="preTestScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">鹏城非遗知多少？</h2>
                    <div class="pengzi-chat inline-block">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">🦀</div>
                    </div>
                    <p class="text-gray-600">小传人，让我们先来测试一下你对鹏城非遗的初始记忆吧！</p>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4">以下哪些是深圳的民间艺术？（可多选）</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="preTestOptions">
                        <!-- 选项会通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <div class="text-center">
                    <button onclick="submitPreTest()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        提交答案
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 体验场景 -->
        <div id="experienceScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">鹏城非遗工坊</h2>
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">🦀</div>
                    </div>
                    <p class="text-gray-600">欢迎来到非遗工坊！这里有七个神奇的体验区，让我们一起唤醒七艺之魂吧！</p>
                </div>
                
                <!-- 进度条 -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600">体验进度</span>
                        <span class="text-sm text-gray-600" id="progressText">0/7</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full progress-bar" style="width: 0%" id="progressBar"></div>
                    </div>
                </div>
                
                <!-- 七艺体验区 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="artExperiences">
                    <!-- 体验卡片会通过JavaScript动态生成 -->
                </div>
                
                <div class="text-center mt-8">
                    <button id="nextToTreasure" onclick="showTreasureScene()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-8 py-3 rounded-full font-medium hover:from-yellow-500 hover:to-orange-600 transition-all transform hover:scale-105 hidden">
                        前往宝箱选择
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 宝箱选择场景 -->
        <div id="treasureScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">秘境宝箱</h2>
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">🦀</div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <p class="text-gray-700" id="treasureRecommendation">根据你的体验表现，我推荐你选择...</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="treasureBoxes">
                    <!-- 宝箱会通过JavaScript动态生成 -->
                </div>
                
                <div class="text-center mt-6">
                    <button onclick="openSelectedBoxes()" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">
                        打开选中的宝箱
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 课后探宝场景 -->
        <div id="afterScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">非遗秘境探宝</h2>
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">🦀</div>
                    </div>
                    <p class="text-gray-600">恭喜你获得了秘境之钥！快去实地探访真正的非遗传承地吧！</p>
                </div>
                
                <div id="secretKeys" class="space-y-4 mb-6">
                    <!-- 秘境钥匙会通过JavaScript动态生成 -->
                </div>
                
                <div class="text-center">
                    <button onclick="showEasterEgg()" class="bg-gradient-to-r from-pink-400 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-pink-500 hover:to-purple-600 transition-all">
                        🎁 发现更多彩蛋
                    </button>
                    <button onclick="restartGame()" class="ml-4 bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                        重新开始游戏
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 游戏模态框 -->
    <div id="gameModal" class="fixed inset-0 bg-black/50 modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6" id="modalContent">
            <!-- 模态框内容会动态更新 -->
        </div>
    </div>
    
    <!-- 彩蛋模态框 -->
    <div id="easterEggModal" class="fixed inset-0 bg-black/50 modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-96 overflow-y-auto p-6">
            <h3 class="text-xl font-bold mb-4">🎊 深圳·中国非遗万花筒</h3>
            <div class="pengzi-chat text-center mb-4">
                <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2 mx-auto">🦀</div>
                <p class="text-sm text-gray-600">小传人，鹏城的非遗宝藏可不止这七项哦！看看更广阔的非遗世界吧！</p>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-blue-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">🎭</div>
                    <p class="text-sm font-medium">粤剧</p>
                    <p class="text-xs text-gray-600">南国红豆</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">🏮</div>
                    <p class="text-sm font-medium">沙头角鱼灯舞</p>
                    <p class="text-xs text-gray-600">海上明珠</p>
                </div>
                <div class="bg-yellow-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">🍲</div>
                    <p class="text-sm font-medium">下沙大盆菜</p>
                    <p class="text-xs text-gray-600">围村盛宴</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">🎨</div>
                    <p class="text-sm font-medium">满堂红瓷艺</p>
                    <p class="text-xs text-gray-600">红釉彩瓷</p>
                </div>
                <div class="bg-pink-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">💊</div>
                    <p class="text-sm font-medium">平乐郭氏正骨</p>
                    <p class="text-xs text-gray-600">悬壶济世</p>
                </div>
                <div class="bg-indigo-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">🏺</div>
                    <p class="text-sm font-medium">更多非遗...</p>
                    <p class="text-xs text-gray-600">等你探索</p>
                </div>
            </div>
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg text-center">
                <p class="mb-2">🌟 暑期非遗探险家邀请</p>
                <p class="text-sm">选择一个心动的项目，去图书馆、博物馆或实地探访，成为小小非遗探险家吧！</p>
            </div>
            <div class="text-center mt-4">
                <button onclick="closeEasterEgg()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据
        let gameData = {
            preTestAnswers: [],
            artScores: {},
            selectedBoxes: [],
            currentProgress: 0        };
          // 七艺数据
        const arts = [
            {
                id: 'paper-cutting',
                name: '田氏剪纸',
                icon: '✂️',
                color: 'bg-red-500',
                description: '巧手剪乾坤',
                location: '罗湖区',
                venue: '罗湖区文化馆非遗展示中心',
                address: '深圳市罗湖区桂园街道',
                activity: '每周三下午有剪纸体验课程'
            },
            {
                id: 'qilin-dance',
                name: '麒麟舞',
                icon: '🦄',
                color: 'bg-yellow-500',
                description: '瑞兽献祥和',
                location: '福田区',
                venue: '福田区民俗文化村',
                address: '深圳市福田区华强北街道',
                activity: '每周六上午有麒麟舞表演和教学'
            },
            {
                id: 'fish-lantern',
                name: '鱼灯舞',
                icon: '🐠',
                color: 'bg-blue-500',
                description: '鱼跃龙门阵',
                location: '盐田区',
                venue: '盐田区沙头角鱼灯舞传承基地',
                address: '深圳市盐田区沙头角街道',
                activity: '节庆期间有鱼灯舞巡游表演'
            },
            {
                id: 'mantis-boxing',
                name: '螳螂拳',
                icon: '🥋',
                color: 'bg-green-500',
                description: '仿生武之道',
                location: '宝安区',
                venue: '宝安区传统武术馆',
                address: '深圳市宝安区新安街道',
                activity: '周末有螳螂拳教学课程'
            },
            {
                id: 'hakka-hat',
                name: '客家凉帽',
                icon: '👒',
                color: 'bg-purple-500',
                description: '经纬织清凉',
                location: '龙岗区',
                venue: '龙岗客家民俗博物馆',
                address: '深圳市龙岗区龙城街道',
                activity: '可预约体验凉帽制作工艺'
            },
            {
                id: 'sea-urchin-zongzi',
                name: '海胆粽',
                icon: '🍙',
                color: 'bg-orange-500',
                description: '山海滋味藏',
                location: '大鹏新区',
                venue: '大鹏所城非遗美食体验馆',
                address: '深圳市大鹏新区大鹏所城',
                activity: '端午节期间有海胆粽制作体验'
            },
            {
                id: 'woodblock-print',
                name: '版画艺术',
                icon: '🖼️',
                color: 'bg-indigo-500',
                description: '刻印新篇章',
                location: '龙岗区',
                venue: '观澜版画原创产业基地',
                address: '深圳市龙岗区观澜街道',
                activity: '版画工坊常年开放体验'
            }
        ];
        
        // 课前测试选项（包含干扰项）
        const preTestOptions = [
            { name: '田氏剪纸', correct: true, icon: '✂️' },
            { name: '麒麟舞', correct: true, icon: '🦄' },
            { name: '鱼灯舞', correct: true, icon: '🐠' },
            { name: '螳螂拳', correct: true, icon: '🥋' },
            { name: '客家凉帽', correct: true, icon: '👒' },
            { name: '海胆粽', correct: true, icon: '🍙' },
            { name: '版画艺术', correct: true, icon: '🖼️' },
            { name: '粤剧', correct: false, icon: '🎭' },
            { name: '佛山醒狮', correct: false, icon: '🦁' },
            { name: '潮汕英歌舞', correct: false, icon: '🥁' }
        ];
        
        // 开始游戏
        function startGame() {
            hideAllScenes();
            document.getElementById('preTestScene').classList.remove('hidden');
            initPreTest();
        }
        
        // 初始化课前测试
        function initPreTest() {
            const container = document.getElementById('preTestOptions');
            container.innerHTML = '';
            
            preTestOptions.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'game-card bg-gray-50 border-2 border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-blue-400 transition-all';
                optionDiv.onclick = () => togglePreTestOption(index, optionDiv);
                
                optionDiv.innerHTML = `
                    <div class="text-3xl mb-2">${option.icon}</div>
                    <p class="text-sm font-medium">${option.name}</p>
                `;
                
                container.appendChild(optionDiv);
            });
        }
        
        // 切换课前测试选项
        function togglePreTestOption(index, element) {
            if (gameData.preTestAnswers.includes(index)) {
                gameData.preTestAnswers = gameData.preTestAnswers.filter(i => i !== index);
                element.classList.remove('border-blue-500', 'bg-blue-50');
                element.classList.add('border-gray-200', 'bg-gray-50');
            } else {
                gameData.preTestAnswers.push(index);
                element.classList.remove('border-gray-200', 'bg-gray-50');
                element.classList.add('border-blue-500', 'bg-blue-50');
            }
        }
        
        // 提交课前测试
        function submitPreTest() {
            let feedback = '';
            const correctCount = gameData.preTestAnswers.filter(i => preTestOptions[i].correct).length;
            
            if (correctCount >= 5) {
                feedback = '哇！你连这么多都知道，不愧是未来守护者！';
            } else if (correctCount >= 3) {
                feedback = '不错不错！看来你对鹏城非遗有一定了解呢！';
            } else {
                feedback = '哦？看来有很多神秘的艺术等着我们一起探索呢！';
            }
            
            showModal('课前测试结果', `
                <div class="text-center">
                    <div class="bg-orange-400 text-white rounded-full w-16 h-16 flex items-center justify-center text-2xl mb-4 mx-auto">🦀</div>
                    <p class="mb-4">${feedback}</p>
                    <p class="text-sm text-gray-600 mb-4">你答对了 ${correctCount}/7 个深圳非遗项目</p>
                    <button onclick="closeModal(); startExperience();" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        开始非遗体验
                    </button>
                </div>
            `);
        }
        
        // 开始体验阶段
        function startExperience() {
            hideAllScenes();
            document.getElementById('experienceScene').classList.remove('hidden');
            initArtExperiences();
        }
        
        // 初始化艺术体验
        function initArtExperiences() {
            const container = document.getElementById('artExperiences');
            container.innerHTML = '';
            
            arts.forEach(art => {
                const artDiv = document.createElement('div');
                artDiv.className = `game-card ${art.color} text-white rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all`;
                artDiv.onclick = () => startArtGame(art);
                
                artDiv.innerHTML = `
                    <div class="text-4xl mb-3 text-center">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">${art.name}</h3>
                    <p class="text-sm opacity-90 mb-2">${art.description}</p>
                    <p class="text-xs opacity-75">${art.location}</p>
                    <div class="mt-4 text-center">
                        <span class="text-xs bg-white/20 px-3 py-1 rounded-full">
                            ${gameData.artScores[art.id] ? '已完成' : '点击体验'}
                        </span>
                    </div>
                `;
                
                if (gameData.artScores[art.id]) {
                    artDiv.style.opacity = '0.7';
                    artDiv.onclick = null;
                }
                
                container.appendChild(artDiv);
            });
        }
        
        // 开始艺术游戏
        function startArtGame(art) {
            let gameContent = '';
            
            switch(art.id) {
                case 'paper-cutting':
                    gameContent = createPaperCuttingGame(art);
                    break;
                case 'qilin-dance':
                    gameContent = createQilinDanceGame(art);
                    break;
                case 'fish-lantern':
                    gameContent = createFishLanternGame(art);
                    break;
                case 'mantis-boxing':
                    gameContent = createMantisBoxingGame(art);
                    break;
                case 'hakka-hat':
                    gameContent = createHakkaHatGame(art);
                    break;
                case 'sea-urchin-zongzi':
                    gameContent = createSeaUrchinZongziGame(art);
                    break;
                case 'woodblock-print':
                    gameContent = createWoodblockPrintGame(art);
                    break;
            }
            
            showModal(art.name + ' - ' + art.description, gameContent);
        }
          // 剪纸游戏
        function createPaperCuttingGame(art) {
            const gameState = {
                selectedPieces: [],
                correctSequence: [1, 2, 3, 4, 5],
                currentStep: 0,
                completed: false
            };
            
            // Store game state globally for this mini-game
            window.paperCuttingState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <p class="mb-4">将碎片按正确顺序拼成完整的剪纸图案！</p>
                    <div id="paperCuttingProgress" class="mb-4">
                        <div class="text-sm text-gray-600">进度: <span id="progressText">0/5</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="progressBar" class="bg-red-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-4" id="paperCuttingGrid">
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 1)">
                            <div class="text-center">
                                <div class="text-lg">🌸</div>
                                <div class="text-xs">片1</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 2)">
                            <div class="text-center">
                                <div class="text-lg">🍃</div>
                                <div class="text-xs">片2</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 3)">
                            <div class="text-center">
                                <div class="text-lg">🦋</div>
                                <div class="text-xs">片3</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 4)">
                            <div class="text-center">
                                <div class="text-lg">☀️</div>
                                <div class="text-xs">片4</div>
                            </div>
                        </div>
                        <div class="bg-red-200 h-16 rounded flex items-center justify-center text-red-800 border-2 border-red-400">
                            <div class="text-center">
                                <div class="text-lg">❀</div>
                                <div class="text-xs">中心</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 5)">
                            <div class="text-center">
                                <div class="text-lg">🌿</div>
                                <div class="text-xs">片5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">按顺序点击碎片：花朵 → 叶子 → 蝴蝶 → 太阳 → 藤蔓</p>
                    <div id="paperCuttingFeedback" class="text-sm mb-4"></div>
                    <button id="paperCuttingComplete" onclick="completePaperCutting('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                        完成拼图
                    </button>
                </div>
            `;
        }
          // 麒麟舞游戏
        function createQilinDanceGame(art) {
            const gameState = {
                drumBeats: [],
                targetPattern: ['鼓1', '鼓2', '鼓1', '鼓2', '鼓1'],
                currentBeat: 0,
                completed: false
            };
            
            window.qilinDanceState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <p class="mb-4">跟着鼓点节拍舞动麒麟！</p>
                    <div id="qilinProgress" class="mb-4">
                        <div class="text-sm text-gray-600">节拍进度: <span id="beatProgress">0/5</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="beatProgressBar" class="bg-yellow-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-center space-x-4 mb-4">
                            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center border-4 border-yellow-300 cursor-pointer hover:bg-yellow-200 transition-all transform hover:scale-105" onclick="beatQilinDrum(this, 1)">
                                <div class="text-center">
                                    <div class="text-2xl">🥁</div>
                                    <div class="text-xs">鼓1</div>
                                </div>
                            </div>
                            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center border-4 border-yellow-300 cursor-pointer hover:bg-yellow-200 transition-all transform hover:scale-105" onclick="beatQilinDrum(this, 2)">
                                <div class="text-center">
                                    <div class="text-2xl">🥁</div>
                                    <div class="text-xs">鼓2</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">按节拍敲击！节奏：鼓1-鼓2-鼓1-鼓2-鼓1</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                        <p class="text-sm">🎵 麒麟出洞、麒麟采青、麒麟戏珠...</p>
                        <div id="qilinFeedback" class="text-sm mt-2"></div>
                    </div>
                    <button id="qilinComplete" onclick="completeQilinDance('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                        完成表演
                    </button>
                </div>
            `;
        }
          // 鱼灯舞游戏
        function createFishLanternGame(art) {
            const gameState = {
                fishPosition: { x: 1, y: 1 },
                lanterns: [
                    { x: 6, y: 1, lit: false },
                    { x: 3, y: 3, lit: false },
                    { x: 5, y: 2, lit: false }
                ],
                lanternsLit: 0,
                completed: false
            };
            
            window.fishLanternState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <p class="mb-4">控制鱼灯穿越巷道，点亮祈福灯笼！</p>
                    <div id="fishProgress" class="mb-4">
                        <div class="text-sm text-gray-600">已点亮灯笼: <span id="lanternCount">0/3</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="lanternProgressBar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="fishGameBoard" class="relative bg-blue-50 p-2 rounded-lg mb-4 mx-auto" style="width: 300px; height: 200px; background-image: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);">
                        <!-- Grid lines for reference -->
                        <div class="grid grid-cols-6 grid-rows-4 h-full w-full absolute inset-0 opacity-20">
                            ${Array.from({length: 24}, (_, i) => `<div class="border border-blue-200"></div>`).join('')}
                        </div>
                        <!-- Fish lantern -->
                        <div id="fishLantern" class="absolute w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white cursor-pointer transform transition-all duration-300" style="left: 8px; top: 8px; z-index: 10;">
                            🐠
                        </div>
                        <!-- Lanterns to light up -->
                        <div class="lantern absolute w-8 h-8 bg-yellow-300 rounded-full flex items-center justify-center transition-all duration-300" style="right: 8px; top: 8px;" data-lantern="0">🏮</div>
                        <div class="lantern absolute w-8 h-8 bg-yellow-300 rounded-full flex items-center justify-center transition-all duration-300" style="left: 96px; bottom: 8px;" data-lantern="1">🏮</div>
                        <div class="lantern absolute w-8 h-8 bg-yellow-300 rounded-full flex items-center justify-center transition-all duration-300" style="right: 48px; top: 48px;" data-lantern="2">🏮</div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button onclick="moveFish('up')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">⬆️ 上</button>
                        <button onclick="moveFish('left')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">⬅️ 左</button>
                        <button onclick="moveFish('right')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">➡️ 右</button>
                        <div></div>
                        <button onclick="moveFish('down')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">⬇️ 下</button>
                        <div></div>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">移动鱼灯靠近灯笼自动点亮</p>
                    <div id="fishFeedback" class="text-sm mb-4"></div>
                    <button id="fishComplete" onclick="completeFishLantern('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                        完成游戏
                    </button>
                </div>
            `;
        }
          // 螳螂拳游戏
        function createMantisBoxingGame(art) {
            const gameState = {
                currentMove: 0,
                moveSequence: ['捕蝉', '勾搂', '闪身', '进退'],
                userSequence: [],
                moveDescriptions: {
                    '捕蝉': '双臂如螳螂前肢，迅速捕捉',
                    '勾搂': '手指如钩，搂抱防守',
                    '闪身': '身如螳螂，灵活闪避',
                    '进退': '步法稳健，进退有度'
                },
                completed: false,
                practiceRound: 1,
                maxRounds: 3
            };
            
            window.mantisBoxingState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">螳螂拳基础套路</h3>
                    <p class="mb-4">学习螳螂拳的四大基础招式，体验仿生武术的精髓！</p>
                    
                    <div id="mantisProgress" class="mb-4">
                        <div class="text-sm text-gray-600">练习轮次: <span id="practiceRound">1/3</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="mantisProgressBar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- 示范阶段 -->
                    <div id="demonstrationPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">👀 观察示范（点击观看招式）</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('捕蝉', this)" data-move="捕蝉">
                                <div class="text-3xl mb-2">🦂</div>
                                <p class="text-sm font-bold">螳螂捕蝉</p>
                                <p class="text-xs text-gray-600 mt-1">双臂前伸如螳螂</p>
                            </div>
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('勾搂', this)" data-move="勾搂">
                                <div class="text-3xl mb-2">🤲</div>
                                <p class="text-sm font-bold">勾搂采手</p>
                                <p class="text-xs text-gray-600 mt-1">手指如钩搂抱</p>
                            </div>
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('闪身', this)" data-move="闪身">
                                <div class="text-3xl mb-2">⚡</div>
                                <p class="text-sm font-bold">闪身靠打</p>
                                <p class="text-xs text-gray-600 mt-1">身体灵活闪避</p>
                            </div>
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('进退', this)" data-move="进退">
                                <div class="text-3xl mb-2">🔄</div>
                                <p class="text-sm font-bold">进退身法</p>
                                <p class="text-xs text-gray-600 mt-1">步法稳健有度</p>
                            </div>
                        </div>
                        <div id="moveDescription" class="mt-4 bg-yellow-50 p-3 rounded-lg text-sm text-gray-700 hidden">
                            <div id="moveDescriptionContent"></div>
                        </div>
                    </div>
                    
                    <!-- 练习阶段 -->
                    <div id="practicePhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🥋 跟练阶段（按正确顺序点击）</h4>
                        <div class="bg-blue-50 p-3 rounded-lg mb-3">
                            <p class="text-sm text-blue-800">正确顺序：<span id="correctSequenceDisplay">捕蝉 → 勾搂 → 闪身 → 进退</span></p>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('捕蝉', this)" data-move="捕蝉">
                                <div class="text-3xl mb-2">🦂</div>
                                <p class="text-sm font-bold">螳螂捕蝉</p>
                            </div>
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('勾搂', this)" data-move="勾搂">
                                <div class="text-3xl mb-2">🤲</div>
                                <p class="text-sm font-bold">勾搂采手</p>
                            </div>
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('闪身', this)" data-move="闪身">
                                <div class="text-3xl mb-2">⚡</div>
                                <p class="text-sm font-bold">闪身靠打</p>
                            </div>
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('进退', this)" data-move="进退">
                                <div class="text-3xl mb-2">🔄</div>
                                <p class="text-sm font-bold">进退身法</p>
                            </div>
                        </div>
                        <div id="practiceFeedback" class="mt-3 text-sm"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="startPracticeBtn" onclick="startMantisPractice()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors mr-2">
                            开始练习
                        </button>
                        <button id="mantisComplete" onclick="completeMantisBoxing('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            完成训练
                        </button>
                    </div>
                </div>
            `;
        }
          // 客家凉帽游戏
        function createHakkaHatGame(art) {
            const gameState = {
                selectedMaterials: [],
                correctMaterials: ['竹篾', '彩线', '布料'],
                weavingStep: 0,
                weavingPattern: ['横编', '竖编', '横编', '竖编', '收尾'],
                materialColors: {},
                completed: false,
                phase: 'material' // material, color, weaving
            };
            
            window.hakkaHatState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">客家凉帽制作工坊</h3>
                    <p class="mb-4">体验传统客家凉帽的制作工艺，从选材到编织的完整过程！</p>
                    
                    <div id="hatProgress" class="mb-4">
                        <div class="text-sm text-gray-600">制作进度: <span id="hatProgressText">材料选择</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="hatProgressBar" class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- 材料选择阶段 -->
                    <div id="materialPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">🧺 第一步：选择合适的材料</h4>
                        <p class="text-sm text-gray-600 mb-4">传统客家凉帽需要选择正确的天然材料</p>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="material-option bg-yellow-100 p-4 rounded-lg cursor-pointer border-2 border-yellow-200 hover:border-yellow-400 transition-all" onclick="selectHakkaMaterial(this, '竹篾', true)">
                                <div class="text-2xl mb-2">🎋</div>
                                <p class="text-sm font-bold">竹篾</p>
                                <p class="text-xs text-gray-600">主要骨架材料</p>
                            </div>
                            <div class="material-option bg-blue-100 p-4 rounded-lg cursor-pointer border-2 border-blue-200 hover:border-blue-400 transition-all" onclick="selectHakkaMaterial(this, '彩线', true)">
                                <div class="text-2xl mb-2">🧵</div>
                                <p class="text-sm font-bold">彩线</p>
                                <p class="text-xs text-gray-600">装饰与固定</p>
                            </div>
                            <div class="material-option bg-purple-100 p-4 rounded-lg cursor-pointer border-2 border-purple-200 hover:border-purple-400 transition-all" onclick="selectHakkaMaterial(this, '布料', true)">
                                <div class="text-2xl mb-2">🧶</div>
                                <p class="text-sm font-bold">布料</p>
                                <p class="text-xs text-gray-600">帽沿装饰</p>
                            </div>
                            <div class="material-option bg-gray-100 p-4 rounded-lg cursor-pointer border-2 border-gray-200 hover:border-gray-400 transition-all" onclick="selectHakkaMaterial(this, '石头', false)">
                                <div class="text-2xl mb-2">🪨</div>
                                <p class="text-sm font-bold">石头</p>
                                <p class="text-xs text-gray-600">过硬不适用</p>
                            </div>
                            <div class="material-option bg-red-100 p-4 rounded-lg cursor-pointer border-2 border-red-200 hover:border-red-400 transition-all" onclick="selectHakkaMaterial(this, '塑料', false)">
                                <div class="text-2xl mb-2">🧱</div>
                                <p class="text-sm font-bold">塑料</p>
                                <p class="text-xs text-gray-600">非传统材料</p>
                            </div>
                            <div class="material-option bg-green-100 p-4 rounded-lg cursor-pointer border-2 border-green-200 hover:border-green-400 transition-all" onclick="selectHakkaMaterial(this, '金属', false)">
                                <div class="text-2xl mb-2">⚙️</div>
                                <p class="text-sm font-bold">金属</p>
                                <p class="text-xs text-gray-600">太重不合适</p>
                            </div>
                        </div>
                        <div id="materialFeedback" class="mt-4 text-sm"></div>
                        <div class="mt-4">
                            <button id="nextToColorBtn" onclick="startColorPhase()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors hidden">
                                进入配色阶段
                            </button>
                        </div>
                    </div>
                    
                    <!-- 配色阶段 -->
                    <div id="colorPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🎨 第二步：搭配传统色彩</h4>
                        <p class="text-sm text-gray-600 mb-4">为凉帽选择传统的客家配色方案</p>
                        <div class="grid grid-cols-4 gap-3 mb-4">
                            <div class="color-option bg-red-200 p-3 rounded-lg cursor-pointer border-2 border-red-300 text-center hover:border-red-500 transition-all" onclick="selectHatColor(this, '大红', 'red')">
                                <div class="w-8 h-8 bg-red-500 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">大红</p>
                                <p class="text-xs text-gray-600">喜庆传统</p>
                            </div>
                            <div class="color-option bg-blue-200 p-3 rounded-lg cursor-pointer border-2 border-blue-300 text-center hover:border-blue-500 transition-all" onclick="selectHatColor(this, '靛蓝', 'blue')">
                                <div class="w-8 h-8 bg-blue-600 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">靛蓝</p>
                                <p class="text-xs text-gray-600">朴素典雅</p>
                            </div>
                            <div class="color-option bg-green-200 p-3 rounded-lg cursor-pointer border-2 border-green-300 text-center hover:border-green-500 transition-all" onclick="selectHatColor(this, '竹绿', 'green')">
                                <div class="w-8 h-8 bg-green-600 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">竹绿</p>
                                <p class="text-xs text-gray-600">自然清新</p>
                            </div>
                            <div class="color-option bg-yellow-200 p-3 rounded-lg cursor-pointer border-2 border-yellow-300 text-center hover:border-yellow-500 transition-all" onclick="selectHatColor(this, '金黄', 'yellow')">
                                <div class="w-8 h-8 bg-yellow-500 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">金黄</p>
                                <p class="text-xs text-gray-600">丰收富贵</p>
                            </div>
                        </div>
                        <div id="colorPreview" class="bg-gray-50 p-4 rounded-lg mb-4 hidden">
                            <p class="text-sm font-medium mb-2">预览效果：</p>
                            <div class="w-16 h-16 mx-auto rounded-full border-4 border-gray-300" id="hatPreview"></div>
                        </div>
                        <div id="colorFeedback" class="text-sm mb-4"></div>
                        <button id="nextToWeavingBtn" onclick="startWeavingPhase()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors hidden">
                            开始编织
                        </button>
                    </div>
                    
                    <!-- 编织阶段 -->
                    <div id="weavingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🧺 第三步：传统编织手法</h4>
                        <p class="text-sm text-gray-600 mb-4">按照正确的编织顺序完成凉帽制作</p>
                        <div id="weavingProgress" class="mb-4">
                            <div class="text-sm text-gray-600">编织步骤: <span id="weavingStepText">1/5</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="weavingProgressBar" class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg mb-4">
                            <p class="text-sm text-purple-800">当前步骤：<span id="currentWeavingStep">横向编织竹篾</span></p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="weaving-option bg-orange-100 p-4 rounded-lg cursor-pointer border-2 border-orange-300 hover:border-orange-500 transition-all text-center" onclick="performWeaving(this, '横编')">
                                <div class="text-3xl mb-2">↔️</div>
                                <p class="text-sm font-bold">横编</p>
                                <p class="text-xs text-gray-600">水平编织</p>
                            </div>
                            <div class="weaving-option bg-teal-100 p-4 rounded-lg cursor-pointer border-2 border-teal-300 hover:border-teal-500 transition-all text-center" onclick="performWeaving(this, '竖编')">
                                <div class="text-3xl mb-2">↕️</div>
                                <p class="text-sm font-bold">竖编</p>
                                <p class="text-xs text-gray-600">垂直编织</p>
                            </div>
                        </div>
                        <div id="weavingFeedback" class="mt-4 text-sm"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="hakkaComplete" onclick="completeHakkaHat('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            完成制作
                        </button>
                    </div>
                </div>
            `;
        }
          // 海胆粽游戏
        function createSeaUrchinZongziGame(art) {
            const gameState = {
                ingredients: {
                    '海胆': { selected: false, quality: 0 },
                    '糯米': { selected: false, quality: 0 },
                    '粽叶': { selected: false, quality: 0 },
                    '咸蛋黄': { selected: false, quality: 0 }
                },
                cookingSteps: ['清洗海胆', '浸泡糯米', '粽叶包馅', '绳子捆扎', '下锅蒸煮'],
                currentStep: 0,
                totalQuality: 0,
                completed: false,
                phase: 'selection' // selection, cooking, tasting
            };
            
            window.seaUrchinZongziState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">大鹏海胆粽制作坊</h3>
                    <p class="mb-4">体验独特的海鲜风味粽子制作工艺，传承大鹏渔民的智慧！</p>
                    
                    <div id="zongziProgress" class="mb-4">
                        <div class="text-sm text-gray-600">制作进度: <span id="zongziProgressText">食材选择</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="zongziProgressBar" class="bg-orange-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- 食材选择阶段 -->
                    <div id="selectionPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">🦐 第一步：选择新鲜食材</h4>
                        <p class="text-sm text-gray-600 mb-4">优质的食材是制作美味海胆粽的关键</p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="ingredient-card bg-blue-50 p-4 rounded-lg border-2 border-blue-200 cursor-pointer hover:border-blue-400 transition-all" onclick="selectIngredient(this, '海胆')">
                                <div class="text-3xl mb-2">🦔</div>
                                <p class="text-sm font-bold">海胆</p>
                                <p class="text-xs text-gray-600">鲜美主料</p>
                                <div class="quality-stars mt-2" data-ingredient="海胆">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('海胆', 1)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('海胆', 2)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('海胆', 3)">⭐</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">点击星星评分新鲜度</p>
                            </div>
                            <div class="ingredient-card bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200 cursor-pointer hover:border-yellow-400 transition-all" onclick="selectIngredient(this, '糯米')">
                                <div class="text-3xl mb-2">🌾</div>
                                <p class="text-sm font-bold">糯米</p>
                                <p class="text-xs text-gray-600">主要填充</p>
                                <div class="quality-stars mt-2" data-ingredient="糯米">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('糯米', 1)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('糯米', 2)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('糯米', 3)">⭐</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">点击星星评分品质</p>
                            </div>
                            <div class="ingredient-card bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:border-green-400 transition-all" onclick="selectIngredient(this, '粽叶')">
                                <div class="text-3xl mb-2">🍃</div>
                                <p class="text-sm font-bold">粽叶</p>
                                <p class="text-xs text-gray-600">天然包装</p>
                                <div class="quality-stars mt-2" data-ingredient="粽叶">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('粽叶', 1)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('粽叶', 2)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('粽叶', 3)">⭐</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">点击星星评分新鲜度</p>
                            </div>
                            <div class="ingredient-card bg-red-50 p-4 rounded-lg border-2 border-red-200 cursor-pointer hover:border-red-400 transition-all" onclick="selectIngredient(this, '咸蛋黄')">
                                <div class="text-3xl mb-2">🥚</div>
                                <p class="text-sm font-bold">咸蛋黄</p>
                                <p class="text-xs text-gray-600">增香配料</p>
                                <div class="quality-stars mt-2" data-ingredient="咸蛋黄">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('咸蛋黄', 1)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('咸蛋黄', 2)">⭐</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('咸蛋黄', 3)">⭐</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">点击星星评分品质</p>
                            </div>
                        </div>
                        <div id="ingredientFeedback" class="mt-4 text-sm"></div>
                        <div class="mt-4">
                            <button id="nextToCookingBtn" onclick="startCookingPhase()" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors hidden">
                                开始制作
                            </button>
                        </div>
                    </div>
                    
                    <!-- 制作阶段 -->
                    <div id="cookingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">👨‍🍳 第二步：制作工序</h4>
                        <p class="text-sm text-gray-600 mb-4">按照传统工序，精心制作海胆粽</p>
                        <div id="cookingStepProgress" class="mb-4">
                            <div class="text-sm text-gray-600">制作步骤: <span id="cookingStepText">1/5</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="cookingStepBar" class="bg-orange-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg mb-4">
                            <p class="text-sm text-orange-800">当前步骤：<span id="currentCookingStep">清洗海胆，去除杂质</span></p>
                            <div class="mt-2 text-xs text-gray-600" id="stepInstruction">
                                轻柔地清洗海胆，保持其完整性和鲜味
                            </div>
                        </div>
                        <div class="cooking-step-visualization mb-4 bg-gray-50 p-6 rounded-lg">
                            <div class="text-6xl mb-2" id="stepVisualization">🦔</div>
                            <div class="text-sm text-gray-600" id="stepAnimation">正在清洗海胆...</div>
                        </div>
                        <button id="performStepBtn" onclick="performCookingStep()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            执行步骤
                        </button>
                        <div id="cookingFeedback" class="mt-4 text-sm"></div>
                    </div>
                    
                    <!-- 品尝阶段 -->
                    <div id="tastingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🍽️ 第三步：品鉴成果</h4>
                        <div class="bg-gradient-to-br from-orange-100 to-yellow-100 p-6 rounded-lg mb-4">
                            <div class="text-6xl mb-4">🍙</div>
                            <p class="text-lg font-bold text-orange-800 mb-2">海胆粽制作完成！</p>
                            <div id="finalScore" class="text-sm text-gray-700"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h5 class="font-medium text-blue-800 mb-2">口感评价</h5>
                                <div id="tasteRating" class="text-2xl"></div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h5 class="font-medium text-green-800 mb-2">制作技艺</h5>
                                <div id="skillRating" class="text-2xl"></div>
                            </div>
                        </div>
                        <div id="tastingFeedback" class="text-sm mb-4"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="zongziComplete" onclick="completeSeaUrchinZongzi('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            完成制作
                        </button>
                    </div>
                </div>
            `;
        }
          // 版画游戏
        function createWoodblockPrintGame(art) {
            const gameState = {
                selectedTools: [],
                correctTools: ['刻刀', '油墨', '拓包'],
                carvingPattern: [
                    [0, 1, 1, 0, 0, 1, 1, 0],
                    [1, 1, 1, 1, 1, 1, 1, 1],
                    [1, 0, 1, 1, 1, 1, 0, 1],
                    [1, 1, 1, 0, 0, 1, 1, 1],
                    [0, 1, 1, 1, 1, 1, 1, 0],
                    [0, 0, 1, 1, 1, 1, 0, 0]
                ],
                playerPattern: Array(6).fill().map(() => Array(8).fill(0)),
                inkColors: ['黑色', '红色', '蓝色'],
                selectedInk: '',
                printQuality: 0,
                completed: false,
                phase: 'tools' // tools, carving, inking, printing
            };
            
            window.woodblockPrintState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">观澜版画工坊</h3>
                    <p class="mb-4">体验传统版画制作的完整流程，从工具选择到作品印制！</p>
                    
                    <div id="printProgress" class="mb-4">
                        <div class="text-sm text-gray-600">制作进度: <span id="printProgressText">工具准备</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="printProgressBar" class="bg-indigo-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- 工具选择阶段 -->
                    <div id="toolsPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">🔧 第一步：选择版画工具</h4>
                        <p class="text-sm text-gray-600 mb-4">选择制作版画所需的传统工具</p>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="tool-option bg-yellow-100 p-4 rounded-lg cursor-pointer border-2 border-yellow-200 hover:border-yellow-400 transition-all" onclick="selectPrintTool(this, '刻刀', true)">
                                <div class="text-3xl mb-2">🔪</div>
                                <p class="text-sm font-bold">刻刀</p>
                                <p class="text-xs text-gray-600">雕刻版面</p>
                            </div>
                            <div class="tool-option bg-purple-100 p-4 rounded-lg cursor-pointer border-2 border-purple-200 hover:border-purple-400 transition-all" onclick="selectPrintTool(this, '油墨', true)">
                                <div class="text-3xl mb-2">🎨</div>
                                <p class="text-sm font-bold">油墨</p>
                                <p class="text-xs text-gray-600">印刷颜料</p>
                            </div>
                            <div class="tool-option bg-blue-100 p-4 rounded-lg cursor-pointer border-2 border-blue-200 hover:border-blue-400 transition-all" onclick="selectPrintTool(this, '拓包', true)">
                                <div class="text-3xl mb-2">⚫</div>
                                <p class="text-sm font-bold">拓包</p>
                                <p class="text-xs text-gray-600">均匀着墨</p>
                            </div>
                            <div class="tool-option bg-red-100 p-4 rounded-lg cursor-pointer border-2 border-red-200 hover:border-red-400 transition-all" onclick="selectPrintTool(this, '锤子', false)">
                                <div class="text-3xl mb-2">🔨</div>
                                <p class="text-sm font-bold">锤子</p>
                                <p class="text-xs text-gray-600">过于粗糙</p>
                            </div>
                            <div class="tool-option bg-green-100 p-4 rounded-lg cursor-pointer border-2 border-green-200 hover:border-green-400 transition-all" onclick="selectPrintTool(this, '毛笔', false)">
                                <div class="text-3xl mb-2">🖌️</div>
                                <p class="text-sm font-bold">毛笔</p>
                                <p class="text-xs text-gray-600">用于书法</p>
                            </div>
                            <div class="tool-option bg-gray-100 p-4 rounded-lg cursor-pointer border-2 border-gray-200 hover:border-gray-400 transition-all" onclick="selectPrintTool(this, '铅笔', false)">
                                <div class="text-3xl mb-2">✏️</div>
                                <p class="text-sm font-bold">铅笔</p>
                                <p class="text-xs text-gray-600">无法雕刻</p>
                            </div>
                        </div>
                        <div id="toolFeedback" class="mt-4 text-sm"></div>
                        <div class="mt-4">
                            <button id="nextToCarvingBtn" onclick="startCarvingPhase()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden">
                                开始雕刻
                            </button>
                        </div>
                    </div>
                    
                    <!-- 雕刻阶段 -->
                    <div id="carvingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🎨 第二步：雕刻版面</h4>
                        <p class="text-sm text-gray-600 mb-4">点击格子来雕刻出传统图案（深色为雕刻部分）</p>
                        <div class="mb-4">
                            <p class="text-sm font-medium mb-2">目标图案：</p>
                            <div class="grid grid-cols-8 gap-1 max-w-64 mx-auto mb-4" id="targetPattern">
                                <!-- 目标图案会动态生成 -->
                            </div>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm font-medium mb-2">你的雕刻：</p>
                            <div class="grid grid-cols-8 gap-1 max-w-64 mx-auto" id="playerPattern">
                                <!-- 玩家图案会动态生成 -->
                            </div>
                        </div>
                        <div id="carvingFeedback" class="text-sm mb-4"></div>
                        <button id="nextToInkingBtn" onclick="startInkingPhase()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden">
                            准备上墨
                        </button>
                    </div>
                    
                    <!-- 上墨阶段 -->
                    <div id="inkingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🖋️ 第三步：选择墨色</h4>
                        <p class="text-sm text-gray-600 mb-4">为你的版画选择合适的墨色</p>
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="ink-option bg-gray-800 text-white p-4 rounded-lg cursor-pointer border-2 border-gray-600 hover:border-gray-400 transition-all text-center" onclick="selectInkColor(this, '黑色')">
                                <div class="text-2xl mb-2">⚫</div>
                                <p class="text-sm font-bold">传统黑墨</p>
                                <p class="text-xs opacity-80">经典庄重</p>
                            </div>
                            <div class="ink-option bg-red-600 text-white p-4 rounded-lg cursor-pointer border-2 border-red-400 hover:border-red-300 transition-all text-center" onclick="selectInkColor(this, '红色')">
                                <div class="text-2xl mb-2">🔴</div>
                                <p class="text-sm font-bold">朱砂红墨</p>
                                <p class="text-xs opacity-80">喜庆热烈</p>
                            </div>
                            <div class="ink-option bg-blue-600 text-white p-4 rounded-lg cursor-pointer border-2 border-blue-400 hover:border-blue-300 transition-all text-center" onclick="selectInkColor(this, '蓝色')">
                                <div class="text-2xl mb-2">🔵</div>
                                <p class="text-sm font-bold">靛青蓝墨</p>
                                <p class="text-xs opacity-80">清雅宁静</p>
                            </div>
                        </div>
                        <div id="inkFeedback" class="text-sm mb-4"></div>
                        <button id="nextToPrintingBtn" onclick="startPrintingPhase()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden">
                            开始印制
                        </button>
                    </div>
                    
                    <!-- 印制阶段 -->
                    <div id="printingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">🖨️ 第四步：印制作品</h4>
                        <p class="text-sm text-gray-600 mb-4">按压版面，印制你的版画作品</p>
                        <div class="bg-gray-50 p-6 rounded-lg mb-4">
                            <div class="text-center mb-4">
                                <div class="text-6xl mb-2">📄</div>
                                <p class="text-sm text-gray-600">点击下方按钮进行印制</p>
                            </div>
                            <div class="grid grid-cols-8 gap-1 max-w-64 mx-auto mb-4" id="finalPrint">
                                <!-- 最终作品会动态生成 -->
                            </div>
                        </div>
                        <button id="performPrintBtn" onclick="performPrinting()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            用力按压印制
                        </button>
                        <div id="printingFeedback" class="mt-4 text-sm"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="printComplete" onclick="completePrintGame('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            完成作品
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 完成艺术游戏
        function completeArtGame(artId, score) {
            gameData.artScores[artId] = score;
            gameData.currentProgress++;
            
            updateProgress();
            
            const art = arts.find(a => a.id === artId);
            
            showModal('游戏完成！', `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">${art.name}</h3>
                    <div class="bg-green-100 border border-green-400 rounded-lg p-4 mb-4">
                        <p class="text-green-800 font-medium mb-2">恭喜完成体验！</p>
                        <p class="text-green-700">你的得分：${score}/100</p>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2 mx-auto">🦀</div>
                        <p class="text-sm text-gray-700">鹏仔：太棒了！你已经初步掌握了${art.name}的精髓！</p>
                    </div>
                    <button onclick="closeModal(); initArtExperiences();" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        继续探索
                    </button>
                </div>
            `);
        }
        
        // 更新进度
        function updateProgress() {
            const progress = (gameData.currentProgress / 7) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${gameData.currentProgress}/7`;
            
            if (gameData.currentProgress === 7) {
                document.getElementById('nextToTreasure').classList.remove('hidden');
            }
        }
        
        // 显示宝箱选择场景
        function showTreasureScene() {
            hideAllScenes();
            document.getElementById('treasureScene').classList.remove('hidden');
            initTreasureScene();
        }
        
        // 初始化宝箱场景
        function initTreasureScene() {
            // 找出得分最高的艺术
            let bestArt = null;
            let bestScore = 0;
            
            Object.entries(gameData.artScores).forEach(([artId, score]) => {
                if (score > bestScore) {
                    bestScore = score;
                    bestArt = arts.find(a => a.id === artId);
                }
            });
            
            // 设置推荐文本
            const recommendationEl = document.getElementById('treasureRecommendation');
            if (bestArt) {
                recommendationEl.textContent = `根据你的体验表现，你在【${bestArt.name}】上展现了非凡的天赋！得分：${bestScore}/100。我推荐你选择它的宝箱，或者跟随内心选择你最感兴趣的艺术！`;
            }
            
            // 生成宝箱
            const container = document.getElementById('treasureBoxes');
            container.innerHTML = '';
            
            arts.forEach(art => {
                const boxDiv = document.createElement('div');
                boxDiv.className = `treasure-box cursor-pointer p-4 rounded-lg border-4 transition-all ${
                    art.id === bestArt?.id ? 'border-yellow-400 bg-yellow-50' : 'border-gray-300 bg-white'
                }`;
                boxDiv.onclick = () => toggleTreasureBox(art.id, boxDiv);
                
                boxDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-3xl mb-2">📦</div>
                        <div class="text-2xl mb-2">${art.icon}</div>
                        <p class="text-sm font-medium">${art.name}</p>
                        ${art.id === bestArt?.id ? '<p class="text-xs text-yellow-600 mt-1">推荐</p>' : ''}
                    </div>
                `;
                
                container.appendChild(boxDiv);
            });
        }
        
        // 切换宝箱选择
        function toggleTreasureBox(artId, element) {
            if (gameData.selectedBoxes.includes(artId)) {
                gameData.selectedBoxes = gameData.selectedBoxes.filter(id => id !== artId);
                element.classList.remove('border-purple-500', 'bg-purple-50');
                element.classList.add('border-gray-300', 'bg-white');
            } else {
                gameData.selectedBoxes.push(artId);
                element.classList.remove('border-gray-300', 'bg-white');
                element.classList.add('border-purple-500', 'bg-purple-50');
            }
        }
        
        // 打开选中的宝箱
        function openSelectedBoxes() {
            if (gameData.selectedBoxes.length === 0) {
                alert('请先选择至少一个宝箱！');
                return;
            }
            
            hideAllScenes();
            document.getElementById('afterScene').classList.remove('hidden');
            generateSecretKeys();
        }
        
        // 生成秘境钥匙
        function generateSecretKeys() {
            const container = document.getElementById('secretKeys');
            container.innerHTML = '';
            
            gameData.selectedBoxes.forEach(artId => {
                const art = arts.find(a => a.id === artId);
                
                const keyDiv = document.createElement('div');
                keyDiv.className = 'bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300 rounded-lg p-6';
                
                keyDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="text-4xl">${art.icon}</div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800 mb-2">${art.name} 秘境之钥 🗝️</h3>
                            <div class="space-y-2 text-sm">
                                <p><span class="font-medium">传承基地：</span>${art.venue}</p>
                                <p><span class="font-medium">地址：</span>${art.address}</p>
                                <p><span class="font-medium">推荐活动：</span>${art.activity}</p>
                            </div>
                            <div class="mt-3 bg-yellow-200 rounded-lg p-3">
                                <p class="text-xs text-yellow-800">💡 快带着这把钥匙，在课后或假期去实地探访吧！那里有真正的传承人在等着你！</p>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(keyDiv);
            });
        }
        
        // 显示彩蛋
        function showEasterEgg() {
            document.getElementById('easterEggModal').classList.remove('hidden');
        }
        
        // 关闭彩蛋
        function closeEasterEgg() {
            document.getElementById('easterEggModal').classList.add('hidden');
        }
        
        // 重新开始游戏
        function restartGame() {
            gameData = {
                preTestAnswers: [],
                artScores: {},
                selectedBoxes: [],
                currentProgress: 0
            };
            
            hideAllScenes();
            document.getElementById('introScene').classList.remove('hidden');
            
            // 重置进度条
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0/7';
            document.getElementById('nextToTreasure').classList.add('hidden');
        }
        
        // 工具函数
        function hideAllScenes() {
            document.querySelectorAll('.scene').forEach(scene => {
                scene.classList.add('hidden');
            });
        }
        
        function showModal(title, content) {
            document.getElementById('modalContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">${title}</h3>
                ${content}
            `;
            document.getElementById('gameModal').classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('gameModal').classList.add('hidden');
        }
        
        // 游戏辅助函数
        function selectPiece(element, number) {
            element.style.backgroundColor = '#fef2f2';
            element.style.borderColor = '#f87171';
            element.innerHTML = '✓';
        }
        
        function beatDrum(element) {
            element.style.animation = 'pulse 0.3s';
            setTimeout(() => {
                element.style.animation = '';
            }, 300);
        }
        
        function selectMaterial(element, isCorrect) {
            if (isCorrect) {
                element.style.borderColor = '#10b981';
                element.style.backgroundColor = '#d1fae5';
            } else {
                element.style.borderColor = '#ef4444';
                element.style.backgroundColor = '#fee2e2';
            }
        }
          function selectTool(tool) {
            console.log('选择工具：', tool);
        }
        
        // 剪纸游戏函数
        function selectPaperPiece(element, pieceNumber) {
            const state = window.paperCuttingState;
            if (!state || state.completed) return;
            
            const expectedPiece = state.correctSequence[state.currentStep];
            const isCorrect = pieceNumber === expectedPiece;
            
            if (isCorrect) {
                // 正确选择
                element.style.backgroundColor = '#dc2626';
                element.style.borderColor = '#dc2626';
                element.style.color = 'white';
                element.style.transform = 'scale(0.95)';
                element.style.pointerEvents = 'none';
                
                state.selectedPieces.push(pieceNumber);
                state.currentStep++;
                
                // 更新进度
                const progress = (state.currentStep / state.correctSequence.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = `${state.currentStep}/${state.correctSequence.length}`;
                
                // 反馈信息
                const feedback = document.getElementById('paperCuttingFeedback');
                feedback.textContent = '✓ 很好！继续选择下一片...';
                feedback.style.color = '#059669';
                
                // 检查是否完成
                if (state.currentStep >= state.correctSequence.length) {
                    state.completed = true;
                    feedback.textContent = '🎉 太棒了！剪纸图案拼接完成！';
                    document.getElementById('paperCuttingComplete').disabled = false;
                    document.getElementById('paperCuttingComplete').className = 'bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                }
            } else {
                // 错误选择
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#ef4444';
                setTimeout(() => {
                    element.style.backgroundColor = '#fef2f2';
                    element.style.borderColor = '#fca5a5';
                }, 300);
                
                const feedback = document.getElementById('paperCuttingFeedback');
                feedback.textContent = '✗ 顺序不对，请按正确顺序选择';
                feedback.style.color = '#dc2626';
            }
        }
        
        function completePaperCutting(artId) {
            const state = window.paperCuttingState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 20) + 80;
                completeArtGame(artId, score);
            }
        }
        
        // 麒麟舞游戏函数
        function beatQilinDrum(element, drumNumber) {
            const state = window.qilinDanceState;
            if (!state || state.completed) return;
            
            const expectedDrum = state.targetPattern[state.currentBeat];
            const drumName = drumNumber === 1 ? '鼓1' : '鼓2';
            const isCorrect = drumName === expectedDrum;
            
            // 视觉反馈
            element.style.transform = 'scale(0.9)';
            element.style.backgroundColor = isCorrect ? '#fbbf24' : '#fca5a5';
            
            setTimeout(() => {
                element.style.transform = 'scale(1)';
                element.style.backgroundColor = '#fef3c7';
            }, 150);
            
            if (isCorrect) {
                state.drumBeats.push(drumName);
                state.currentBeat++;
                
                // 更新进度
                const progress = (state.currentBeat / state.targetPattern.length) * 100;
                document.getElementById('beatProgressBar').style.width = progress + '%';
                document.getElementById('beatProgress').textContent = `${state.currentBeat}/${state.targetPattern.length}`;
                
                // 反馈信息
                const feedback = document.getElementById('qilinFeedback');
                feedback.textContent = '🎵 节拍正确！麒麟舞动起来...';
                feedback.style.color = '#d97706';
                
                // 检查是否完成
                if (state.currentBeat >= state.targetPattern.length) {
                    state.completed = true;
                    feedback.textContent = '🎉 完美！麒麟舞表演圆满成功！';
                    document.getElementById('qilinComplete').disabled = false;
                    document.getElementById('qilinComplete').className = 'bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                }
            } else {
                // 错误节拍，重置
                state.drumBeats = [];
                state.currentBeat = 0;
                
                document.getElementById('beatProgressBar').style.width = '0%';
                document.getElementById('beatProgress').textContent = '0/5';
                
                const feedback = document.getElementById('qilinFeedback');
                feedback.textContent = '✗ 节拍不对，重新开始';
                feedback.style.color = '#dc2626';
            }
        }
        
        function completeQilinDance(artId) {
            const state = window.qilinDanceState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 20) + 85;
                completeArtGame(artId, score);
            }
        }
        
        // 鱼灯舞游戏函数
        function moveFish(direction) {
            const state = window.fishLanternState;
            if (!state || state.completed) return;
            
            const fishElement = document.getElementById('fishLantern');
            const currentLeft = parseInt(fishElement.style.left) || 8;
            const currentTop = parseInt(fishElement.style.top) || 8;
            
            let newLeft = currentLeft;
            let newTop = currentTop;
            const step = 32; // Grid size
            
            switch (direction) {
                case 'up':
                    newTop = Math.max(8, currentTop - step);
                    break;
                case 'down':
                    newTop = Math.min(160, currentTop + step);
                    break;
                case 'left':
                    newLeft = Math.max(8, currentLeft - step);
                    break;
                case 'right':
                    newLeft = Math.min(264, currentLeft + step);
                    break;
            }
            
            fishElement.style.left = newLeft + 'px';
            fishElement.style.top = newTop + 'px';
            
            // 检查是否靠近灯笼
            checkLanternProximity(newLeft, newTop);
        }
        
        function checkLanternProximity(fishX, fishY) {
            const state = window.fishLanternState;
            const lanternElements = document.querySelectorAll('.lantern');
            
            lanternElements.forEach((lanternEl, index) => {
                if (state.lanterns[index].lit) return;
                
                const lanternRect = lanternEl.getBoundingClientRect();
                const fishRect = document.getElementById('fishLantern').getBoundingClientRect();
                
                const distance = Math.sqrt(
                    Math.pow(lanternRect.left - fishRect.left, 2) + 
                    Math.pow(lanternRect.top - fishRect.top, 2)
                );
                
                if (distance < 50) { // 靠近距离
                    // 点亮灯笼
                    state.lanterns[index].lit = true;
                    state.lanternsLit++;
                    
                    lanternEl.style.backgroundColor = '#fbbf24';
                    lanternEl.style.boxShadow = '0 0 15px #fbbf24';
                    lanternEl.style.transform = 'scale(1.1)';
                    
                    // 更新进度
                    const progress = (state.lanternsLit / state.lanterns.length) * 100;
                    document.getElementById('lanternProgressBar').style.width = progress + '%';
                    document.getElementById('lanternCount').textContent = `${state.lanternsLit}/${state.lanterns.length}`;
                    
                    // 反馈
                    const feedback = document.getElementById('fishFeedback');
                    feedback.textContent = `✨ 点亮了第${state.lanternsLit}个灯笼！`;
                    feedback.style.color = '#2563eb';
                    
                    // 检查是否全部点亮
                    if (state.lanternsLit >= state.lanterns.length) {
                        state.completed = true;
                        feedback.textContent = '🎉 所有灯笼都点亮了！鱼灯舞圆满成功！';
                        document.getElementById('fishComplete').disabled = false;
                        document.getElementById('fishComplete').className = 'bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                    }
                }
            });
        }
          function completeFishLantern(artId) {
            const state = window.fishLanternState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 20) + 82;
                completeArtGame(artId, score);
            }
        }
        
        // 螳螂拳游戏函数
        function demonstrateMove(moveName, element) {
            const state = window.mantisBoxingState;
            if (!state) return;
            
            // 重置所有招式的样式
            document.querySelectorAll('.mantis-move').forEach(move => {
                move.classList.remove('border-green-500', 'bg-green-200');
                move.classList.add('border-green-200', 'bg-green-50');
            });
            
            // 高亮当前选中的招式
            element.classList.remove('border-green-200', 'bg-green-50');
            element.classList.add('border-green-500', 'bg-green-200');
            
            // 显示招式描述
            const descriptionContainer = document.getElementById('moveDescription');
            const descriptionContent = document.getElementById('moveDescriptionContent');
            
            descriptionContent.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">${getMoveMoji(moveName)}</div>
                    <div>
                        <p class="font-bold text-yellow-800">${moveName}</p>
                        <p class="text-yellow-700">${state.moveDescriptions[moveName]}</p>
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-600">
                    💡 ${getMoveDetails(moveName)}
                </div>
            `;
            
            descriptionContainer.classList.remove('hidden');
            
            // 播放动画效果
            element.style.transform = 'scale(1.05)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }
        
        function getMoveMoji(moveName) {
            const mojiMap = {
                '捕蝉': '🦂',
                '勾搂': '🤲', 
                '闪身': '⚡',
                '进退': '🔄'
            };
            return mojiMap[moveName] || '🥋';
        }
        
        function getMoveDetails(moveName) {
            const details = {
                '捕蝉': '模仿螳螂捕食动作，双臂快速前探，手型如螳螂前足',
                '勾搂': '手指弯曲如钩，用于抓握和控制对手的攻击',
                '闪身': '身体侧移闪避，同时准备反击，体现螳螂的敏捷',
                '进退': '步法灵活，前进时迅猛，后退时稳健，保持平衡'
            };
            return details[moveName] || '';
        }
        
        function startMantisPractice() {
            const state = window.mantisBoxingState;
            if (!state) return;
            
            // 隐藏示范阶段，显示练习阶段
            document.getElementById('demonstrationPhase').classList.add('hidden');
            document.getElementById('practicePhase').classList.remove('hidden');
            document.getElementById('startPracticeBtn').classList.add('hidden');
            
            // 重置练习状态
            state.currentMove = 0;
            state.userSequence = [];
            
            // 更新进度显示
            updateMantisPracticeProgress();
        }
        
        function practiceMove(moveName, element) {
            const state = window.mantisBoxingState;
            if (!state || state.completed) return;
            
            const expectedMove = state.moveSequence[state.currentMove];
            const isCorrect = moveName === expectedMove;
            
            if (isCorrect) {
                // 正确的动作
                element.style.backgroundColor = '#10b981';
                element.style.borderColor = '#10b981';
                element.style.color = 'white';
                element.style.transform = 'scale(0.95)';
                
                // 添加成功动画
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '#d1fae5';
                    element.style.borderColor = '#10b981';
                    element.style.color = '#064e3b';
                }, 300);
                
                state.userSequence.push(moveName);
                state.currentMove++;
                
                // 更新反馈
                const feedback = document.getElementById('practiceFeedback');
                feedback.innerHTML = `
                    <div class="text-green-600">
                        ✓ <strong>${moveName}</strong> - 动作标准！继续下一个动作...
                    </div>
                `;
                
                // 检查是否完成一轮
                if (state.currentMove >= state.moveSequence.length) {
                    completeRound();
                }
                
            } else {
                // 错误的动作
                element.style.backgroundColor = '#ef4444';
                element.style.borderColor = '#ef4444';
                element.style.color = 'white';
                element.style.transform = 'scale(1.05)';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '#fee2e2';
                    element.style.borderColor = '#fca5a5';
                    element.style.color = '#7f1d1d';
                }, 300);
                
                // 重置当前轮次
                state.currentMove = 0;
                state.userSequence = [];
                
                // 重置所有元素样式
                resetPracticeMoves();
                
                const feedback = document.getElementById('practiceFeedback');
                feedback.innerHTML = `
                    <div class="text-red-600">
                        ✗ 动作顺序错误！应该是：<strong>${expectedMove}</strong><br>
                        <span class="text-sm">重新开始这一轮练习</span>
                    </div>
                `;
            }
            
            updateMantisPracticeProgress();
        }
        
        function resetPracticeMoves() {
            document.querySelectorAll('.practice-move').forEach(move => {
                move.style.backgroundColor = '#f3f4f6';
                move.style.borderColor = '#d1d5db';
                move.style.color = '#374151';
                move.style.transform = 'scale(1)';
            });
        }
        
        function completeRound() {
            const state = window.mantisBoxingState;
            state.practiceRound++;
            
            const feedback = document.getElementById('practiceFeedback');
            
            if (state.practiceRound > state.maxRounds) {
                // 完成所有轮次
                state.completed = true;
                feedback.innerHTML = `
                    <div class="bg-green-100 border border-green-400 rounded-lg p-3 text-green-800">
                        🎉 <strong>恭喜！你已经掌握了螳螂拳基础套路！</strong><br>
                        <span class="text-sm">连续完成${state.maxRounds}轮练习，武学天赋出众！</span>
                    </div>
                `;
                
                document.getElementById('mantisComplete').disabled = false;
                document.getElementById('mantisComplete').className = 'bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                
            } else {
                // 继续下一轮
                state.currentMove = 0;
                state.userSequence = [];
                resetPracticeMoves();
                
                feedback.innerHTML = `
                    <div class="bg-blue-100 border border-blue-400 rounded-lg p-3 text-blue-800">
                        🥋 第${state.practiceRound - 1}轮完成！开始第${state.practiceRound}轮练习...<br>
                        <span class="text-sm">熟能生巧，继续保持！</span>
                    </div>
                `;
            }
            
            updateMantisPracticeProgress();
        }
        
        function updateMantisPracticeProgress() {
            const state = window.mantisBoxingState;
            if (!state) return;
            
            const overallProgress = ((state.practiceRound - 1) * 4 + state.currentMove) / (state.maxRounds * 4) * 100;
            
            document.getElementById('mantisProgressBar').style.width = overallProgress + '%';
            document.getElementById('practiceRound').textContent = `${state.practiceRound}/${state.maxRounds}`;
        }
          function completeMantisBoxing(artId) {
            const state = window.mantisBoxingState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 15) + 85; // 85-100分
                completeArtGame(artId, score);
            }
        }
        
        // 客家凉帽游戏函数
        function selectHakkaMaterial(element, materialName, isCorrect) {
            const state = window.hakkaHatState;
            if (!state || state.phase !== 'material') return;
            
            if (isCorrect) {
                if (!state.selectedMaterials.includes(materialName)) {
                    state.selectedMaterials.push(materialName);
                    element.style.backgroundColor = '#dcfce7';
                    element.style.borderColor = '#16a34a';
                    element.style.transform = 'scale(0.95)';
                    element.style.pointerEvents = 'none';
                    
                    // 更新反馈
                    const feedback = document.getElementById('materialFeedback');
                    feedback.innerHTML = `<div class="text-green-600">✓ ${materialName} - 选择正确！(${state.selectedMaterials.length}/3)</div>`;
                    
                    // 检查是否选择完所有正确材料
                    if (state.selectedMaterials.length >= state.correctMaterials.length) {
                        feedback.innerHTML = `<div class="text-green-600">🎉 太棒了！所有材料选择正确！</div>`;
                        document.getElementById('nextToColorBtn').classList.remove('hidden');
                        document.getElementById('hatProgressBar').style.width = '33%';
                        document.getElementById('hatProgressText').textContent = '配色阶段';
                    }
                }
            } else {
                // 错误材料
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#dc2626';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 500);
                
                const feedback = document.getElementById('materialFeedback');
                feedback.innerHTML = `<div class="text-red-600">✗ ${materialName} 不适合制作凉帽，请重新选择</div>`;
            }
        }
        
        function startColorPhase() {
            const state = window.hakkaHatState;
            if (!state) return;
            
            state.phase = 'color';
            document.getElementById('materialPhase').classList.add('hidden');
            document.getElementById('colorPhase').classList.remove('hidden');
        }
        
        function selectHatColor(element, colorName, colorClass) {
            const state = window.hakkaHatState;
            if (!state || state.phase !== 'color') return;
            
            // 重置其他颜色选项
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('border-4');
                option.classList.add('border-2');
            });
            
            // 高亮选中的颜色
            element.classList.remove('border-2');
            element.classList.add('border-4');
            
            state.materialColors.selected = colorName;
            state.materialColors.class = colorClass;
            
            // 显示预览
            const preview = document.getElementById('colorPreview');
            const hatPreview = document.getElementById('hatPreview');
            preview.classList.remove('hidden');
            
            const colorMap = {
                'red': '#ef4444',
                'blue': '#3b82f6', 
                'green': '#10b981',
                'yellow': '#f59e0b'
            };
            
            hatPreview.style.backgroundColor = colorMap[colorClass];
            hatPreview.innerHTML = '👒';
            hatPreview.style.display = 'flex';
            hatPreview.style.alignItems = 'center';
            hatPreview.style.justifyContent = 'center';
            hatPreview.style.fontSize = '2rem';
            
            // 反馈
            const feedback = document.getElementById('colorFeedback');
            feedback.innerHTML = `<div class="text-${colorClass}-600">✓ 选择了${colorName}色，很有客家传统韵味！</div>`;
            
            // 显示下一步按钮
            document.getElementById('nextToWeavingBtn').classList.remove('hidden');
            document.getElementById('hatProgressBar').style.width = '66%';
            document.getElementById('hatProgressText').textContent = '编织阶段';
        }
        
        function startWeavingPhase() {
            const state = window.hakkaHatState;
            if (!state) return;
            
            state.phase = 'weaving';
            document.getElementById('colorPhase').classList.add('hidden');
            document.getElementById('weavingPhase').classList.remove('hidden');
            
            updateWeavingStep();
        }
        
        function performWeaving(element, weavingType) {
            const state = window.hakkaHatState;
            if (!state || state.phase !== 'weaving' || state.completed) return;
            
            const expectedWeaving = state.weavingPattern[state.weavingStep];
            const isCorrect = weavingType === expectedWeaving;
            
            if (isCorrect) {
                // 正确编织
                element.style.backgroundColor = '#dcfce7';
                element.style.borderColor = '#16a34a';
                element.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 300);
                
                state.weavingStep++;
                
                // 更新进度
                const weavingProgress = (state.weavingStep / state.weavingPattern.length) * 100;
                document.getElementById('weavingProgressBar').style.width = weavingProgress + '%';
                document.getElementById('weavingStepText').textContent = `${state.weavingStep}/${state.weavingPattern.length}`;
                
                const feedback = document.getElementById('weavingFeedback');
                
                if (state.weavingStep >= state.weavingPattern.length) {
                    // 完成编织
                    state.completed = true;
                    feedback.innerHTML = `
                        <div class="bg-green-100 border border-green-400 rounded-lg p-3 text-green-800">
                            🎉 <strong>恭喜！客家凉帽制作完成！</strong><br>
                            <span class="text-sm">你成功掌握了传统编织工艺！</span>
                        </div>
                    `;
                    
                    document.getElementById('hakkaComplete').disabled = false;
                    document.getElementById('hakkaComplete').className = 'bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                    
                    document.getElementById('hatProgressBar').style.width = '100%';
                    document.getElementById('hatProgressText').textContent = '制作完成';
                    
                } else {
                    feedback.innerHTML = `<div class="text-green-600">✓ ${weavingType} - 编织正确！继续下一步...</div>`;
                    updateWeavingStep();
                }
                
            } else {
                // 错误编织
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#dc2626';
                element.style.transform = 'scale(1.05)';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 300);
                
                const feedback = document.getElementById('weavingFeedback');
                feedback.innerHTML = `<div class="text-red-600">✗ 编织方向错误！应该是：${expectedWeaving}</div>`;
            }
        }
        
        function updateWeavingStep() {
            const state = window.hakkaHatState;
            if (!state) return;
            
            const stepDescriptions = {
                '横编': '横向编织竹篾',
                '竖编': '竖向编织竹篾',
                '收尾': '收尾固定边缘'
            };
            
            const currentStep = state.weavingPattern[state.weavingStep];
            document.getElementById('currentWeavingStep').textContent = stepDescriptions[currentStep] || '编织完成';
        }
          function completeHakkaHat(artId) {
            const state = window.hakkaHatState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 15) + 85; // 85-100分
                completeArtGame(artId, score);
            }
        }
        
        // 海胆粽游戏函数
        function selectIngredient(element, ingredientName) {
            const state = window.seaUrchinZongziState;
            if (!state || state.phase !== 'selection') return;
            
            // 选中食材
            if (!state.ingredients[ingredientName].selected) {
                state.ingredients[ingredientName].selected = true;
                element.style.backgroundColor = '#dbeafe';
                element.style.borderColor = '#3b82f6';
                element.style.transform = 'scale(0.98)';
                
                updateIngredientProgress();
            }
        }
        
        function setQuality(ingredientName, quality) {
            const state = window.seaUrchinZongziState;
            if (!state || state.phase !== 'selection') return;
            
            state.ingredients[ingredientName].quality = quality;
            state.totalQuality = Object.values(state.ingredients).reduce((sum, ingredient) => sum + ingredient.quality, 0);
            
            // 更新星星显示
            const starsContainer = document.querySelector(`[data-ingredient="${ingredientName}"]`);
            const stars = starsContainer.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                if (index < quality) {
                    star.textContent = '⭐';
                    star.style.color = '#fbbf24';
                } else {
                    star.textContent = '☆';
                    star.style.color = '#d1d5db';
                }
            });
            
            updateIngredientProgress();
        }
        
        function updateIngredientProgress() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            const selectedCount = Object.values(state.ingredients).filter(ingredient => ingredient.selected).length;
            const qualityCount = Object.values(state.ingredients).filter(ingredient => ingredient.quality > 0).length;
            
            const feedback = document.getElementById('ingredientFeedback');
            
            if (selectedCount === 4 && qualityCount === 4) {
                const avgQuality = state.totalQuality / 4;
                let qualityText = '';
                
                if (avgQuality >= 2.5) {
                    qualityText = '优质食材，必定香味浓郁！';
                } else if (avgQuality >= 2) {
                    qualityText = '食材品质不错，粽子会很美味！';
                } else {
                    qualityText = '食材一般，但用心制作同样可以成功！';
                }
                
                feedback.innerHTML = `<div class="text-green-600">✓ 所有食材已选择完毕！${qualityText}</div>`;
                document.getElementById('nextToCookingBtn').classList.remove('hidden');
                document.getElementById('zongziProgressBar').style.width = '33%';
                document.getElementById('zongziProgressText').textContent = '制作工序';
            } else {
                feedback.innerHTML = `<div class="text-blue-600">已选择 ${selectedCount}/4 种食材，已评分 ${qualityCount}/4 种</div>`;
            }
        }
        
        function startCookingPhase() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            state.phase = 'cooking';
            document.getElementById('selectionPhase').classList.add('hidden');
            document.getElementById('cookingPhase').classList.remove('hidden');
            
            updateCookingStep();
        }
        
        function updateCookingStep() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            const stepDescriptions = {
                '清洗海胆': '轻柔地清洗海胆，保持其完整性和鲜味',
                '浸泡糯米': '糯米需要浸泡2-3小时，使其充分吸水',
                '粽叶包馅': '将糯米和海胆包入粽叶，手法要熟练',
                '绳子捆扎': '用棉绳紧密捆扎，确保不会散开',
                '下锅蒸煮': '大火煮开后转小火，蒸煮1-2小时'
            };
            
            const stepEmojis = {
                '清洗海胆': '🦔💧',
                '浸泡糯米': '🌾💧',
                '粽叶包馅': '🍃🍙',
                '绳子捆扎': '🪢🔗',
                '下锅蒸煮': '🔥🍲'
            };
            
            const currentStepName = state.cookingSteps[state.currentStep];
            document.getElementById('currentCookingStep').textContent = currentStepName;
            document.getElementById('stepInstruction').textContent = stepDescriptions[currentStepName];
            document.getElementById('stepVisualization').textContent = stepEmojis[currentStepName];
            document.getElementById('stepAnimation').textContent = `正在执行：${currentStepName}`;
            
            // 更新步骤进度
            document.getElementById('cookingStepText').textContent = `${state.currentStep + 1}/${state.cookingSteps.length}`;
        }
        
        function performCookingStep() {
            const state = window.seaUrchinZongziState;
            if (!state || state.phase !== 'cooking') return;
            
            // 执行当前步骤
            const stepProgress = ((state.currentStep + 1) / state.cookingSteps.length) * 100;
            document.getElementById('cookingStepBar').style.width = stepProgress + '%';
            
            const feedback = document.getElementById('cookingFeedback');
            const currentStepName = state.cookingSteps[state.currentStep];
            
            // 添加动画效果
            const visualization = document.getElementById('stepVisualization');
            visualization.style.transform = 'scale(1.2)';
            setTimeout(() => {
                visualization.style.transform = 'scale(1)';
            }, 300);
            
            feedback.innerHTML = `<div class="text-green-600">✓ ${currentStepName} - 完成！</div>`;
            
            state.currentStep++;
            
            if (state.currentStep >= state.cookingSteps.length) {
                // 完成所有制作步骤
                state.phase = 'tasting';
                document.getElementById('cookingPhase').classList.add('hidden');
                document.getElementById('tastingPhase').classList.remove('hidden');
                
                // 计算最终评分
                calculateFinalScore();
                
                document.getElementById('zongziProgressBar').style.width = '100%';
                document.getElementById('zongziProgressText').textContent = '制作完成';
                
            } else {
                // 继续下一步
                setTimeout(() => {
                    updateCookingStep();
                    feedback.innerHTML = `<div class="text-blue-600">准备下一步骤...</div>`;
                }, 1000);
            }
        }
        
        function calculateFinalScore() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            const avgQuality = state.totalQuality / 4;
            const baseScore = 70;
            const qualityBonus = avgQuality * 10;
            const finalScore = Math.min(100, baseScore + qualityBonus);
            
            // 显示评分
            document.getElementById('finalScore').innerHTML = `
                <p class="mb-2">食材品质平均分：${avgQuality.toFixed(1)}/3 ⭐</p>
                <p>最终得分：<span class="text-orange-600 font-bold text-lg">${finalScore.toFixed(0)}/100</span></p>
            `;
            
            // 口感和技艺评价
            const tasteStars = '⭐'.repeat(Math.floor(avgQuality)) + '☆'.repeat(3 - Math.floor(avgQuality));
            const skillStars = '⭐'.repeat(Math.floor(finalScore / 25)) + '☆'.repeat(4 - Math.floor(finalScore / 25));
            
            document.getElementById('tasteRating').textContent = tasteStars;
            document.getElementById('skillRating').textContent = skillStars;
            
            // 反馈文字
            let feedback = '';
            if (finalScore >= 90) {
                feedback = '🎉 完美！你制作的海胆粽鲜美无比，堪比大鹏渔民的手艺！';
            } else if (finalScore >= 80) {
                feedback = '👍 很棒！海胆粽味道很好，已经掌握了基本制作要领！';
            } else {
                feedback = '💪 不错！虽然还有改进空间，但你已经体验了传统制作工艺！';
            }
            
            document.getElementById('tastingFeedback').innerHTML = `<div class="text-orange-600">${feedback}</div>`;
            
            // 启用完成按钮
            state.completed = true;
            document.getElementById('zongziComplete').disabled = false;
            document.getElementById('zongziComplete').className = 'bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
        }
          function completeSeaUrchinZongzi(artId) {
            const state = window.seaUrchinZongziState;
            if (state && state.completed) {
                const avgQuality = state.totalQuality / 4;
                const score = Math.min(100, 70 + avgQuality * 10);
                completeArtGame(artId, Math.floor(score));
            }
        }
        
        // 版画游戏函数
        function selectPrintTool(element, toolName, isCorrect) {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'tools') return;
            
            if (isCorrect) {
                if (!state.selectedTools.includes(toolName)) {
                    state.selectedTools.push(toolName);
                    element.style.backgroundColor = '#dcfce7';
                    element.style.borderColor = '#16a34a';
                    element.style.transform = 'scale(0.95)';
                    element.style.pointerEvents = 'none';
                    
                    // 更新反馈
                    const feedback = document.getElementById('toolFeedback');
                    feedback.innerHTML = `<div class="text-green-600">✓ ${toolName} - 选择正确！(${state.selectedTools.length}/3)</div>`;
                    
                    // 检查是否选择完所有正确工具
                    if (state.selectedTools.length >= state.correctTools.length) {
                        feedback.innerHTML = `<div class="text-green-600">🎉 太棒了！所有工具选择正确！</div>`;
                        document.getElementById('nextToCarvingBtn').classList.remove('hidden');
                        document.getElementById('printProgressBar').style.width = '25%';
                        document.getElementById('printProgressText').textContent = '雕刻图案';
                    }
                }
            } else {
                // 错误工具
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#dc2626';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 500);
                
                const feedback = document.getElementById('toolFeedback');
                feedback.innerHTML = `<div class="text-red-600">✗ ${toolName} 不适合版画制作，请重新选择</div>`;
            }
        }
        
        function startCarvingPhase() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            state.phase = 'carving';
            document.getElementById('toolsPhase').classList.add('hidden');
            document.getElementById('carvingPhase').classList.remove('hidden');
            
            // 生成目标图案和玩家图案
            generateCarvingPatterns();
        }
        
        function generateCarvingPatterns() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            // 生成目标图案
            const targetContainer = document.getElementById('targetPattern');
            targetContainer.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = `w-6 h-6 border border-gray-300 ${state.carvingPattern[i][j] ? 'bg-gray-800' : 'bg-gray-100'}`;
                    targetContainer.appendChild(cell);
                }
            }
            
            // 生成玩家图案（可点击）
            const playerContainer = document.getElementById('playerPattern');
            playerContainer.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'w-6 h-6 border border-gray-300 bg-gray-100 cursor-pointer hover:bg-gray-200 transition-colors';
                    cell.onclick = () => toggleCarvingCell(i, j, cell);
                    playerContainer.appendChild(cell);
                }
            }
        }
        
        function toggleCarvingCell(row, col, element) {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'carving') return;
            
            // 切换雕刻状态
            state.playerPattern[row][col] = state.playerPattern[row][col] ? 0 : 1;
            
            // 更新视觉效果
            if (state.playerPattern[row][col]) {
                element.className = 'w-6 h-6 border border-gray-300 bg-gray-800 cursor-pointer transition-colors';
            } else {
                element.className = 'w-6 h-6 border border-gray-300 bg-gray-100 cursor-pointer hover:bg-gray-200 transition-colors';
            }
            
            // 检查匹配度
            checkCarvingMatch();
        }
        
        function checkCarvingMatch() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            let matches = 0;
            let total = 0;
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    total++;
                    if (state.playerPattern[i][j] === state.carvingPattern[i][j]) {
                        matches++;
                    }
                }
            }
            
            const accuracy = (matches / total) * 100;
            const feedback = document.getElementById('carvingFeedback');
            
            if (accuracy >= 80) {
                feedback.innerHTML = `<div class="text-green-600">🎉 雕刻精美！匹配度：${accuracy.toFixed(0)}%</div>`;
                document.getElementById('nextToInkingBtn').classList.remove('hidden');
                document.getElementById('printProgressBar').style.width = '50%';
                document.getElementById('printProgressText').textContent = '选择墨色';
            } else if (accuracy >= 60) {
                feedback.innerHTML = `<div class="text-yellow-600">👍 不错！继续雕刻，匹配度：${accuracy.toFixed(0)}%</div>`;
            } else {
                feedback.innerHTML = `<div class="text-blue-600">继续雕刻，匹配度：${accuracy.toFixed(0)}%（需要80%以上）</div>`;
            }
        }
        
        function startInkingPhase() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            state.phase = 'inking';
            document.getElementById('carvingPhase').classList.add('hidden');
            document.getElementById('inkingPhase').classList.remove('hidden');
        }
        
        function selectInkColor(element, colorName) {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'inking') return;
            
            // 重置其他颜色选项
            document.querySelectorAll('.ink-option').forEach(option => {
                option.classList.remove('border-4');
                option.classList.add('border-2');
            });
            
            // 高亮选中的颜色
            element.classList.remove('border-2');
            element.classList.add('border-4');
            
            state.selectedInk = colorName;
            
            // 反馈
            const feedback = document.getElementById('inkFeedback');
            feedback.innerHTML = `<div class="text-indigo-600">✓ 选择了${colorName}墨，古朴雅致！</div>`;
            
            // 显示下一步按钮
            document.getElementById('nextToPrintingBtn').classList.remove('hidden');
            document.getElementById('printProgressBar').style.width = '75%';
            document.getElementById('printProgressText').textContent = '印制作品';
        }
        
        function startPrintingPhase() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            state.phase = 'printing';
            document.getElementById('inkingPhase').classList.add('hidden');
            document.getElementById('printingPhase').classList.remove('hidden');
            
            // 生成最终打印预览
            generatePrintPreview();
        }
        
        function generatePrintPreview() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            const printContainer = document.getElementById('finalPrint');
            printContainer.innerHTML = '';
            
            const colorMap = {
                '黑色': 'bg-gray-800',
                '红色': 'bg-red-600',
                '蓝色': 'bg-blue-600'
            };
            
            const selectedColor = colorMap[state.selectedInk] || 'bg-gray-800';
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = `w-6 h-6 border border-gray-300 ${
                        state.playerPattern[i][j] ? selectedColor : 'bg-white'
                    }`;
                    printContainer.appendChild(cell);
                }
            }
        }
        
        function performPrinting() {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'printing') return;
            
            // 打印动画效果
            const printBtn = document.getElementById('performPrintBtn');
            printBtn.style.transform = 'scale(0.95)';
            printBtn.disabled = true;
            
            setTimeout(() => {
                printBtn.style.transform = 'scale(1)';
                
                // 计算打印质量
                let matches = 0;
                let total = 0;
                
                for (let i = 0; i < 6; i++) {
                    for (let j = 0; j < 8; j++) {
                        total++;
                        if (state.playerPattern[i][j] === state.carvingPattern[i][j]) {
                            matches++;
                        }
                    }
                }
                
                state.printQuality = (matches / total) * 100;
                state.completed = true;
                
                const feedback = document.getElementById('printingFeedback');
                
                if (state.printQuality >= 80) {
                    feedback.innerHTML = `
                        <div class="bg-green-100 border border-green-400 rounded-lg p-3 text-green-800">
                            🎉 <strong>印制成功！版画作品精美绝伦！</strong><br>
                            <span class="text-sm">图案匹配度：${state.printQuality.toFixed(0)}%</span>
                        </div>
                    `;
                } else {
                    feedback.innerHTML = `
                        <div class="bg-blue-100 border border-blue-400 rounded-lg p-3 text-blue-800">
                            👍 <strong>印制完成！虽有瑕疵，但已是不错的作品！</strong><br>
                            <span class="text-sm">图案匹配度：${state.printQuality.toFixed(0)}%</span>
                        </div>
                    `;
                }
                
                document.getElementById('printComplete').disabled = false;
                document.getElementById('printComplete').className = 'bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                
                document.getElementById('printProgressBar').style.width = '100%';
                document.getElementById('printProgressText').textContent = '作品完成';
                
            }, 500);
        }
        
        function completePrintGame(artId) {
            const state = window.woodblockPrintState;
            if (state && state.completed) {
                const score = Math.min(100, 60 + state.printQuality * 0.4);
                completeArtGame(artId, Math.floor(score));
            }
        }
        
        
    </script>
</body>
</html>
