<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¼€å‘è€…æ§åˆ¶å° - DevConsole</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <script src="https://cdn.keepwork.com/sdk/keepworkSDK.iife.js?v=1.0.3"></script>
    <style>
      body {
        font-family: "JetBrains Mono", "Consolas", "Monaco", "Courier New", monospace;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        overflow-x: hidden;
      }

      .console-container {
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid #333;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      }

      .console-header {
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
        padding: 8px 16px;
        border-radius: 7px 7px 0 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .console-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }

      .console-output {
        height: 300px;
        overflow-y: auto;
        background: #1a1a1a;
        font-size: 12px;
        line-height: 1.4;
      }

      .console-input {
        background: #2a2a2a;
        border: none;
        color: #00ff00;
        padding: 8px;
        width: 100%;
        font-family: inherit;
        font-size: 12px;
      }

      .console-input:focus {
        outline: none;
        background: #333;
      }

      .log-entry {
        padding: 4px 8px;
        border-bottom: 1px solid #333;
      }

      .log-info {
        color: #00ff00;
      }
      .log-warn {
        color: #ffaa00;
      }
      .log-error {
        color: #ff4444;
      }
      .log-debug {
        color: #8888ff;
      }

      .dev-button {
        background: linear-gradient(45deg, #667eea, #764ba2);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 12px;
        margin: 4px;
      }

      .dev-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .dev-button.danger {
        background: linear-gradient(45deg, #ff6b6b, #ff4757);
      }

      .dev-button.success {
        background: linear-gradient(45deg, #2ed573, #1e90ff);
      }

      .dev-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 16px;
        margin: 8px 0;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .dev-section h3 {
        color: #4ecdc4;
        margin-bottom: 12px;
        font-size: 16px;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .info-label {
        color: #aaa;
        font-size: 12px;
      }

      .info-value {
        color: #fff;
        font-family: "Courier New", monospace;
        font-size: 11px;
        background: rgba(0, 0, 0, 0.3);
        padding: 4px 8px;
        border-radius: 4px;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        backdrop-filter: blur(5px);
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #1a1a2e;
        border-radius: 12px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        border: 1px solid #333;
      }

      .task-item {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #444;
        border-radius: 6px;
        padding: 12px;
        margin: 8px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .task-completed {
        opacity: 0.6;
        text-decoration: line-through;
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }

      .status-online {
        background: #00ff00;
      }
      .status-offline {
        background: #ff4444;
      }
      .status-loading {
        background: #ffaa00;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .json-viewer {
        background: #000;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 12px;
        font-family: "Courier New", monospace;
        font-size: 11px;
        color: #00ff00;
        max-height: 200px;
        overflow: auto;
        white-space: pre-wrap;
      }

      .tabs {
        display: flex;
        border-bottom: 1px solid #333;
        margin-bottom: 16px;
      }

      .tab {
        padding: 8px 16px;
        background: rgba(0, 0, 0, 0.3);
        border: none;
        color: #aaa;
        cursor: pointer;
        border-bottom: 2px solid transparent;
      }

      .tab.active {
        color: #4ecdc4;
        border-bottom-color: #4ecdc4;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }
    </style>
  </head>
  <body class="min-h-screen text-white p-4">
    <div class="max-w-7xl w-full">
      <!-- Header -->
      <div class="text-center mb-4">
        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">ğŸ› ï¸ã€Šéº¦æ€æ˜Ÿçƒã€‹å¼€å‘è€…æ§åˆ¶å°</h1>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('system')">ç³»ç»Ÿä¿¡æ¯</button>
        <button class="tab" onclick="switchTab('user')">ç”¨æˆ·ç®¡ç†</button>
        <button class="tab" onclick="switchTab('tasks')">ä»»åŠ¡ç®¡ç†</button>
        <button class="tab" onclick="switchTab('storage')">å­˜å‚¨ç®¡ç†</button>
        <button class="tab" onclick="switchTab('console')">æ§åˆ¶å°</button>
        <button class="tab" onclick="switchTab('tools')">å¼€å‘å·¥å…·</button>
      </div>

      <!-- System Info Tab -->
      <div id="tab-system" class="tab-content active">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="dev-section">
            <h3>ğŸ–¥ï¸ ç³»ç»ŸçŠ¶æ€</h3>
            <div class="info-item">
              <span class="info-label">SDKçŠ¶æ€</span>
              <span class="info-value">
                <span id="sdk-status" class="status-indicator status-loading"></span>
                <span id="sdk-status-text">æ£€æµ‹ä¸­...</span>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">å½“å‰æ—¶é—´</span>
              <span class="info-value" id="current-time">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">æµè§ˆå™¨</span>
              <span class="info-value" id="browser-info">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">å±å¹•åˆ†è¾¨ç‡</span>
              <span class="info-value" id="screen-info">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">ç½‘ç»œçŠ¶æ€</span>
              <span class="info-value" id="network-status">--</span>
            </div>
          </div>

          <div class="dev-section">
            <h3>ğŸŒ ç¯å¢ƒä¿¡æ¯</h3>
            <div class="info-item">
              <span class="info-label">å½“å‰åŸŸå</span>
              <span class="info-value" id="current-domain">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">åè®®</span>
              <span class="info-value" id="protocol">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">ç”¨æˆ·ä»£ç†</span>
              <span class="info-value" id="user-agent">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">è¯­è¨€</span>
              <span class="info-value" id="language">--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- User Management Tab -->
      <div id="tab-user" class="tab-content">
        <div class="dev-section">
          <h3>ğŸ‘¤ å½“å‰ç”¨æˆ·ä¿¡æ¯</h3>
          <div class="info-item">
            <span class="info-label">ç”¨æˆ·ID</span>
            <span class="info-value" id="user-id">--</span>
          </div>
          <div class="info-item">
            <span class="info-label">ç”¨æˆ·å</span>
            <span class="info-value" id="username">--</span>
          </div>
          <div class="info-item">
            <span class="info-label">è®¤è¯Token</span>
            <div class="flex items-center gap-2">
              <span class="info-value" id="auth-token" style="max-width: none; white-space: break-all; word-break: break-all">--</span>
              <button class="dev-button" onclick="copyToken()" title="å¤åˆ¶Token">ğŸ“‹</button>
            </div>
          </div>
          <div class="info-item">
            <span class="info-label">ç™»å½•çŠ¶æ€</span>
            <span class="info-value" id="login-status">--</span>
          </div>
          <div class="mt-4">
            <button class="dev-button" onclick="refreshUserInfo()">ğŸ”„ åˆ·æ–°ç”¨æˆ·ä¿¡æ¯</button>
            <button class="dev-button danger" onclick="clearUserSession()">ğŸšª æ¸…é™¤ä¼šè¯</button>
            <button class="dev-button" onclick="showUserProfile()">ğŸ“‹ æŸ¥çœ‹å®Œæ•´èµ„æ–™</button>
          </div>
        </div>
        <div class="dev-section">
          <h3>ğŸ® MiniGame Proxy æ•°æ®</h3>
          <div class="info-item">
            <span class="info-label">æ•°æ®çŠ¶æ€</span>
            <span class="info-value" id="proxy-data-status">--</span>
          </div>
          <div class="mt-4">
            <button class="dev-button" onclick="refreshProxyData()">ğŸ”„ åˆ·æ–°ä»£ç†æ•°æ®</button>
            <button class="dev-button" onclick="showProxyData()">ğŸ“‹ æŸ¥çœ‹å®Œæ•´æ•°æ®</button>
          </div>
          <div class="mt-4">
            <label class="block text-sm text-gray-400 mb-2">åŸå§‹ä»£ç†æ•°æ® (miniGameProxyDataResponse):</label>
            <div id="proxy-data-raw" class="json-viewer" style="min-height: 100px; max-height: 300px">æš‚æ— æ•°æ®</div>
          </div>
          <div id="proxy-data-viewer" class="json-viewer mt-4" style="display: none"></div>
        </div>
      </div>
      <!-- Task Management Tab -->
      <div id="tab-tasks" class="tab-content">
        <div class="dev-section">
          <h3>ğŸ“‹ ä»»åŠ¡ç®¡ç†</h3>
          <div class="mb-4">
            <button class="dev-button" onclick="refreshTaskData()">ğŸ”„ åˆ·æ–°ä»»åŠ¡æ•°æ®</button>
            <button class="dev-button" onclick="editTaskData()">âœï¸ ç¼–è¾‘ä»»åŠ¡æ•°æ®</button>
            <button class="dev-button danger" onclick="resetAllTasks()">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰ä»»åŠ¡</button>
          </div>
          <!-- Task Data Display -->
          <div class="dev-section">
            <h4 class="text-lg mb-3 text-green-400">âœ… å·²å®Œæˆä»»åŠ¡</h4>
            <div class="info-item">
              <span class="info-label">ä»»åŠ¡æ€»æ•°</span>
              <span class="info-value" id="completed-tasks-count">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">æ•°æ®çŠ¶æ€</span>
              <span class="info-value" id="completed-tasks-status">æœªåŠ è½½</span>
            </div>
            <div id="completed-tasks-viewer" class="json-viewer mt-4" style="max-height: 300px; overflow-y: auto">ç‚¹å‡»"ä»SDKåŠ è½½ä»»åŠ¡"æŸ¥çœ‹å·²å®Œæˆä»»åŠ¡æ•°æ®</div>
          </div>

          <div class="dev-section">
            <h4 class="text-lg mb-3 text-blue-400">ğŸ“ å·²æ¥å—ä»»åŠ¡</h4>
            <div class="info-item">
              <span class="info-label">ä»»åŠ¡æ€»æ•°</span>
              <span class="info-value" id="accepted-tasks-count">--</span>
            </div>
            <div class="info-item">
              <span class="info-label">æ•°æ®çŠ¶æ€</span>
              <span class="info-value" id="accepted-tasks-status">æœªåŠ è½½</span>
            </div>
            <div id="accepted-tasks-viewer" class="json-viewer mt-4" style="max-height: 300px; overflow-y: auto">ç‚¹å‡»"ä»SDKåŠ è½½ä»»åŠ¡"æŸ¥çœ‹å·²æ¥å—ä»»åŠ¡æ•°æ®</div>
          </div>
          <!-- Simple Task Overview -->
          <div class="dev-section">
            <h4 class="text-lg mb-3 text-yellow-400">ğŸ“Š ä»»åŠ¡æ¦‚è§ˆ</h4>
            <div id="tasks-container" class="json-viewer" style="min-height: 100px">
              <p class="text-gray-400">ç‚¹å‡»"ä»SDKåŠ è½½ä»»åŠ¡"æŸ¥çœ‹å½“å‰ä»»åŠ¡æ¦‚è§ˆ</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Storage Management Tab -->
      <div id="tab-storage" class="tab-content">
        <div class="dev-section">
          <h3>ğŸ’¾ å­˜å‚¨ç®¡ç†</h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <h4 class="text-lg mb-3 text-blue-400">LocalStorage</h4>
              <div class="mb-4">
                <button class="dev-button" onclick="showLocalStorage()">ğŸ“– æŸ¥çœ‹å­˜å‚¨</button>
                <button class="dev-button danger" onclick="clearLocalStorage()">ğŸ—‘ï¸ æ¸…ç©ºå­˜å‚¨</button>
              </div>
              <div id="localStorage-viewer" class="json-viewer" style="display: none"></div>
            </div>
            <div>
              <h4 class="text-lg mb-3 text-purple-400">SessionStorage</h4>
              <div class="mb-4">
                <button class="dev-button" onclick="showSessionStorage()">ğŸ“– æŸ¥çœ‹å­˜å‚¨</button>
                <button class="dev-button danger" onclick="clearSessionStorage()">ğŸ—‘ï¸ æ¸…ç©ºå­˜å‚¨</button>
              </div>
              <div id="sessionStorage-viewer" class="json-viewer" style="display: none"></div>
            </div>
          </div>
          <div class="mt-6">
            <h4 class="text-lg mb-3 text-green-400">Cookieç®¡ç†</h4>
            <button class="dev-button" onclick="showCookies()">ğŸª æŸ¥çœ‹Cookies</button>
            <button class="dev-button danger" onclick="clearCookies()">ğŸ—‘ï¸ æ¸…ç©ºCookies</button>
            <div id="cookies-viewer" class="json-viewer mt-4" style="display: none"></div>
          </div>
        </div>
      </div>

      <!-- Console Tab -->
      <div id="tab-console" class="tab-content">
        <div class="dev-section">
          <h3>ğŸ–¥ï¸ å¼€å‘è€…æ§åˆ¶å°</h3>
          <div class="console-container">
            <div class="console-header">
              <div class="console-dot bg-red-500"></div>
              <div class="console-dot bg-yellow-500"></div>
              <div class="console-dot bg-green-500"></div>
              <span class="text-black font-semibold ml-2">DevConsole</span>
              <div class="ml-auto">
                <button class="dev-button" onclick="clearConsole()">æ¸…ç©º</button>
                <button class="dev-button" onclick="openChromeConsole()">æ‰“å¼€Chromeæ§åˆ¶å°</button>
              </div>
            </div>
            <div id="console-output" class="console-output">
              <div class="log-entry log-info"><span class="text-gray-500">[INFO]</span> å¼€å‘è€…æ§åˆ¶å°å·²å¯åŠ¨</div>
            </div>
            <input type="text" id="console-input" class="console-input" placeholder="è¾“å…¥JavaScriptå‘½ä»¤..." />
          </div>
        </div>
      </div>

      <!-- Tools Tab -->
      <div id="tab-tools" class="tab-content">
        <div class="dev-section">
          <h3>ğŸ› ï¸ å¼€å‘å·¥å…·</h3>
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <button class="dev-button" onclick="testSDKConnection()">ğŸ”— æµ‹è¯•SDKè¿æ¥</button>
            <button class="dev-button" onclick="generateTestData()">ğŸ“Š ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
            <button class="dev-button" onclick="exportLogs()">ğŸ“¤ å¯¼å‡ºæ—¥å¿—</button>
            <button class="dev-button" onclick="performanceCheck()">âš¡ æ€§èƒ½æ£€æµ‹</button>
            <button class="dev-button" onclick="networkDiagnostic()">ğŸŒ ç½‘ç»œè¯Šæ–­</button>
            <button class="dev-button" onclick="memoryUsage()">ğŸ’¾ å†…å­˜ä½¿ç”¨</button>
            <button class="dev-button" onclick="resetAll()">ğŸ”„ é‡ç½®æ‰€æœ‰</button>
            <button class="dev-button danger" onclick="emergencyMode()">ğŸš¨ ç´§æ€¥æ¨¡å¼</button>
          </div>

          <div class="mt-6">
            <h4 class="text-lg mb-3 text-yellow-400">å¿«é€Ÿæ“ä½œ</h4>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-gray-400 mb-2">å¿«é€Ÿè®¾ç½®ç”¨æˆ·ID:</label>
                <div class="flex gap-2">
                  <input type="text" id="quick-user-id" class="console-input flex-1" placeholder="è¾“å…¥ç”¨æˆ·ID" />
                  <button class="dev-button" onclick="setQuickUserId()">è®¾ç½®</button>
                </div>
              </div>
              <div>
                <label class="block text-sm text-gray-400 mb-2">å¿«é€Ÿæ‰§è¡Œ:</label>
                <div class="flex gap-2">
                  <select id="quick-actions" class="console-input flex-1">
                    <option value="">é€‰æ‹©å¿«é€Ÿæ“ä½œ...</option>
                    <option value="reload">é‡æ–°åŠ è½½é¡µé¢</option>
                    <option value="fullscreen">è¿›å…¥å…¨å±</option>
                    <option value="mobile-view">ç§»åŠ¨ç«¯è§†å›¾</option>
                    <option value="debug-mode">è°ƒè¯•æ¨¡å¼</option>
                  </select>
                  <button class="dev-button" onclick="executeQuickAction()">æ‰§è¡Œ</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal for detailed views -->
    <div id="detail-modal" class="modal">
      <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
          <h3 id="modal-title" class="text-xl font-bold text-blue-400">è¯¦ç»†ä¿¡æ¯</h3>
          <button class="dev-button" onclick="closeModal()">âœ•</button>
        </div>
        <div id="modal-body" class="json-viewer">
          <!-- Dynamic content -->
        </div>
      </div>
    </div>

    <!-- Modal for editing tasks -->
    <div id="edit-task-modal" class="modal">
      <div class="modal-content" style="max-width: 800px">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-blue-400">ç¼–è¾‘ä»»åŠ¡æ•°æ®</h3>
          <button class="dev-button" onclick="closeEditTaskModal()">âœ•</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Completed Tasks Editor -->
          <div>
            <h4 class="text-lg mb-3 text-green-400">âœ… å·²å®Œæˆä»»åŠ¡</h4>
            <textarea id="completed-tasks-editor" class="console-input w-full h-64 resize-none font-mono text-sm" placeholder="è¯·è¾“å…¥JSONæ ¼å¼çš„å·²å®Œæˆä»»åŠ¡æ•°æ®"></textarea>
            <div class="mt-2">
              <button class="dev-button success" onclick="saveCompletedTasks()">ğŸ’¾ ä¿å­˜å·²å®Œæˆä»»åŠ¡</button>
              <button class="dev-button danger" onclick="clearCompletedTasks()">ğŸ—‘ï¸ æ¸…ç©ºå·²å®Œæˆä»»åŠ¡</button>
            </div>
          </div>

          <!-- Accepted Tasks Editor -->
          <div>
            <h4 class="text-lg mb-3 text-blue-400">ğŸ“ å·²æ¥å—ä»»åŠ¡</h4>
            <textarea id="accepted-tasks-editor" class="console-input w-full h-64 resize-none font-mono text-sm" placeholder="è¯·è¾“å…¥JSONæ ¼å¼çš„å·²æ¥å—ä»»åŠ¡æ•°æ®"></textarea>
            <div class="mt-2">
              <button class="dev-button success" onclick="saveAcceptedTasks()">ğŸ’¾ ä¿å­˜å·²æ¥å—ä»»åŠ¡</button>
              <button class="dev-button danger" onclick="clearAcceptedTasks()">ğŸ—‘ï¸ æ¸…ç©ºå·²æ¥å—ä»»åŠ¡</button>
            </div>
          </div>
        </div>

        <div class="mt-6 pt-4 border-t border-gray-600">
          <div class="flex justify-between">
            <button class="dev-button" onclick="resetTaskEditorsToOriginal()">ğŸ”„ é‡ç½®ä¸ºåŸå§‹æ•°æ®</button>
            <div>
              <button class="dev-button success" onclick="saveAllTaskData()">ğŸ’¾ ä¿å­˜å…¨éƒ¨</button>
              <button class="dev-button" onclick="closeEditTaskModal()">å–æ¶ˆ</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Initialize SDK
      const sdk = new KeepworkSDK({
        timeout: 30000,
      });
      console.log(`Keepwork SDK initialized token: ${sdk.token}`); // Global variables
      let devConsole = {
        logs: [],
        userInfo: {},
        tasks: [], // Legacy task array
        completedTasks: {}, // SDK: dragon.taskCompleted
        acceptedTasks: {}, // SDK: dragon.taskAccepted
        isSDKReady: false,
        miniGameProxyData: null,
        tasksLoaded: false, // Flag to track if tasks have been loaded
      }; // Initialize on page load      // Tab switching
      function switchTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });

        // Remove active class from all tabs
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected tab content
        document.getElementById(`tab-${tabName}`).classList.add("active");

        // Add active class to clicked tab
        event.target.classList.add("active");

        // Auto-load tasks when switching to tasks tab
        if (tabName === "tasks" && !devConsole.tasksLoaded && devConsole.isSDKReady) {
          log("è‡ªåŠ¨åŠ è½½ä»»åŠ¡æ•°æ®...", "info");
          loadTasksFromSDK();
        }
      } // Initialize dev console
      function initDevConsole() {
        log("æ­£åœ¨åˆå§‹åŒ–å¼€å‘è€…æ§åˆ¶å°...", "info");

        // Check if running in iframe
        if (window.parent !== window) {
          log("æ£€æµ‹åˆ°iframeç¯å¢ƒ", "warn");
        }

        // Check KeepWork SDK
        if (typeof KeepworkSDK !== "undefined" && sdk) {
          log("KeepWork SDKå·²åŠ è½½", "success");
          devConsole.isSDKReady = true;
          initSDK();
        } else {
          log("KeepWork SDKæœªæ‰¾åˆ°", "error");
        }
      } // Initialize SDK
      async function initSDK() {
        try {
          // Try to get user info
          const userInfo = await sdk.getUserProfile();
          if (userInfo) {
            devConsole.userInfo = userInfo;
            updateUserInfo();
            log("ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ", "success");
          }
        } catch (error) {
          log(`SDKåˆå§‹åŒ–å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Update system information
      function updateSystemInfo() {
        // Browser info
        document.getElementById("browser-info").textContent = getBrowserInfo();
        document.getElementById("screen-info").textContent = `${screen.width}x${screen.height}`;
        document.getElementById("current-domain").textContent = window.location.hostname;
        document.getElementById("protocol").textContent = window.location.protocol;
        document.getElementById("user-agent").textContent = navigator.userAgent;
        document.getElementById("language").textContent = navigator.language;

        // Network status
        updateNetworkStatus();
      }

      // Update time
      function updateTime() {
        const now = new Date();
        document.getElementById("current-time").textContent = now.toLocaleString("zh-CN");
      }

      // Get browser info
      function getBrowserInfo() {
        const ua = navigator.userAgent;
        if (ua.includes("Chrome")) return "Chrome";
        if (ua.includes("Firefox")) return "Firefox";
        if (ua.includes("Safari")) return "Safari";
        if (ua.includes("Edge")) return "Edge";
        return "Unknown";
      }

      // Update network status
      function updateNetworkStatus() {
        const status = navigator.onLine ? "åœ¨çº¿" : "ç¦»çº¿";
        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        let info = status;

        if (connection) {
          info += ` (${connection.effectiveType || "unknown"})`;
        }

        document.getElementById("network-status").textContent = info;
      } // Check SDK status
      function checkSDKStatus() {
        const statusEl = document.getElementById("sdk-status");
        const textEl = document.getElementById("sdk-status-text");

        if (typeof KeepworkSDK !== "undefined" && sdk) {
          statusEl.className = "status-indicator status-online";
          textEl.textContent = "å·²è¿æ¥";
        } else {
          statusEl.className = "status-indicator status-offline";
          textEl.textContent = "æœªè¿æ¥";
        }
      }

      // Update user info display
      function updateUserInfo() {
        const userInfo = devConsole.userInfo;
        document.getElementById("user-id").textContent = userInfo.id || "æœªçŸ¥";
        document.getElementById("username").textContent = userInfo.username || "æœªçŸ¥";
        document.getElementById("auth-token").textContent = sdk.token ? sdk.token : "æ— ";
        document.getElementById("login-status").textContent = userInfo.id ? "å·²ç™»å½•" : "æœªç™»å½•";
      } // Refresh user information
      async function refreshUserInfo() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ª", "error");
          return;
        }

        try {
          log("æ­£åœ¨åˆ·æ–°ç”¨æˆ·ä¿¡æ¯...", "info");
          const userInfo = await sdk.getUserProfile();
          devConsole.userInfo = userInfo;
          updateUserInfo();
          log("ç”¨æˆ·ä¿¡æ¯åˆ·æ–°æˆåŠŸ", "success");
        } catch (error) {
          log(`åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Clear user session
      function clearUserSession() {
        if (confirm("ç¡®å®šè¦æ¸…é™¤ç”¨æˆ·ä¼šè¯å—ï¼Ÿ")) {
          localStorage.removeItem("token");
          sessionStorage.clear();
          devConsole.userInfo = {};
          updateUserInfo();
          log("ç”¨æˆ·ä¼šè¯å·²æ¸…é™¤", "warn");
        }
      }

      // Show user profile in modal
      function showUserProfile() {
        const modalTitle = document.getElementById("modal-title");
        const modalBody = document.getElementById("modal-body");

        modalTitle.textContent = "ç”¨æˆ·å®Œæ•´èµ„æ–™";
        modalBody.textContent = JSON.stringify(devConsole.userInfo, null, 2);
        document.getElementById("detail-modal").style.display = "block";
      } // Load tasks from SDK
      async function loadTasksFromSDK() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ªï¼Œæ— æ³•åŠ è½½ä»»åŠ¡æ•°æ®", "error");
          return;
        }

        try {
          log("æ­£åœ¨ä»SDKåŠ è½½ä»»åŠ¡æ•°æ®...", "info");

          // Load completed tasks
          const completedTasks = await sdk.personalPageStore.loadPageData("maisi_userinfo", "dragon.taskCompleted");
          devConsole.completedTasks = completedTasks || {};

          // Load accepted tasks
          const acceptedTasks = await sdk.personalPageStore.loadPageData("maisi_userinfo", "dragon.taskAccepted");
          devConsole.acceptedTasks = acceptedTasks || {}; // Update displays
          updateTaskDisplays();
          displayCombinedTasks();

          // Mark tasks as loaded
          devConsole.tasksLoaded = true;

          log("ä»»åŠ¡æ•°æ®åŠ è½½å®Œæˆ", "success");
        } catch (error) {
          log(`åŠ è½½ä»»åŠ¡æ•°æ®å¤±è´¥: ${error.message}`, "error");
        }
      } // Refresh task data
      async function refreshTaskData() {
        // Reset the loaded flag to allow fresh loading
        devConsole.tasksLoaded = false;
        await loadTasksFromSDK();
      }

      // Update task displays
      function updateTaskDisplays() {
        // Update completed tasks display
        const completedTasksViewer = document.getElementById("completed-tasks-viewer");
        const completedTasksCount = document.getElementById("completed-tasks-count");
        const completedTasksStatus = document.getElementById("completed-tasks-status");

        if (devConsole.completedTasks && Object.keys(devConsole.completedTasks).length > 0) {
          completedTasksViewer.textContent = JSON.stringify(devConsole.completedTasks, null, 2);
          completedTasksCount.textContent = Object.keys(devConsole.completedTasks).length;
          completedTasksStatus.textContent = "å·²åŠ è½½";
        } else {
          completedTasksViewer.textContent = "æš‚æ— å·²å®Œæˆä»»åŠ¡æ•°æ®";
          completedTasksCount.textContent = "0";
          completedTasksStatus.textContent = "æ— æ•°æ®";
        }

        // Update accepted tasks display
        const acceptedTasksViewer = document.getElementById("accepted-tasks-viewer");
        const acceptedTasksCount = document.getElementById("accepted-tasks-count");
        const acceptedTasksStatus = document.getElementById("accepted-tasks-status");

        if (devConsole.acceptedTasks && Object.keys(devConsole.acceptedTasks).length > 0) {
          acceptedTasksViewer.textContent = JSON.stringify(devConsole.acceptedTasks, null, 2);
          acceptedTasksCount.textContent = Object.keys(devConsole.acceptedTasks).length;
          acceptedTasksStatus.textContent = "å·²åŠ è½½";
        } else {
          acceptedTasksViewer.textContent = "æš‚æ— å·²æ¥å—ä»»åŠ¡æ•°æ®";
          acceptedTasksCount.textContent = "0";
          acceptedTasksStatus.textContent = "æ— æ•°æ®";
        }
      } // Display combined tasks in a simple text format
      function displayCombinedTasks() {
        const container = document.getElementById("tasks-container");
        container.innerHTML = "";

        const hasData = (devConsole.completedTasks && Object.keys(devConsole.completedTasks).length > 0) || (devConsole.acceptedTasks && Object.keys(devConsole.acceptedTasks).length > 0);

        if (!hasData) {
          container.innerHTML = '<p class="text-gray-400">æš‚æ— ä»»åŠ¡æ•°æ®</p>';
          return;
        }

        // Create simple text overview
        let overview = "";

        if (devConsole.completedTasks && Object.keys(devConsole.completedTasks).length > 0) {
          overview += `âœ… å·²å®Œæˆä»»åŠ¡ (${Object.keys(devConsole.completedTasks).length}ä¸ª):\n`;
          for (const [key, value] of Object.entries(devConsole.completedTasks)) {
            overview += `  - ${key}: ${typeof value === "object" ? JSON.stringify(value) : value}\n`;
          }
          overview += "\n";
        }

        if (devConsole.acceptedTasks && Object.keys(devConsole.acceptedTasks).length > 0) {
          overview += `ğŸ“ å·²æ¥å—ä»»åŠ¡ (${Object.keys(devConsole.acceptedTasks).length}ä¸ª):\n`;
          for (const [key, value] of Object.entries(devConsole.acceptedTasks)) {
            overview += `  - ${key}: ${typeof value === "object" ? JSON.stringify(value) : value}\n`;
          }
        }

        container.textContent = overview;
      }

      // Show task details in modal
      function showTaskDetails() {
        const modalTitle = document.getElementById("modal-title");
        const modalBody = document.getElementById("modal-body");

        const taskData = {
          completedTasks: devConsole.completedTasks || {},
          acceptedTasks: devConsole.acceptedTasks || {},
        };

        modalTitle.textContent = "ä»»åŠ¡æ•°æ®è¯¦æƒ…";
        modalBody.textContent = JSON.stringify(taskData, null, 2);
        document.getElementById("detail-modal").style.display = "block";
      }

      // Legacy function - kept for compatibility
      function loadTasks() {
        // Redirect to SDK-based loading
        loadTasksFromSDK();
      }

      // Display tasks
      function displayTasks() {
        // Redirect to combined display
        displayCombinedTasks();
      }

      // Toggle task completion (disabled for SDK data)
      function toggleTaskComplete(taskId) {
        log("SDKä»»åŠ¡æ•°æ®ä¸ºåªè¯»ï¼Œæ— æ³•ä¿®æ”¹çŠ¶æ€", "warn");
      }

      // Remove completed tasks (disabled for SDK data)
      function removeCompletedTasks() {
        log("SDKä»»åŠ¡æ•°æ®ä¸ºåªè¯»ï¼Œæ— æ³•åˆ é™¤", "warn");
      } // Mark all tasks as complete (disabled for SDK data)
      function markAllTasksComplete() {
        log("SDKä»»åŠ¡æ•°æ®ä¸ºåªè¯»ï¼Œæ— æ³•ä¿®æ”¹", "warn");
      }

      // Edit task data function
      function editTaskData() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ªï¼Œæ— æ³•ç¼–è¾‘ä»»åŠ¡æ•°æ®", "error");
          return;
        }

        // Fill the editors with current data
        document.getElementById("completed-tasks-editor").value = JSON.stringify(devConsole.completedTasks || {}, null, 2);
        document.getElementById("accepted-tasks-editor").value = JSON.stringify(devConsole.acceptedTasks || {}, null, 2);

        // Show the edit modal
        document.getElementById("edit-task-modal").style.display = "block";
        log("å·²æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨", "info");
      }

      // Close edit task modal
      function closeEditTaskModal() {
        document.getElementById("edit-task-modal").style.display = "none";
      }

      // Reset editors to original data
      function resetTaskEditorsToOriginal() {
        document.getElementById("completed-tasks-editor").value = JSON.stringify(devConsole.completedTasks || {}, null, 2);
        document.getElementById("accepted-tasks-editor").value = JSON.stringify(devConsole.acceptedTasks || {}, null, 2);
        log("å·²é‡ç½®ç¼–è¾‘å™¨ä¸ºåŸå§‹æ•°æ®", "info");
      }

      // Save completed tasks
      async function saveCompletedTasks() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ª", "error");
          return;
        }

        try {
          const editorValue = document.getElementById("completed-tasks-editor").value.trim();
          let tasksData = {};

          if (editorValue) {
            tasksData = JSON.parse(editorValue);
          }

          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskCompleted", tasksData, true);
          devConsole.completedTasks = tasksData;
          updateTaskDisplays();
          log("å·²å®Œæˆä»»åŠ¡æ•°æ®ä¿å­˜æˆåŠŸ", "success");
        } catch (error) {
          log(`ä¿å­˜å·²å®Œæˆä»»åŠ¡å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Save accepted tasks
      async function saveAcceptedTasks() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ª", "error");
          return;
        }

        try {
          const editorValue = document.getElementById("accepted-tasks-editor").value.trim();
          let tasksData = {};

          if (editorValue) {
            tasksData = JSON.parse(editorValue);
          }

          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskAccepted", tasksData, true);
          devConsole.acceptedTasks = tasksData;
          updateTaskDisplays();
          log("å·²æ¥å—ä»»åŠ¡æ•°æ®ä¿å­˜æˆåŠŸ", "success");
        } catch (error) {
          log(`ä¿å­˜å·²æ¥å—ä»»åŠ¡å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Clear completed tasks
      async function clearCompletedTasks() {
        if (!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å·²å®Œæˆä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
          return;
        }

        try {
          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskCompleted", {}, true);
          devConsole.completedTasks = {};
          document.getElementById("completed-tasks-editor").value = "{}";
          updateTaskDisplays();
          log("å·²å®Œæˆä»»åŠ¡æ•°æ®å·²æ¸…ç©º", "success");
        } catch (error) {
          log(`æ¸…ç©ºå·²å®Œæˆä»»åŠ¡å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Clear accepted tasks
      async function clearAcceptedTasks() {
        if (!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å·²æ¥å—ä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
          return;
        }

        try {
          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskAccepted", {}, true);
          devConsole.acceptedTasks = {};
          document.getElementById("accepted-tasks-editor").value = "{}";
          updateTaskDisplays();
          log("å·²æ¥å—ä»»åŠ¡æ•°æ®å·²æ¸…ç©º", "success");
        } catch (error) {
          log(`æ¸…ç©ºå·²æ¥å—ä»»åŠ¡å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Save all task data
      async function saveAllTaskData() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ª", "error");
          return;
        }

        try {
          // Save completed tasks
          const completedValue = document.getElementById("completed-tasks-editor").value.trim();
          let completedData = {};
          if (completedValue) {
            completedData = JSON.parse(completedValue);
          }

          // Save accepted tasks
          const acceptedValue = document.getElementById("accepted-tasks-editor").value.trim();
          let acceptedData = {};
          if (acceptedValue) {
            acceptedData = JSON.parse(acceptedValue);
          }

          // Save both to SDK
          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskCompleted", completedData, true);
          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskAccepted", acceptedData, true);

          // Update local cache
          devConsole.completedTasks = completedData;
          devConsole.acceptedTasks = acceptedData;

          updateTaskDisplays();
          closeEditTaskModal();
          log("æ‰€æœ‰ä»»åŠ¡æ•°æ®ä¿å­˜æˆåŠŸ", "success");
        } catch (error) {
          log(`ä¿å­˜ä»»åŠ¡æ•°æ®å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Reset all tasks
      async function resetAllTasks() {
        if (!devConsole.isSDKReady) {
          log("SDKæœªå°±ç»ª", "error");
          return;
        }

        if (!confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰ä»»åŠ¡æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰å·²å®Œæˆå’Œå·²æ¥å—çš„ä»»åŠ¡æ•°æ®ï¼æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
          return;
        }

        try {
          // Clear both task types
          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskCompleted", {}, true);
          await sdk.personalPageStore.savePageData("maisi_userinfo", "dragon.taskAccepted", {}, true);

          // Update local cache
          devConsole.completedTasks = {};
          devConsole.acceptedTasks = {};

          updateTaskDisplays();
          log("æ‰€æœ‰ä»»åŠ¡æ•°æ®å·²é‡ç½®", "success");
        } catch (error) {
          log(`é‡ç½®ä»»åŠ¡æ•°æ®å¤±è´¥: ${error.message}`, "error");
        }
      }

      // Storage management functions
      function showLocalStorage() {
        const viewer = document.getElementById("localStorage-viewer");
        const data = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          data[key] = localStorage.getItem(key);
        }
        viewer.textContent = JSON.stringify(data, null, 2);
        viewer.style.display = "block";
        log("LocalStorageæ•°æ®å·²æ˜¾ç¤º", "info");
      }

      function showSessionStorage() {
        const viewer = document.getElementById("sessionStorage-viewer");
        const data = {};
        for (let i = 0; i < sessionStorage.length; i++) {
          const key = sessionStorage.key(i);
          data[key] = sessionStorage.getItem(key);
        }
        viewer.textContent = JSON.stringify(data, null, 2);
        viewer.style.display = "block";
        log("SessionStorageæ•°æ®å·²æ˜¾ç¤º", "info");
      }

      function showCookies() {
        const viewer = document.getElementById("cookies-viewer");
        const cookies = {};
        document.cookie.split(";").forEach((cookie) => {
          const [name, value] = cookie.trim().split("=");
          if (name) cookies[name] = value || "";
        });
        viewer.textContent = JSON.stringify(cookies, null, 2);
        viewer.style.display = "block";
        log("Cookieæ•°æ®å·²æ˜¾ç¤º", "info");
      }

      function clearLocalStorage() {
        if (confirm("ç¡®å®šè¦æ¸…ç©ºLocalStorageå—ï¼Ÿ")) {
          localStorage.clear();
          document.getElementById("localStorage-viewer").style.display = "none";
          log("LocalStorageå·²æ¸…ç©º", "warn");
        }
      }

      function clearSessionStorage() {
        if (confirm("ç¡®å®šè¦æ¸…ç©ºSessionStorageå—ï¼Ÿ")) {
          sessionStorage.clear();
          document.getElementById("sessionStorage-viewer").style.display = "none";
          log("SessionStorageå·²æ¸…ç©º", "warn");
        }
      }

      function clearCookies() {
        if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰Cookieså—ï¼Ÿ")) {
          document.cookie.split(";").forEach(function (c) {
            document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
          });
          document.getElementById("cookies-viewer").style.display = "none";
          log("Cookieså·²æ¸…ç©º", "warn");
        }
      }

      // Console functions
      function setupConsoleInput() {
        const input = document.getElementById("console-input");
        input.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            const command = input.value.trim();
            if (command) {
              executeConsoleCommand(command);
              input.value = "";
            }
          }
        });
      }

      function executeConsoleCommand(command) {
        log(`> ${command}`, "debug");

        try {
          const result = eval(command);
          log(result, "info");
        } catch (error) {
          log(`Error: ${error.message}`, "error");
        }
      }

      function clearConsole() {
        document.getElementById("console-output").innerHTML = "";
        log("æ§åˆ¶å°å·²æ¸…ç©º", "info");
      }

      function openChromeConsole() {
        log("è¯·æŒ‰ F12 æˆ– Ctrl+Shift+I æ‰“å¼€Chromeå¼€å‘è€…å·¥å…·", "info");
        // Try to trigger dev tools (may not work due to security)
        debugger;
      }

      // Tool functions
      function testSDKConnection() {
        if (devConsole.isSDKReady) {
          log("âœ… SDKè¿æ¥æ­£å¸¸", "success");
        } else {
          log("âŒ SDKè¿æ¥å¤±è´¥", "error");
        }
      }

      function generateTestData() {
        const testData = {
          userId: Math.floor(Math.random() * 10000),
          score: Math.floor(Math.random() * 100),
          level: Math.floor(Math.random() * 10) + 1,
          timestamp: new Date().toISOString(),
        };
        log(`ç”Ÿæˆæµ‹è¯•æ•°æ®: ${JSON.stringify(testData)}`, "info");
      }

      function exportLogs() {
        const logsText = devConsole.logs.map((log) => `[${log.timestamp}] ${log.level.toUpperCase()}: ${log.message}`).join("\n");
        const blob = new Blob([logsText], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `dev-logs-${new Date().toISOString().split("T")[0]}.txt`;
        a.click();
        URL.revokeObjectURL(url);
        log("æ—¥å¿—å·²å¯¼å‡º", "success");
      }

      function performanceCheck() {
        const info = {
          memory: performance.memory
            ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + "MB",
                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) + "MB",
              }
            : "N/A",
          timing: performance.timing
            ? {
                domLoaded: performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart + "ms",
                pageLoaded: performance.timing.loadEventEnd - performance.timing.navigationStart + "ms",
              }
            : "N/A",
        };
        log(`æ€§èƒ½ä¿¡æ¯: ${JSON.stringify(info, null, 2)}`, "info");
      }

      function networkDiagnostic() {
        log("æ­£åœ¨è¿›è¡Œç½‘ç»œè¯Šæ–­...", "info");

        fetch("https://api.keepwork.com/core/v0/ping")
          .then((response) => {
            log(`âœ… æœåŠ¡å™¨è¿æ¥æ­£å¸¸ (${response.status})`, "success");
          })
          .catch((error) => {
            log(`âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, "error");
          });
      }

      function memoryUsage() {
        if (performance.memory) {
          const used = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
          const total = Math.round(performance.memory.totalJSHeapSize / 1024 / 1024);
          const limit = Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024);
          log(`å†…å­˜ä½¿ç”¨: ${used}MB / ${total}MB (é™åˆ¶: ${limit}MB)`, "info");
        } else {
          log("å†…å­˜ä¿¡æ¯ä¸å¯ç”¨", "warn");
        }
      }

      function resetAll() {
        if (confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿè¿™å°†æ¸…ç©ºæ‰€æœ‰å­˜å‚¨å’Œé‡æ–°åŠ è½½é¡µé¢ã€‚")) {
          localStorage.clear();
          sessionStorage.clear();
          location.reload();
        }
      }

      function emergencyMode() {
        log("ğŸš¨ ç´§æ€¥æ¨¡å¼æ¿€æ´»", "error");
        log("æ¸…ç©ºæ‰€æœ‰å­˜å‚¨...", "warn");
        localStorage.clear();
        sessionStorage.clear();
        log("åœæ­¢æ‰€æœ‰è®¡æ—¶å™¨...", "warn");
        // Clear all intervals and timeouts
        const highestTimeoutId = setTimeout(";");
        for (let i = 0; i < highestTimeoutId; i++) {
          clearTimeout(i);
        }
        log("ç´§æ€¥æ¨¡å¼å®Œæˆ", "success");
      }

      function setQuickUserId() {
        const userId = document.getElementById("quick-user-id").value;
        if (userId) {
          devConsole.userInfo.id = userId;
          updateUserInfo();
          log(`ç”¨æˆ·IDå·²è®¾ç½®ä¸º: ${userId}`, "success");
        }
      }

      function executeQuickAction() {
        const action = document.getElementById("quick-actions").value;
        switch (action) {
          case "reload":
            location.reload();
            break;
          case "fullscreen":
            document.documentElement.requestFullscreen();
            break;
          case "mobile-view":
            document.body.style.maxWidth = "375px";
            document.body.style.margin = "0 auto";
            break;
          case "debug-mode":
            debugger;
            break;
          default:
            log("è¯·é€‰æ‹©ä¸€ä¸ªæ“ä½œ", "warn");
        }
      }

      // Utility functions
      function log(message, level = "info") {
        const timestamp = new Date().toISOString();
        const logEntry = { message, level, timestamp };
        devConsole.logs.push(logEntry);

        const output = document.getElementById("console-output");
        const entry = document.createElement("div");
        entry.className = `log-entry log-${level}`;
        entry.innerHTML = `<span class="text-gray-500">[${level.toUpperCase()}]</span> ${message}`;
        output.appendChild(entry);
        output.scrollTop = output.scrollHeight;
      }
      function closeModal() {
        document.getElementById("detail-modal").style.display = "none";
      }

      // Copy token to clipboard
      function copyToken() {
        const tokenElement = document.getElementById("auth-token");
        const token = tokenElement.textContent;

        if (token && token !== "--" && token !== "æ— ") {
          navigator.clipboard
            .writeText(token)
            .then(() => {
              log("Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "success");
            })
            .catch((err) => {
              // Fallback for older browsers
              const textArea = document.createElement("textarea");
              textArea.value = token;
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand("copy");
              document.body.removeChild(textArea);
              log("Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "success");
            });
        } else {
          log("æ²¡æœ‰æœ‰æ•ˆçš„Tokenå¯å¤åˆ¶", "warn");
        }
      } // MiniGame Proxy functions
      function refreshProxyData() {
        log("æ­£åœ¨åˆ·æ–°ä»£ç†æ•°æ®...", "info");
        checkStartGame(100); // Quick refresh
      }

      function showProxyData() {
        const modalTitle = document.getElementById("modal-title");
        const modalBody = document.getElementById("modal-body");

        modalTitle.textContent = "MiniGame Proxy å®Œæ•´æ•°æ®";
        modalBody.textContent = devConsole.miniGameProxyData ? JSON.stringify(devConsole.miniGameProxyData, null, 2) : "æš‚æ— æ•°æ®";
        document.getElementById("detail-modal").style.display = "block";
      } // Update proxy data status display
      function updateProxyDataStatus() {
        const statusEl = document.getElementById("proxy-data-status");
        const viewerEl = document.getElementById("proxy-data-viewer");
        const rawViewerEl = document.getElementById("proxy-data-raw");

        if (devConsole.miniGameProxyData) {
          statusEl.textContent = "å·²è·å–";
          const jsonString = JSON.stringify(devConsole.miniGameProxyData, null, 2);
          viewerEl.textContent = jsonString;
          rawViewerEl.textContent = jsonString;
        } else {
          statusEl.textContent = "æœªè·å–";
          viewerEl.textContent = "æš‚æ— æ•°æ®";
          rawViewerEl.textContent = "æš‚æ— æ•°æ®";
        }
      }

      // Start the developer console initialization
      function startDevConsole(hasProxyData = false) {
        const message = hasProxyData ? "å¼€å‘è€…æ§åˆ¶å°å¯åŠ¨å®Œæˆ" : "å¼€å‘è€…æ§åˆ¶å°å¯åŠ¨å®Œæˆ (æ— ä»£ç†æ•°æ®)";
        const level = hasProxyData ? "success" : "warn";

        log(message, level);

        // Initialize other components
        initDevConsole();
        updateSystemInfo();
        updateTime();
        checkSDKStatus();
        setupConsoleInput();

        // Update time every second
        setInterval(updateTime, 1000);
        // Check SDK status periodically
        setInterval(checkSDKStatus, 5000);
      }

      // Check start game function (adapted from wiki_dashboard.html)
      function checkStartGame(timeoutMs) {
        if (!timeoutMs) {
          const urlParams = new URLSearchParams(window.location.search);
          timeoutMs = urlParams.get("parent") === "miniGameProxy" ? 3000 : 200;
        }

        let gameStarted = false;
        const waitForMinigameProxyWithTimeout = new Promise((resolve, reject) => {
          const timeout = setTimeout(() => {
            if (!gameStarted) {
              resolve(null);
            }
          }, timeoutMs);

          let miniGameProxyReceived = false;
          const messageHandler = function (e) {
            if (e.data.type === "miniGameProxyDataResponse") {
              miniGameProxyReceived = true;
              // Store the proxy data
              devConsole.miniGameProxyData = e.data;
              // Update SDK token if available
              if (e.data?.keepworkToken) {
                sdk.token = e.data.keepworkToken;
              }
              log("MiniGame Proxyæ•°æ®å·²æ¥æ”¶", "success");
              updateProxyDataStatus();
            }
            if (miniGameProxyReceived) {
              miniGameProxyReceived = false;
              window.removeEventListener("message", messageHandler);
              clearTimeout(timeout);
              resolve(e.data);
            }
          };

          window.addEventListener("message", messageHandler);
          window.parent.postMessage({ type: "getLocation" }, "*");
          window.parent.postMessage({ type: "getMiniGameProxyData" }, "*");
        });
        waitForMinigameProxyWithTimeout
          .then(async (data) => {
            if (!gameStarted) {
              gameStarted = true;
              startDevConsole(!!data);
            }
          })
          .catch(async (error) => {
            if (!gameStarted) {
              gameStarted = true;
              startDevConsole(false);
            }
          });
      }

      log("å¼€å‘è€…æ§åˆ¶å°åˆå§‹åŒ–å®Œæˆ", "info");
      checkStartGame();

      // Network status listener
      window.addEventListener("online", () => {
        updateNetworkStatus();
        log("ç½‘ç»œè¿æ¥å·²æ¢å¤", "success");
      });

      window.addEventListener("offline", () => {
        updateNetworkStatus();
        log("ç½‘ç»œè¿æ¥å·²æ–­å¼€", "error");
      });
    </script>
  </body>
</html>
