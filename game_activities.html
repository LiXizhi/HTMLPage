<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>æ´»åŠ¨ä¸­å¿ƒ</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>    
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            position: relative;
            min-height: 100vh;
            min-height: 100dvh; /* åŠ¨æ€è§†å£é«˜åº¦ */
        }
        
        .star-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
            width: 100%;
            min-height: 100vh;
            min-height: 100dvh;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-glow {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1), 0 0 20px rgba(255, 255, 255, 0.1);
        }
        
        .active-tab {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .reward-card {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            transition: transform 0.3s ease;
        }
        
        .reward-card:hover {
            transform: translateY(-2px);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ - åŸºç¡€åˆ†è¾¨ç‡ 1282x720 */
        .signin-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .signin-header {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            flex: 0 0 60%;
        }
        
        .signin-cards-container {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #e0f2fe 0%,rgb(151, 180, 231) 50%,rgb(151, 180, 254) 100%);
            padding: 1rem;
        }
        
        .cumulative-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .cumulative-header {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            flex: 0 0 65%;
        }
        
        .cumulative-cards-container {
            flex: 0 0 35%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #e0f2fe 0%,rgb(151, 180, 231) 50%,rgb(151, 180, 254) 100%);
            padding: 1rem;
        }
        
        .day-card {
            transition: all 0.3s ease;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .day-card:hover {
            transform: scale(1.05);
        }
        
        /* å…¨å±é€‚é… */
        .app-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            overflow: hidden;
            max-width: none;
            margin: 0;
        }
        
        .sidebar {
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .content-area {
            flex: 1;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* ç§»åŠ¨ç«¯æ±‰å ¡èœå• */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        /* è§¦æ§ä¼˜åŒ– */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .day-card {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Loading Animation */
        .loading-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        
        .loading-container.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            margin-top: 1.5rem;
            font-size: 1.125rem;
            font-weight: 500;
            animation: pulse-text 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-text {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .error-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            z-index: 10;
            padding: 2rem;
        }
        
        .error-container.show {
            display: flex;
        }
        
        .error-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .error-text {
            color: white;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        
        .error-message {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .retry-btn {
            background: white;
            color: #f5576c;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .retry-btn:active {
            transform: translateY(0);
        }
        
        /* Red dot indicator for unvisited updates */
        .update-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 10px;
            height: 10px;
            background-color: #ef4444;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
            z-index: 20;
        }
        
        .tab-btn {
            position: relative;
        }
        
        .iframe-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 5;
        }
        
        .iframe-container iframe.loaded {
            opacity: 1;
        }
        
    </style>
</head>
<body class="star-bg min-h-screen">
    <div class="app-container">
        <div class="flex w-full bg-white shadow-2xl h-full">
        <!-- å·¦ä¾§å¯¼èˆª -->
        <div class="sidebar w-48 gradient-bg p-4 flex flex-col">
            <div class="text-white text-xl font-bold mb-6 text-center">
                æ´»åŠ¨ä¸­å¿ƒ
            </div>
            
            <nav class="space-y-3 flex-1">
                <button id="tab_signin" onclick="switchTab('signin')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    7æ—¥ç­¾åˆ°
                </button>
                <button id="tab_vip" onclick="switchTab('vip')" class="tab-btn active-tab w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 flex items-center shadow-lg" style="background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);">
                    <span class="mr-2">ğŸ‘‘</span>
                    éº¦æ€æ˜Ÿçƒä¼šå‘˜
                </button>
                <button id="tab_candybox" onclick="switchTab('candybox')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center relative overflow-visible">
                    <span class="mr-2">ğŸ¬</span>
                    ç³–æœç›’
                    <span class="absolute -top-2 -left-2 bg-orange-500 text-white text-xs px-2 py-0.5 rounded transform -rotate-12 shadow-lg font-bold whitespace-nowrap" style="z-index: 10;">ğŸƒ ä¸‡åœ£èŠ‚</span>
                </button>
                <button id="tab_contest" onclick="switchTab('contest')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    <span class="mr-2">ğŸ†</span>
                    åˆ›ä½œå¤§èµ›
                    <span class="absolute -top-2 -left-2 bg-red-500 text-white text-xs px-2 py-0.5 rounded transform -rotate-12 shadow-lg font-bold whitespace-nowrap animate-pulse" style="z-index: 10;">ğŸ”¥ ç«çƒ­æŠ¥åä¸­</span>
                </button>
                <button id="tab_mai_si_test" onclick="switchTab('mai_si_test')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    éº¦æ€æµ‹è¯„
                </button>
                <button id="tab_paracraft_tips" onclick="switchTab('paracraft_tips')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    åˆ›ä½œè€…å­¦å ‚
                </button>
                <!-- <button id="tab_referral" onclick="switchTab('referral')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    <span class="mr-2">ğŸ</span>
                    æ‹‰æ–°å¥–åŠ±
                </button>
                
                <button id="tab_contest" onclick="switchTab('contest')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    <span class="mr-2">ğŸ†</span>
                    å®¶å›­å¤§èµ›
                </button>
                
                <button id="tab_feedback" onclick="switchTab('feedback')" class="tab-btn w-full text-white py-3 px-4 rounded-lg font-medium text-left transition-all duration-300 hover:bg-white hover:bg-opacity-20 flex items-center">
                    <span class="mr-2">âœï¸</span>
                    æ´»åŠ¨æŠ•ç¨¿
                </button> -->
  
            </nav>
        </div>

        <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
        <div class="content-area flex-1" id="contentArea">
            <!-- iframeå®¹å™¨å°†åŠ¨æ€åˆ›å»º -->
        </div>
    </div>
    <script>
        // Get all visit data from localStorage
        function getVisitData() {
            const data = localStorage.getItem('game_activities_visits');
            return data ? JSON.parse(data) : {};
        }
        
        // Save visit data to localStorage
        function saveVisitData(data) {
            localStorage.setItem('game_activities_visits', JSON.stringify(data));
        }
        
        // Check if page needs update indicator
        function needsUpdateIndicator(tabId) {
            const config = iframeConfig[tabId];
            if (!config || !config.updateDate) {
                return false;
            }
            
            const visitData = getVisitData();
            const lastVisit = visitData[tabId];
            
            if (!lastVisit) {
                return true; // Never visited
            }
            
            // Compare dates
            const updateTime = new Date(config.updateDate).getTime();
            const visitTime = new Date(lastVisit).getTime();
            
            return updateTime > visitTime;
        }
        
        // Update last visit date
        function updateLastVisit(tabId) {
            const now = new Date().toISOString();
            const visitData = getVisitData();
            visitData[tabId] = now;
            saveVisitData(visitData);
            console.log(`Updated lastVisit for ${tabId}: ${now}`);
            
            // Remove indicator
            const button = document.getElementById(`tab_${tabId}`);
            if (button) {
                const indicator = button.querySelector('.update-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
        }
        
        // Add indicator to button
        function addUpdateIndicator(tabId) {
            const button = document.getElementById(`tab_${tabId}`);
            if (!button) return;
            
            // Check if indicator already exists
            if (button.querySelector('.update-indicator')) return;
            
            const indicator = document.createElement('span');
            indicator.className = 'update-indicator';
            button.appendChild(indicator);
        }
        
        // Initialize all indicators
        function initializeIndicators() {
            Object.keys(iframeConfig).forEach(tabId => {
                if (needsUpdateIndicator(tabId)) {
                    addUpdateIndicator(tabId);
                }
            });
        }
        
        // iframeé…ç½®
        const iframeConfig = {
            signin: {
                id: 'game_activity_checkin',
                url: 'https://cross.keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_checkin',
                title: '7æ—¥ç­¾åˆ°',
                updateDate: '2025-10-24'
            },
            vip: {
                id: 'game_activity_vip', 
                url: 'https://keepwork.com/api/raw/maisi/maisi/webgames/data/msplanet_vip',
                // url: 'https://cross.keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_vip2',
                title: 'ä¼šå‘˜å¥–åŠ±',
                updateDate: '2025-10-24'
            },
            mai_si_test:{
                id: 'game_activity_mai_si_test',
                url: 'https://keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_test',
                title: 'éº¦æ€æµ‹è¯„',
                updateDate: '2025-10-24'
            },
            paracraft_tips:{
                id: 'game_activity_paracraft_tips',
                url: 'https://keepwork.com/api/raw/maisi/maisi/webgames/data/paracraft_tips',
                title: 'åˆ›ä½œå­¦å ‚',
                updateDate: '2025-10-24'
            },
            candybox: {
                id: 'game_activity_candybox',
                url: 'https://keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_candybox',
                title: 'ç³–æœç›’',
                updateDate: '2025-10-24'
            },
            contest: {
                id: 'game_activity_contest',
                url: 'https://keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_contest',
                title: 'åˆ›ä½œå¤§èµ›',
                updateDate: '2025-10-24'
            },
            referral: {
                id: 'game_activity_referral',
                url: 'https://cross.keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_referral', 
                title: 'æ‹‰æ–°å¥–åŠ±',
            },
            feedback: {
                id: 'game_activity_feedback',
                url: 'https://cross.keepwork.com/api/raw/maisi/maisi/webgames/data/game_activity_feedback',
                title: 'æ´»åŠ¨æŠ•ç¨¿'
            }
        };

        // åˆ›å»ºå•ä¸ªiframeå®¹å™¨
        function createIframeContainer(tabId) {
            const config = iframeConfig[tabId];
            if (!config) return null;
            
            const contentArea = document.getElementById('contentArea');
            
            // åˆ›å»ºtabå†…å®¹å®¹å™¨
            const tabContent = document.createElement('div');
            tabContent.id = config.id;
            tabContent.className = 'tab-content';
            tabContent.style.display = 'none';
            
            // åˆ›å»ºiframeå®¹å™¨
            const iframeContainer = document.createElement('div');
            iframeContainer.className = 'iframe-container';
            
            // åˆ›å»ºloadingå®¹å™¨
            const loadingContainer = document.createElement('div');
            loadingContainer.className = 'loading-container';
            loadingContainer.id = `loading_${tabId}`;
            loadingContainer.innerHTML = `
                <div class="spinner"></div>
                <div class="loading-text">åŠ è½½ä¸­...</div>
            `;
            
            // åˆ›å»ºerrorå®¹å™¨
            const errorContainer = document.createElement('div');
            errorContainer.className = 'error-container';
            errorContainer.id = `error_${tabId}`;
            errorContainer.innerHTML = `
                <div class="error-icon">âš ï¸</div>
                <div class="error-text">åŠ è½½å¤±è´¥</div>
                <div class="error-message">æ— æ³•åŠ è½½å†…å®¹ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</div>
                <button class="retry-btn" onclick="retryLoad('${tabId}')">ğŸ”„ é‡è¯•</button>
            `;
            
            // åˆ›å»ºiframe
            const iframe = document.createElement('iframe');
            iframe.id = `${tabId}_iframe`;
            iframe.src = '';
            
            // ç»„è£…ç»“æ„
            iframeContainer.appendChild(loadingContainer);
            iframeContainer.appendChild(errorContainer);
            iframeContainer.appendChild(iframe);
            tabContent.appendChild(iframeContainer);
            contentArea.appendChild(tabContent);
            
            return tabContent;
        }

        function switchTab(tabId, targetButton = null) {
            // éšè—æ‰€æœ‰å†…å®¹
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.add('hidden');
                content.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active-tab'));
            
            const activeButton = targetButton || document.getElementById("tab_" + tabId);
            // ç¡®ä¿æ‰¾åˆ°æŒ‰é’®ä¸”æŒ‰é’®æœ‰classListå±æ€§
            if (activeButton && activeButton.classList) {
                activeButton.classList.add('active-tab');
            }
            
            // Record visit and remove indicator
            updateLastVisit(tabId);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„iframeé…ç½®
            if (iframeConfig[tabId]) {
                loadTabInIframe(tabId);
            } else {
                // æ˜¾ç¤ºåŸå§‹å†…å®¹
                document.getElementById(tabId).classList.remove('hidden');
                document.getElementById(tabId).style.display = 'block';
            }
        }
        
        // Timeout configuration (in milliseconds)
        const IFRAME_LOAD_TIMEOUT = 15000; // 15 seconds
        const loadingTimers = {};
        
        function loadTabInIframe(tabId) {
            const config = iframeConfig[tabId];
            if (!config) return;
            
            // æ£€æŸ¥å®¹å™¨æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
            let iframeContainer = document.getElementById(config.id);
            if (!iframeContainer) {
                iframeContainer = createIframeContainer(tabId);
                if (!iframeContainer) return;
            }
            
            const iframe = iframeContainer.querySelector('iframe');
            const loadingElement = document.getElementById(`loading_${tabId}`);
            const errorElement = document.getElementById(`error_${tabId}`);
            
            // æ£€æŸ¥å½“å‰iframeæ˜¯å¦å·²ç»åŠ è½½äº†ç›¸åŒçš„å†…å®¹
            if (iframe.src === config.url || iframe.src.endsWith(config.url)) {
                // å¦‚æœæ˜¯ç›¸åŒçš„iframeå†…å®¹ï¼Œåªéœ€è¦æ˜¾ç¤ºå®¹å™¨å³å¯
                iframeContainer.classList.remove('hidden');
                iframeContainer.style.display = 'block';
                return;
            }
            
            // é‡ç½®çŠ¶æ€
            iframe.classList.remove('loaded');
            if (loadingElement) {
                loadingElement.classList.remove('hidden');
            }
            if (errorElement) {
                errorElement.classList.remove('show');
            }
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (loadingTimers[tabId]) {
                clearTimeout(loadingTimers[tabId]);
            }
            
            // è®¾ç½®åŠ è½½è¶…æ—¶
            loadingTimers[tabId] = setTimeout(() => {
                console.error(`${config.title} åŠ è½½è¶…æ—¶`);
                showLoadError(tabId);
            }, IFRAME_LOAD_TIMEOUT);
            
            // è®¾ç½®iframeåŠ è½½äº‹ä»¶
            iframe.onload = function() {
                clearTimeout(loadingTimers[tabId]);
                console.log(`${config.title} åŠ è½½æˆåŠŸ`);
                hideLoading(tabId);
                iframe.classList.add('loaded');
            };
            
            iframe.onerror = function() {
                clearTimeout(loadingTimers[tabId]);
                console.error(`${config.title} åŠ è½½å¤±è´¥`);
                showLoadError(tabId);
            };
            
            // Append all URL params to iframe URL
            let iframeSrc = config.url;
            const urlParams = new URLSearchParams(window.location.search);
            if(window.miniGameProxyData)
            {
                // check if user is vip, if so, append vip=1 to url params
                if(window.miniGameProxyData.local_vip)
                {
                    urlParams.set("vip", "0"); // for free local vip
                }
                if(window.miniGameProxyData.isVip)
                {
                    urlParams.set("vip", "1"); // for real vip
                }
            }
            
            // Forward all URL parameters to the iframe
            if (urlParams.toString()) {
                const separator = config.url.includes('?') ? '&' : '?';
                iframeSrc = `${config.url}${separator}${urlParams.toString()}`;
            }
            
            iframe.src = iframeSrc;
            
            // æ˜¾ç¤ºiframeå®¹å™¨
            iframeContainer.classList.remove('hidden');
            iframeContainer.style.display = 'block';
            
            console.log(`å¼€å§‹åŠ è½½${config.title}åˆ°iframe: ${config.id}`);
        }
        
        function hideLoading(tabId) {
            const loadingElement = document.getElementById(`loading_${tabId}`);
            if (loadingElement) {
                loadingElement.classList.add('hidden');
            }
        }
        
        function showLoadError(tabId) {
            const loadingElement = document.getElementById(`loading_${tabId}`);
            const errorElement = document.getElementById(`error_${tabId}`);
            
            if (loadingElement) {
                loadingElement.classList.add('hidden');
            }
            
            if (errorElement) {
                errorElement.classList.add('show');
            }
        }
        
        function retryLoad(tabId) {
            const config = iframeConfig[tabId];
            const errorElement = document.getElementById(`error_${tabId}`);
            const iframe = document.getElementById(`${tabId}_iframe`);
            
            if (errorElement) {
                errorElement.classList.remove('show');
            }
            
            // é‡ç½®iframe srcå¼ºåˆ¶é‡æ–°åŠ è½½
            if (iframe) {
                iframe.src = '';
                setTimeout(() => {
                    loadTabInIframe(tabId);
                }, 100);
            }
        }
        
        function showSuccessMessage(message) {
            // åˆ›å»ºæˆåŠŸæç¤º
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-sm';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function showErrorMessage(message) {
            // åˆ›å»ºé”™è¯¯æç¤º
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-sm';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

         window.addEventListener('message', function (e) {
            if (!e.data || !e.data.type) {
                return;
            }
            try {
                switch (e.data.type) {
                    case 'setGameConfig':
                        if (e.data.data) {
                            game_config = e.data.data;
                            const configData = JSON.parse(game_config);
                            console.log('æ¸¸æˆé…ç½®ï¼š', configData);

                            // æ ¹æ®é…ç½®ç±»å‹è¿›è¡Œä¸åŒå¤„ç†
                            if (configData.type === 'dailycheckin') {
                                const dailycheckinIframe = document.getElementById('signin_iframe');
                                console.log(dailycheckinIframe)
                                if (dailycheckinIframe && dailycheckinIframe.contentWindow) {
                                    dailycheckinIframe.contentWindow.postMessage({
                                        type: 'updateSignConfig',
                                        data: configData
                                    }, '*');
                                }
                            }
                        }
                        break;
                    case "loadSignConfig":
                        if (window.parent) {
                            window.parent.postMessage({ type: 'loadSignConfig' }, '*');
                        }
                        break;
                    case "getSigninReward":
                        if (window.parent) {
                            window.parent.postMessage({ type: 'getSigninReward', data: e.data.data }, '*');
                        }
                        break;
                    case "locationResponse":
                        const searchPath = e.data.search;
                        let tabToSwitch = 'candybox'; // Default tab
                        
                        if (searchPath) {
                            const params = new URLSearchParams(searchPath);
                            const iframeType = params.get('type');
                            if (iframeType) {
                                tabToSwitch = iframeType;
                            }
                        } else if (e.data.tab) {
                            tabToSwitch = e.data.tab;
                        }
                        
                        switchTab(tabToSwitch);
                        break;
                    case "miniGameProxyDataResponse":
                        window.miniGameProxyData = e.data;
                        break;
                    case "closeGameCommon":
                    case "GameLogic.RunCommand":
                    case "vipPayResult":
                        // ç›´æ¥è½¬å‘æ¶ˆæ¯ç»™çˆ¶çª—å£
                        if (window.parent != window) {
                            window.parent.postMessage(e.data, '*');
                        }
                        break;
                    case "navigate":
                        // å¤„ç†å¯¼èˆªæ¶ˆæ¯
                        if (e.data.url) {
                            console.log('å¯¼èˆªåˆ°URL:', e.data.url);
                            if (window.parent !== window) {
                                // å¦‚æœåœ¨iframeä¸­ï¼Œå‘é€æ¶ˆæ¯ç»™çˆ¶çª—å£å¤„ç†å¯¼èˆª
                                window.parent.postMessage({ 
                                    type: 'navigate', 
                                    url: e.data.url,
                                    navigateType: e.data.navigateType || 'openGame'
                                }, '*');
                            } else {
                                // å¦‚æœä¸åœ¨iframeä¸­ï¼Œç›´æ¥è·³è½¬
                                window.location.href = e.data.url;
                            }
                        }
                        break;
                    case "getLocation":
                        // å¤„ç†è·å–ä½ç½®ä¿¡æ¯çš„è¯·æ±‚
                        const currentLocation = window.location.href;
                        e.source.postMessage({
                            type: 'locationResponse',
                            href: encodeURIComponent(currentLocation),
                            search: window.location.search
                        }, '*');
                        break;
                    default:
                        console.log('Unknown message type:', e.data.type);
                }
            } catch (error) {
                console.error('Error processing message:', error);
            }
        });
        

        // Only request location when not in proxy mode
        const urlParams = new URLSearchParams(window.location.search);
        const isProxyMode = urlParams.get("parent") === "miniGameProxy";

        if (isProxyMode) {
            window.parent.postMessage({ type: 'getLocation' }, '*');
            window.parent.postMessage({ type: "getMiniGameProxyData" }, "*");
        }
        else{
            // If not in proxy mode, load the default tab directly
            switchTab('vip');
        }
        
        // Initialize update indicators after page loads
        setTimeout(() => {
            initializeIndicators();
        }, 500);
    </script>
</body>
</html>