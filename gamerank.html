
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆæ’è¡Œæ¦œ</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <style>
        html, body { 
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        }
        
        /* Ensure game list can scroll when content exceeds container */
        .game-list-scroll {
            min-height: 200px;
            overflow-y: scroll !important; /* Force scroll even without content overflow */
        }          
        /* Leaderboard scrollable area */
        .leaderboard-scroll {
            overflow-y: scroll !important;
            max-height: 77vh; /* Force maximum height to ensure scrolling */
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }
        
        .game-item:hover { background: rgba(102, 126, 234, 0.1); transform: translateX(4px); }
        .game-item.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .leaderboard-item:nth-child(1) { background: linear-gradient(135deg, #ffd700, #ffed4e); }
        .leaderboard-item:nth-child(2) { background: linear-gradient(135deg, #c0c0c0, #e5e5e5); }
        .leaderboard-item:nth-child(3) { background: linear-gradient(135deg, #cd7f32, #daa520); }
        .tab-active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .age-button:hover { background: rgba(102, 126, 234, 0.1); }
        .age-button.active { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .user-highlight { border: 3px solid #10b981; background: rgba(16, 185, 129, 0.1); animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }        
        .layout-container { display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 320px; flex-shrink: 0; }
        .main-content { flex: 1; min-width: 0; overflow: hidden; }        .dropdown:hover .dropdown-menu { display: block; }
        .dropdown-menu { display: none; }
        .dropdown-menu:hover { display: block; }
        .dropdown-menu::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 0;
            right: 0;
            height: 8px;
            background: transparent;
        }
        @media (max-width: 768px) {
            .layout-container { flex-direction: column; }
            .sidebar { width: 100%; min-height: auto; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- æ•´ä½“å¸ƒå±€å®¹å™¨ -->
    <div class="layout-container">
        <!-- å·¦ä¾§æ¸¸æˆåˆ—è¡¨ -->
        <div class="sidebar bg-white shadow-lg flex flex-col">
            <div class="flex-1 overflow-hidden flex flex-col">
                <div class="p-4 pb-2">
                    <h2 class="text-lg font-bold mb-4 text-gray-800">å¾—åˆ†æ’è¡Œæ¦œ</h2>
                </div>                
                <div class="flex-1 overflow-y-auto px-4 pb-2 game-list-scroll">
                    <div id="gameList" class="space-y-2">
                        <!-- æ¸¸æˆé¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>            <!-- åˆ†æ•°æäº¤åŒºåŸŸ -->
            <div class="p-4 bg-gray-50 border-t">
                <div class="space-y-3">
                    <input 
                        type="number" 
                        id="userScore" 
                        placeholder="è¾“å…¥ä½ çš„åˆ†æ•°" 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                    <select 
                        id="userAge" 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                        <option value="">é€‰æ‹©å¹´é¾„</option>
                        <option value="5">5å²</option>
                        <option value="6">6å²</option>
                        <option value="7">7å²</option>
                        <option value="8">8å²</option>
                        <option value="9">9å²</option>
                        <option value="10">10å²</option>
                        <option value="11">11å²</option>
                        <option value="12">12å²</option>
                        <option value="13">13å²</option>
                        <option value="14">14å²</option>
                        <option value="15">15å²</option>
                        <option value="16">16å²</option>
                        <option value="17">17å²</option>
                        <option value="18">18å²åŠä»¥ä¸Š</option>
                    </select>
                   
                    <button 
                        onclick="submitScore()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-bold hover:from-purple-700 hover:to-blue-700 transition-all"
                    >
                        ğŸš€ æäº¤åˆ†æ•°
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">æäº¤åå°†æ˜¾ç¤ºåœ¨å¯¹åº”å¹´é¾„ç»„çš„æ’è¡Œæ¦œä¸­</p>
            </div>
        </div>        <!-- å³ä¾§ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content flex flex-col">
            <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
            <div class="bg-white shadow-sm p-4 border-b">
                <div class="flex items-center justify-between">
                    
                    <div class="flex items-center space-x-6">
                        <!-- å‘¨æ¦œ/æœˆæ¦œåˆ‡æ¢ -->
                        <div class="flex space-x-3">
                            <button id="weeklyTab" class="tab-active px-6 py-2 rounded-lg font-bold transition-all" onclick="switchTab('weekly')">
                                ğŸ“… å‘¨æ¦œ
                            </button>
                            <button id="monthlyTab" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg font-bold transition-all hover:bg-gray-300" onclick="switchTab('monthly')">
                                ğŸ“Š æœˆæ¦œ
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            åœ¨çº¿ç”¨æˆ·: <span class="font-bold text-green-600">1,234</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ’è¡Œæ¦œå†…å®¹ -->
            <div class="flex-1 p-2">
                <div class="bg-white rounded-xl shadow-sm h-full flex flex-col">
                    <div class="p-6 border-b">
                        <div class="flex items-center justify-between">
                            <!-- åŠ¨æ€æ ‡é¢˜å’Œä¸‹æ‹‰èœå• -->
                            <div class="dropdown relative">
                                <button class="flex items-center text-xl font-bold text-gray-800 hover:text-blue-600 transition-colors cursor-pointer">
                                    <span>ğŸ… </span>
                                    <span id="rankingTitle">æ··é¾„æ€»æ¦œå‘¨æ¦œ</span>
                                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>                                
                                <!-- ä¸‹æ‹‰èœå• -->
                                <div class="dropdown-menu absolute top-full left-0 mt-2 w-48 bg-white border rounded-lg shadow-lg z-10">
                                    <div class="py-2 text-lg">
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100" onclick="selectLeaderboard('all')">ğŸ† æ··é¾„æ€»æ¦œ</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100" onclick="selectLeaderboard('5-6')">ğŸ‘¶ 5-6å²</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100" onclick="selectLeaderboard('7-8')">ğŸ§’ 7-8å²</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100" onclick="selectLeaderboard('9-10')">ğŸ‘¦ 9-10å²</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100" onclick="selectLeaderboard('11-12')">ğŸ‘§ 11-12å²</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100" onclick="selectLeaderboard('13+')">ğŸ§‘ 13å²ä»¥ä¸Š</a>
                                    </div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-600">
                                æ€»è®¡: <span id="totalPlayers" class="font-bold text-blue-600">100</span> äºº
                            </div>
                        </div>
                    </div>                      
                    <div class="flex-1 overflow-hidden">
                        <div id="leaderboardList" class="h-full min-h-[400px] overflow-y-auto leaderboard-scroll">
                            <!-- æ’è¡Œæ¦œé¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸæç¤ºæ¨¡æ€æ¡† -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 m-4 max-w-md shadow-2xl">
            <div class="text-center">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h3 class="text-2xl font-bold mb-3 text-gray-800">åˆ†æ•°æäº¤æˆåŠŸï¼</h3>
                <p class="text-gray-600 mb-2">ä½ çš„åˆ†æ•°å·²åŠ å…¥æ’è¡Œæ¦œ</p>
                <p id="rankInfo" class="text-lg font-bold text-blue-600 mb-6"></p>
                <button onclick="closeModal()" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:from-purple-700 hover:to-blue-700 transition-all">
                    å¤ªæ£’äº†ï¼
                </button>
            </div>
        </div>
    </div>    <script>
        // æ¸¸æˆé…ç½®
        let gameConfig = '';
        let games = {};        // é»˜è®¤æ¸¸æˆæ•°æ®ï¼ˆä½œä¸ºåå¤‡ï¼‰
        const defaultGames = {
            puzzle: { name: 'ç›Šæ™ºè§£è°œ', icon: 'ğŸ§©', desc: 'æŒ‘æˆ˜ä½ çš„æ™ºåŠ›' },
            racing: { name: 'æé€Ÿèµ›è½¦', icon: 'ğŸï¸', desc: 'é€Ÿåº¦ä¸æ¿€æƒ…' },
            shooting: { name: 'å°„å‡»å¤§å¸ˆ', icon: 'ğŸ¯', desc: 'è€ƒéªŒä½ çš„å‡†åº¦' },
            platform: { name: 'è·³è·ƒå†’é™©', icon: 'ğŸ¦˜', desc: 'å¹³å°è·³è·ƒæ¸¸æˆ' },
            music: { name: 'éŸ³ä¹èŠ‚æ‹', icon: 'ğŸµ', desc: 'èŠ‚å¥æ„ŸæŒ‘æˆ˜' },
            card: { name: 'è®°å¿†å¡ç‰Œ', icon: 'ğŸƒ', desc: 'è®°å¿†åŠ›è®­ç»ƒ' },
            sudoku: { name: 'æ•°ç‹¬æ¸¸æˆ', icon: 'ğŸ”¢', desc: 'é€»è¾‘æ¨ç†æ•°å­—æ¸¸æˆ' },
            memory: { name: 'è®°å¿†å¤§å¸ˆ', icon: 'ğŸ§ ', desc: 'è®­ç»ƒè®°å¿†åŠ›' },
            math: { name: 'æ•°å­¦æŒ‘æˆ˜', icon: 'â•', desc: 'æ•°å­¦è¿ç®—èƒ½åŠ›' },
            word: { name: 'å•è¯æ¸¸æˆ', icon: 'ğŸ“', desc: 'è‹±è¯­å•è¯æŒ‘æˆ˜' },
            color: { name: 'é¢œè‰²è®°å¿†', icon: 'ğŸ¨', desc: 'é¢œè‰²ä½ç½®è®°å¿†' },
            cube: { name: 'ç«‹æ–¹ä½“', icon: 'ğŸ“¦', desc: '3Dç©ºé—´æ€ç»´' },
            chess: { name: 'äº”å­æ£‹', icon: 'âš«', desc: 'ç­–ç•¥å¯¹æˆ˜æ¸¸æˆ' },
            water: { name: 'å€’æ°´æ¸¸æˆ', icon: 'ğŸ§ª', desc: 'é€»è¾‘æ¨ç†å€’æ°´' },
            shape: { name: 'å›¾å½¢è®¡æ•°', icon: 'ğŸ”º', desc: 'è§†è§‰è®¡æ•°è®­ç»ƒ' }
        };

        // è§£ææ¸¸æˆé…ç½®
        function parseGameConfig(configText) {
            const parsedGames = {};
            
            if (!configText || typeof configText !== 'string') {
                return defaultGames;
            }

            try {
                // æŒ‰è¡Œåˆ†å‰²é…ç½®æ–‡æœ¬
                const lines = configText.split('\n');
                let currentCategory = '';
                
                for (const line of lines) {
                    const trimmedLine = line.trim();
                    
                    // è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š
                    if (!trimmedLine || trimmedLine.startsWith('#')) {
                        continue;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ†ç±»æ ‡é¢˜
                    if (trimmedLine.startsWith('## ')) {
                        currentCategory = trimmedLine.substring(3).trim();
                        continue;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯æ¸¸æˆé¡¹ç›®
                    if (trimmedLine.startsWith('### ')) {
                        const gameTitle = trimmedLine.substring(4).trim();
                        const parts = gameTitle.split(' ');
                        
                        if (parts.length >= 2) {
                            const icon = parts[0];
                            const name = parts.slice(1).join(' ');
                            
                            // ç”Ÿæˆæ¸¸æˆIDï¼ˆä½¿ç”¨åç§°çš„æ‹¼éŸ³æˆ–ç®€åŒ–ç‰ˆæœ¬ï¼‰
                            const gameId = name.toLowerCase()
                                .replace(/[^\w\s]/g, '')
                                .replace(/\s+/g, '_')
                                .substring(0, 20);
                            
                            parsedGames[gameId] = {
                                name: name,
                                icon: icon,
                                desc: '', // æè¿°å°†åœ¨ä¸‹ä¸€è¡Œè§£æ
                                category: currentCategory
                            };
                        }
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯æè¿°è¡Œ
                    if (trimmedLine.startsWith('- desc: ')) {
                        const desc = trimmedLine.substring(8).trim();
                        // æ‰¾åˆ°æœ€åæ·»åŠ çš„æ¸¸æˆå¹¶è®¾ç½®æè¿°
                        const gameIds = Object.keys(parsedGames);
                        if (gameIds.length > 0) {
                            const lastGameId = gameIds[gameIds.length - 1];
                            parsedGames[lastGameId].desc = desc;
                        }
                    }
                }
                
                // å¦‚æœè§£æåˆ°äº†æ¸¸æˆï¼Œè¿”å›è§£æç»“æœï¼Œå¦åˆ™è¿”å›é»˜è®¤æ¸¸æˆ
                return Object.keys(parsedGames).length > 0 ? parsedGames : defaultGames;
                
            } catch (error) {
                console.error('Error parsing game config:', error);
                return defaultGames;
            }
        }        // åŠ¨æ€ç”Ÿæˆæ¸¸æˆåˆ—è¡¨
        function generateGameList() {
            const gameListContainer = document.getElementById('gameList');
            gameListContainer.innerHTML = '';
            
            const gameKeys = Object.keys(games);
            if (gameKeys.length === 0) {
                gameListContainer.innerHTML = '<p class="text-gray-500 text-center py-4">æš‚æ— æ¸¸æˆæ•°æ®</p>';
                return;
            }
            
            gameKeys.forEach((gameId, index) => {
                const game = games[gameId];
                const isFirst = index === 0;
                
                const gameItem = document.createElement('div');
                gameItem.className = `game-item ${isFirst ? 'active' : ''} cursor-pointer p-4 rounded-lg transition-all duration-200`;
                gameItem.setAttribute('data-game-id', gameId);
                gameItem.addEventListener('click', () => selectGame(gameId));
                
                gameItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-3xl mr-3">${game.icon}</span>
                        <div>
                            <h3 class="font-bold">${game.name}</h3>
                            <p class="text-sm opacity-80">${game.desc || 'æš‚æ— æè¿°'}</p>
                        </div>
                    </div>
                `;
                
                gameListContainer.appendChild(gameItem);
            });
            
            // è®¾ç½®ç¬¬ä¸€ä¸ªæ¸¸æˆä¸ºå½“å‰æ¸¸æˆå¹¶æ›´æ–°ç•Œé¢
            if (gameKeys.length > 0) {
                currentGame = gameKeys[0];
                const firstGame = games[currentGame];
            }
        }

        // æ¶ˆæ¯ç›‘å¬å™¨
        window.addEventListener('message', function (e) {
            switch (e.data.type) {
                case 'setGameConfig':
                    gameConfig = e.data.data;
                    games = parseGameConfig(gameConfig);
                    generateGameList();
                    initializeData();
                    updateTitle();
                    updateLeaderboard();
                    console.log('Game config updated:', games);
                    break;
                case 'getGameStats':
                    // å‘é€æ¸¸æˆç»Ÿè®¡æ•°æ®
                    window.parent.postMessage({ 
                        type: 'gameStats', 
                        data: {
                            currentGame: currentGame,
                            games: Object.keys(games),
                            leaderboardData: leaderboardData
                        }
                    }, '*');
                    break;
            }
        });

        // å¹´é¾„ç»„é…ç½®
        const ageGroups = {
            'all': { name: 'æ··é¾„æ€»æ¦œ', emoji: 'ğŸ†', filter: () => true },
            '5-6': { name: '5-6å²', emoji: 'ğŸ‘¶', filter: (age) => age >= 5 && age <= 6 },
            '7-8': { name: '7-8å²', emoji: 'ğŸ§’', filter: (age) => age >= 7 && age <= 8 },
            '9-10': { name: '9-10å²', emoji: 'ğŸ‘¦', filter: (age) => age >= 9 && age <= 10 },
            '11-12': { name: '11-12å²', emoji: 'ğŸ‘§', filter: (age) => age >= 11 && age <= 12 },
            '13+': { name: '13å²ä»¥ä¸Š', emoji: 'ğŸ§‘', filter: (age) => age >= 13 }
        };

        let currentGame = 'puzzle';
        let currentTab = 'weekly';
        let currentAgeGroup = 'all';
        let leaderboardData = {};

        // åˆå§‹åŒ–æ¨¡æ‹Ÿæ•°æ®
        function initializeData() {
            Object.keys(games).forEach(gameId => {
                leaderboardData[gameId] = {
                    weekly: generateMockData(),
                    monthly: generateMockData()
                };
            });
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿæ’è¡Œæ¦œæ•°æ®
        function generateMockData() {
            const names = ['å°æ˜', 'å°çº¢', 'å°åˆš', 'å°ä¸½', 'å°å', 'å°ç‹', 'å°æ', 'å°å¼ ', 'å°é™ˆ', 'å°èµµ', 'å°å‘¨', 'å°å´', 'å°éƒ‘', 'å°å†¯', 'å°å­™'];
            const data = [];
            for (let i = 0; i < 120; i++) {
                data.push({
                    rank: i + 1,
                    name: names[Math.floor(Math.random() * names.length)] + (i + 1),
                    score: 100000 - i * 800 + Math.floor(Math.random() * 600),
                    age: Math.floor(Math.random() * 14) + 5 // 5-18å²
                });
            }
            return data.sort((a, b) => b.score - a.score);
        }

        // æ›´æ–°æ ‡é¢˜
        function updateTitle() {
            const tabName = currentTab === 'weekly' ? 'å‘¨æ¦œ' : 'æœˆæ¦œ';
            const ageName = ageGroups[currentAgeGroup].name;
            document.getElementById('rankingTitle').textContent = `${ageName}${tabName}`;
        }        // ä»ä¸‹æ‹‰èœå•é€‰æ‹©æ’è¡Œæ¦œ
        function selectLeaderboard(ageGroup) {
            event.preventDefault();
            currentAgeGroup = ageGroup;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateAgeButtons();
            updateTitle();
            updateLeaderboard();
        }

        // æ›´æ–°æ¦œå•ç±»å‹æŒ‰é’®çŠ¶æ€
        function updateTabButtons() {
            document.querySelectorAll('[id$="Tab"]').forEach(btn => {
                btn.className = 'bg-gray-200 text-gray-700 px-6 py-2 rounded-lg font-bold transition-all hover:bg-gray-300';
            });
            document.getElementById(currentTab + 'Tab').className = 'tab-active px-6 py-2 rounded-lg font-bold transition-all';
        }

        // æ›´æ–°å¹´é¾„ç»„æŒ‰é’®çŠ¶æ€
        function updateAgeButtons() {
            document.querySelectorAll('.age-button').forEach((btn, index) => {
                btn.classList.remove('active');
                const groups = ['all', '5-6', '7-8', '9-10', '11-12', '13+'];
                if (groups[index] === currentAgeGroup) {
                    btn.classList.add('active');
                }
            });
        }        // é€‰æ‹©æ¸¸æˆ
        function selectGame(gameId) {
            currentGame = gameId;
            
            // æ›´æ–°æ¸¸æˆé€‰æ‹©æ ·å¼
            document.querySelectorAll('.game-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-game-id') === gameId) {
                    item.classList.add('active');
                }
            });
            
            updateLeaderboard();
        }

        // åˆ‡æ¢æ¦œå•ç±»å‹
        function switchTab(tab) {
            currentTab = tab;
            updateTabButtons();
            updateTitle();
            updateLeaderboard();
        }

        // é€‰æ‹©å¹´é¾„ç»„
        function selectAge(ageGroup) {
            currentAgeGroup = ageGroup;
            updateAgeButtons();
            updateTitle();
            updateLeaderboard();
        }

        // æ›´æ–°æ’è¡Œæ¦œ
        function updateLeaderboard() {
            if (!currentGame) return;

            let data = [...leaderboardData[currentGame][currentTab]];

            // åº”ç”¨å¹´é¾„ç»„ç­›é€‰
            if (currentAgeGroup !== 'all') {
                data = data.filter(item => ageGroups[currentAgeGroup].filter(item.age));
            }

            document.getElementById('totalPlayers').textContent = data.length;

            const listContainer = document.getElementById('leaderboardList');
            listContainer.innerHTML = '';

            if (data.length === 0) {
                listContainer.innerHTML = `
                    <div class="flex items-center justify-center h-full text-gray-500">
                        <div class="text-center">
                            <div class="text-6xl mb-4">ğŸ¯</div>
                            <p class="text-xl">æš‚æ— ${ageGroups[currentAgeGroup].name}çš„ç©å®¶è®°å½•</p>
                            <p class="text-sm mt-2">å¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªä¸Šæ¦œçš„ç©å®¶å§ï¼</p>
                        </div>
                    </div>
                `;
                return;
            }

            data.slice(0, 100).forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `leaderboard-item flex items-center justify-between p-4 border-b hover:bg-gray-50 transition-all ${index < 3 ? 'text-white font-bold' : ''} ${item.name === 'æˆ‘' ? 'user-highlight' : ''}`;
                
                let rankDisplay = index + 1;
                let rankIcon = '';
                if (index === 0) rankIcon = 'ğŸ¥‡';
                else if (index === 1) rankIcon = 'ğŸ¥ˆ';
                else if (index === 2) rankIcon = 'ğŸ¥‰';

                div.innerHTML = `
                    <div class="flex items-center">
                        <div class="text-3xl font-bold mr-4 min-w-[60px] text-center ${index < 3 ? '' : 'text-gray-600'}">
                            ${rankIcon || rankDisplay}
                        </div>
                        <div class="flex items-center">
                            <div class="mr-4">
                                <div class="text-lg font-bold">${item.name}</div>
                                <div class="text-sm ${index < 3 ? 'text-white opacity-80' : 'text-gray-500'}">${item.age}å² ${item.name === 'æˆ‘' ? '(ä½ )' : ''}</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold">${item.score.toLocaleString()}</div>
                        <div class="text-sm ${index < 3 ? 'text-white opacity-80' : 'text-gray-500'}">åˆ†æ•°</div>
                    </div>
                `;
                
                listContainer.appendChild(div);
            });
        }

        // æ ¹æ®å¹´é¾„ç¡®å®šå¹´é¾„ç»„
        function getAgeGroup(age) {
            if (age >= 5 && age <= 6) return '5-6';
            if (age >= 7 && age <= 8) return '7-8';
            if (age >= 9 && age <= 10) return '9-10';
            if (age >= 11 && age <= 12) return '11-12';
            if (age >= 13) return '13+';
            return 'all';
        }

        // æäº¤åˆ†æ•°
        function submitScore() {
            const score = parseInt(document.getElementById('userScore').value);
            const age = parseInt(document.getElementById('userAge').value);

            if (!score || !age) {
                alert('è¯·è¾“å…¥åˆ†æ•°å’Œé€‰æ‹©å¹´é¾„');
                return;
            }

            if (score <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ†æ•°');
                return;
            }

            // ç§»é™¤ä¹‹å‰çš„ç”¨æˆ·è®°å½•
            ['weekly', 'monthly'].forEach(tab => {
                leaderboardData[currentGame][tab] = leaderboardData[currentGame][tab].filter(item => item.name !== 'æˆ‘');
            });

            // æ·»åŠ åˆ°æ’è¡Œæ¦œæ•°æ®
            const userEntry = {
                rank: 0,
                name: 'æˆ‘',
                score: score,
                age: age
            };

            // æ·»åŠ åˆ°æ‰€æœ‰ç›¸å…³æ¦œå•
            ['weekly', 'monthly'].forEach(tab => {
                leaderboardData[currentGame][tab].push(userEntry);
                leaderboardData[currentGame][tab].sort((a, b) => b.score - a.score);
                // é‡æ–°è®¡ç®—æ’å
                leaderboardData[currentGame][tab].forEach((item, index) => {
                    item.rank = index + 1;
                });
            });

            // è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”å¹´é¾„ç»„
            const targetAgeGroup = getAgeGroup(age);
            currentAgeGroup = targetAgeGroup;
            updateAgeButtons();
            updateTitle();

            // è·å–ç”¨æˆ·æ’åä¿¡æ¯
            const userRank = leaderboardData[currentGame][currentTab].findIndex(item => item.name === 'æˆ‘') + 1;
            document.getElementById('rankInfo').textContent = `ä½ åœ¨${games[currentGame].name}ä¸­æ’åç¬¬ ${userRank} ä½ï¼`;

            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('userScore').value = '';
            document.getElementById('userAge').value = '';

            // æ˜¾ç¤ºæˆåŠŸæç¤º
            document.getElementById('successModal').classList.remove('hidden');

            // æ›´æ–°æ’è¡Œæ¦œ
            updateLeaderboard();

            // æ»šåŠ¨åˆ°ç”¨æˆ·ä½ç½®
            setTimeout(() => {
                const userItem = document.querySelector('.user-highlight');
                if (userItem) {
                    userItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
        }        // é¡µé¢åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // åˆå§‹åŒ–ä¸ºé»˜è®¤æ¸¸æˆ
            games = defaultGames;
            generateGameList();
            initializeData();
            updateTitle();
            updateLeaderboard();
            
            // é€šçŸ¥çˆ¶çª—å£æ¸¸æˆå·²åŠ è½½å®Œæˆ
            window.parent.postMessage({ type: 'gameLoaded' }, '*');
        });
    </script>
</body>
</html>
