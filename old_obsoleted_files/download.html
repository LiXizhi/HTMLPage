<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>麦思星球 - 下载</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <script>
      // Global Configuration - 全局配置
      const GLOBAL_CONFIG = {
        apkDownloadUrl: "https://cdn.keepwork.com/dist/maseai/maseai-v1.6-10-20251026-1129-master-release.apk",
        webUrl: "https://play.maseai.com",
        webGameUrl: "https://keepwork.com/public/resource/miniGameProxy.html?projectPath=maisi/maisi/webgames/data&gameName=ms_games_login&ver=11",
        iosAppStoreUrl: "https://apps.apple.com/app/6749035691",
        androidPlayStoreUrl: "https://play.google.com/store/apps/details?id=com.maixi.planet",
      };
    </script>
    <style>
      .download-card {
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .download-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .recommended {
        border-color: #3b82f6;
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      }

      .secondary-recommended {
        border-color: #10b981;
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      }

      .maixi-qrcode {
        background-image: url("https://api.keepwork.com/ts-storage/siteFiles/46418/raw#qrcodemaisiai.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
    </style>
  </head>

  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <!-- Download Options Container -->
      <div id="downloadContainer" class="space-y-4">
        <!-- iOS App Store -->
        <div class="download-card bg-white rounded-xl p-6 shadow-lg" data-platform="ios" data-priority="0">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="text-4xl">🍎</div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">iOS版本</h3>
                <p class="text-gray-600">从苹果应用商店安装</p>
                <div class="flex items-center mt-1">
                  <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">推荐</span>
                </div>
              </div>
            </div>
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" onclick="downloadApp('ios-appstore')">立即安装</button>
          </div>
        </div>

        <!-- Android APK Direct -->
        <div class="download-card bg-white rounded-xl p-6 shadow-lg" data-platform="android" data-priority="0">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="text-4xl">🤖</div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">Android 安卓版本</h3>
                <p class="text-gray-600">直接下载安装包, 或从安卓应用商店安装</p>
                <div class="flex items-center mt-1">
                  <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">推荐</span>
                  <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded ml-1">快速</span>
                </div>
              </div>
            </div>
            <a
              href=""
              class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center"
              id="apkDownloadButton"
              download
            >
              下载APK
            </a>
          </div>
        </div>

        <!-- Android Play Store -->
        <div class="download-card bg-white rounded-xl p-6 shadow-lg" data-platform="android" data-priority="1">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="text-4xl">📱</div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">Google Play</h3>
                <p class="text-gray-600">从Google应用商店安装</p>
              </div>
            </div>
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" onclick="downloadApp('android-playstore')">打开商店</button>
          </div>
        </div>
        <!-- Web Version -->
        <div class="download-card bg-white rounded-xl p-6 shadow-lg" data-platform="web" data-priority="1">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="text-4xl">🌐</div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">电脑网页版</h3>
                <p class="text-gray-600">鼠标、键盘、大屏更护眼</p>
                <p class="text-sm text-blue-600 font-mono bg-blue-50 px-2 py-1 rounded mt-1" id="webUrlDisplay"></p>
                <div class="flex items-center mt-1">
                  <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">推荐</span>
                  <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded ml-1">支持鼠标/键盘</span>
                </div>
              </div>
            </div>
            <div class="flex flex-col gap-2" id="webButtonContainer">
              <button class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" onclick="copyWebUrl()">复制网址</button>
            </div>
          </div>
        </div>
        <!-- WeChat Mini Program -->
        <div class="download-card bg-white rounded-xl p-6 shadow-lg" data-platform="wechat" data-priority="2">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="text-4xl">💬</div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">微信服务号</h3>
                <p class="text-gray-600">支持微信PC版/手机多端登录</p>
                <div class="flex items-center mt-2 space-x-3">
                  <div class="w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center border cursor-pointer hover:bg-gray-100 transition-colors maixi-qrcode" onclick="showQRCode()"></div>
                  <div class="text-sm">
                    <p class="text-gray-500">扫描二维码关注</p>
                    <p class="text-blue-600 font-medium">麦思星球</p>
                  </div>
                </div>
              </div>
            </div>
            <button class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" onclick="showQRCode()">扫码关注</button>
          </div>
        </div>
      </div>

      <!-- Device Info -->
      <div class="mt-8 text-center">
        <div class="bg-white rounded-lg p-4 shadow-md">
          <p class="text-sm text-gray-600">当前检测到的设备: <span id="deviceInfo" class="font-medium text-blue-600"></span></p>
          <p class="text-xs text-gray-500 mt-1">我们已为您优化显示顺序</p>
        </div>
      </div>
      <!-- Footer -->
      <div class="mt-12 text-center text-gray-500 text-sm">
        <p>🌟<span class="">麦思星球</span>：让每个孩子在自己的世界里<span class="shine-text">自由发光</span>🌟</p>
      </div>
    </div>

    <!-- 二维码弹窗 -->
    <div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-8 max-w-sm mx-4 text-center">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">扫码关注麦思星球</h3>
        <div class="mb-4">
          <div class="w-48 h-48 mx-auto rounded-lg maixi-qrcode"></div>
        </div>
        <p class="text-gray-600 mb-2">使用微信扫描二维码</p>
        <p class="text-blue-600 font-medium mb-4">关注麦思星球公众号</p>
        <button onclick="hideQRCode()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">关闭</button>
      </div>
    </div>

    <script>
      // 设备检测函数
      function detectDevice() {
        const userAgent = navigator.userAgent.toLowerCase();
        const isWeChat = /micromessenger/i.test(userAgent);
        const isIOS = /iphone|ipad|ipod/.test(userAgent);
        const isAndroid = /android|harmonyos/.test(userAgent);
        const isMobile = /mobile|tablet|phone|pad/.test(userAgent) || isIOS || isAndroid;
        const isPC = !isMobile;

        return {
          isWeChat,
          isIOS,
          isAndroid,
          isMobile,
          isPC,
          userAgent,
        };
      }

      // 重新排序下载选项
      function reorderDownloadOptions() {
        const device = detectDevice();
        const container = document.getElementById("downloadContainer");
        const cards = Array.from(container.children);

        // 显示设备信息
        let deviceText = "";
        if (device.isWeChat) deviceText = "微信浏览器";
        else if (device.isIOS) deviceText = "iOS设备";
        else if (device.isAndroid) deviceText = "Android设备";
        else if (device.isPC) deviceText = "PC浏览器";
        else deviceText = "未知设备";

        document.getElementById("deviceInfo").textContent = deviceText;

        // 清除现有的推荐标记
        cards.forEach((card) => {
          card.classList.remove("recommended", "secondary-recommended");
          const badges = card.querySelectorAll(".bg-blue-100, .bg-green-100");
          badges.forEach((badge) => {
            if (badge.textContent === "推荐" || badge.textContent === "次推荐") {
              badge.remove();
            }
          });
        });

        // 根据设备类型重新排序
        let sortedCards = [];

        if (device.isIOS) {
          // iOS设备：iOS App Store > Web版 > 其他
          sortedCards = cards.sort((a, b) => {
            const aPlat = a.dataset.platform;
            const bPlat = b.dataset.platform;

            if (aPlat === "ios") return -1;
            if (bPlat === "ios") return 1;
            if (aPlat === "web") return -1;
            if (bPlat === "web") return 1;
            return 0;
          });
        } else if (device.isAndroid) {
          // Android设备：Android APK > Android Play Store > Web版 > 其他
          sortedCards = cards.sort((a, b) => {
            const aPlat = a.dataset.platform;
            const bPlat = b.dataset.platform;
            const aPrio = parseInt(a.dataset.priority);
            const bPrio = parseInt(b.dataset.priority);

            if (aPlat === "android" && bPlat === "android") {
              return aPrio - bPrio; // APK(0) 优先于 Play Store(1)
            }
            if (aPlat === "android") return -1;
            if (bPlat === "android") return 1;
            if (aPlat === "web") return -1;
            if (bPlat === "web") return 1;
            return 0;
          });
        } else if (device.isWeChat) {
          // 微信浏览器：微信服务号 > Web版 > 移动端应用
          sortedCards = cards.sort((a, b) => {
            const aPlat = a.dataset.platform;
            const bPlat = b.dataset.platform;

            if (aPlat === "wechat") return -1;
            if (bPlat === "wechat") return 1;
            if (aPlat === "web") return -1;
            if (bPlat === "web") return 1;
            return 0;
          });
        } else {
          // PC浏览器：Web版优先
          sortedCards = cards.sort((a, b) => {
            const aPlat = a.dataset.platform;
            const bPlat = b.dataset.platform;

            if (aPlat === "web") return -1;
            if (bPlat === "web") return 1;
            return 0;
          });
        }

        // 添加推荐标记
        if (sortedCards.length > 0) {
          // 第一个选项标记为推荐
          sortedCards[0].classList.add("recommended");
          const firstBadgeContainer = sortedCards[0].querySelector(".flex.items-center.mt-1");
          if (firstBadgeContainer) {
            const recommendedBadge = document.createElement("span");
            recommendedBadge.className = "bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded";
            recommendedBadge.textContent = "推荐";
            firstBadgeContainer.insertBefore(recommendedBadge, firstBadgeContainer.firstChild);
          }

          // Web版总是作为次推荐（如果不是第一推荐的话）
          const webCard = sortedCards.find((card) => card.dataset.platform === "web");
          if (webCard && webCard !== sortedCards[0]) {
            webCard.classList.add("secondary-recommended");
            const webBadgeContainer = webCard.querySelector(".flex.items-center.mt-1");
            if (webBadgeContainer) {
              const secondaryBadge = document.createElement("span");
              secondaryBadge.className = "bg-green-100 text-green-800 text-xs px-2 py-1 rounded";
              secondaryBadge.textContent = "次推荐";
              webBadgeContainer.insertBefore(secondaryBadge, webBadgeContainer.firstChild);
            }
          }
        }

        // 重新排列DOM元素
        container.innerHTML = "";
        sortedCards.forEach((card) => container.appendChild(card));
      } // 复制网址函数
      function copyWebUrl() {
        const webUrl = GLOBAL_CONFIG.webUrl;

        // 尝试使用现代的Clipboard API
        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard
            .writeText(webUrl)
            .then(() => {
              showCopySuccess();
            })
            .catch((err) => {
              // 如果失败，使用备用方法
              fallbackCopyTextToClipboard(webUrl);
            });
        } else {
          // 使用备用方法
          fallbackCopyTextToClipboard(webUrl);
        }
      }

      // 备用复制方法
      function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.top = "0";
        textArea.style.left = "0";
        textArea.style.position = "fixed";
        textArea.style.opacity = "0";

        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
          document.execCommand("copy");
          showCopySuccess();
        } catch (err) {
          showNotification('复制失败', `请手动复制网址：\n\n${text}`, 'error');
        }

        document.body.removeChild(textArea);
      } // 显示复制成功提示
      function showCopySuccess() {
        // 创建临时提示元素
        const toast = document.createElement("div");
        toast.className = "fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300";
        toast.textContent = "网址已复制到剪贴板";

        document.body.appendChild(toast);

        // 3秒后移除提示
        setTimeout(() => {
          toast.style.opacity = "0";
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 300);
        }, 3000);
      }

      // 显示二维码弹窗
      function showQRCode() {
        document.getElementById("qrModal").classList.remove("hidden");
      }

      // 隐藏二维码弹窗
      function hideQRCode() {
        document.getElementById("qrModal").classList.add("hidden");
      }

      // 点击弹窗外部关闭
      document.getElementById("qrModal").addEventListener("click", function (e) {
        if (e.target === this) {
          hideQRCode();
        }
      }); 
      // APK下载函数 - 专门处理移动端下载
      function onClickDownloadAPK() {
        const device = detectDevice();
        const apkUrl = GLOBAL_CONFIG.apkDownloadUrl;

        // 检测微信浏览器
        if (device.isWeChat) {
          showNotification(
            '检测到微信浏览器', 
            `为了正常下载APK安装包，请：\n\n1. 点击右上角"..."菜单\n2. 选择"在浏览器中打开"\n3. 然后重新点击下载按钮\n\n或者复制链接到系统浏览器中打开：\n${apkUrl}`, 
            'warning'
          );
          return;
        }

        // 显示下载开始提示
        showDownloadTip();
      }

      // 显示下载提示
      function showDownloadTip() {
        const device = detectDevice();
        const toast = document.createElement("div");
        toast.id = "downloadToast";
        toast.className = "fixed top-4 left-4 right-4 bg-blue-500 text-white p-4 rounded-lg shadow-lg z-50 transition-all duration-300";

        let tipContent = "";
        if (device.isMobile) {
          tipContent = `
                    <div class="flex items-start space-x-3">
                        <div class="text-2xl">📱</div>
                        <div class="flex-1">
                            <div class="font-semibold">正在尝试下载APK安装包...</div>
                            <div class="text-sm mt-1">如果下载未自动开始：</div>
                            <div class="text-xs mt-1 space-y-1">
                                <div>• 检查浏览器是否允许下载文件</div>
                                <div>• 查看通知栏或下载管理器</div>
                                <div>• 尝试长按下载按钮选择"下载链接"</div>
                            </div>
                            <div class="text-xs mt-2 opacity-90">下载完成后在文件管理器中找到APK文件并安装</div>
                            <button onclick="manualDownload()" class="mt-2 bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium hover:bg-gray-100">
                                手动下载
                            </button>
                        </div>
                        <button onclick="closeDownloadTip()" class="text-white hover:text-gray-200 text-xl leading-none">&times;</button>
                    </div>
                `;
        } else {
          tipContent = `
                    <div class="flex items-start space-x-3">
                        <div class="text-2xl">💻</div>
                        <div class="flex-1">
                            <div class="font-semibold">正在下载APK安装包...</div>
                            <div class="text-sm mt-1">请传输到Android设备进行安装</div>
                            <button onclick="manualDownload()" class="mt-2 bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium hover:bg-gray-100">
                                重新下载
                            </button>
                        </div>
                        <button onclick="closeDownloadTip()" class="text-white hover:text-gray-200 text-xl leading-none">&times;</button>
                    </div>
                `;
        }

        toast.innerHTML = tipContent;
        document.body.appendChild(toast);

        // 10秒后自动移除提示
        setTimeout(() => {
          closeDownloadTip();
        }, 10000);
      }

      // 手动下载函数
      function manualDownload() {
        window.open(GLOBAL_CONFIG.apkDownloadUrl, "_blank");
      }

      // 关闭下载提示
      function closeDownloadTip() {
        const toast = document.getElementById("downloadToast");
        if (toast) {
          toast.style.opacity = "0";
          setTimeout(() => {
            if (document.body.contains(toast)) {
              document.body.removeChild(toast);
            }
          }, 300);
        }
      }

      // 显示自定义通知替代alert
      function showNotification(title, message, type = 'info') {
        const notificationId = 'notification_' + Date.now();
        const notification = document.createElement('div');
        notification.id = notificationId;
        notification.className = `fixed top-4 left-4 right-4 md:left-1/2 md:right-auto md:transform md:-translate-x-1/2 md:max-w-md bg-white border-l-4 rounded-lg shadow-xl z-50 transition-all duration-300 ${
          type === 'error' ? 'border-red-500' : 
          type === 'warning' ? 'border-yellow-500' : 
          'border-blue-500'
        }`;
        
        notification.innerHTML = `
            <div class="p-4 cursor-pointer" onclick="closeNotification('${notificationId}')">
            <div class="flex items-start justify-between">
              <div class="flex items-start space-x-3 flex-1">
              <div class="text-2xl">
                ${type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
              </div>
              <div class="flex-1">
                <div class="font-semibold text-gray-800 mb-2">${title}</div>
                <div class="text-sm text-gray-600 whitespace-pre-line">${message}</div>
              </div>
              </div>
              <button onclick="event.stopPropagation(); closeNotification('${notificationId}')" 
              class="text-gray-400 hover:text-gray-600 text-xl leading-none flex-shrink-0 ml-2">
              ×
              </button>
            </div>
            </div>
        `;
        
        document.body.appendChild(notification);
      }

      // 关闭通知
      function closeNotification(notificationId) {
        const notification = document.getElementById(notificationId);
        if (notification) {
          notification.style.opacity = '0';
          notification.style.transform = 'translateY(-20px)';
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        }
      }

      // 下载处理函数
      function downloadApp(type) {
        const device = detectDevice();
        // 下载链接
        const downloadLinks = {
          "ios-appstore": GLOBAL_CONFIG.iosAppStoreUrl,
          "android-playstore": GLOBAL_CONFIG.androidPlayStoreUrl,
          web: GLOBAL_CONFIG.webUrl,
        };

        if (type === "wechat") {
          // 显示二维码弹窗
          showQRCode();
          return;
        }

        // 直接下载
        if (downloadLinks[type]) {
          window.open(downloadLinks[type], "_blank");
        }
      }

      // 启动网页版函数
      function launchWebVersion() {
        window.open(GLOBAL_CONFIG.webGameUrl, "_blank");
      }

      // 初始化配置
      function initializeConfig() {
        // 设置网页版URL显示
        const webUrlDisplay = document.getElementById("webUrlDisplay");
        if (webUrlDisplay) {
          webUrlDisplay.textContent = GLOBAL_CONFIG.webUrl;
        }

        // 设置APK下载链接
        const apkDownloadButton = document.getElementById("apkDownloadButton");
        if (apkDownloadButton) {
          const device = detectDevice();
          if (!device.isWeChat) {
            apkDownloadButton.href = GLOBAL_CONFIG.apkDownloadUrl;
          } else {
            apkDownloadButton.onclick = onClickDownloadAPK;
            apkDownloadButton.removeAttribute('href');
          }
        }

        // 为PC平台添加"启动网页版"按钮
        const device = detectDevice();
        if (device.isPC) {
          const webButtonContainer = document.getElementById("webButtonContainer");
          if (webButtonContainer) {
            const launchButton = document.createElement("button");
            launchButton.className = "bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors";
            launchButton.textContent = "启动网页版";
            launchButton.onclick = launchWebVersion;
            webButtonContainer.appendChild(launchButton);
          }
        }
      }

      // 页面加载完成后执行初始化和排序
      initializeConfig();
      reorderDownloadOptions();

      // 监听窗口大小变化（处理横竖屏切换等情况）
      window.addEventListener("resize", function () {
        setTimeout(reorderDownloadOptions, 100);
      });
    </script>
  </body>
</html>
