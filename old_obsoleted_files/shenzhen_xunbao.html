
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¹åŸæ°‘é—´è‰ºæœ¯å°ä¼ äººï¼šéé—å¯»å®è®°</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }
        
        .pengzi-chat {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .game-card {
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .treasure-box {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .modal {
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-purple-50 to-pink-100 min-h-screen">
    
    <!-- æ¸¸æˆå®¹å™¨ -->
    <div id="gameContainer" class="max-w-4xl mx-auto p-4">
        
        <!-- å¼€åœºåœºæ™¯ -->
        <div id="introScene" class="scene">
            <div class="bg-white rounded-xl shadow-xl p-8 text-center">
                <div class="mb-6">
                    <div class="w-32 h-32 mx-auto bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center mb-4">
                        <div class="text-4xl">ğŸ¦€</div>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">é¹åŸæ°‘é—´è‰ºæœ¯å°ä¼ äºº</h1>
                    <h2 class="text-xl text-purple-600 mb-4">éé—å¯»å®è®°</h2>
                </div>
                
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-6">
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-white text-gray-800 rounded-full w-16 h-16 flex items-center justify-center text-2xl mb-2">ğŸ¦€</div>
                        <p class="text-sm font-medium">é¹ä»”</p>
                    </div>
                    <div class="bg-white/20 rounded-lg p-4 text-left">
                        <p class="mb-3">ä½ å¥½ï¼Œæœªæ¥çš„æ–‡åŒ–å®ˆæŠ¤è€…ï¼</p>
                        <p class="mb-3">æˆ‘æ˜¯ä½ çš„æ™ºèƒ½åŠ©æ‰‹é¹ä»”ï¼Œä¸€åªæ¥è‡ªæ·±åœ³æ¹¾çº¢æ ‘æ—çš„æ‹›æ½®èŸ¹ã€‚</p>
                        <p>è®©æˆ‘ä»¬ä¸€èµ·ä¹˜åæ—¶å…‰æœºï¼Œå¯»æ‰¾å¹¶ä¼ æ‰¿å³å°†å¤±è½çš„"é¹åŸä¸ƒè‰º"å§ï¼</p>
                    </div>
                </div>
                
                <div class="skyline mb-6">
                    <div class="flex justify-center items-end space-x-2">
                        <div class="w-8 h-16 bg-gray-600 rounded-t"></div>
                        <div class="w-12 h-24 bg-blue-600 rounded-t"></div>
                        <div class="w-10 h-20 bg-purple-600 rounded-t"></div>
                        <div class="w-14 h-28 bg-gray-700 rounded-t"></div>
                        <div class="w-8 h-16 bg-green-600 rounded-t"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">æ·±åœ³å¤©é™…çº¿</p>
                </div>
                
                <button onclick="startGame()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-full font-medium hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                    å¼€å§‹éé—å¯»å®ä¹‹æ—…
                </button>
            </div>
        </div>
        
        <!-- è¯¾å‰æµ‹è¯•åœºæ™¯ -->
        <div id="preTestScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">é¹åŸéé—çŸ¥å¤šå°‘ï¼Ÿ</h2>
                    <div class="pengzi-chat inline-block">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">ğŸ¦€</div>
                    </div>
                    <p class="text-gray-600">å°ä¼ äººï¼Œè®©æˆ‘ä»¬å…ˆæ¥æµ‹è¯•ä¸€ä¸‹ä½ å¯¹é¹åŸéé—çš„åˆå§‹è®°å¿†å§ï¼</p>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4">ä»¥ä¸‹å“ªäº›æ˜¯æ·±åœ³çš„æ°‘é—´è‰ºæœ¯ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="preTestOptions">
                        <!-- é€‰é¡¹ä¼šé€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="text-center">
                    <button onclick="submitPreTest()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        æäº¤ç­”æ¡ˆ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ä½“éªŒåœºæ™¯ -->
        <div id="experienceScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">é¹åŸéé—å·¥åŠ</h2>
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">ğŸ¦€</div>
                    </div>
                    <p class="text-gray-600">æ¬¢è¿æ¥åˆ°éé—å·¥åŠï¼è¿™é‡Œæœ‰ä¸ƒä¸ªç¥å¥‡çš„ä½“éªŒåŒºï¼Œè®©æˆ‘ä»¬ä¸€èµ·å”¤é†’ä¸ƒè‰ºä¹‹é­‚å§ï¼</p>
                </div>
                
                <!-- è¿›åº¦æ¡ -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600">ä½“éªŒè¿›åº¦</span>
                        <span class="text-sm text-gray-600" id="progressText">0/7</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full progress-bar" style="width: 0%" id="progressBar"></div>
                    </div>
                </div>
                
                <!-- ä¸ƒè‰ºä½“éªŒåŒº -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="artExperiences">
                    <!-- ä½“éªŒå¡ç‰‡ä¼šé€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="text-center mt-8">
                    <button id="nextToTreasure" onclick="showTreasureScene()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-8 py-3 rounded-full font-medium hover:from-yellow-500 hover:to-orange-600 transition-all transform hover:scale-105 hidden">
                        å‰å¾€å®ç®±é€‰æ‹©
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å®ç®±é€‰æ‹©åœºæ™¯ -->
        <div id="treasureScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">ç§˜å¢ƒå®ç®±</h2>
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">ğŸ¦€</div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <p class="text-gray-700" id="treasureRecommendation">æ ¹æ®ä½ çš„ä½“éªŒè¡¨ç°ï¼Œæˆ‘æ¨èä½ é€‰æ‹©...</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="treasureBoxes">
                    <!-- å®ç®±ä¼šé€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="text-center mt-6">
                    <button onclick="openSelectedBoxes()" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">
                        æ‰“å¼€é€‰ä¸­çš„å®ç®±
                    </button>
                </div>
            </div>
        </div>
        
        <!-- è¯¾åæ¢å®åœºæ™¯ -->
        <div id="afterScene" class="scene hidden">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">éé—ç§˜å¢ƒæ¢å®</h2>
                    <div class="pengzi-chat inline-block mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2">ğŸ¦€</div>
                    </div>
                    <p class="text-gray-600">æ­å–œä½ è·å¾—äº†ç§˜å¢ƒä¹‹é’¥ï¼å¿«å»å®åœ°æ¢è®¿çœŸæ­£çš„éé—ä¼ æ‰¿åœ°å§ï¼</p>
                </div>
                
                <div id="secretKeys" class="space-y-4 mb-6">
                    <!-- ç§˜å¢ƒé’¥åŒ™ä¼šé€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="text-center">
                    <button onclick="showEasterEgg()" class="bg-gradient-to-r from-pink-400 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-pink-500 hover:to-purple-600 transition-all">
                        ğŸ å‘ç°æ›´å¤šå½©è›‹
                    </button>
                    <button onclick="restartGame()" class="ml-4 bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                        é‡æ–°å¼€å§‹æ¸¸æˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ¸¸æˆæ¨¡æ€æ¡† -->
    <div id="gameModal" class="fixed inset-0 bg-black/50 modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6" id="modalContent">
            <!-- æ¨¡æ€æ¡†å†…å®¹ä¼šåŠ¨æ€æ›´æ–° -->
        </div>
    </div>
    
    <!-- å½©è›‹æ¨¡æ€æ¡† -->
    <div id="easterEggModal" class="fixed inset-0 bg-black/50 modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-96 overflow-y-auto p-6">
            <h3 class="text-xl font-bold mb-4">ğŸŠ æ·±åœ³Â·ä¸­å›½éé—ä¸‡èŠ±ç­’</h3>
            <div class="pengzi-chat text-center mb-4">
                <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2 mx-auto">ğŸ¦€</div>
                <p class="text-sm text-gray-600">å°ä¼ äººï¼Œé¹åŸçš„éé—å®è—å¯ä¸æ­¢è¿™ä¸ƒé¡¹å“¦ï¼çœ‹çœ‹æ›´å¹¿é˜”çš„éé—ä¸–ç•Œå§ï¼</p>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-blue-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">ğŸ­</div>
                    <p class="text-sm font-medium">ç²¤å‰§</p>
                    <p class="text-xs text-gray-600">å—å›½çº¢è±†</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">ğŸ®</div>
                    <p class="text-sm font-medium">æ²™å¤´è§’é±¼ç¯èˆ</p>
                    <p class="text-xs text-gray-600">æµ·ä¸Šæ˜ç </p>
                </div>
                <div class="bg-yellow-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">ğŸ²</div>
                    <p class="text-sm font-medium">ä¸‹æ²™å¤§ç›†èœ</p>
                    <p class="text-xs text-gray-600">å›´æ‘ç››å®´</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">ğŸ¨</div>
                    <p class="text-sm font-medium">æ»¡å ‚çº¢ç“·è‰º</p>
                    <p class="text-xs text-gray-600">çº¢é‡‰å½©ç“·</p>
                </div>
                <div class="bg-pink-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">ğŸ’Š</div>
                    <p class="text-sm font-medium">å¹³ä¹éƒ­æ°æ­£éª¨</p>
                    <p class="text-xs text-gray-600">æ‚¬å£¶æµä¸–</p>
                </div>
                <div class="bg-indigo-50 p-3 rounded-lg text-center">
                    <div class="text-2xl mb-2">ğŸº</div>
                    <p class="text-sm font-medium">æ›´å¤šéé—...</p>
                    <p class="text-xs text-gray-600">ç­‰ä½ æ¢ç´¢</p>
                </div>
            </div>
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg text-center">
                <p class="mb-2">ğŸŒŸ æš‘æœŸéé—æ¢é™©å®¶é‚€è¯·</p>
                <p class="text-sm">é€‰æ‹©ä¸€ä¸ªå¿ƒåŠ¨çš„é¡¹ç›®ï¼Œå»å›¾ä¹¦é¦†ã€åšç‰©é¦†æˆ–å®åœ°æ¢è®¿ï¼Œæˆä¸ºå°å°éé—æ¢é™©å®¶å§ï¼</p>
            </div>
            <div class="text-center mt-4">
                <button onclick="closeEasterEgg()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        let gameData = {
            preTestAnswers: [],
            artScores: {},
            selectedBoxes: [],
            currentProgress: 0        };
          // ä¸ƒè‰ºæ•°æ®
        const arts = [
            {
                id: 'paper-cutting',
                name: 'ç”°æ°å‰ªçº¸',
                icon: 'âœ‚ï¸',
                color: 'bg-red-500',
                description: 'å·§æ‰‹å‰ªä¹¾å¤',
                location: 'ç½—æ¹–åŒº',
                venue: 'ç½—æ¹–åŒºæ–‡åŒ–é¦†éé—å±•ç¤ºä¸­å¿ƒ',
                address: 'æ·±åœ³å¸‚ç½—æ¹–åŒºæ¡‚å›­è¡—é“',
                activity: 'æ¯å‘¨ä¸‰ä¸‹åˆæœ‰å‰ªçº¸ä½“éªŒè¯¾ç¨‹'
            },
            {
                id: 'qilin-dance',
                name: 'éº’éºŸèˆ',
                icon: 'ğŸ¦„',
                color: 'bg-yellow-500',
                description: 'ç‘å…½çŒ®ç¥¥å’Œ',
                location: 'ç¦ç”°åŒº',
                venue: 'ç¦ç”°åŒºæ°‘ä¿—æ–‡åŒ–æ‘',
                address: 'æ·±åœ³å¸‚ç¦ç”°åŒºåå¼ºåŒ—è¡—é“',
                activity: 'æ¯å‘¨å…­ä¸Šåˆæœ‰éº’éºŸèˆè¡¨æ¼”å’Œæ•™å­¦'
            },
            {
                id: 'fish-lantern',
                name: 'é±¼ç¯èˆ',
                icon: 'ğŸ ',
                color: 'bg-blue-500',
                description: 'é±¼è·ƒé¾™é—¨é˜µ',
                location: 'ç›ç”°åŒº',
                venue: 'ç›ç”°åŒºæ²™å¤´è§’é±¼ç¯èˆä¼ æ‰¿åŸºåœ°',
                address: 'æ·±åœ³å¸‚ç›ç”°åŒºæ²™å¤´è§’è¡—é“',
                activity: 'èŠ‚åº†æœŸé—´æœ‰é±¼ç¯èˆå·¡æ¸¸è¡¨æ¼”'
            },
            {
                id: 'mantis-boxing',
                name: 'è³è‚æ‹³',
                icon: 'ğŸ¥‹',
                color: 'bg-green-500',
                description: 'ä»¿ç”Ÿæ­¦ä¹‹é“',
                location: 'å®å®‰åŒº',
                venue: 'å®å®‰åŒºä¼ ç»Ÿæ­¦æœ¯é¦†',
                address: 'æ·±åœ³å¸‚å®å®‰åŒºæ–°å®‰è¡—é“',
                activity: 'å‘¨æœ«æœ‰è³è‚æ‹³æ•™å­¦è¯¾ç¨‹'
            },
            {
                id: 'hakka-hat',
                name: 'å®¢å®¶å‡‰å¸½',
                icon: 'ğŸ‘’',
                color: 'bg-purple-500',
                description: 'ç»çº¬ç»‡æ¸…å‡‰',
                location: 'é¾™å²—åŒº',
                venue: 'é¾™å²—å®¢å®¶æ°‘ä¿—åšç‰©é¦†',
                address: 'æ·±åœ³å¸‚é¾™å²—åŒºé¾™åŸè¡—é“',
                activity: 'å¯é¢„çº¦ä½“éªŒå‡‰å¸½åˆ¶ä½œå·¥è‰º'
            },
            {
                id: 'sea-urchin-zongzi',
                name: 'æµ·èƒ†ç²½',
                icon: 'ğŸ™',
                color: 'bg-orange-500',
                description: 'å±±æµ·æ»‹å‘³è—',
                location: 'å¤§é¹æ–°åŒº',
                venue: 'å¤§é¹æ‰€åŸéé—ç¾é£Ÿä½“éªŒé¦†',
                address: 'æ·±åœ³å¸‚å¤§é¹æ–°åŒºå¤§é¹æ‰€åŸ',
                activity: 'ç«¯åˆèŠ‚æœŸé—´æœ‰æµ·èƒ†ç²½åˆ¶ä½œä½“éªŒ'
            },
            {
                id: 'woodblock-print',
                name: 'ç‰ˆç”»è‰ºæœ¯',
                icon: 'ğŸ–¼ï¸',
                color: 'bg-indigo-500',
                description: 'åˆ»å°æ–°ç¯‡ç« ',
                location: 'é¾™å²—åŒº',
                venue: 'è§‚æ¾œç‰ˆç”»åŸåˆ›äº§ä¸šåŸºåœ°',
                address: 'æ·±åœ³å¸‚é¾™å²—åŒºè§‚æ¾œè¡—é“',
                activity: 'ç‰ˆç”»å·¥åŠå¸¸å¹´å¼€æ”¾ä½“éªŒ'
            }
        ];
        
        // è¯¾å‰æµ‹è¯•é€‰é¡¹ï¼ˆåŒ…å«å¹²æ‰°é¡¹ï¼‰
        const preTestOptions = [
            { name: 'ç”°æ°å‰ªçº¸', correct: true, icon: 'âœ‚ï¸' },
            { name: 'éº’éºŸèˆ', correct: true, icon: 'ğŸ¦„' },
            { name: 'é±¼ç¯èˆ', correct: true, icon: 'ğŸ ' },
            { name: 'è³è‚æ‹³', correct: true, icon: 'ğŸ¥‹' },
            { name: 'å®¢å®¶å‡‰å¸½', correct: true, icon: 'ğŸ‘’' },
            { name: 'æµ·èƒ†ç²½', correct: true, icon: 'ğŸ™' },
            { name: 'ç‰ˆç”»è‰ºæœ¯', correct: true, icon: 'ğŸ–¼ï¸' },
            { name: 'ç²¤å‰§', correct: false, icon: 'ğŸ­' },
            { name: 'ä½›å±±é†’ç‹®', correct: false, icon: 'ğŸ¦' },
            { name: 'æ½®æ±•è‹±æ­Œèˆ', correct: false, icon: 'ğŸ¥' }
        ];
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            hideAllScenes();
            document.getElementById('preTestScene').classList.remove('hidden');
            initPreTest();
        }
        
        // åˆå§‹åŒ–è¯¾å‰æµ‹è¯•
        function initPreTest() {
            const container = document.getElementById('preTestOptions');
            container.innerHTML = '';
            
            preTestOptions.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'game-card bg-gray-50 border-2 border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-blue-400 transition-all';
                optionDiv.onclick = () => togglePreTestOption(index, optionDiv);
                
                optionDiv.innerHTML = `
                    <div class="text-3xl mb-2">${option.icon}</div>
                    <p class="text-sm font-medium">${option.name}</p>
                `;
                
                container.appendChild(optionDiv);
            });
        }
        
        // åˆ‡æ¢è¯¾å‰æµ‹è¯•é€‰é¡¹
        function togglePreTestOption(index, element) {
            if (gameData.preTestAnswers.includes(index)) {
                gameData.preTestAnswers = gameData.preTestAnswers.filter(i => i !== index);
                element.classList.remove('border-blue-500', 'bg-blue-50');
                element.classList.add('border-gray-200', 'bg-gray-50');
            } else {
                gameData.preTestAnswers.push(index);
                element.classList.remove('border-gray-200', 'bg-gray-50');
                element.classList.add('border-blue-500', 'bg-blue-50');
            }
        }
        
        // æäº¤è¯¾å‰æµ‹è¯•
        function submitPreTest() {
            let feedback = '';
            const correctCount = gameData.preTestAnswers.filter(i => preTestOptions[i].correct).length;
            
            if (correctCount >= 5) {
                feedback = 'å“‡ï¼ä½ è¿è¿™ä¹ˆå¤šéƒ½çŸ¥é“ï¼Œä¸æ„§æ˜¯æœªæ¥å®ˆæŠ¤è€…ï¼';
            } else if (correctCount >= 3) {
                feedback = 'ä¸é”™ä¸é”™ï¼çœ‹æ¥ä½ å¯¹é¹åŸéé—æœ‰ä¸€å®šäº†è§£å‘¢ï¼';
            } else {
                feedback = 'å“¦ï¼Ÿçœ‹æ¥æœ‰å¾ˆå¤šç¥ç§˜çš„è‰ºæœ¯ç­‰ç€æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å‘¢ï¼';
            }
            
            showModal('è¯¾å‰æµ‹è¯•ç»“æœ', `
                <div class="text-center">
                    <div class="bg-orange-400 text-white rounded-full w-16 h-16 flex items-center justify-center text-2xl mb-4 mx-auto">ğŸ¦€</div>
                    <p class="mb-4">${feedback}</p>
                    <p class="text-sm text-gray-600 mb-4">ä½ ç­”å¯¹äº† ${correctCount}/7 ä¸ªæ·±åœ³éé—é¡¹ç›®</p>
                    <button onclick="closeModal(); startExperience();" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        å¼€å§‹éé—ä½“éªŒ
                    </button>
                </div>
            `);
        }
        
        // å¼€å§‹ä½“éªŒé˜¶æ®µ
        function startExperience() {
            hideAllScenes();
            document.getElementById('experienceScene').classList.remove('hidden');
            initArtExperiences();
        }
        
        // åˆå§‹åŒ–è‰ºæœ¯ä½“éªŒ
        function initArtExperiences() {
            const container = document.getElementById('artExperiences');
            container.innerHTML = '';
            
            arts.forEach(art => {
                const artDiv = document.createElement('div');
                artDiv.className = `game-card ${art.color} text-white rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all`;
                artDiv.onclick = () => startArtGame(art);
                
                artDiv.innerHTML = `
                    <div class="text-4xl mb-3 text-center">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">${art.name}</h3>
                    <p class="text-sm opacity-90 mb-2">${art.description}</p>
                    <p class="text-xs opacity-75">${art.location}</p>
                    <div class="mt-4 text-center">
                        <span class="text-xs bg-white/20 px-3 py-1 rounded-full">
                            ${gameData.artScores[art.id] ? 'å·²å®Œæˆ' : 'ç‚¹å‡»ä½“éªŒ'}
                        </span>
                    </div>
                `;
                
                if (gameData.artScores[art.id]) {
                    artDiv.style.opacity = '0.7';
                    artDiv.onclick = null;
                }
                
                container.appendChild(artDiv);
            });
        }
        
        // å¼€å§‹è‰ºæœ¯æ¸¸æˆ
        function startArtGame(art) {
            let gameContent = '';
            
            switch(art.id) {
                case 'paper-cutting':
                    gameContent = createPaperCuttingGame(art);
                    break;
                case 'qilin-dance':
                    gameContent = createQilinDanceGame(art);
                    break;
                case 'fish-lantern':
                    gameContent = createFishLanternGame(art);
                    break;
                case 'mantis-boxing':
                    gameContent = createMantisBoxingGame(art);
                    break;
                case 'hakka-hat':
                    gameContent = createHakkaHatGame(art);
                    break;
                case 'sea-urchin-zongzi':
                    gameContent = createSeaUrchinZongziGame(art);
                    break;
                case 'woodblock-print':
                    gameContent = createWoodblockPrintGame(art);
                    break;
            }
            
            showModal(art.name + ' - ' + art.description, gameContent);
        }
          // å‰ªçº¸æ¸¸æˆ
        function createPaperCuttingGame(art) {
            const gameState = {
                selectedPieces: [],
                correctSequence: [1, 2, 3, 4, 5],
                currentStep: 0,
                completed: false
            };
            
            // Store game state globally for this mini-game
            window.paperCuttingState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <p class="mb-4">å°†ç¢ç‰‡æŒ‰æ­£ç¡®é¡ºåºæ‹¼æˆå®Œæ•´çš„å‰ªçº¸å›¾æ¡ˆï¼</p>
                    <div id="paperCuttingProgress" class="mb-4">
                        <div class="text-sm text-gray-600">è¿›åº¦: <span id="progressText">0/5</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="progressBar" class="bg-red-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-4" id="paperCuttingGrid">
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 1)">
                            <div class="text-center">
                                <div class="text-lg">ğŸŒ¸</div>
                                <div class="text-xs">ç‰‡1</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 2)">
                            <div class="text-center">
                                <div class="text-lg">ğŸƒ</div>
                                <div class="text-xs">ç‰‡2</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 3)">
                            <div class="text-center">
                                <div class="text-lg">ğŸ¦‹</div>
                                <div class="text-xs">ç‰‡3</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 4)">
                            <div class="text-center">
                                <div class="text-lg">â˜€ï¸</div>
                                <div class="text-xs">ç‰‡4</div>
                            </div>
                        </div>
                        <div class="bg-red-200 h-16 rounded flex items-center justify-center text-red-800 border-2 border-red-400">
                            <div class="text-center">
                                <div class="text-lg">â€</div>
                                <div class="text-xs">ä¸­å¿ƒ</div>
                            </div>
                        </div>
                        <div class="bg-red-100 h-16 rounded flex items-center justify-center cursor-pointer border-2 border-dashed border-red-300 hover:bg-red-150 transition-colors" onclick="selectPaperPiece(this, 5)">
                            <div class="text-center">
                                <div class="text-lg">ğŸŒ¿</div>
                                <div class="text-xs">ç‰‡5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">æŒ‰é¡ºåºç‚¹å‡»ç¢ç‰‡ï¼šèŠ±æœµ â†’ å¶å­ â†’ è´è¶ â†’ å¤ªé˜³ â†’ è—¤è”“</p>
                    <div id="paperCuttingFeedback" class="text-sm mb-4"></div>
                    <button id="paperCuttingComplete" onclick="completePaperCutting('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                        å®Œæˆæ‹¼å›¾
                    </button>
                </div>
            `;
        }
          // éº’éºŸèˆæ¸¸æˆ
        function createQilinDanceGame(art) {
            const gameState = {
                drumBeats: [],
                targetPattern: ['é¼“1', 'é¼“2', 'é¼“1', 'é¼“2', 'é¼“1'],
                currentBeat: 0,
                completed: false
            };
            
            window.qilinDanceState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <p class="mb-4">è·Ÿç€é¼“ç‚¹èŠ‚æ‹èˆåŠ¨éº’éºŸï¼</p>
                    <div id="qilinProgress" class="mb-4">
                        <div class="text-sm text-gray-600">èŠ‚æ‹è¿›åº¦: <span id="beatProgress">0/5</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="beatProgressBar" class="bg-yellow-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-center space-x-4 mb-4">
                            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center border-4 border-yellow-300 cursor-pointer hover:bg-yellow-200 transition-all transform hover:scale-105" onclick="beatQilinDrum(this, 1)">
                                <div class="text-center">
                                    <div class="text-2xl">ğŸ¥</div>
                                    <div class="text-xs">é¼“1</div>
                                </div>
                            </div>
                            <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center border-4 border-yellow-300 cursor-pointer hover:bg-yellow-200 transition-all transform hover:scale-105" onclick="beatQilinDrum(this, 2)">
                                <div class="text-center">
                                    <div class="text-2xl">ğŸ¥</div>
                                    <div class="text-xs">é¼“2</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">æŒ‰èŠ‚æ‹æ•²å‡»ï¼èŠ‚å¥ï¼šé¼“1-é¼“2-é¼“1-é¼“2-é¼“1</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                        <p class="text-sm">ğŸµ éº’éºŸå‡ºæ´ã€éº’éºŸé‡‡é’ã€éº’éºŸæˆç ...</p>
                        <div id="qilinFeedback" class="text-sm mt-2"></div>
                    </div>
                    <button id="qilinComplete" onclick="completeQilinDance('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                        å®Œæˆè¡¨æ¼”
                    </button>
                </div>
            `;
        }
          // é±¼ç¯èˆæ¸¸æˆ
        function createFishLanternGame(art) {
            const gameState = {
                fishPosition: { x: 1, y: 1 },
                lanterns: [
                    { x: 6, y: 1, lit: false },
                    { x: 3, y: 3, lit: false },
                    { x: 5, y: 2, lit: false }
                ],
                lanternsLit: 0,
                completed: false
            };
            
            window.fishLanternState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <p class="mb-4">æ§åˆ¶é±¼ç¯ç©¿è¶Šå··é“ï¼Œç‚¹äº®ç¥ˆç¦ç¯ç¬¼ï¼</p>
                    <div id="fishProgress" class="mb-4">
                        <div class="text-sm text-gray-600">å·²ç‚¹äº®ç¯ç¬¼: <span id="lanternCount">0/3</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="lanternProgressBar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="fishGameBoard" class="relative bg-blue-50 p-2 rounded-lg mb-4 mx-auto" style="width: 300px; height: 200px; background-image: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);">
                        <!-- Grid lines for reference -->
                        <div class="grid grid-cols-6 grid-rows-4 h-full w-full absolute inset-0 opacity-20">
                            ${Array.from({length: 24}, (_, i) => `<div class="border border-blue-200"></div>`).join('')}
                        </div>
                        <!-- Fish lantern -->
                        <div id="fishLantern" class="absolute w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white cursor-pointer transform transition-all duration-300" style="left: 8px; top: 8px; z-index: 10;">
                            ğŸ 
                        </div>
                        <!-- Lanterns to light up -->
                        <div class="lantern absolute w-8 h-8 bg-yellow-300 rounded-full flex items-center justify-center transition-all duration-300" style="right: 8px; top: 8px;" data-lantern="0">ğŸ®</div>
                        <div class="lantern absolute w-8 h-8 bg-yellow-300 rounded-full flex items-center justify-center transition-all duration-300" style="left: 96px; bottom: 8px;" data-lantern="1">ğŸ®</div>
                        <div class="lantern absolute w-8 h-8 bg-yellow-300 rounded-full flex items-center justify-center transition-all duration-300" style="right: 48px; top: 48px;" data-lantern="2">ğŸ®</div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button onclick="moveFish('up')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">â¬†ï¸ ä¸Š</button>
                        <button onclick="moveFish('left')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">â¬…ï¸ å·¦</button>
                        <button onclick="moveFish('right')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">â¡ï¸ å³</button>
                        <div></div>
                        <button onclick="moveFish('down')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded transition-colors">â¬‡ï¸ ä¸‹</button>
                        <div></div>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">ç§»åŠ¨é±¼ç¯é è¿‘ç¯ç¬¼è‡ªåŠ¨ç‚¹äº®</p>
                    <div id="fishFeedback" class="text-sm mb-4"></div>
                    <button id="fishComplete" onclick="completeFishLantern('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                        å®Œæˆæ¸¸æˆ
                    </button>
                </div>
            `;
        }
          // è³è‚æ‹³æ¸¸æˆ
        function createMantisBoxingGame(art) {
            const gameState = {
                currentMove: 0,
                moveSequence: ['æ•è‰', 'å‹¾æ‚', 'é—ªèº«', 'è¿›é€€'],
                userSequence: [],
                moveDescriptions: {
                    'æ•è‰': 'åŒè‡‚å¦‚è³è‚å‰è‚¢ï¼Œè¿…é€Ÿæ•æ‰',
                    'å‹¾æ‚': 'æ‰‹æŒ‡å¦‚é’©ï¼Œæ‚æŠ±é˜²å®ˆ',
                    'é—ªèº«': 'èº«å¦‚è³è‚ï¼Œçµæ´»é—ªé¿',
                    'è¿›é€€': 'æ­¥æ³•ç¨³å¥ï¼Œè¿›é€€æœ‰åº¦'
                },
                completed: false,
                practiceRound: 1,
                maxRounds: 3
            };
            
            window.mantisBoxingState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">è³è‚æ‹³åŸºç¡€å¥—è·¯</h3>
                    <p class="mb-4">å­¦ä¹ è³è‚æ‹³çš„å››å¤§åŸºç¡€æ‹›å¼ï¼Œä½“éªŒä»¿ç”Ÿæ­¦æœ¯çš„ç²¾é«“ï¼</p>
                    
                    <div id="mantisProgress" class="mb-4">
                        <div class="text-sm text-gray-600">ç»ƒä¹ è½®æ¬¡: <span id="practiceRound">1/3</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="mantisProgressBar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- ç¤ºèŒƒé˜¶æ®µ -->
                    <div id="demonstrationPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">ğŸ‘€ è§‚å¯Ÿç¤ºèŒƒï¼ˆç‚¹å‡»è§‚çœ‹æ‹›å¼ï¼‰</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('æ•è‰', this)" data-move="æ•è‰">
                                <div class="text-3xl mb-2">ğŸ¦‚</div>
                                <p class="text-sm font-bold">è³è‚æ•è‰</p>
                                <p class="text-xs text-gray-600 mt-1">åŒè‡‚å‰ä¼¸å¦‚è³è‚</p>
                            </div>
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('å‹¾æ‚', this)" data-move="å‹¾æ‚">
                                <div class="text-3xl mb-2">ğŸ¤²</div>
                                <p class="text-sm font-bold">å‹¾æ‚é‡‡æ‰‹</p>
                                <p class="text-xs text-gray-600 mt-1">æ‰‹æŒ‡å¦‚é’©æ‚æŠ±</p>
                            </div>
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('é—ªèº«', this)" data-move="é—ªèº«">
                                <div class="text-3xl mb-2">âš¡</div>
                                <p class="text-sm font-bold">é—ªèº«é æ‰“</p>
                                <p class="text-xs text-gray-600 mt-1">èº«ä½“çµæ´»é—ªé¿</p>
                            </div>
                            <div class="mantis-move bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:bg-green-100 transition-all" onclick="demonstrateMove('è¿›é€€', this)" data-move="è¿›é€€">
                                <div class="text-3xl mb-2">ğŸ”„</div>
                                <p class="text-sm font-bold">è¿›é€€èº«æ³•</p>
                                <p class="text-xs text-gray-600 mt-1">æ­¥æ³•ç¨³å¥æœ‰åº¦</p>
                            </div>
                        </div>
                        <div id="moveDescription" class="mt-4 bg-yellow-50 p-3 rounded-lg text-sm text-gray-700 hidden">
                            <div id="moveDescriptionContent"></div>
                        </div>
                    </div>
                    
                    <!-- ç»ƒä¹ é˜¶æ®µ -->
                    <div id="practicePhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ¥‹ è·Ÿç»ƒé˜¶æ®µï¼ˆæŒ‰æ­£ç¡®é¡ºåºç‚¹å‡»ï¼‰</h4>
                        <div class="bg-blue-50 p-3 rounded-lg mb-3">
                            <p class="text-sm text-blue-800">æ­£ç¡®é¡ºåºï¼š<span id="correctSequenceDisplay">æ•è‰ â†’ å‹¾æ‚ â†’ é—ªèº« â†’ è¿›é€€</span></p>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('æ•è‰', this)" data-move="æ•è‰">
                                <div class="text-3xl mb-2">ğŸ¦‚</div>
                                <p class="text-sm font-bold">è³è‚æ•è‰</p>
                            </div>
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('å‹¾æ‚', this)" data-move="å‹¾æ‚">
                                <div class="text-3xl mb-2">ğŸ¤²</div>
                                <p class="text-sm font-bold">å‹¾æ‚é‡‡æ‰‹</p>
                            </div>
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('é—ªèº«', this)" data-move="é—ªèº«">
                                <div class="text-3xl mb-2">âš¡</div>
                                <p class="text-sm font-bold">é—ªèº«é æ‰“</p>
                            </div>
                            <div class="practice-move bg-gray-100 p-4 rounded-lg border-2 border-gray-300 cursor-pointer hover:bg-gray-200 transition-all" onclick="practiceMove('è¿›é€€', this)" data-move="è¿›é€€">
                                <div class="text-3xl mb-2">ğŸ”„</div>
                                <p class="text-sm font-bold">è¿›é€€èº«æ³•</p>
                            </div>
                        </div>
                        <div id="practiceFeedback" class="mt-3 text-sm"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="startPracticeBtn" onclick="startMantisPractice()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors mr-2">
                            å¼€å§‹ç»ƒä¹ 
                        </button>
                        <button id="mantisComplete" onclick="completeMantisBoxing('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            å®Œæˆè®­ç»ƒ
                        </button>
                    </div>
                </div>
            `;
        }
          // å®¢å®¶å‡‰å¸½æ¸¸æˆ
        function createHakkaHatGame(art) {
            const gameState = {
                selectedMaterials: [],
                correctMaterials: ['ç«¹ç¯¾', 'å½©çº¿', 'å¸ƒæ–™'],
                weavingStep: 0,
                weavingPattern: ['æ¨ªç¼–', 'ç«–ç¼–', 'æ¨ªç¼–', 'ç«–ç¼–', 'æ”¶å°¾'],
                materialColors: {},
                completed: false,
                phase: 'material' // material, color, weaving
            };
            
            window.hakkaHatState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">å®¢å®¶å‡‰å¸½åˆ¶ä½œå·¥åŠ</h3>
                    <p class="mb-4">ä½“éªŒä¼ ç»Ÿå®¢å®¶å‡‰å¸½çš„åˆ¶ä½œå·¥è‰ºï¼Œä»é€‰æåˆ°ç¼–ç»‡çš„å®Œæ•´è¿‡ç¨‹ï¼</p>
                    
                    <div id="hatProgress" class="mb-4">
                        <div class="text-sm text-gray-600">åˆ¶ä½œè¿›åº¦: <span id="hatProgressText">ææ–™é€‰æ‹©</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="hatProgressBar" class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- ææ–™é€‰æ‹©é˜¶æ®µ -->
                    <div id="materialPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">ğŸ§º ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©åˆé€‚çš„ææ–™</h4>
                        <p class="text-sm text-gray-600 mb-4">ä¼ ç»Ÿå®¢å®¶å‡‰å¸½éœ€è¦é€‰æ‹©æ­£ç¡®çš„å¤©ç„¶ææ–™</p>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="material-option bg-yellow-100 p-4 rounded-lg cursor-pointer border-2 border-yellow-200 hover:border-yellow-400 transition-all" onclick="selectHakkaMaterial(this, 'ç«¹ç¯¾', true)">
                                <div class="text-2xl mb-2">ğŸ‹</div>
                                <p class="text-sm font-bold">ç«¹ç¯¾</p>
                                <p class="text-xs text-gray-600">ä¸»è¦éª¨æ¶ææ–™</p>
                            </div>
                            <div class="material-option bg-blue-100 p-4 rounded-lg cursor-pointer border-2 border-blue-200 hover:border-blue-400 transition-all" onclick="selectHakkaMaterial(this, 'å½©çº¿', true)">
                                <div class="text-2xl mb-2">ğŸ§µ</div>
                                <p class="text-sm font-bold">å½©çº¿</p>
                                <p class="text-xs text-gray-600">è£…é¥°ä¸å›ºå®š</p>
                            </div>
                            <div class="material-option bg-purple-100 p-4 rounded-lg cursor-pointer border-2 border-purple-200 hover:border-purple-400 transition-all" onclick="selectHakkaMaterial(this, 'å¸ƒæ–™', true)">
                                <div class="text-2xl mb-2">ğŸ§¶</div>
                                <p class="text-sm font-bold">å¸ƒæ–™</p>
                                <p class="text-xs text-gray-600">å¸½æ²¿è£…é¥°</p>
                            </div>
                            <div class="material-option bg-gray-100 p-4 rounded-lg cursor-pointer border-2 border-gray-200 hover:border-gray-400 transition-all" onclick="selectHakkaMaterial(this, 'çŸ³å¤´', false)">
                                <div class="text-2xl mb-2">ğŸª¨</div>
                                <p class="text-sm font-bold">çŸ³å¤´</p>
                                <p class="text-xs text-gray-600">è¿‡ç¡¬ä¸é€‚ç”¨</p>
                            </div>
                            <div class="material-option bg-red-100 p-4 rounded-lg cursor-pointer border-2 border-red-200 hover:border-red-400 transition-all" onclick="selectHakkaMaterial(this, 'å¡‘æ–™', false)">
                                <div class="text-2xl mb-2">ğŸ§±</div>
                                <p class="text-sm font-bold">å¡‘æ–™</p>
                                <p class="text-xs text-gray-600">éä¼ ç»Ÿææ–™</p>
                            </div>
                            <div class="material-option bg-green-100 p-4 rounded-lg cursor-pointer border-2 border-green-200 hover:border-green-400 transition-all" onclick="selectHakkaMaterial(this, 'é‡‘å±', false)">
                                <div class="text-2xl mb-2">âš™ï¸</div>
                                <p class="text-sm font-bold">é‡‘å±</p>
                                <p class="text-xs text-gray-600">å¤ªé‡ä¸åˆé€‚</p>
                            </div>
                        </div>
                        <div id="materialFeedback" class="mt-4 text-sm"></div>
                        <div class="mt-4">
                            <button id="nextToColorBtn" onclick="startColorPhase()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors hidden">
                                è¿›å…¥é…è‰²é˜¶æ®µ
                            </button>
                        </div>
                    </div>
                    
                    <!-- é…è‰²é˜¶æ®µ -->
                    <div id="colorPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ¨ ç¬¬äºŒæ­¥ï¼šæ­é…ä¼ ç»Ÿè‰²å½©</h4>
                        <p class="text-sm text-gray-600 mb-4">ä¸ºå‡‰å¸½é€‰æ‹©ä¼ ç»Ÿçš„å®¢å®¶é…è‰²æ–¹æ¡ˆ</p>
                        <div class="grid grid-cols-4 gap-3 mb-4">
                            <div class="color-option bg-red-200 p-3 rounded-lg cursor-pointer border-2 border-red-300 text-center hover:border-red-500 transition-all" onclick="selectHatColor(this, 'å¤§çº¢', 'red')">
                                <div class="w-8 h-8 bg-red-500 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">å¤§çº¢</p>
                                <p class="text-xs text-gray-600">å–œåº†ä¼ ç»Ÿ</p>
                            </div>
                            <div class="color-option bg-blue-200 p-3 rounded-lg cursor-pointer border-2 border-blue-300 text-center hover:border-blue-500 transition-all" onclick="selectHatColor(this, 'é›è“', 'blue')">
                                <div class="w-8 h-8 bg-blue-600 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">é›è“</p>
                                <p class="text-xs text-gray-600">æœ´ç´ å…¸é›…</p>
                            </div>
                            <div class="color-option bg-green-200 p-3 rounded-lg cursor-pointer border-2 border-green-300 text-center hover:border-green-500 transition-all" onclick="selectHatColor(this, 'ç«¹ç»¿', 'green')">
                                <div class="w-8 h-8 bg-green-600 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">ç«¹ç»¿</p>
                                <p class="text-xs text-gray-600">è‡ªç„¶æ¸…æ–°</p>
                            </div>
                            <div class="color-option bg-yellow-200 p-3 rounded-lg cursor-pointer border-2 border-yellow-300 text-center hover:border-yellow-500 transition-all" onclick="selectHatColor(this, 'é‡‘é»„', 'yellow')">
                                <div class="w-8 h-8 bg-yellow-500 rounded-full mx-auto mb-2"></div>
                                <p class="text-xs font-medium">é‡‘é»„</p>
                                <p class="text-xs text-gray-600">ä¸°æ”¶å¯Œè´µ</p>
                            </div>
                        </div>
                        <div id="colorPreview" class="bg-gray-50 p-4 rounded-lg mb-4 hidden">
                            <p class="text-sm font-medium mb-2">é¢„è§ˆæ•ˆæœï¼š</p>
                            <div class="w-16 h-16 mx-auto rounded-full border-4 border-gray-300" id="hatPreview"></div>
                        </div>
                        <div id="colorFeedback" class="text-sm mb-4"></div>
                        <button id="nextToWeavingBtn" onclick="startWeavingPhase()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors hidden">
                            å¼€å§‹ç¼–ç»‡
                        </button>
                    </div>
                    
                    <!-- ç¼–ç»‡é˜¶æ®µ -->
                    <div id="weavingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ§º ç¬¬ä¸‰æ­¥ï¼šä¼ ç»Ÿç¼–ç»‡æ‰‹æ³•</h4>
                        <p class="text-sm text-gray-600 mb-4">æŒ‰ç…§æ­£ç¡®çš„ç¼–ç»‡é¡ºåºå®Œæˆå‡‰å¸½åˆ¶ä½œ</p>
                        <div id="weavingProgress" class="mb-4">
                            <div class="text-sm text-gray-600">ç¼–ç»‡æ­¥éª¤: <span id="weavingStepText">1/5</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="weavingProgressBar" class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg mb-4">
                            <p class="text-sm text-purple-800">å½“å‰æ­¥éª¤ï¼š<span id="currentWeavingStep">æ¨ªå‘ç¼–ç»‡ç«¹ç¯¾</span></p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="weaving-option bg-orange-100 p-4 rounded-lg cursor-pointer border-2 border-orange-300 hover:border-orange-500 transition-all text-center" onclick="performWeaving(this, 'æ¨ªç¼–')">
                                <div class="text-3xl mb-2">â†”ï¸</div>
                                <p class="text-sm font-bold">æ¨ªç¼–</p>
                                <p class="text-xs text-gray-600">æ°´å¹³ç¼–ç»‡</p>
                            </div>
                            <div class="weaving-option bg-teal-100 p-4 rounded-lg cursor-pointer border-2 border-teal-300 hover:border-teal-500 transition-all text-center" onclick="performWeaving(this, 'ç«–ç¼–')">
                                <div class="text-3xl mb-2">â†•ï¸</div>
                                <p class="text-sm font-bold">ç«–ç¼–</p>
                                <p class="text-xs text-gray-600">å‚ç›´ç¼–ç»‡</p>
                            </div>
                        </div>
                        <div id="weavingFeedback" class="mt-4 text-sm"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="hakkaComplete" onclick="completeHakkaHat('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            å®Œæˆåˆ¶ä½œ
                        </button>
                    </div>
                </div>
            `;
        }
          // æµ·èƒ†ç²½æ¸¸æˆ
        function createSeaUrchinZongziGame(art) {
            const gameState = {
                ingredients: {
                    'æµ·èƒ†': { selected: false, quality: 0 },
                    'ç³¯ç±³': { selected: false, quality: 0 },
                    'ç²½å¶': { selected: false, quality: 0 },
                    'å’¸è›‹é»„': { selected: false, quality: 0 }
                },
                cookingSteps: ['æ¸…æ´—æµ·èƒ†', 'æµ¸æ³¡ç³¯ç±³', 'ç²½å¶åŒ…é¦…', 'ç»³å­æ†æ‰', 'ä¸‹é”…è’¸ç…®'],
                currentStep: 0,
                totalQuality: 0,
                completed: false,
                phase: 'selection' // selection, cooking, tasting
            };
            
            window.seaUrchinZongziState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">å¤§é¹æµ·èƒ†ç²½åˆ¶ä½œåŠ</h3>
                    <p class="mb-4">ä½“éªŒç‹¬ç‰¹çš„æµ·é²œé£å‘³ç²½å­åˆ¶ä½œå·¥è‰ºï¼Œä¼ æ‰¿å¤§é¹æ¸”æ°‘çš„æ™ºæ…§ï¼</p>
                    
                    <div id="zongziProgress" class="mb-4">
                        <div class="text-sm text-gray-600">åˆ¶ä½œè¿›åº¦: <span id="zongziProgressText">é£Ÿæé€‰æ‹©</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="zongziProgressBar" class="bg-orange-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- é£Ÿæé€‰æ‹©é˜¶æ®µ -->
                    <div id="selectionPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">ğŸ¦ ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ–°é²œé£Ÿæ</h4>
                        <p class="text-sm text-gray-600 mb-4">ä¼˜è´¨çš„é£Ÿææ˜¯åˆ¶ä½œç¾å‘³æµ·èƒ†ç²½çš„å…³é”®</p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="ingredient-card bg-blue-50 p-4 rounded-lg border-2 border-blue-200 cursor-pointer hover:border-blue-400 transition-all" onclick="selectIngredient(this, 'æµ·èƒ†')">
                                <div class="text-3xl mb-2">ğŸ¦”</div>
                                <p class="text-sm font-bold">æµ·èƒ†</p>
                                <p class="text-xs text-gray-600">é²œç¾ä¸»æ–™</p>
                                <div class="quality-stars mt-2" data-ingredient="æµ·èƒ†">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('æµ·èƒ†', 1)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('æµ·èƒ†', 2)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('æµ·èƒ†', 3)">â­</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç‚¹å‡»æ˜Ÿæ˜Ÿè¯„åˆ†æ–°é²œåº¦</p>
                            </div>
                            <div class="ingredient-card bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200 cursor-pointer hover:border-yellow-400 transition-all" onclick="selectIngredient(this, 'ç³¯ç±³')">
                                <div class="text-3xl mb-2">ğŸŒ¾</div>
                                <p class="text-sm font-bold">ç³¯ç±³</p>
                                <p class="text-xs text-gray-600">ä¸»è¦å¡«å……</p>
                                <div class="quality-stars mt-2" data-ingredient="ç³¯ç±³">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('ç³¯ç±³', 1)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('ç³¯ç±³', 2)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('ç³¯ç±³', 3)">â­</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç‚¹å‡»æ˜Ÿæ˜Ÿè¯„åˆ†å“è´¨</p>
                            </div>
                            <div class="ingredient-card bg-green-50 p-4 rounded-lg border-2 border-green-200 cursor-pointer hover:border-green-400 transition-all" onclick="selectIngredient(this, 'ç²½å¶')">
                                <div class="text-3xl mb-2">ğŸƒ</div>
                                <p class="text-sm font-bold">ç²½å¶</p>
                                <p class="text-xs text-gray-600">å¤©ç„¶åŒ…è£…</p>
                                <div class="quality-stars mt-2" data-ingredient="ç²½å¶">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('ç²½å¶', 1)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('ç²½å¶', 2)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('ç²½å¶', 3)">â­</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç‚¹å‡»æ˜Ÿæ˜Ÿè¯„åˆ†æ–°é²œåº¦</p>
                            </div>
                            <div class="ingredient-card bg-red-50 p-4 rounded-lg border-2 border-red-200 cursor-pointer hover:border-red-400 transition-all" onclick="selectIngredient(this, 'å’¸è›‹é»„')">
                                <div class="text-3xl mb-2">ğŸ¥š</div>
                                <p class="text-sm font-bold">å’¸è›‹é»„</p>
                                <p class="text-xs text-gray-600">å¢é¦™é…æ–™</p>
                                <div class="quality-stars mt-2" data-ingredient="å’¸è›‹é»„">
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('å’¸è›‹é»„', 1)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('å’¸è›‹é»„', 2)">â­</span>
                                    <span class="star cursor-pointer" onclick="event.stopPropagation(); setQuality('å’¸è›‹é»„', 3)">â­</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">ç‚¹å‡»æ˜Ÿæ˜Ÿè¯„åˆ†å“è´¨</p>
                            </div>
                        </div>
                        <div id="ingredientFeedback" class="mt-4 text-sm"></div>
                        <div class="mt-4">
                            <button id="nextToCookingBtn" onclick="startCookingPhase()" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors hidden">
                                å¼€å§‹åˆ¶ä½œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- åˆ¶ä½œé˜¶æ®µ -->
                    <div id="cookingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ‘¨â€ğŸ³ ç¬¬äºŒæ­¥ï¼šåˆ¶ä½œå·¥åº</h4>
                        <p class="text-sm text-gray-600 mb-4">æŒ‰ç…§ä¼ ç»Ÿå·¥åºï¼Œç²¾å¿ƒåˆ¶ä½œæµ·èƒ†ç²½</p>
                        <div id="cookingStepProgress" class="mb-4">
                            <div class="text-sm text-gray-600">åˆ¶ä½œæ­¥éª¤: <span id="cookingStepText">1/5</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="cookingStepBar" class="bg-orange-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg mb-4">
                            <p class="text-sm text-orange-800">å½“å‰æ­¥éª¤ï¼š<span id="currentCookingStep">æ¸…æ´—æµ·èƒ†ï¼Œå»é™¤æ‚è´¨</span></p>
                            <div class="mt-2 text-xs text-gray-600" id="stepInstruction">
                                è½»æŸ”åœ°æ¸…æ´—æµ·èƒ†ï¼Œä¿æŒå…¶å®Œæ•´æ€§å’Œé²œå‘³
                            </div>
                        </div>
                        <div class="cooking-step-visualization mb-4 bg-gray-50 p-6 rounded-lg">
                            <div class="text-6xl mb-2" id="stepVisualization">ğŸ¦”</div>
                            <div class="text-sm text-gray-600" id="stepAnimation">æ­£åœ¨æ¸…æ´—æµ·èƒ†...</div>
                        </div>
                        <button id="performStepBtn" onclick="performCookingStep()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            æ‰§è¡Œæ­¥éª¤
                        </button>
                        <div id="cookingFeedback" class="mt-4 text-sm"></div>
                    </div>
                    
                    <!-- å“å°é˜¶æ®µ -->
                    <div id="tastingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ½ï¸ ç¬¬ä¸‰æ­¥ï¼šå“é‰´æˆæœ</h4>
                        <div class="bg-gradient-to-br from-orange-100 to-yellow-100 p-6 rounded-lg mb-4">
                            <div class="text-6xl mb-4">ğŸ™</div>
                            <p class="text-lg font-bold text-orange-800 mb-2">æµ·èƒ†ç²½åˆ¶ä½œå®Œæˆï¼</p>
                            <div id="finalScore" class="text-sm text-gray-700"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h5 class="font-medium text-blue-800 mb-2">å£æ„Ÿè¯„ä»·</h5>
                                <div id="tasteRating" class="text-2xl"></div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h5 class="font-medium text-green-800 mb-2">åˆ¶ä½œæŠ€è‰º</h5>
                                <div id="skillRating" class="text-2xl"></div>
                            </div>
                        </div>
                        <div id="tastingFeedback" class="text-sm mb-4"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="zongziComplete" onclick="completeSeaUrchinZongzi('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            å®Œæˆåˆ¶ä½œ
                        </button>
                    </div>
                </div>
            `;
        }
          // ç‰ˆç”»æ¸¸æˆ
        function createWoodblockPrintGame(art) {
            const gameState = {
                selectedTools: [],
                correctTools: ['åˆ»åˆ€', 'æ²¹å¢¨', 'æ‹“åŒ…'],
                carvingPattern: [
                    [0, 1, 1, 0, 0, 1, 1, 0],
                    [1, 1, 1, 1, 1, 1, 1, 1],
                    [1, 0, 1, 1, 1, 1, 0, 1],
                    [1, 1, 1, 0, 0, 1, 1, 1],
                    [0, 1, 1, 1, 1, 1, 1, 0],
                    [0, 0, 1, 1, 1, 1, 0, 0]
                ],
                playerPattern: Array(6).fill().map(() => Array(8).fill(0)),
                inkColors: ['é»‘è‰²', 'çº¢è‰²', 'è“è‰²'],
                selectedInk: '',
                printQuality: 0,
                completed: false,
                phase: 'tools' // tools, carving, inking, printing
            };
            
            window.woodblockPrintState = gameState;
            
            return `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">è§‚æ¾œç‰ˆç”»å·¥åŠ</h3>
                    <p class="mb-4">ä½“éªŒä¼ ç»Ÿç‰ˆç”»åˆ¶ä½œçš„å®Œæ•´æµç¨‹ï¼Œä»å·¥å…·é€‰æ‹©åˆ°ä½œå“å°åˆ¶ï¼</p>
                    
                    <div id="printProgress" class="mb-4">
                        <div class="text-sm text-gray-600">åˆ¶ä½œè¿›åº¦: <span id="printProgressText">å·¥å…·å‡†å¤‡</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="printProgressBar" class="bg-indigo-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- å·¥å…·é€‰æ‹©é˜¶æ®µ -->
                    <div id="toolsPhase" class="mb-6">
                        <h4 class="text-md font-medium mb-3">ğŸ”§ ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ç‰ˆç”»å·¥å…·</h4>
                        <p class="text-sm text-gray-600 mb-4">é€‰æ‹©åˆ¶ä½œç‰ˆç”»æ‰€éœ€çš„ä¼ ç»Ÿå·¥å…·</p>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="tool-option bg-yellow-100 p-4 rounded-lg cursor-pointer border-2 border-yellow-200 hover:border-yellow-400 transition-all" onclick="selectPrintTool(this, 'åˆ»åˆ€', true)">
                                <div class="text-3xl mb-2">ğŸ”ª</div>
                                <p class="text-sm font-bold">åˆ»åˆ€</p>
                                <p class="text-xs text-gray-600">é›•åˆ»ç‰ˆé¢</p>
                            </div>
                            <div class="tool-option bg-purple-100 p-4 rounded-lg cursor-pointer border-2 border-purple-200 hover:border-purple-400 transition-all" onclick="selectPrintTool(this, 'æ²¹å¢¨', true)">
                                <div class="text-3xl mb-2">ğŸ¨</div>
                                <p class="text-sm font-bold">æ²¹å¢¨</p>
                                <p class="text-xs text-gray-600">å°åˆ·é¢œæ–™</p>
                            </div>
                            <div class="tool-option bg-blue-100 p-4 rounded-lg cursor-pointer border-2 border-blue-200 hover:border-blue-400 transition-all" onclick="selectPrintTool(this, 'æ‹“åŒ…', true)">
                                <div class="text-3xl mb-2">âš«</div>
                                <p class="text-sm font-bold">æ‹“åŒ…</p>
                                <p class="text-xs text-gray-600">å‡åŒ€ç€å¢¨</p>
                            </div>
                            <div class="tool-option bg-red-100 p-4 rounded-lg cursor-pointer border-2 border-red-200 hover:border-red-400 transition-all" onclick="selectPrintTool(this, 'é”¤å­', false)">
                                <div class="text-3xl mb-2">ğŸ”¨</div>
                                <p class="text-sm font-bold">é”¤å­</p>
                                <p class="text-xs text-gray-600">è¿‡äºç²—ç³™</p>
                            </div>
                            <div class="tool-option bg-green-100 p-4 rounded-lg cursor-pointer border-2 border-green-200 hover:border-green-400 transition-all" onclick="selectPrintTool(this, 'æ¯›ç¬”', false)">
                                <div class="text-3xl mb-2">ğŸ–Œï¸</div>
                                <p class="text-sm font-bold">æ¯›ç¬”</p>
                                <p class="text-xs text-gray-600">ç”¨äºä¹¦æ³•</p>
                            </div>
                            <div class="tool-option bg-gray-100 p-4 rounded-lg cursor-pointer border-2 border-gray-200 hover:border-gray-400 transition-all" onclick="selectPrintTool(this, 'é“…ç¬”', false)">
                                <div class="text-3xl mb-2">âœï¸</div>
                                <p class="text-sm font-bold">é“…ç¬”</p>
                                <p class="text-xs text-gray-600">æ— æ³•é›•åˆ»</p>
                            </div>
                        </div>
                        <div id="toolFeedback" class="mt-4 text-sm"></div>
                        <div class="mt-4">
                            <button id="nextToCarvingBtn" onclick="startCarvingPhase()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden">
                                å¼€å§‹é›•åˆ»
                            </button>
                        </div>
                    </div>
                    
                    <!-- é›•åˆ»é˜¶æ®µ -->
                    <div id="carvingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ¨ ç¬¬äºŒæ­¥ï¼šé›•åˆ»ç‰ˆé¢</h4>
                        <p class="text-sm text-gray-600 mb-4">ç‚¹å‡»æ ¼å­æ¥é›•åˆ»å‡ºä¼ ç»Ÿå›¾æ¡ˆï¼ˆæ·±è‰²ä¸ºé›•åˆ»éƒ¨åˆ†ï¼‰</p>
                        <div class="mb-4">
                            <p class="text-sm font-medium mb-2">ç›®æ ‡å›¾æ¡ˆï¼š</p>
                            <div class="grid grid-cols-8 gap-1 max-w-64 mx-auto mb-4" id="targetPattern">
                                <!-- ç›®æ ‡å›¾æ¡ˆä¼šåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm font-medium mb-2">ä½ çš„é›•åˆ»ï¼š</p>
                            <div class="grid grid-cols-8 gap-1 max-w-64 mx-auto" id="playerPattern">
                                <!-- ç©å®¶å›¾æ¡ˆä¼šåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div id="carvingFeedback" class="text-sm mb-4"></div>
                        <button id="nextToInkingBtn" onclick="startInkingPhase()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden">
                            å‡†å¤‡ä¸Šå¢¨
                        </button>
                    </div>
                    
                    <!-- ä¸Šå¢¨é˜¶æ®µ -->
                    <div id="inkingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ–‹ï¸ ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©å¢¨è‰²</h4>
                        <p class="text-sm text-gray-600 mb-4">ä¸ºä½ çš„ç‰ˆç”»é€‰æ‹©åˆé€‚çš„å¢¨è‰²</p>
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="ink-option bg-gray-800 text-white p-4 rounded-lg cursor-pointer border-2 border-gray-600 hover:border-gray-400 transition-all text-center" onclick="selectInkColor(this, 'é»‘è‰²')">
                                <div class="text-2xl mb-2">âš«</div>
                                <p class="text-sm font-bold">ä¼ ç»Ÿé»‘å¢¨</p>
                                <p class="text-xs opacity-80">ç»å…¸åº„é‡</p>
                            </div>
                            <div class="ink-option bg-red-600 text-white p-4 rounded-lg cursor-pointer border-2 border-red-400 hover:border-red-300 transition-all text-center" onclick="selectInkColor(this, 'çº¢è‰²')">
                                <div class="text-2xl mb-2">ğŸ”´</div>
                                <p class="text-sm font-bold">æœ±ç ‚çº¢å¢¨</p>
                                <p class="text-xs opacity-80">å–œåº†çƒ­çƒˆ</p>
                            </div>
                            <div class="ink-option bg-blue-600 text-white p-4 rounded-lg cursor-pointer border-2 border-blue-400 hover:border-blue-300 transition-all text-center" onclick="selectInkColor(this, 'è“è‰²')">
                                <div class="text-2xl mb-2">ğŸ”µ</div>
                                <p class="text-sm font-bold">é›é’è“å¢¨</p>
                                <p class="text-xs opacity-80">æ¸…é›…å®é™</p>
                            </div>
                        </div>
                        <div id="inkFeedback" class="text-sm mb-4"></div>
                        <button id="nextToPrintingBtn" onclick="startPrintingPhase()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden">
                            å¼€å§‹å°åˆ¶
                        </button>
                    </div>
                    
                    <!-- å°åˆ¶é˜¶æ®µ -->
                    <div id="printingPhase" class="mb-6 hidden">
                        <h4 class="text-md font-medium mb-3">ğŸ–¨ï¸ ç¬¬å››æ­¥ï¼šå°åˆ¶ä½œå“</h4>
                        <p class="text-sm text-gray-600 mb-4">æŒ‰å‹ç‰ˆé¢ï¼Œå°åˆ¶ä½ çš„ç‰ˆç”»ä½œå“</p>
                        <div class="bg-gray-50 p-6 rounded-lg mb-4">
                            <div class="text-center mb-4">
                                <div class="text-6xl mb-2">ğŸ“„</div>
                                <p class="text-sm text-gray-600">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿›è¡Œå°åˆ¶</p>
                            </div>
                            <div class="grid grid-cols-8 gap-1 max-w-64 mx-auto mb-4" id="finalPrint">
                                <!-- æœ€ç»ˆä½œå“ä¼šåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <button id="performPrintBtn" onclick="performPrinting()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            ç”¨åŠ›æŒ‰å‹å°åˆ¶
                        </button>
                        <div id="printingFeedback" class="mt-4 text-sm"></div>
                    </div>
                    
                    <div class="text-center">
                        <button id="printComplete" onclick="completePrintGame('${art.id}')" class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                            å®Œæˆä½œå“
                        </button>
                    </div>
                </div>
            `;
        }
        
        // å®Œæˆè‰ºæœ¯æ¸¸æˆ
        function completeArtGame(artId, score) {
            gameData.artScores[artId] = score;
            gameData.currentProgress++;
            
            updateProgress();
            
            const art = arts.find(a => a.id === artId);
            
            showModal('æ¸¸æˆå®Œæˆï¼', `
                <div class="text-center">
                    <div class="text-4xl mb-4">${art.icon}</div>
                    <h3 class="text-lg font-bold mb-2">${art.name}</h3>
                    <div class="bg-green-100 border border-green-400 rounded-lg p-4 mb-4">
                        <p class="text-green-800 font-medium mb-2">æ­å–œå®Œæˆä½“éªŒï¼</p>
                        <p class="text-green-700">ä½ çš„å¾—åˆ†ï¼š${score}/100</p>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                        <div class="bg-orange-400 text-white rounded-full w-12 h-12 flex items-center justify-center text-xl mb-2 mx-auto">ğŸ¦€</div>
                        <p class="text-sm text-gray-700">é¹ä»”ï¼šå¤ªæ£’äº†ï¼ä½ å·²ç»åˆæ­¥æŒæ¡äº†${art.name}çš„ç²¾é«“ï¼</p>
                    </div>
                    <button onclick="closeModal(); initArtExperiences();" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        ç»§ç»­æ¢ç´¢
                    </button>
                </div>
            `);
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = (gameData.currentProgress / 7) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${gameData.currentProgress}/7`;
            
            if (gameData.currentProgress === 7) {
                document.getElementById('nextToTreasure').classList.remove('hidden');
            }
        }
        
        // æ˜¾ç¤ºå®ç®±é€‰æ‹©åœºæ™¯
        function showTreasureScene() {
            hideAllScenes();
            document.getElementById('treasureScene').classList.remove('hidden');
            initTreasureScene();
        }
        
        // åˆå§‹åŒ–å®ç®±åœºæ™¯
        function initTreasureScene() {
            // æ‰¾å‡ºå¾—åˆ†æœ€é«˜çš„è‰ºæœ¯
            let bestArt = null;
            let bestScore = 0;
            
            Object.entries(gameData.artScores).forEach(([artId, score]) => {
                if (score > bestScore) {
                    bestScore = score;
                    bestArt = arts.find(a => a.id === artId);
                }
            });
            
            // è®¾ç½®æ¨èæ–‡æœ¬
            const recommendationEl = document.getElementById('treasureRecommendation');
            if (bestArt) {
                recommendationEl.textContent = `æ ¹æ®ä½ çš„ä½“éªŒè¡¨ç°ï¼Œä½ åœ¨ã€${bestArt.name}ã€‘ä¸Šå±•ç°äº†éå‡¡çš„å¤©èµ‹ï¼å¾—åˆ†ï¼š${bestScore}/100ã€‚æˆ‘æ¨èä½ é€‰æ‹©å®ƒçš„å®ç®±ï¼Œæˆ–è€…è·Ÿéšå†…å¿ƒé€‰æ‹©ä½ æœ€æ„Ÿå…´è¶£çš„è‰ºæœ¯ï¼`;
            }
            
            // ç”Ÿæˆå®ç®±
            const container = document.getElementById('treasureBoxes');
            container.innerHTML = '';
            
            arts.forEach(art => {
                const boxDiv = document.createElement('div');
                boxDiv.className = `treasure-box cursor-pointer p-4 rounded-lg border-4 transition-all ${
                    art.id === bestArt?.id ? 'border-yellow-400 bg-yellow-50' : 'border-gray-300 bg-white'
                }`;
                boxDiv.onclick = () => toggleTreasureBox(art.id, boxDiv);
                
                boxDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-3xl mb-2">ğŸ“¦</div>
                        <div class="text-2xl mb-2">${art.icon}</div>
                        <p class="text-sm font-medium">${art.name}</p>
                        ${art.id === bestArt?.id ? '<p class="text-xs text-yellow-600 mt-1">æ¨è</p>' : ''}
                    </div>
                `;
                
                container.appendChild(boxDiv);
            });
        }
        
        // åˆ‡æ¢å®ç®±é€‰æ‹©
        function toggleTreasureBox(artId, element) {
            if (gameData.selectedBoxes.includes(artId)) {
                gameData.selectedBoxes = gameData.selectedBoxes.filter(id => id !== artId);
                element.classList.remove('border-purple-500', 'bg-purple-50');
                element.classList.add('border-gray-300', 'bg-white');
            } else {
                gameData.selectedBoxes.push(artId);
                element.classList.remove('border-gray-300', 'bg-white');
                element.classList.add('border-purple-500', 'bg-purple-50');
            }
        }
        
        // æ‰“å¼€é€‰ä¸­çš„å®ç®±
        function openSelectedBoxes() {
            if (gameData.selectedBoxes.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è‡³å°‘ä¸€ä¸ªå®ç®±ï¼');
                return;
            }
            
            hideAllScenes();
            document.getElementById('afterScene').classList.remove('hidden');
            generateSecretKeys();
        }
        
        // ç”Ÿæˆç§˜å¢ƒé’¥åŒ™
        function generateSecretKeys() {
            const container = document.getElementById('secretKeys');
            container.innerHTML = '';
            
            gameData.selectedBoxes.forEach(artId => {
                const art = arts.find(a => a.id === artId);
                
                const keyDiv = document.createElement('div');
                keyDiv.className = 'bg-gradient-to-r from-yellow-100 to-orange-100 border border-yellow-300 rounded-lg p-6';
                
                keyDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="text-4xl">${art.icon}</div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800 mb-2">${art.name} ç§˜å¢ƒä¹‹é’¥ ğŸ—ï¸</h3>
                            <div class="space-y-2 text-sm">
                                <p><span class="font-medium">ä¼ æ‰¿åŸºåœ°ï¼š</span>${art.venue}</p>
                                <p><span class="font-medium">åœ°å€ï¼š</span>${art.address}</p>
                                <p><span class="font-medium">æ¨èæ´»åŠ¨ï¼š</span>${art.activity}</p>
                            </div>
                            <div class="mt-3 bg-yellow-200 rounded-lg p-3">
                                <p class="text-xs text-yellow-800">ğŸ’¡ å¿«å¸¦ç€è¿™æŠŠé’¥åŒ™ï¼Œåœ¨è¯¾åæˆ–å‡æœŸå»å®åœ°æ¢è®¿å§ï¼é‚£é‡Œæœ‰çœŸæ­£çš„ä¼ æ‰¿äººåœ¨ç­‰ç€ä½ ï¼</p>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(keyDiv);
            });
        }
        
        // æ˜¾ç¤ºå½©è›‹
        function showEasterEgg() {
            document.getElementById('easterEggModal').classList.remove('hidden');
        }
        
        // å…³é—­å½©è›‹
        function closeEasterEgg() {
            document.getElementById('easterEggModal').classList.add('hidden');
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            gameData = {
                preTestAnswers: [],
                artScores: {},
                selectedBoxes: [],
                currentProgress: 0
            };
            
            hideAllScenes();
            document.getElementById('introScene').classList.remove('hidden');
            
            // é‡ç½®è¿›åº¦æ¡
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0/7';
            document.getElementById('nextToTreasure').classList.add('hidden');
        }
        
        // å·¥å…·å‡½æ•°
        function hideAllScenes() {
            document.querySelectorAll('.scene').forEach(scene => {
                scene.classList.add('hidden');
            });
        }
        
        function showModal(title, content) {
            document.getElementById('modalContent').innerHTML = `
                <h3 class="text-xl font-bold mb-4">${title}</h3>
                ${content}
            `;
            document.getElementById('gameModal').classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('gameModal').classList.add('hidden');
        }
        
        // æ¸¸æˆè¾…åŠ©å‡½æ•°
        function selectPiece(element, number) {
            element.style.backgroundColor = '#fef2f2';
            element.style.borderColor = '#f87171';
            element.innerHTML = 'âœ“';
        }
        
        function beatDrum(element) {
            element.style.animation = 'pulse 0.3s';
            setTimeout(() => {
                element.style.animation = '';
            }, 300);
        }
        
        function selectMaterial(element, isCorrect) {
            if (isCorrect) {
                element.style.borderColor = '#10b981';
                element.style.backgroundColor = '#d1fae5';
            } else {
                element.style.borderColor = '#ef4444';
                element.style.backgroundColor = '#fee2e2';
            }
        }
          function selectTool(tool) {
            console.log('é€‰æ‹©å·¥å…·ï¼š', tool);
        }
        
        // å‰ªçº¸æ¸¸æˆå‡½æ•°
        function selectPaperPiece(element, pieceNumber) {
            const state = window.paperCuttingState;
            if (!state || state.completed) return;
            
            const expectedPiece = state.correctSequence[state.currentStep];
            const isCorrect = pieceNumber === expectedPiece;
            
            if (isCorrect) {
                // æ­£ç¡®é€‰æ‹©
                element.style.backgroundColor = '#dc2626';
                element.style.borderColor = '#dc2626';
                element.style.color = 'white';
                element.style.transform = 'scale(0.95)';
                element.style.pointerEvents = 'none';
                
                state.selectedPieces.push(pieceNumber);
                state.currentStep++;
                
                // æ›´æ–°è¿›åº¦
                const progress = (state.currentStep / state.correctSequence.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = `${state.currentStep}/${state.correctSequence.length}`;
                
                // åé¦ˆä¿¡æ¯
                const feedback = document.getElementById('paperCuttingFeedback');
                feedback.textContent = 'âœ“ å¾ˆå¥½ï¼ç»§ç»­é€‰æ‹©ä¸‹ä¸€ç‰‡...';
                feedback.style.color = '#059669';
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (state.currentStep >= state.correctSequence.length) {
                    state.completed = true;
                    feedback.textContent = 'ğŸ‰ å¤ªæ£’äº†ï¼å‰ªçº¸å›¾æ¡ˆæ‹¼æ¥å®Œæˆï¼';
                    document.getElementById('paperCuttingComplete').disabled = false;
                    document.getElementById('paperCuttingComplete').className = 'bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                }
            } else {
                // é”™è¯¯é€‰æ‹©
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#ef4444';
                setTimeout(() => {
                    element.style.backgroundColor = '#fef2f2';
                    element.style.borderColor = '#fca5a5';
                }, 300);
                
                const feedback = document.getElementById('paperCuttingFeedback');
                feedback.textContent = 'âœ— é¡ºåºä¸å¯¹ï¼Œè¯·æŒ‰æ­£ç¡®é¡ºåºé€‰æ‹©';
                feedback.style.color = '#dc2626';
            }
        }
        
        function completePaperCutting(artId) {
            const state = window.paperCuttingState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 20) + 80;
                completeArtGame(artId, score);
            }
        }
        
        // éº’éºŸèˆæ¸¸æˆå‡½æ•°
        function beatQilinDrum(element, drumNumber) {
            const state = window.qilinDanceState;
            if (!state || state.completed) return;
            
            const expectedDrum = state.targetPattern[state.currentBeat];
            const drumName = drumNumber === 1 ? 'é¼“1' : 'é¼“2';
            const isCorrect = drumName === expectedDrum;
            
            // è§†è§‰åé¦ˆ
            element.style.transform = 'scale(0.9)';
            element.style.backgroundColor = isCorrect ? '#fbbf24' : '#fca5a5';
            
            setTimeout(() => {
                element.style.transform = 'scale(1)';
                element.style.backgroundColor = '#fef3c7';
            }, 150);
            
            if (isCorrect) {
                state.drumBeats.push(drumName);
                state.currentBeat++;
                
                // æ›´æ–°è¿›åº¦
                const progress = (state.currentBeat / state.targetPattern.length) * 100;
                document.getElementById('beatProgressBar').style.width = progress + '%';
                document.getElementById('beatProgress').textContent = `${state.currentBeat}/${state.targetPattern.length}`;
                
                // åé¦ˆä¿¡æ¯
                const feedback = document.getElementById('qilinFeedback');
                feedback.textContent = 'ğŸµ èŠ‚æ‹æ­£ç¡®ï¼éº’éºŸèˆåŠ¨èµ·æ¥...';
                feedback.style.color = '#d97706';
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (state.currentBeat >= state.targetPattern.length) {
                    state.completed = true;
                    feedback.textContent = 'ğŸ‰ å®Œç¾ï¼éº’éºŸèˆè¡¨æ¼”åœ†æ»¡æˆåŠŸï¼';
                    document.getElementById('qilinComplete').disabled = false;
                    document.getElementById('qilinComplete').className = 'bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                }
            } else {
                // é”™è¯¯èŠ‚æ‹ï¼Œé‡ç½®
                state.drumBeats = [];
                state.currentBeat = 0;
                
                document.getElementById('beatProgressBar').style.width = '0%';
                document.getElementById('beatProgress').textContent = '0/5';
                
                const feedback = document.getElementById('qilinFeedback');
                feedback.textContent = 'âœ— èŠ‚æ‹ä¸å¯¹ï¼Œé‡æ–°å¼€å§‹';
                feedback.style.color = '#dc2626';
            }
        }
        
        function completeQilinDance(artId) {
            const state = window.qilinDanceState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 20) + 85;
                completeArtGame(artId, score);
            }
        }
        
        // é±¼ç¯èˆæ¸¸æˆå‡½æ•°
        function moveFish(direction) {
            const state = window.fishLanternState;
            if (!state || state.completed) return;
            
            const fishElement = document.getElementById('fishLantern');
            const currentLeft = parseInt(fishElement.style.left) || 8;
            const currentTop = parseInt(fishElement.style.top) || 8;
            
            let newLeft = currentLeft;
            let newTop = currentTop;
            const step = 32; // Grid size
            
            switch (direction) {
                case 'up':
                    newTop = Math.max(8, currentTop - step);
                    break;
                case 'down':
                    newTop = Math.min(160, currentTop + step);
                    break;
                case 'left':
                    newLeft = Math.max(8, currentLeft - step);
                    break;
                case 'right':
                    newLeft = Math.min(264, currentLeft + step);
                    break;
            }
            
            fishElement.style.left = newLeft + 'px';
            fishElement.style.top = newTop + 'px';
            
            // æ£€æŸ¥æ˜¯å¦é è¿‘ç¯ç¬¼
            checkLanternProximity(newLeft, newTop);
        }
        
        function checkLanternProximity(fishX, fishY) {
            const state = window.fishLanternState;
            const lanternElements = document.querySelectorAll('.lantern');
            
            lanternElements.forEach((lanternEl, index) => {
                if (state.lanterns[index].lit) return;
                
                const lanternRect = lanternEl.getBoundingClientRect();
                const fishRect = document.getElementById('fishLantern').getBoundingClientRect();
                
                const distance = Math.sqrt(
                    Math.pow(lanternRect.left - fishRect.left, 2) + 
                    Math.pow(lanternRect.top - fishRect.top, 2)
                );
                
                if (distance < 50) { // é è¿‘è·ç¦»
                    // ç‚¹äº®ç¯ç¬¼
                    state.lanterns[index].lit = true;
                    state.lanternsLit++;
                    
                    lanternEl.style.backgroundColor = '#fbbf24';
                    lanternEl.style.boxShadow = '0 0 15px #fbbf24';
                    lanternEl.style.transform = 'scale(1.1)';
                    
                    // æ›´æ–°è¿›åº¦
                    const progress = (state.lanternsLit / state.lanterns.length) * 100;
                    document.getElementById('lanternProgressBar').style.width = progress + '%';
                    document.getElementById('lanternCount').textContent = `${state.lanternsLit}/${state.lanterns.length}`;
                    
                    // åé¦ˆ
                    const feedback = document.getElementById('fishFeedback');
                    feedback.textContent = `âœ¨ ç‚¹äº®äº†ç¬¬${state.lanternsLit}ä¸ªç¯ç¬¼ï¼`;
                    feedback.style.color = '#2563eb';
                    
                    // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨ç‚¹äº®
                    if (state.lanternsLit >= state.lanterns.length) {
                        state.completed = true;
                        feedback.textContent = 'ğŸ‰ æ‰€æœ‰ç¯ç¬¼éƒ½ç‚¹äº®äº†ï¼é±¼ç¯èˆåœ†æ»¡æˆåŠŸï¼';
                        document.getElementById('fishComplete').disabled = false;
                        document.getElementById('fishComplete').className = 'bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                    }
                }
            });
        }
          function completeFishLantern(artId) {
            const state = window.fishLanternState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 20) + 82;
                completeArtGame(artId, score);
            }
        }
        
        // è³è‚æ‹³æ¸¸æˆå‡½æ•°
        function demonstrateMove(moveName, element) {
            const state = window.mantisBoxingState;
            if (!state) return;
            
            // é‡ç½®æ‰€æœ‰æ‹›å¼çš„æ ·å¼
            document.querySelectorAll('.mantis-move').forEach(move => {
                move.classList.remove('border-green-500', 'bg-green-200');
                move.classList.add('border-green-200', 'bg-green-50');
            });
            
            // é«˜äº®å½“å‰é€‰ä¸­çš„æ‹›å¼
            element.classList.remove('border-green-200', 'bg-green-50');
            element.classList.add('border-green-500', 'bg-green-200');
            
            // æ˜¾ç¤ºæ‹›å¼æè¿°
            const descriptionContainer = document.getElementById('moveDescription');
            const descriptionContent = document.getElementById('moveDescriptionContent');
            
            descriptionContent.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">${getMoveMoji(moveName)}</div>
                    <div>
                        <p class="font-bold text-yellow-800">${moveName}</p>
                        <p class="text-yellow-700">${state.moveDescriptions[moveName]}</p>
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-600">
                    ğŸ’¡ ${getMoveDetails(moveName)}
                </div>
            `;
            
            descriptionContainer.classList.remove('hidden');
            
            // æ’­æ”¾åŠ¨ç”»æ•ˆæœ
            element.style.transform = 'scale(1.05)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }
        
        function getMoveMoji(moveName) {
            const mojiMap = {
                'æ•è‰': 'ğŸ¦‚',
                'å‹¾æ‚': 'ğŸ¤²', 
                'é—ªèº«': 'âš¡',
                'è¿›é€€': 'ğŸ”„'
            };
            return mojiMap[moveName] || 'ğŸ¥‹';
        }
        
        function getMoveDetails(moveName) {
            const details = {
                'æ•è‰': 'æ¨¡ä»¿è³è‚æ•é£ŸåŠ¨ä½œï¼ŒåŒè‡‚å¿«é€Ÿå‰æ¢ï¼Œæ‰‹å‹å¦‚è³è‚å‰è¶³',
                'å‹¾æ‚': 'æ‰‹æŒ‡å¼¯æ›²å¦‚é’©ï¼Œç”¨äºæŠ“æ¡å’Œæ§åˆ¶å¯¹æ‰‹çš„æ”»å‡»',
                'é—ªèº«': 'èº«ä½“ä¾§ç§»é—ªé¿ï¼ŒåŒæ—¶å‡†å¤‡åå‡»ï¼Œä½“ç°è³è‚çš„æ•æ·',
                'è¿›é€€': 'æ­¥æ³•çµæ´»ï¼Œå‰è¿›æ—¶è¿…çŒ›ï¼Œåé€€æ—¶ç¨³å¥ï¼Œä¿æŒå¹³è¡¡'
            };
            return details[moveName] || '';
        }
        
        function startMantisPractice() {
            const state = window.mantisBoxingState;
            if (!state) return;
            
            // éšè—ç¤ºèŒƒé˜¶æ®µï¼Œæ˜¾ç¤ºç»ƒä¹ é˜¶æ®µ
            document.getElementById('demonstrationPhase').classList.add('hidden');
            document.getElementById('practicePhase').classList.remove('hidden');
            document.getElementById('startPracticeBtn').classList.add('hidden');
            
            // é‡ç½®ç»ƒä¹ çŠ¶æ€
            state.currentMove = 0;
            state.userSequence = [];
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateMantisPracticeProgress();
        }
        
        function practiceMove(moveName, element) {
            const state = window.mantisBoxingState;
            if (!state || state.completed) return;
            
            const expectedMove = state.moveSequence[state.currentMove];
            const isCorrect = moveName === expectedMove;
            
            if (isCorrect) {
                // æ­£ç¡®çš„åŠ¨ä½œ
                element.style.backgroundColor = '#10b981';
                element.style.borderColor = '#10b981';
                element.style.color = 'white';
                element.style.transform = 'scale(0.95)';
                
                // æ·»åŠ æˆåŠŸåŠ¨ç”»
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '#d1fae5';
                    element.style.borderColor = '#10b981';
                    element.style.color = '#064e3b';
                }, 300);
                
                state.userSequence.push(moveName);
                state.currentMove++;
                
                // æ›´æ–°åé¦ˆ
                const feedback = document.getElementById('practiceFeedback');
                feedback.innerHTML = `
                    <div class="text-green-600">
                        âœ“ <strong>${moveName}</strong> - åŠ¨ä½œæ ‡å‡†ï¼ç»§ç»­ä¸‹ä¸€ä¸ªåŠ¨ä½œ...
                    </div>
                `;
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€è½®
                if (state.currentMove >= state.moveSequence.length) {
                    completeRound();
                }
                
            } else {
                // é”™è¯¯çš„åŠ¨ä½œ
                element.style.backgroundColor = '#ef4444';
                element.style.borderColor = '#ef4444';
                element.style.color = 'white';
                element.style.transform = 'scale(1.05)';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '#fee2e2';
                    element.style.borderColor = '#fca5a5';
                    element.style.color = '#7f1d1d';
                }, 300);
                
                // é‡ç½®å½“å‰è½®æ¬¡
                state.currentMove = 0;
                state.userSequence = [];
                
                // é‡ç½®æ‰€æœ‰å…ƒç´ æ ·å¼
                resetPracticeMoves();
                
                const feedback = document.getElementById('practiceFeedback');
                feedback.innerHTML = `
                    <div class="text-red-600">
                        âœ— åŠ¨ä½œé¡ºåºé”™è¯¯ï¼åº”è¯¥æ˜¯ï¼š<strong>${expectedMove}</strong><br>
                        <span class="text-sm">é‡æ–°å¼€å§‹è¿™ä¸€è½®ç»ƒä¹ </span>
                    </div>
                `;
            }
            
            updateMantisPracticeProgress();
        }
        
        function resetPracticeMoves() {
            document.querySelectorAll('.practice-move').forEach(move => {
                move.style.backgroundColor = '#f3f4f6';
                move.style.borderColor = '#d1d5db';
                move.style.color = '#374151';
                move.style.transform = 'scale(1)';
            });
        }
        
        function completeRound() {
            const state = window.mantisBoxingState;
            state.practiceRound++;
            
            const feedback = document.getElementById('practiceFeedback');
            
            if (state.practiceRound > state.maxRounds) {
                // å®Œæˆæ‰€æœ‰è½®æ¬¡
                state.completed = true;
                feedback.innerHTML = `
                    <div class="bg-green-100 border border-green-400 rounded-lg p-3 text-green-800">
                        ğŸ‰ <strong>æ­å–œï¼ä½ å·²ç»æŒæ¡äº†è³è‚æ‹³åŸºç¡€å¥—è·¯ï¼</strong><br>
                        <span class="text-sm">è¿ç»­å®Œæˆ${state.maxRounds}è½®ç»ƒä¹ ï¼Œæ­¦å­¦å¤©èµ‹å‡ºä¼—ï¼</span>
                    </div>
                `;
                
                document.getElementById('mantisComplete').disabled = false;
                document.getElementById('mantisComplete').className = 'bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                
            } else {
                // ç»§ç»­ä¸‹ä¸€è½®
                state.currentMove = 0;
                state.userSequence = [];
                resetPracticeMoves();
                
                feedback.innerHTML = `
                    <div class="bg-blue-100 border border-blue-400 rounded-lg p-3 text-blue-800">
                        ğŸ¥‹ ç¬¬${state.practiceRound - 1}è½®å®Œæˆï¼å¼€å§‹ç¬¬${state.practiceRound}è½®ç»ƒä¹ ...<br>
                        <span class="text-sm">ç†Ÿèƒ½ç”Ÿå·§ï¼Œç»§ç»­ä¿æŒï¼</span>
                    </div>
                `;
            }
            
            updateMantisPracticeProgress();
        }
        
        function updateMantisPracticeProgress() {
            const state = window.mantisBoxingState;
            if (!state) return;
            
            const overallProgress = ((state.practiceRound - 1) * 4 + state.currentMove) / (state.maxRounds * 4) * 100;
            
            document.getElementById('mantisProgressBar').style.width = overallProgress + '%';
            document.getElementById('practiceRound').textContent = `${state.practiceRound}/${state.maxRounds}`;
        }
          function completeMantisBoxing(artId) {
            const state = window.mantisBoxingState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 15) + 85; // 85-100åˆ†
                completeArtGame(artId, score);
            }
        }
        
        // å®¢å®¶å‡‰å¸½æ¸¸æˆå‡½æ•°
        function selectHakkaMaterial(element, materialName, isCorrect) {
            const state = window.hakkaHatState;
            if (!state || state.phase !== 'material') return;
            
            if (isCorrect) {
                if (!state.selectedMaterials.includes(materialName)) {
                    state.selectedMaterials.push(materialName);
                    element.style.backgroundColor = '#dcfce7';
                    element.style.borderColor = '#16a34a';
                    element.style.transform = 'scale(0.95)';
                    element.style.pointerEvents = 'none';
                    
                    // æ›´æ–°åé¦ˆ
                    const feedback = document.getElementById('materialFeedback');
                    feedback.innerHTML = `<div class="text-green-600">âœ“ ${materialName} - é€‰æ‹©æ­£ç¡®ï¼(${state.selectedMaterials.length}/3)</div>`;
                    
                    // æ£€æŸ¥æ˜¯å¦é€‰æ‹©å®Œæ‰€æœ‰æ­£ç¡®ææ–™
                    if (state.selectedMaterials.length >= state.correctMaterials.length) {
                        feedback.innerHTML = `<div class="text-green-600">ğŸ‰ å¤ªæ£’äº†ï¼æ‰€æœ‰ææ–™é€‰æ‹©æ­£ç¡®ï¼</div>`;
                        document.getElementById('nextToColorBtn').classList.remove('hidden');
                        document.getElementById('hatProgressBar').style.width = '33%';
                        document.getElementById('hatProgressText').textContent = 'é…è‰²é˜¶æ®µ';
                    }
                }
            } else {
                // é”™è¯¯ææ–™
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#dc2626';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 500);
                
                const feedback = document.getElementById('materialFeedback');
                feedback.innerHTML = `<div class="text-red-600">âœ— ${materialName} ä¸é€‚åˆåˆ¶ä½œå‡‰å¸½ï¼Œè¯·é‡æ–°é€‰æ‹©</div>`;
            }
        }
        
        function startColorPhase() {
            const state = window.hakkaHatState;
            if (!state) return;
            
            state.phase = 'color';
            document.getElementById('materialPhase').classList.add('hidden');
            document.getElementById('colorPhase').classList.remove('hidden');
        }
        
        function selectHatColor(element, colorName, colorClass) {
            const state = window.hakkaHatState;
            if (!state || state.phase !== 'color') return;
            
            // é‡ç½®å…¶ä»–é¢œè‰²é€‰é¡¹
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('border-4');
                option.classList.add('border-2');
            });
            
            // é«˜äº®é€‰ä¸­çš„é¢œè‰²
            element.classList.remove('border-2');
            element.classList.add('border-4');
            
            state.materialColors.selected = colorName;
            state.materialColors.class = colorClass;
            
            // æ˜¾ç¤ºé¢„è§ˆ
            const preview = document.getElementById('colorPreview');
            const hatPreview = document.getElementById('hatPreview');
            preview.classList.remove('hidden');
            
            const colorMap = {
                'red': '#ef4444',
                'blue': '#3b82f6', 
                'green': '#10b981',
                'yellow': '#f59e0b'
            };
            
            hatPreview.style.backgroundColor = colorMap[colorClass];
            hatPreview.innerHTML = 'ğŸ‘’';
            hatPreview.style.display = 'flex';
            hatPreview.style.alignItems = 'center';
            hatPreview.style.justifyContent = 'center';
            hatPreview.style.fontSize = '2rem';
            
            // åé¦ˆ
            const feedback = document.getElementById('colorFeedback');
            feedback.innerHTML = `<div class="text-${colorClass}-600">âœ“ é€‰æ‹©äº†${colorName}è‰²ï¼Œå¾ˆæœ‰å®¢å®¶ä¼ ç»ŸéŸµå‘³ï¼</div>`;
            
            // æ˜¾ç¤ºä¸‹ä¸€æ­¥æŒ‰é’®
            document.getElementById('nextToWeavingBtn').classList.remove('hidden');
            document.getElementById('hatProgressBar').style.width = '66%';
            document.getElementById('hatProgressText').textContent = 'ç¼–ç»‡é˜¶æ®µ';
        }
        
        function startWeavingPhase() {
            const state = window.hakkaHatState;
            if (!state) return;
            
            state.phase = 'weaving';
            document.getElementById('colorPhase').classList.add('hidden');
            document.getElementById('weavingPhase').classList.remove('hidden');
            
            updateWeavingStep();
        }
        
        function performWeaving(element, weavingType) {
            const state = window.hakkaHatState;
            if (!state || state.phase !== 'weaving' || state.completed) return;
            
            const expectedWeaving = state.weavingPattern[state.weavingStep];
            const isCorrect = weavingType === expectedWeaving;
            
            if (isCorrect) {
                // æ­£ç¡®ç¼–ç»‡
                element.style.backgroundColor = '#dcfce7';
                element.style.borderColor = '#16a34a';
                element.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 300);
                
                state.weavingStep++;
                
                // æ›´æ–°è¿›åº¦
                const weavingProgress = (state.weavingStep / state.weavingPattern.length) * 100;
                document.getElementById('weavingProgressBar').style.width = weavingProgress + '%';
                document.getElementById('weavingStepText').textContent = `${state.weavingStep}/${state.weavingPattern.length}`;
                
                const feedback = document.getElementById('weavingFeedback');
                
                if (state.weavingStep >= state.weavingPattern.length) {
                    // å®Œæˆç¼–ç»‡
                    state.completed = true;
                    feedback.innerHTML = `
                        <div class="bg-green-100 border border-green-400 rounded-lg p-3 text-green-800">
                            ğŸ‰ <strong>æ­å–œï¼å®¢å®¶å‡‰å¸½åˆ¶ä½œå®Œæˆï¼</strong><br>
                            <span class="text-sm">ä½ æˆåŠŸæŒæ¡äº†ä¼ ç»Ÿç¼–ç»‡å·¥è‰ºï¼</span>
                        </div>
                    `;
                    
                    document.getElementById('hakkaComplete').disabled = false;
                    document.getElementById('hakkaComplete').className = 'bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                    
                    document.getElementById('hatProgressBar').style.width = '100%';
                    document.getElementById('hatProgressText').textContent = 'åˆ¶ä½œå®Œæˆ';
                    
                } else {
                    feedback.innerHTML = `<div class="text-green-600">âœ“ ${weavingType} - ç¼–ç»‡æ­£ç¡®ï¼ç»§ç»­ä¸‹ä¸€æ­¥...</div>`;
                    updateWeavingStep();
                }
                
            } else {
                // é”™è¯¯ç¼–ç»‡
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#dc2626';
                element.style.transform = 'scale(1.05)';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 300);
                
                const feedback = document.getElementById('weavingFeedback');
                feedback.innerHTML = `<div class="text-red-600">âœ— ç¼–ç»‡æ–¹å‘é”™è¯¯ï¼åº”è¯¥æ˜¯ï¼š${expectedWeaving}</div>`;
            }
        }
        
        function updateWeavingStep() {
            const state = window.hakkaHatState;
            if (!state) return;
            
            const stepDescriptions = {
                'æ¨ªç¼–': 'æ¨ªå‘ç¼–ç»‡ç«¹ç¯¾',
                'ç«–ç¼–': 'ç«–å‘ç¼–ç»‡ç«¹ç¯¾',
                'æ”¶å°¾': 'æ”¶å°¾å›ºå®šè¾¹ç¼˜'
            };
            
            const currentStep = state.weavingPattern[state.weavingStep];
            document.getElementById('currentWeavingStep').textContent = stepDescriptions[currentStep] || 'ç¼–ç»‡å®Œæˆ';
        }
          function completeHakkaHat(artId) {
            const state = window.hakkaHatState;
            if (state && state.completed) {
                const score = Math.floor(Math.random() * 15) + 85; // 85-100åˆ†
                completeArtGame(artId, score);
            }
        }
        
        // æµ·èƒ†ç²½æ¸¸æˆå‡½æ•°
        function selectIngredient(element, ingredientName) {
            const state = window.seaUrchinZongziState;
            if (!state || state.phase !== 'selection') return;
            
            // é€‰ä¸­é£Ÿæ
            if (!state.ingredients[ingredientName].selected) {
                state.ingredients[ingredientName].selected = true;
                element.style.backgroundColor = '#dbeafe';
                element.style.borderColor = '#3b82f6';
                element.style.transform = 'scale(0.98)';
                
                updateIngredientProgress();
            }
        }
        
        function setQuality(ingredientName, quality) {
            const state = window.seaUrchinZongziState;
            if (!state || state.phase !== 'selection') return;
            
            state.ingredients[ingredientName].quality = quality;
            state.totalQuality = Object.values(state.ingredients).reduce((sum, ingredient) => sum + ingredient.quality, 0);
            
            // æ›´æ–°æ˜Ÿæ˜Ÿæ˜¾ç¤º
            const starsContainer = document.querySelector(`[data-ingredient="${ingredientName}"]`);
            const stars = starsContainer.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                if (index < quality) {
                    star.textContent = 'â­';
                    star.style.color = '#fbbf24';
                } else {
                    star.textContent = 'â˜†';
                    star.style.color = '#d1d5db';
                }
            });
            
            updateIngredientProgress();
        }
        
        function updateIngredientProgress() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            const selectedCount = Object.values(state.ingredients).filter(ingredient => ingredient.selected).length;
            const qualityCount = Object.values(state.ingredients).filter(ingredient => ingredient.quality > 0).length;
            
            const feedback = document.getElementById('ingredientFeedback');
            
            if (selectedCount === 4 && qualityCount === 4) {
                const avgQuality = state.totalQuality / 4;
                let qualityText = '';
                
                if (avgQuality >= 2.5) {
                    qualityText = 'ä¼˜è´¨é£Ÿæï¼Œå¿…å®šé¦™å‘³æµ“éƒï¼';
                } else if (avgQuality >= 2) {
                    qualityText = 'é£Ÿæå“è´¨ä¸é”™ï¼Œç²½å­ä¼šå¾ˆç¾å‘³ï¼';
                } else {
                    qualityText = 'é£Ÿæä¸€èˆ¬ï¼Œä½†ç”¨å¿ƒåˆ¶ä½œåŒæ ·å¯ä»¥æˆåŠŸï¼';
                }
                
                feedback.innerHTML = `<div class="text-green-600">âœ“ æ‰€æœ‰é£Ÿæå·²é€‰æ‹©å®Œæ¯•ï¼${qualityText}</div>`;
                document.getElementById('nextToCookingBtn').classList.remove('hidden');
                document.getElementById('zongziProgressBar').style.width = '33%';
                document.getElementById('zongziProgressText').textContent = 'åˆ¶ä½œå·¥åº';
            } else {
                feedback.innerHTML = `<div class="text-blue-600">å·²é€‰æ‹© ${selectedCount}/4 ç§é£Ÿæï¼Œå·²è¯„åˆ† ${qualityCount}/4 ç§</div>`;
            }
        }
        
        function startCookingPhase() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            state.phase = 'cooking';
            document.getElementById('selectionPhase').classList.add('hidden');
            document.getElementById('cookingPhase').classList.remove('hidden');
            
            updateCookingStep();
        }
        
        function updateCookingStep() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            const stepDescriptions = {
                'æ¸…æ´—æµ·èƒ†': 'è½»æŸ”åœ°æ¸…æ´—æµ·èƒ†ï¼Œä¿æŒå…¶å®Œæ•´æ€§å’Œé²œå‘³',
                'æµ¸æ³¡ç³¯ç±³': 'ç³¯ç±³éœ€è¦æµ¸æ³¡2-3å°æ—¶ï¼Œä½¿å…¶å……åˆ†å¸æ°´',
                'ç²½å¶åŒ…é¦…': 'å°†ç³¯ç±³å’Œæµ·èƒ†åŒ…å…¥ç²½å¶ï¼Œæ‰‹æ³•è¦ç†Ÿç»ƒ',
                'ç»³å­æ†æ‰': 'ç”¨æ£‰ç»³ç´§å¯†æ†æ‰ï¼Œç¡®ä¿ä¸ä¼šæ•£å¼€',
                'ä¸‹é”…è’¸ç…®': 'å¤§ç«ç…®å¼€åè½¬å°ç«ï¼Œè’¸ç…®1-2å°æ—¶'
            };
            
            const stepEmojis = {
                'æ¸…æ´—æµ·èƒ†': 'ğŸ¦”ğŸ’§',
                'æµ¸æ³¡ç³¯ç±³': 'ğŸŒ¾ğŸ’§',
                'ç²½å¶åŒ…é¦…': 'ğŸƒğŸ™',
                'ç»³å­æ†æ‰': 'ğŸª¢ğŸ”—',
                'ä¸‹é”…è’¸ç…®': 'ğŸ”¥ğŸ²'
            };
            
            const currentStepName = state.cookingSteps[state.currentStep];
            document.getElementById('currentCookingStep').textContent = currentStepName;
            document.getElementById('stepInstruction').textContent = stepDescriptions[currentStepName];
            document.getElementById('stepVisualization').textContent = stepEmojis[currentStepName];
            document.getElementById('stepAnimation').textContent = `æ­£åœ¨æ‰§è¡Œï¼š${currentStepName}`;
            
            // æ›´æ–°æ­¥éª¤è¿›åº¦
            document.getElementById('cookingStepText').textContent = `${state.currentStep + 1}/${state.cookingSteps.length}`;
        }
        
        function performCookingStep() {
            const state = window.seaUrchinZongziState;
            if (!state || state.phase !== 'cooking') return;
            
            // æ‰§è¡Œå½“å‰æ­¥éª¤
            const stepProgress = ((state.currentStep + 1) / state.cookingSteps.length) * 100;
            document.getElementById('cookingStepBar').style.width = stepProgress + '%';
            
            const feedback = document.getElementById('cookingFeedback');
            const currentStepName = state.cookingSteps[state.currentStep];
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const visualization = document.getElementById('stepVisualization');
            visualization.style.transform = 'scale(1.2)';
            setTimeout(() => {
                visualization.style.transform = 'scale(1)';
            }, 300);
            
            feedback.innerHTML = `<div class="text-green-600">âœ“ ${currentStepName} - å®Œæˆï¼</div>`;
            
            state.currentStep++;
            
            if (state.currentStep >= state.cookingSteps.length) {
                // å®Œæˆæ‰€æœ‰åˆ¶ä½œæ­¥éª¤
                state.phase = 'tasting';
                document.getElementById('cookingPhase').classList.add('hidden');
                document.getElementById('tastingPhase').classList.remove('hidden');
                
                // è®¡ç®—æœ€ç»ˆè¯„åˆ†
                calculateFinalScore();
                
                document.getElementById('zongziProgressBar').style.width = '100%';
                document.getElementById('zongziProgressText').textContent = 'åˆ¶ä½œå®Œæˆ';
                
            } else {
                // ç»§ç»­ä¸‹ä¸€æ­¥
                setTimeout(() => {
                    updateCookingStep();
                    feedback.innerHTML = `<div class="text-blue-600">å‡†å¤‡ä¸‹ä¸€æ­¥éª¤...</div>`;
                }, 1000);
            }
        }
        
        function calculateFinalScore() {
            const state = window.seaUrchinZongziState;
            if (!state) return;
            
            const avgQuality = state.totalQuality / 4;
            const baseScore = 70;
            const qualityBonus = avgQuality * 10;
            const finalScore = Math.min(100, baseScore + qualityBonus);
            
            // æ˜¾ç¤ºè¯„åˆ†
            document.getElementById('finalScore').innerHTML = `
                <p class="mb-2">é£Ÿæå“è´¨å¹³å‡åˆ†ï¼š${avgQuality.toFixed(1)}/3 â­</p>
                <p>æœ€ç»ˆå¾—åˆ†ï¼š<span class="text-orange-600 font-bold text-lg">${finalScore.toFixed(0)}/100</span></p>
            `;
            
            // å£æ„Ÿå’ŒæŠ€è‰ºè¯„ä»·
            const tasteStars = 'â­'.repeat(Math.floor(avgQuality)) + 'â˜†'.repeat(3 - Math.floor(avgQuality));
            const skillStars = 'â­'.repeat(Math.floor(finalScore / 25)) + 'â˜†'.repeat(4 - Math.floor(finalScore / 25));
            
            document.getElementById('tasteRating').textContent = tasteStars;
            document.getElementById('skillRating').textContent = skillStars;
            
            // åé¦ˆæ–‡å­—
            let feedback = '';
            if (finalScore >= 90) {
                feedback = 'ğŸ‰ å®Œç¾ï¼ä½ åˆ¶ä½œçš„æµ·èƒ†ç²½é²œç¾æ— æ¯”ï¼Œå ªæ¯”å¤§é¹æ¸”æ°‘çš„æ‰‹è‰ºï¼';
            } else if (finalScore >= 80) {
                feedback = 'ğŸ‘ å¾ˆæ£’ï¼æµ·èƒ†ç²½å‘³é“å¾ˆå¥½ï¼Œå·²ç»æŒæ¡äº†åŸºæœ¬åˆ¶ä½œè¦é¢†ï¼';
            } else {
                feedback = 'ğŸ’ª ä¸é”™ï¼è™½ç„¶è¿˜æœ‰æ”¹è¿›ç©ºé—´ï¼Œä½†ä½ å·²ç»ä½“éªŒäº†ä¼ ç»Ÿåˆ¶ä½œå·¥è‰ºï¼';
            }
            
            document.getElementById('tastingFeedback').innerHTML = `<div class="text-orange-600">${feedback}</div>`;
            
            // å¯ç”¨å®ŒæˆæŒ‰é’®
            state.completed = true;
            document.getElementById('zongziComplete').disabled = false;
            document.getElementById('zongziComplete').className = 'bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
        }
          function completeSeaUrchinZongzi(artId) {
            const state = window.seaUrchinZongziState;
            if (state && state.completed) {
                const avgQuality = state.totalQuality / 4;
                const score = Math.min(100, 70 + avgQuality * 10);
                completeArtGame(artId, Math.floor(score));
            }
        }
        
        // ç‰ˆç”»æ¸¸æˆå‡½æ•°
        function selectPrintTool(element, toolName, isCorrect) {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'tools') return;
            
            if (isCorrect) {
                if (!state.selectedTools.includes(toolName)) {
                    state.selectedTools.push(toolName);
                    element.style.backgroundColor = '#dcfce7';
                    element.style.borderColor = '#16a34a';
                    element.style.transform = 'scale(0.95)';
                    element.style.pointerEvents = 'none';
                    
                    // æ›´æ–°åé¦ˆ
                    const feedback = document.getElementById('toolFeedback');
                    feedback.innerHTML = `<div class="text-green-600">âœ“ ${toolName} - é€‰æ‹©æ­£ç¡®ï¼(${state.selectedTools.length}/3)</div>`;
                    
                    // æ£€æŸ¥æ˜¯å¦é€‰æ‹©å®Œæ‰€æœ‰æ­£ç¡®å·¥å…·
                    if (state.selectedTools.length >= state.correctTools.length) {
                        feedback.innerHTML = `<div class="text-green-600">ğŸ‰ å¤ªæ£’äº†ï¼æ‰€æœ‰å·¥å…·é€‰æ‹©æ­£ç¡®ï¼</div>`;
                        document.getElementById('nextToCarvingBtn').classList.remove('hidden');
                        document.getElementById('printProgressBar').style.width = '25%';
                        document.getElementById('printProgressText').textContent = 'é›•åˆ»å›¾æ¡ˆ';
                    }
                }
            } else {
                // é”™è¯¯å·¥å…·
                element.style.backgroundColor = '#fee2e2';
                element.style.borderColor = '#dc2626';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                    element.style.borderColor = '';
                }, 500);
                
                const feedback = document.getElementById('toolFeedback');
                feedback.innerHTML = `<div class="text-red-600">âœ— ${toolName} ä¸é€‚åˆç‰ˆç”»åˆ¶ä½œï¼Œè¯·é‡æ–°é€‰æ‹©</div>`;
            }
        }
        
        function startCarvingPhase() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            state.phase = 'carving';
            document.getElementById('toolsPhase').classList.add('hidden');
            document.getElementById('carvingPhase').classList.remove('hidden');
            
            // ç”Ÿæˆç›®æ ‡å›¾æ¡ˆå’Œç©å®¶å›¾æ¡ˆ
            generateCarvingPatterns();
        }
        
        function generateCarvingPatterns() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            // ç”Ÿæˆç›®æ ‡å›¾æ¡ˆ
            const targetContainer = document.getElementById('targetPattern');
            targetContainer.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = `w-6 h-6 border border-gray-300 ${state.carvingPattern[i][j] ? 'bg-gray-800' : 'bg-gray-100'}`;
                    targetContainer.appendChild(cell);
                }
            }
            
            // ç”Ÿæˆç©å®¶å›¾æ¡ˆï¼ˆå¯ç‚¹å‡»ï¼‰
            const playerContainer = document.getElementById('playerPattern');
            playerContainer.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'w-6 h-6 border border-gray-300 bg-gray-100 cursor-pointer hover:bg-gray-200 transition-colors';
                    cell.onclick = () => toggleCarvingCell(i, j, cell);
                    playerContainer.appendChild(cell);
                }
            }
        }
        
        function toggleCarvingCell(row, col, element) {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'carving') return;
            
            // åˆ‡æ¢é›•åˆ»çŠ¶æ€
            state.playerPattern[row][col] = state.playerPattern[row][col] ? 0 : 1;
            
            // æ›´æ–°è§†è§‰æ•ˆæœ
            if (state.playerPattern[row][col]) {
                element.className = 'w-6 h-6 border border-gray-300 bg-gray-800 cursor-pointer transition-colors';
            } else {
                element.className = 'w-6 h-6 border border-gray-300 bg-gray-100 cursor-pointer hover:bg-gray-200 transition-colors';
            }
            
            // æ£€æŸ¥åŒ¹é…åº¦
            checkCarvingMatch();
        }
        
        function checkCarvingMatch() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            let matches = 0;
            let total = 0;
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    total++;
                    if (state.playerPattern[i][j] === state.carvingPattern[i][j]) {
                        matches++;
                    }
                }
            }
            
            const accuracy = (matches / total) * 100;
            const feedback = document.getElementById('carvingFeedback');
            
            if (accuracy >= 80) {
                feedback.innerHTML = `<div class="text-green-600">ğŸ‰ é›•åˆ»ç²¾ç¾ï¼åŒ¹é…åº¦ï¼š${accuracy.toFixed(0)}%</div>`;
                document.getElementById('nextToInkingBtn').classList.remove('hidden');
                document.getElementById('printProgressBar').style.width = '50%';
                document.getElementById('printProgressText').textContent = 'é€‰æ‹©å¢¨è‰²';
            } else if (accuracy >= 60) {
                feedback.innerHTML = `<div class="text-yellow-600">ğŸ‘ ä¸é”™ï¼ç»§ç»­é›•åˆ»ï¼ŒåŒ¹é…åº¦ï¼š${accuracy.toFixed(0)}%</div>`;
            } else {
                feedback.innerHTML = `<div class="text-blue-600">ç»§ç»­é›•åˆ»ï¼ŒåŒ¹é…åº¦ï¼š${accuracy.toFixed(0)}%ï¼ˆéœ€è¦80%ä»¥ä¸Šï¼‰</div>`;
            }
        }
        
        function startInkingPhase() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            state.phase = 'inking';
            document.getElementById('carvingPhase').classList.add('hidden');
            document.getElementById('inkingPhase').classList.remove('hidden');
        }
        
        function selectInkColor(element, colorName) {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'inking') return;
            
            // é‡ç½®å…¶ä»–é¢œè‰²é€‰é¡¹
            document.querySelectorAll('.ink-option').forEach(option => {
                option.classList.remove('border-4');
                option.classList.add('border-2');
            });
            
            // é«˜äº®é€‰ä¸­çš„é¢œè‰²
            element.classList.remove('border-2');
            element.classList.add('border-4');
            
            state.selectedInk = colorName;
            
            // åé¦ˆ
            const feedback = document.getElementById('inkFeedback');
            feedback.innerHTML = `<div class="text-indigo-600">âœ“ é€‰æ‹©äº†${colorName}å¢¨ï¼Œå¤æœ´é›…è‡´ï¼</div>`;
            
            // æ˜¾ç¤ºä¸‹ä¸€æ­¥æŒ‰é’®
            document.getElementById('nextToPrintingBtn').classList.remove('hidden');
            document.getElementById('printProgressBar').style.width = '75%';
            document.getElementById('printProgressText').textContent = 'å°åˆ¶ä½œå“';
        }
        
        function startPrintingPhase() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            state.phase = 'printing';
            document.getElementById('inkingPhase').classList.add('hidden');
            document.getElementById('printingPhase').classList.remove('hidden');
            
            // ç”Ÿæˆæœ€ç»ˆæ‰“å°é¢„è§ˆ
            generatePrintPreview();
        }
        
        function generatePrintPreview() {
            const state = window.woodblockPrintState;
            if (!state) return;
            
            const printContainer = document.getElementById('finalPrint');
            printContainer.innerHTML = '';
            
            const colorMap = {
                'é»‘è‰²': 'bg-gray-800',
                'çº¢è‰²': 'bg-red-600',
                'è“è‰²': 'bg-blue-600'
            };
            
            const selectedColor = colorMap[state.selectedInk] || 'bg-gray-800';
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = `w-6 h-6 border border-gray-300 ${
                        state.playerPattern[i][j] ? selectedColor : 'bg-white'
                    }`;
                    printContainer.appendChild(cell);
                }
            }
        }
        
        function performPrinting() {
            const state = window.woodblockPrintState;
            if (!state || state.phase !== 'printing') return;
            
            // æ‰“å°åŠ¨ç”»æ•ˆæœ
            const printBtn = document.getElementById('performPrintBtn');
            printBtn.style.transform = 'scale(0.95)';
            printBtn.disabled = true;
            
            setTimeout(() => {
                printBtn.style.transform = 'scale(1)';
                
                // è®¡ç®—æ‰“å°è´¨é‡
                let matches = 0;
                let total = 0;
                
                for (let i = 0; i < 6; i++) {
                    for (let j = 0; j < 8; j++) {
                        total++;
                        if (state.playerPattern[i][j] === state.carvingPattern[i][j]) {
                            matches++;
                        }
                    }
                }
                
                state.printQuality = (matches / total) * 100;
                state.completed = true;
                
                const feedback = document.getElementById('printingFeedback');
                
                if (state.printQuality >= 80) {
                    feedback.innerHTML = `
                        <div class="bg-green-100 border border-green-400 rounded-lg p-3 text-green-800">
                            ğŸ‰ <strong>å°åˆ¶æˆåŠŸï¼ç‰ˆç”»ä½œå“ç²¾ç¾ç»ä¼¦ï¼</strong><br>
                            <span class="text-sm">å›¾æ¡ˆåŒ¹é…åº¦ï¼š${state.printQuality.toFixed(0)}%</span>
                        </div>
                    `;
                } else {
                    feedback.innerHTML = `
                        <div class="bg-blue-100 border border-blue-400 rounded-lg p-3 text-blue-800">
                            ğŸ‘ <strong>å°åˆ¶å®Œæˆï¼è™½æœ‰ç‘•ç–µï¼Œä½†å·²æ˜¯ä¸é”™çš„ä½œå“ï¼</strong><br>
                            <span class="text-sm">å›¾æ¡ˆåŒ¹é…åº¦ï¼š${state.printQuality.toFixed(0)}%</span>
                        </div>
                    `;
                }
                
                document.getElementById('printComplete').disabled = false;
                document.getElementById('printComplete').className = 'bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-2 rounded-lg transition-colors cursor-pointer';
                
                document.getElementById('printProgressBar').style.width = '100%';
                document.getElementById('printProgressText').textContent = 'ä½œå“å®Œæˆ';
                
            }, 500);
        }
        
        function completePrintGame(artId) {
            const state = window.woodblockPrintState;
            if (state && state.completed) {
                const score = Math.min(100, 60 + state.printQuality * 0.4);
                completeArtGame(artId, Math.floor(score));
            }
        }
        
        
    </script>
</body>
</html>
