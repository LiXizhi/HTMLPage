<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>麦思星球 - 游戏加载中</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Microsoft YaHei", sans-serif;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 75%, #c850c0 100%);
        position: relative;
      }

      /* 浮动的卡通云朵背景 */
      .cloud {
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
        opacity: 0.6;
        animation: float 6s ease-in-out infinite;
      }

      .cloud:before {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
      }

      .cloud:after {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
      }

      .cloud1 {
        width: 80px;
        height: 30px;
        top: 10%;
        left: 10%;
        animation-delay: 0s;
      }

      .cloud1:before {
        width: 30px;
        height: 30px;
        top: -15px;
        left: 10px;
      }

      .cloud1:after {
        width: 40px;
        height: 40px;
        top: -20px;
        right: 10px;
      }

      .cloud2 {
        width: 100px;
        height: 40px;
        top: 20%;
        right: 15%;
        animation-delay: 2s;
      }

      .cloud2:before {
        width: 40px;
        height: 40px;
        top: -20px;
        left: 15px;
      }

      .cloud2:after {
        width: 50px;
        height: 50px;
        top: -25px;
        right: 15px;
      }

      .cloud3 {
        width: 60px;
        height: 25px;
        bottom: 20%;
        left: 20%;
        animation-delay: 4s;
      }

      .cloud3:before {
        width: 25px;
        height: 25px;
        top: -12px;
        left: 8px;
      }

      .cloud3:after {
        width: 30px;
        height: 30px;
        top: -15px;
        right: 8px;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) translateX(0px);
        }

        25% {
          transform: translateY(-10px) translateX(5px);
        }

        50% {
          transform: translateY(-5px) translateX(-5px);
        }

        75% {
          transform: translateY(-15px) translateX(3px);
        }
      }

      /* 闪烁星星 */
      .star {
        position: absolute;
        background: #ffd700;
        /* Webkit prefix for better iOS compatibility */
        -webkit-clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        animation: twinkle 2s ease-in-out infinite alternate;
      }

      /* Fallback for browsers without clip-path support */
      @supports not (clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)) {
        .star {
          /* Simple circle fallback */
          border-radius: 50%;
          transform: rotate(45deg);
        }
      }

      .star1 {
        width: 15px;
        height: 15px;
        top: 15%;
        left: 80%;
        animation-delay: 0s;
      }

      .star2 {
        width: 12px;
        height: 12px;
        top: 30%;
        left: 5%;
        animation-delay: 0.5s;
      }

      .star3 {
        width: 18px;
        height: 18px;
        bottom: 25%;
        right: 10%;
        animation-delay: 1s;
      }

      @keyframes twinkle {
        0% {
          opacity: 0.4;
          transform: scale(0.8);
        }

        100% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      /* 主容器 */
      .main-container {
        /* display: flex; */
        display: none;
        flex-direction: column;
        height: 100vh;
        position: relative;
        z-index: 10;
        box-sizing: border-box;
        /* 确保padding计算正确 */
      }

      /* 顶部标题 */
      .game-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        margin-top: 20px;
        text-align: center;
        animation: bounce 2s ease-in-out infinite;
        min-height: 10vh;
        /* ✓ Already set */
        display: flex;
        align-items: center;
        justify-content: center;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }

        40% {
          transform: translateY(-10px);
        }

        60% {
          transform: translateY(-5px);
        }
      }

      /* 轮播图容器 */
      .slider-container-parent {
        position: relative;
        width: 100%;
        height: 70vh;
        max-height: min(70vh, calc(90vw * 9 / 16 + 40px));
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 0;
      }

      .slider-container {
        position: relative;
        width: auto;
        height: 100%;
        /* Fallback for browsers without aspect-ratio support */
        width: calc(100vh * 0.7 * 16 / 9);
        max-width: 90vw;
        /* Modern aspect-ratio for supported browsers */
        aspect-ratio: 16/9;
        /* Fallback background for browsers without backdrop-filter */
        background: rgba(255, 255, 255, 0.25);
        border-radius: 30px;
        /* Enhanced background with backdrop-filter */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 20px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        border: 3px solid rgba(255, 255, 255, 0.3);
      }

      /* Feature detection fallback for aspect-ratio */
      @supports not (aspect-ratio: 16/9) {
        .slider-container {
          width: calc(100vh * 0.7 * 16 / 9);
          max-width: 90vw;
        }
      }

      /* Fallback for browsers without backdrop-filter support */
      @supports not (backdrop-filter: blur(10px)) {
        .slider-container {
          background: rgba(255, 255, 255, 0.3);
        }
      }

      .slider-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 20px;
        overflow: hidden;
      }

      .slide-image {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 20px;
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.8s ease-in-out;
      }

      .slide-image.active {
        opacity: 1;
        transform: scale(1);
      }

      /* 轮播指示器 */
      .slider-dots {
        position: absolute;
        bottom: -40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 5;
      }

      .slider-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(255, 255, 255, 0.7);
      }

      .slider-dot.active {
        background: linear-gradient(45deg, #667eea, #f093fb);
        transform: scale(1.3);
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.6);
      }

      /* 底部loading区域 */
      .loading-area {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
        height: auto;
        min-height: 20vh;
        /* ✓ Already set */
        justify-content: center;
        padding-top: 60px;
      }

      /* 加载提示文字 */
      .loading-text {
        font-size: 1.5rem;
        color: #fff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        animation: pulse 2s ease-in-out infinite;
        text-align: center;
        gap: 15px;
        padding: 0 20px;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.8;
        }

        50% {
          opacity: 1;
        }
      }

      /* 进度条容器 */
      .progress-container {
        width: 80%;
        max-width: 500px;
        height: 20px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.5);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #c850c0, #667eea);
        background-size: 400% 100%;
        border-radius: 25px;
        animation: progressGlow 3s ease-in-out infinite, progressMove 8s linear infinite;
        transition: width 0.5s ease;
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
      }

      @keyframes progressGlow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        25% {
          box-shadow: 0 0 20px rgba(118, 75, 162, 0.5);
        }

        50% {
          box-shadow: 0 0 20px rgba(240, 147, 251, 0.5);
        }

        75% {
          box-shadow: 0 0 20px rgba(200, 80, 192, 0.5);
        }
      }

      @keyframes progressMove {
        0% {
          background-position: 0% 50%;
        }

        100% {
          background-position: 100% 50%;
        }
      }

      /* 百分比文字 */
      .progress-text {
        color: #fff;
        font-size: 1.2rem;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        margin-top: 10px;
      }

      /* 以下是预跳转页面的样式 */
      .ui-container {
        /* display: none; */
        display: block;
        position: relative;
        background: transparent;
        border-radius: 8px;
        width: 100vw;
        height: 100vh;
        padding: 60px 20px 20px 20px;
        /* 简化的单层渐变效果 */
        background: radial-gradient(
          ellipse at center 15%,
          rgba(236, 72, 153, 0.3) 0%,
          /* 粉色中心 */ rgba(147, 51, 234, 0.2) 40%,
          /* 紫色过渡 */ rgba(0, 0, 0, 0.1) 80%,
          /* 暗色边缘 */ rgba(0, 0, 0, 0.2) 100% /* 更暗的边缘 */
        );
      }

      /* 欢迎界面样式 */
      .welcome-prompt {
        text-align: center;
        color: white;
        position: relative;
        z-index: 2;
      }

      .welcome-prompt h1 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 2rem;
        line-height: 1.4;
      }

      /* 彩色文字样式 */
      .planet-name {
        color: #40ce74;
        /* 绿色 */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .shine-text {
        color: #fbbf24;
        /* 黄色 */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      /* 左侧绿色按钮 - 开始进入任务 */
      .task-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        color: #fff;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 8px 16px rgba(16, 185, 129, 0.4);
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        margin: 0 8px;
      }

      .task-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(16, 185, 129, 0.6);
      }

      /* 右侧黄色按钮 - 进入麦思星球 */
      .enter-btn {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #fff;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 8px 16px rgba(251, 191, 36, 0.4);
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        margin: 0 8px;
        position: relative; /* 为气泡定位做准备 */
      }

      .enter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(251, 191, 36, 0.6);
      }

      /* 测试版气泡样式 */
      .beta-bubble {
        position: absolute;
        top: -40px;
        right: -50px;
        background: white;
        color: #3b82f6;
        border: 2px solid #3b82f6;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 300;
        text-shadow: none;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        z-index: 10;
        animation: bubblePulse 2s ease-in-out infinite;
      }

      .beta-bubble::after {
        content: "";
        position: absolute;
        bottom: -7px;
        left: 20%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 6px solid #3b82f6;
      }

      @keyframes bubblePulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.9;
        }
        50% {
          transform: scale(1.05);
          opacity: 1;
        }
      }

      /* 账号管理按钮 - 左下角固定位置 */
      .account-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: #fff;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        z-index: 1000;
        opacity: 0.9;
      }

      .account-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        opacity: 1;
      }

      /* 按钮容器 */
      .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
        align-items: center;
      }

      /* 背景图片容器 */
      .background-image-container {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        /* 改为使用视窗宽度计算，避免在小屏幕上过窄 */
        width: min(calc(60vh * 16 / 10), 85vw);
        max-width: 85vw;
        /* Modern aspect-ratio for supported browsers */
        aspect-ratio: 16/10;
        height: auto;
        min-height: 40vh;
        max-height: 60vh;
        overflow: hidden;
      }

      /* Feature detection fallback for aspect-ratio */
      @supports not (aspect-ratio: 16/10) {
        .background-image-container {
          width: min(calc(60vh * 16 / 10), 85vw);
          max-width: 85vw;
          height: calc(85vw * 10 / 16);
          max-height: 60vh;
        }
      }

      .background-image {
        width: 100%;
        height: 100%;
        /* 改为cover避免图片变形，保持原始比例 */
        object-fit: cover;
        object-position: center bottom;
        /* Webkit mask for better iOS compatibility - must come first */
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.3) 15%, rgba(0, 0, 0, 0.8) 25%, rgba(0, 0, 0, 1) 35%, rgba(0, 0, 0, 1) 100%),
          linear-gradient(
            to right,
            transparent 0%,
            rgba(0, 0, 0, 0.3) 10%,
            rgba(0, 0, 0, 0.7) 20%,
            rgba(0, 0, 0, 1) 30%,
            rgba(0, 0, 0, 1) 70%,
            rgba(0, 0, 0, 0.7) 80%,
            rgba(0, 0, 0, 0.3) 90%,
            transparent 100%
          );
        -webkit-mask-composite: source-in;

        /* Standard mask for modern browsers */
        mask-image: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.3) 15%, rgba(0, 0, 0, 0.8) 25%, rgba(0, 0, 0, 1) 35%, rgba(0, 0, 0, 1) 100%),
          linear-gradient(
            to right,
            transparent 0%,
            rgba(0, 0, 0, 0.3) 10%,
            rgba(0, 0, 0, 0.7) 20%,
            rgba(0, 0, 0, 1) 30%,
            rgba(0, 0, 0, 1) 70%,
            rgba(0, 0, 0, 0.7) 80%,
            rgba(0, 0, 0, 0.3) 90%,
            transparent 100%
          );
        mask-composite: intersect;
      }

      /* 增强描述框的视觉效果 */
      .description-box {
        /* Fallback background for browsers without backdrop-filter */
        background: rgba(255, 255, 255, 0.25);
        /* Enhanced background with backdrop-filter */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      /* Fallback for browsers without backdrop-filter support */
      @supports not (backdrop-filter: blur(10px)) {
        .description-box {
          background: rgba(255, 255, 255, 0.3);
        }
      }

      /* 消息提示 */
      .toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        z-index: 1000;
        font-size: 14px;
        /* border: 1px solid rgba(0, 200, 255, 0.5); */
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      }

      /* 下载APP容器 */
      .download-app-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: none;
        /* 默认隐藏 */
        flex-direction: column;
        align-items: center;
        z-index: 100;
        cursor: pointer;
      }

      /* 开发模式下显示 */
      .download-app-container.dev-mode {
        display: flex;
      }

      /* 下载APP图标 */
      .download-app-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        object-fit: cover;
      }

      .download-app-container:hover .download-app-icon {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(102, 126, 234, 0.6);
      }

      /* 下载APP文字 */
      .download-app-text {
        margin-top: 8px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 6px 8px;
        border-radius: 8px;
        font-size: 10px;
        font-weight: bold;
        text-align: center;
        line-height: 1.2;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        max-width: 120px;
      }

      .download-app-text .support-text {
        font-size: 8px;
        opacity: 0.9;
        margin-top: 2px;
      }

      /* 抽屉式弹窗 */
      .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .drawer-overlay.open {
        opacity: 1;
        visibility: visible;
      }

      .drawer-content {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 90vh;
        background: white;
        border-radius: 20px 20px 0 0;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
      }

      .drawer-overlay.open .drawer-content {
        transform: translateY(0);
      }

      /* 账号管理弹框样式 - 简洁弹出框 */
      #accountDrawer .drawer-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 500px;
        height: 600px;
        max-width: 90vw;
        max-height: 95vh;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        background: #fff;
        padding: 1px;
      }

      #accountDrawer.open .drawer-content {
        transform: translate(-50%, -50%);
      }

      /* 账号弹框的标题栏样式 */
      #accountDrawer .drawer-header {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 0;
        border-bottom: none;
        height: 32px;
        flex-shrink: 0;
      }

      /* 账号弹框的关闭按钮样式 */
      #accountDrawer .drawer-close {
        background: none;
        border: none;
        font-size: 2.5rem;
        cursor: pointer;
        color: #666;
        padding: 8px 16px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      #accountDrawer .drawer-close:hover {
        color: #333;
      }

      /* 账号弹框的iframe样式 */
      #accountDrawer .drawer-iframe {
        border-radius: 8px;
        overflow: hidden;
        height: calc(100% - 32px);
      }

      .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
        flex-shrink: 0;
      }

      .drawer-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .drawer-close {
        width: 32px;
        height: 32px;
        border: none;
        background: #f0f0f0;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #666;
        transition: background 0.2s ease;
      }

      .drawer-close:hover {
        background: #e0e0e0;
      }

      .drawer-iframe {
        flex: 1;
        border: none;
        width: 100%;
      }

      /* 实名认证弹框样式 */
      .identity-modal {
        display: none;
        position: fixed;
        z-index: 3000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.3s ease;
      }

      .identity-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .identity-modal-content {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 20px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        width: 90%;
        max-width: 480px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: slideIn 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .identity-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px 24px 12px;
        border-bottom: 2px solid #f1f5f9;
      }

      .identity-modal-header h3 {
        margin: 0;
        font-size: 22px;
        font-weight: 700;
        color: #1e293b;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .identity-modal-close {
        background: none;
        border: none;
        font-size: 26px;
        cursor: pointer;
        color: #64748b;
        padding: 6px;
        border-radius: 50%;
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .identity-modal-close:hover {
        background: #f1f5f9;
        color: #334155;
        transform: scale(1.1);
      }

      .identity-modal-body {
        padding: 16px 24px 24px;
      }

      .identity-form {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .identity-input-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .identity-input-label {
        font-size: 15px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 3px;
      }

      .identity-input {
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 16px;
        color: #1e293b;
        background: #ffffff;
        transition: all 0.3s ease;
        outline: none;
      }

      .identity-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        transform: translateY(-1px);
      }

      .identity-input::placeholder {
        color: #94a3b8;
      }

      .identity-input-error {
        font-size: 12px;
        color: #ef4444;
        margin-top: 3px;
        min-height: 16px;
        font-weight: 500;
      }

      .identity-form-buttons {
        display: flex;
        gap: 12px;
        margin-top: 12px;
      }

      .identity-btn {
        flex: 1;
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .identity-btn-cancel {
        background: #f8fafc;
        color: #64748b;
        border: 2px solid #e2e8f0;
      }

      .identity-btn-cancel:hover {
        background: #f1f5f9;
        color: #475569;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .identity-btn-confirm {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 2px solid transparent;
      }

      .identity-btn-confirm:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .identity-btn-confirm:active {
        transform: translateY(0);
      }

      .identity-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .identity-description {
        margin-bottom: 16px;
      }

      .identity-description p {
        font-size: 13px;
        color: #64748b;
        line-height: 1.5;
        margin: 0;
        text-align: left;
      }

      .identity-agreement {
        margin-top: 12px;
        text-align: center;
      }

      .agreement-checkbox {
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 11px;
        color: #94a3b8;
        line-height: 1.4;
      }

      .agreement-checkbox input[type="checkbox"] {
        display: none;
      }

      .checkmark {
        width: 14px;
        height: 14px;
        border: 1px solid #d1d5db;
        border-radius: 3px;
        margin-right: 6px;
        position: relative;
        background: #ffffff;
        transition: all 0.2s ease;
        flex-shrink: 0;
      }

      .agreement-checkbox input[type="checkbox"]:checked + .checkmark {
        background: #667eea;
        border-color: #667eea;
      }

      .agreement-checkbox input[type="checkbox"]:checked + .checkmark::after {
        content: '';
        position: absolute;
        left: 4px;
        top: 1px;
        width: 4px;
        height: 8px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      .agreement-text {
        margin: 0;
      }

      .agreement-link {
        color: #667eea;
        text-decoration: none;
      }

      .agreement-link:hover {
        text-decoration: underline;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* 弹窗样式 */
      .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: #ffffff;
        margin: 5% auto;
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        animation: modalSlideIn 0.3s ease-out;
        display: flex;
        flex-direction: column;
      }

      .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px 12px 0 0;
      }

      .modal-title {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
      }

      .modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
        line-height: 1.6;
      }

      .modal-loading {
        text-align: center;
        color: #6b7280;
        padding: 40px 0;
      }

      .close {
        color: rgba(255, 255, 255, 0.8);
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .close:hover {
        color: white;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-50px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* 响应式设计 */
      @media (max-width: 640px) {
        .identity-modal-content {
          width: 75%;
          margin: 8px;
          max-width: 300px;
        }

        .identity-modal-header {
          padding: 10px 14px 6px;
        }

        .identity-modal-header h3 {
          font-size: 16px;
        }

        .identity-modal-body {
          padding: 6px 14px 14px;
        }

        .identity-description p {
          font-size: 11px;
        }

        .agreement-checkbox {
          font-size: 9px;
        }

        .checkmark {
          width: 12px;
          height: 12px;
          margin-right: 4px;
        }

        .agreement-checkbox input[type="checkbox"]:checked + .checkmark::after {
          left: 3px;
          top: 0px;
          width: 3px;
          height: 6px;
        }

        .identity-input {
          padding: 10px 12px;
          font-size: 15px;
        }

        .identity-btn {
          padding: 12px 18px;
          font-size: 15px;
        }

        .identity-form-buttons {
          flex-direction: column;
          gap: 10px;
        }

        .modal-content {
          width: 95%;
          margin: 10% auto;
          max-height: 85vh;
        }

        .modal-header {
          padding: 16px 20px;
        }

        .modal-title {
          font-size: 16px;
        }

        .modal-body {
          padding: 20px;
          font-size: 14px;
        }

        .close {
          font-size: 20px;
        }
      }
    </style>
  </head>

  <body>
    <!-- 实名认证弹框 -->
    <div id="identityModal" class="identity-modal">
      <div class="identity-modal-content">
        <div class="identity-modal-header">
          <h3>实名认证</h3>
          <span class="identity-modal-close" onclick="closeIdentityModal()">&times;</span>
        </div>
        <div class="identity-modal-body">
          <div class="identity-form">
            <div class="identity-description">
              <p>根据国家新颁布政策《关于防止未成年人沉迷网络游戏的通知》要求，请完成实名认证。该信息仅用于实名认证，不会泄露给任何第三方。</p>
            </div>
            <div class="identity-input-group">
              <label class="identity-input-label">真实姓名</label>
              <input type="text" class="identity-input" id="realNameInput" placeholder="请输入真实姓名" maxlength="20" />
              <div class="identity-input-error" id="nameError"></div>
            </div>
            <div class="identity-input-group">
              <label class="identity-input-label">身份证号码</label>
              <input type="text" class="identity-input" id="idCardInput" placeholder="请输入身份证号码" maxlength="18" />
              <div class="identity-input-error" id="idCardError"></div>
            </div>
            <div class="identity-form-buttons">
              <button class="identity-btn identity-btn-confirm" onclick="confirmIdentity()">立即认证</button>
            </div>
            <div class="identity-agreement">
              <label class="agreement-checkbox">
                <input type="checkbox" id="agreementCheckbox" />
                <span class="checkmark"></span>
                <span class="agreement-text">已阅读并同意 <a href="#" class="agreement-link" onclick="openIdentityModal()">认证服务协议</a>、<a href="#" class="agreement-link" onclick="openPrivacyModal()">隐私协议</a> 及 <a href="#" class="agreement-link" onclick="openLicenseModal()">用户协议</a></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 认证服务协议弹窗 -->
    <div id="identityServiceModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">认证服务协议</div>
          <span class="close" onclick="closeModal('identityServiceModal')">&times;</span>
        </div>
        <div class="modal-body" id="identityContent">
          <div class="modal-loading">正在加载认证服务协议...</div>
        </div>
      </div>
    </div>

    <!-- 隐私政策弹窗 -->
    <div id="privacyModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">隐私政策</div>
          <span class="close" onclick="closeModal('privacyModal')">&times;</span>
        </div>
        <div class="modal-body" id="privacyContent">
          <div class="modal-loading">正在加载隐私政策...</div>
        </div>
      </div>
    </div>

    <!-- 用户协议弹窗 -->
    <div id="licenseModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">用户协议</div>
          <span class="close" onclick="closeModal('licenseModal')">&times;</span>
        </div>
        <div class="modal-body" id="licenseContent">
          <div class="modal-loading">正在加载用户协议...</div>
        </div>
      </div>
    </div>

    <!-- 背景装饰 -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div>
    <div class="star star1"></div>
    <div class="star star2"></div>
    <div class="star star3"></div>

    <!-- 主容器 -->
    <div class="main-container">
      <!-- 游戏标题 -->
      <div class="game-title">🌟 麦思星球 🌟</div>

      <!-- 轮播图区域 -->
      <div class="slider-container-parent">
        <div class="slider-container">
          <div class="slider-wrapper" id="sliderWrapper">
            <!-- 轮播图片将动态加载到这里 -->
          </div>
          <div class="slider-dots" id="sliderDots">
            <!-- 指示器将动态生成 -->
          </div>
        </div>
      </div>

      <!-- 底部加载区域 -->
      <div class="loading-area">
        <div class="loading-text" id="loadingText">正在加载精彩内容...</div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
      </div>
    </div>

    <div class="ui-container">
      <div class="background-image-container">
        <img src="https://api.keepwork.com/ts-storage/siteFiles/46296/raw" alt="新手引导" class="background-image" loading="lazy" />
      </div>
      <div class="welcome-prompt">
        <h1>🌟<span class="planet-name">麦思星球</span>：让每个孩子在自己的世界里<span class="shine-text">自由发光</span>🌟</h1>
        <div class="text-center">
          <div id="welcomeMessage" class="text-lg mb-6">欢迎来到麦思星球！</div>
          <div class="button-container">
            <button class="task-btn hidden" onclick="startTodayTask()">开始今日任务</button>
            <button class="enter-btn hidden" onclick="enterMSPlanet()">
              进入麦思星球
              <span class="beta-bubble" id="betaBubble">测试版</span>
            </button>
          </div>
        </div>

        <!-- 描述内容 -->
        <div class="mt-8 text-left max-w-xl mx-auto">
          <div class="description-box rounded-lg p-4">
            <p class="text-lg font-semibold text-center">🎯 面向5-16岁用户，在线能力提升训练</p>
            <div class="mt-4 text-center">
              <p class="text-base font-medium">⏰ 开放时间：每日 8:00 - 22:00</p>
              <p class="text-base font-medium mt-1">⌛ 建议训练时长：每日30分钟</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 下载APP容器 -->
    <div class="download-app-container" id="downloadAppContainer" onclick="openDownloadDrawer()">
      <img class="download-app-icon" src="https://qiniu-public.keepwork.com/paracraft-cdn-resource/Texture/Aries/Paracraft/Mod/MaiSi/maseai_icon_128x128.jpg" alt="下载APP" loading="lazy" />
      <div class="download-app-text">
        下载麦思星球APP<br />获得最佳体验
        <div class="support-text">支持PC/Android/IOS</div>
      </div>
    </div>

    <!-- 抽屉式弹窗 -->
    <div class="drawer-overlay" id="downloadDrawer" onclick="closeDownloadDrawer(event)">
      <div class="drawer-content" onclick="event.stopPropagation()">
        <div class="drawer-header">
          <div class="drawer-title">下载麦思星球APP</div>
          <button class="drawer-close" onclick="closeDownloadDrawer()">×</button>
        </div>
        <iframe sandbox="allow-scripts allow-same-origin allow-downloads allow-forms allow-popups" class="drawer-iframe" data-src="https://keepwork.com/api/raw/maisi/maisi/webgames/data/download" title="下载麦思星球APP"> </iframe>
      </div>
    </div>

    <!-- 固定在左下角的账号管理按钮 -->
    <button class="account-btn" onclick="openAccountDrawer()" style="display: none">账号管理</button>

    <!-- 账号管理抽屉式弹窗 -->
    <div class="drawer-overlay" id="accountDrawer" onclick="closeAccountDrawer(event)">
      <div class="drawer-content" onclick="event.stopPropagation()">
        <div class="drawer-header">
          <button class="drawer-close" onclick="closeAccountDrawer()">×</button>
        </div>
        <iframe class="drawer-iframe" id="accountIframe" title="账号管理"> </iframe>
      </div>
    </div>

    <script>
      // 平台检测函数
      function detectPlatform() {
        const hasTouchSupport = "ontouchstart" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
        const userAgent = navigator.userAgent.toLowerCase();
        const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
        const isTouchDevice = hasTouchSupport || isMobileUA;
        const isDesktopWithTouch = window.innerWidth > 1024 && window.innerHeight > 768 && !isMobileUA;

        if (isDesktopWithTouch && !isMobileUA) {
          return "pc";
        }
        return isTouchDevice ? "mobile" : "pc";
      }

      // 检测是否为OpenHarmony系统
      function isOpenHarmony() {
        const userAgent = navigator.userAgent;
        return userAgent.includes('OpenHarmony');
      }

      // 图片配置
      const baseGuideImages = [
        { imgurl: "https://cdn.keepwork.com/maisi/launcher/launcher01.jpg", platform: "all" },
        { imgurl: "https://cdn.keepwork.com/maisi/launcher/launcher02.jpg", platform: "all" },
        { imgurl: "https://cdn.keepwork.com/maisi/launcher/launcher03.jpg", platform: "all" },
      ];

      function getFilteredImages() {
        const currentPlatform = detectPlatform();
        return baseGuideImages.filter((config) => config.platform === "all" || config.platform === currentPlatform);
      }
      const miniGameProxyVersion = "11"; // 每当miniGameProxy发版时，版本号请加1；lastUpdated: 2025/08/15
      let currentSlide = 0;
      let slideImages = [];
      let slideInterval;
      let loadingProgress1 = 0;
      let loadingProgress2 = 0;
      let loadingComplete = false;
      let urlParams = {};
      let planetNameClickCount = 0;
      let planetNameClickTimer = null;
      let shineTextClickCount = 0;
      let shineTextClickTimer = null;
      let devModeUnlocked = false;
      let isEnterButtonShown = false;
      let isLoading = false;

      // 加载提示文字数组
      const loadingTexts = ["正在加载精彩内容...", "准备开启思维训练...", "构建学习环境中...", "即将进入麦思星球...", "加载完成，准备开始！"];

      // 初始化轮播图
      function initSlider() {
        const filteredImages = getFilteredImages();
        slideImages = filteredImages;

        const sliderWrapper = document.getElementById("sliderWrapper");
        const sliderDots = document.getElementById("sliderDots");

        // 清空现有内容
        sliderWrapper.innerHTML = "";
        sliderDots.innerHTML = "";

        // 创建图片元素
        slideImages.forEach((config, index) => {
          const img = document.createElement("img");
          img.src = config.imgurl;
          img.className = `slide-image ${index === 0 ? "active" : ""}`;
          img.alt = `引导图片 ${index + 1}`;
          sliderWrapper.appendChild(img);

          // 创建指示器
          const dot = document.createElement("div");
          dot.className = `slider-dot ${index === 0 ? "active" : ""}`;
          dot.onclick = () => goToSlide(index);
          sliderDots.appendChild(dot);
        });

        // 开始自动轮播
        startSlideshow();
      }

      // 切换到指定幻灯片
      function goToSlide(index) {
        const slides = document.querySelectorAll(".slide-image");
        const dots = document.querySelectorAll(".slider-dot");

        // 移除当前活动状态
        slides[currentSlide].classList.remove("active");
        dots[currentSlide].classList.remove("active");

        // 设置新的活动状态
        currentSlide = index;
        slides[currentSlide].classList.add("active");
        dots[currentSlide].classList.add("active");
      }

      // 下一张幻灯片
      function nextSlide() {
        const nextIndex = (currentSlide + 1) % slideImages.length;
        goToSlide(nextIndex);
      }

      // 开始自动轮播
      function startSlideshow() {
        slideInterval = setInterval(nextSlide, 4000);
      }

      // 停止自动轮播
      function stopSlideshow() {
        if (slideInterval) {
          clearInterval(slideInterval);
        }
      }

      function showTaskButton() {
        const taskButton = document.querySelector(".task-btn");
        if (taskButton) {
          taskButton.classList.remove("hidden");
        }
      }
      function showEnterButton() {
        const enterButton = document.querySelector(".enter-btn");
        if (enterButton) {
          enterButton.classList.remove("hidden");
          isEnterButtonShown = true;
        }
      }

      // 控制测试版气泡显示
      function updateBetaBubbleVisibility() {
        const betaBubble = document.getElementById("betaBubble");
        if (betaBubble && isOpenHarmony()) {
          betaBubble.style.display = "none";
        }
      }

      function showDownloadAppButton() {
        const downloadContainer = document.getElementById("downloadAppContainer");
        if (downloadContainer) {
          downloadContainer.classList.add("dev-mode");
        }
      }

      function showAccountButton() {
        const accountButton = document.querySelector(".account-btn");
        if (accountButton) {
          accountButton.style.display = "block";
        }
      }

      window.addEventListener("message", function (event) {
        switch (event.data.type) {
          case "loadingProgress1":
            const progress1 = Math.max(0, Math.min(100, event.data.progress));
            loadingProgress1 = progress1;
            updateProgress();
            break;
          case "loadingProgress2":
            const progress2 = Math.max(0, Math.min(100, event.data.progress));
            loadingProgress2 = progress2;
            updateProgress();
            break;
          case "urlParams":
            urlParams = event.data.params; // 这里是所有由webparacraft传递过来的url参数
            console.log("接收到的URL参数:", urlParams);
            if (urlParams.autoStartParacraft === "true") {
              startParacraft(urlParams.cmdline);
            }
            UpdateButtonsByUrlParams(urlParams);
            break;
          case "deleteAccount":
            navigateToLogin();
            break;
          case "logout":
            navigateToLogin();
            break;
          case "getUserInfo":
            getUserInfo();
            break;
          case "initIdentityVerification":
            if (event.data.platform) {
              window.platform = event.data.platform;
            }
            initIdentityVerification();
            break;
        }
      });

      function UpdateButtonsByUrlParams(urlParams) {
        if (!urlParams) {
          const currentUrl = new URL(window.location.href);
          const currentUrlParams = new URLSearchParams(currentUrl.search);
          devMode = currentUrlParams.get("dev");
          paracraftPlatform = currentUrlParams.get("paracraftPlatform");
          isMaisiTestCompleted = currentUrlParams.get("isMaisiTestCompleted") === "true";
          isLoading = currentUrlParams.get("isLoading") === "true";
        } else {
          devMode = urlParams.dev;
          paracraftPlatform = urlParams.paracraftPlatform || paracraftPlatform;
          isMaisiTestCompleted = urlParams.isMaisiTestCompleted === "true";
          isLoading = urlParams.isLoading === "true";
          updateTaskButtonDisplay(urlParams.taskTime);
        }
        
        // 根据isLoading参数控制容器显示
        const mainContainer = document.querySelector(".main-container");
        const uiContainer = document.querySelector(".ui-container");
        
        if (isLoading) {
          // 如果URL中有isLoading=true，显示main-container（加载界面）
          mainContainer.style.display = "flex";
          uiContainer.style.display = "none";
          // 初始化轮播图和相关功能
          initSlider();
          initSliderHover();
        } else {
          // 否则显示ui-container（欢迎界面）
          mainContainer.style.display = "none";
          uiContainer.style.display = "block";
        }
        
        if (devMode === "true") {
          showTaskButton();
          showEnterButton();
          showDownloadAppButton();
          showAccountButton();
        }
        if (paracraftPlatform == "android" || paracraftPlatform == "ios" || paracraftPlatform == "harmony") {
          showEnterButton();
          showAccountButton();
          // showDownloadAppButton();
          if (isMaisiTestCompleted) {
            showTaskButton();
          }
        } else {
          // web version currently disables the enter button by default.
          showTaskButton();
        }
      }

      function updateTaskButtonDisplay(taskTime) {
        try {
          const today = new Date();
          const taskDate = new Date(taskTime ? Number(taskTime) : Date.now());

          // 判断是否为同一天
          const isToday = today.toDateString() === taskDate.toDateString();

          let titleText;
          if (isToday) {
            titleText = "今日任务";
          } else {
            const month = taskDate.getMonth() + 1;
            const day = taskDate.getDate();
            titleText = `${month}月${day}日任务`;
          }

          // 更新首页的任务标题
          const taskButton = document.querySelector(".task-btn");
          if (taskButton) {
            taskButton.textContent = titleText;
          }
        } catch (error) {
          console.error("更新任务标题失败:", error);
        }
      }

      function getParentUrlParams() {
        UpdateButtonsByUrlParams();
        window.parent.postMessage({ type: "getUrlParams" }, "*");
      }

      function getiOSVersion() {
        var ua = navigator.userAgent;
        var match = ua.match(/OS (\d+)_(\d+)_?(\d+)?/);
        if (match) {
          var major = parseInt(match[1], 10);
          var minor = parseInt(match[2], 10);
          var patch = match[3] ? parseInt(match[3], 10) : 0;
          return {
            major,
            minor,
            patch,
            versionString: major + "." + minor + "." + patch,
          };
        }
        return null;
      }

      // 触发webparacraft加载
      function startParacraft(cmdline) {
        window.parent.postMessage(
          {
            type: "startParacraft",
            cmdline,
          },
          "*"
        );
      }

      // 开始加载进度
      function updateProgress() {
        const iosVersion = getiOSVersion();
        if (iosVersion && iosVersion.major === 18 && iosVersion.minor === 3) {
          document.getElementById("loadingText").textContent = "抱歉：当前iOS系统版本过低，请升级系统版本后重新访问！";
          loadingComplete = true;
        }

        if (loadingComplete) return;

        const progress = Math.floor(loadingProgress1 * 0.7 + loadingProgress2 * 0.3);
        if (progress >= 100) {
          loadingComplete = true;
          setTimeout(() => {
            window.parent.postMessage(
              {
                type: "customLoader",
                data: { name: "remove" },
              },
              "*"
            );
          }, 2000);
        }

        // 更新进度条
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById("progressText").textContent = Math.round(progress) + "%";

        // 更新加载文字
        const textIndex = Math.floor(progress / 20);
        if (textIndex < loadingTexts.length) {
          document.getElementById("loadingText").textContent = loadingTexts[textIndex];
        }
      }

      // 加载完成
      function completeLoading() {
        document.getElementById("loadingText").textContent = "加载完成，准备开始！";

        setTimeout(() => {
          // 这里可以添加跳转到游戏主界面的逻辑
          alert("🎉 欢迎来到麦思星球！即将开始您的思维训练之旅！");
          // 例如：window.location.href = 'game.html';
        }, 1000);
      }

      // 鼠标悬停暂停轮播
      function initSliderHover() {
        const sliderContainer = document.querySelector(".slider-container");
      }

      // 触摸事件支持
      let touchStartX = 0;
      let touchEndX = 0;

      document.addEventListener("touchstart", function (e) {
        touchStartX = e.changedTouches[0].screenX;
      });

      document.addEventListener("touchend", function (e) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      });

      function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            // 向左滑动，下一张
            nextSlide();
          } else {
            // 向右滑动，上一张
            const prevIndex = (currentSlide - 1 + slideImages.length) % slideImages.length;
            goToSlide(prevIndex);
          }
        }
      }

      function showMessage(message) {
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
          document.body.removeChild(toast);
        }, 2000);
      }
      function startTodayTask() {
        showMessage("跳转中...");
        let filename = "miniGameProxy";
        let gameName = "ms_games";
        if (urlParams && urlParams.dev === "true") {
          filename = "miniGameProxyDev";
          gameName = "ms_games_dev";
        }
        let url = `https://keepwork.com/public/resource/${filename}.html?projectPath=maisi/maisi/webgames/data&gameName=${gameName}`;
        if (urlParams && Object.keys(urlParams).length > 0) {
          const params = new URLSearchParams();
          for (const [key, value] of Object.entries(urlParams)) {
            params.append(key, value);
          }
          url += "&" + params.toString();
          url += `&version=${miniGameProxyVersion}`;
        } else {
          url += `&version=${miniGameProxyVersion}`;
        }

        if (devModeUnlocked && (!urlParams || urlParams.dev !== "true")) {
          url += "&dev=true";
        }
        if (urlParams && urlParams.isUseMaisiDevServer === "true") {
          url += "&from=dev";
        }
        if (isEnterButtonShown) {
          url += "&gobackurl=true";
        }

        window.parent.postMessage(
          {
            type: "navigate",
            url,
          },
          "*"
        );
      }
      function enterMSPlanet() {
        if (window.parent) {
          let projectId = (urlParams && urlParams.pid) || 4108584;
          let userToken = (urlParams && urlParams.token) || null;
          let data = `protocol="paracraft"  themecolor="light"  usertoken="${userToken}" cmd/loadworld ${projectId}`;
          window.parent.postMessage(
            {
              type: "launch3DEngine",
              target: "external",
              cmdline: `paracraft://${encodeURIComponent(data)}`,
            },
            "*"
          );
        }

        // Hide download and account buttons when entering MS Planet
        const downloadAppContainer = document.querySelector(".download-app-container");
        const accountButton = document.querySelector(".account-btn");
        if (downloadAppContainer) {
          downloadAppContainer.style.display = "none";
        }
        if (accountButton) {
          accountButton.style.display = "none";
        }

        document.querySelector(".ui-container").style.display = "none";
        const mainContainer = document.querySelector(".main-container");
        mainContainer.style.opacity = "0";
        mainContainer.style.transition = "opacity 0.5s ease-in-out, visibility 0.5s ease-in-out";
        mainContainer.style.display = "flex";

        // Initialize slider and preload images only when entering MS Planet
        initSlider();
        initSliderHover();

        setTimeout(() => {
          mainContainer.style.opacity = "1";
          mainContainer.style.visibility = "visible";
        }, 500);
        startParacraft();
      }
      function setExternalDocumentTitle() {
        window.parent.postMessage(
          {
            type: "setDocumentTitle",
            target: "external",
            title: "麦思星球",
          },
          "*"
        );
      }

      function initPlanetNameClick() {
        const planetNameElement = document.querySelector(".planet-name");
        if (planetNameElement) {
          planetNameElement.style.cursor = "pointer";
          planetNameElement.addEventListener("click", function () {
            planetNameClickCount++;

            if (planetNameClickTimer) {
              clearTimeout(planetNameClickTimer);
            }

            planetNameClickTimer = setTimeout(() => {
              planetNameClickCount = 0;
            }, 5000);

            // 如果连续点击5次，显示隐藏功能
            if (planetNameClickCount >= 5) {
              showEnterButton();
              showDownloadAppButton();
              showAccountButton();
              showMessage("🎉 恭喜！已解锁隐藏功能！");
              planetNameClickCount = 0; // 重置计数器
              if (planetNameClickTimer) {
                clearTimeout(planetNameClickTimer);
                planetNameClickTimer = null;
              }
            }
          });
        }

        const shineTextElement = document.querySelector(".shine-text");
        if (shineTextElement) {
          shineTextElement.style.cursor = "pointer";
          shineTextElement.addEventListener("click", function () {
            shineTextClickCount++;

            if (shineTextClickTimer) {
              clearTimeout(shineTextClickTimer);
            }

            shineTextClickTimer = setTimeout(() => {
              shineTextClickCount = 0;
            }, 5000);

            // 如果连续点击5次，解锁开发模式
            if (shineTextClickCount >= 5) {
              showEnterButton();
              showDownloadAppButton();
              showAccountButton();
              devModeUnlocked = true;
              showMessage("🎉 开发模式已解锁！");
              shineTextClickCount = 0; // 重置计数器
              if (shineTextClickTimer) {
                clearTimeout(shineTextClickTimer);
                shineTextClickTimer = null;
              }
            }
          });
        }
      } // 打开下载抽屉
      function openDownloadDrawer() {
        const drawer = document.getElementById("downloadDrawer");
        const iframe = drawer.querySelector(".drawer-iframe");

        // 如果是第一次打开，加载iframe内容
        if (!iframe.src && iframe.dataset.src) {
          iframe.src = iframe.dataset.src;
        }

        drawer.classList.add("open");
        // 阻止body滚动
        document.body.style.overflow = "hidden";
      }

      // 关闭下载抽屉
      function closeDownloadDrawer(event) {
        // 如果事件存在且点击的是抽屉内容，不关闭
        if (event && event.target.closest(".drawer-content")) {
          return;
        }

        const drawer = document.getElementById("downloadDrawer");
        drawer.classList.remove("open");
        // 恢复body滚动
        document.body.style.overflow = "";
      }

      // 打开账号管理抽屉
      function openAccountDrawer() {
        const drawer = document.getElementById("accountDrawer");
        const iframe = document.getElementById("accountIframe");

        // 加载账号管理页面内容
        iframe.src = "https://cross.keepwork.com/api/raw/maisi/maisi/webgames/data/ms_games_account";

        drawer.classList.add("open");
        // 阻止body滚动
        document.body.style.overflow = "hidden";
      }

      // 关闭账号管理抽屉
      function closeAccountDrawer(event) {
        // 如果事件存在且点击的是抽屉内容，不关闭
        if (event && event.target.closest(".drawer-content")) {
          return;
        }

        const drawer = document.getElementById("accountDrawer");
        drawer.classList.remove("open");
        // 恢复body滚动
        document.body.style.overflow = "";
      }

      // 退出登录页面
      function navigateToLogin() {
        showMessage("跳转中...");
        let url = `https://keepwork.com/public/resource/miniGameProxy.html?projectPath=maisi/maisi/webgames/data`;
        const newUrlParams = new URLSearchParams();
        newUrlParams.set("gameName", "ms_games_login");
        if (urlParams && Object.keys(urlParams).length > 0) {
          if (urlParams.orientation) {
            newUrlParams.set("orientation", urlParams.orientation);
          }
        }
        url += "&" + newUrlParams.toString();
        url += "&showType=logout";
        url += `&version=${miniGameProxyVersion}`;

        window.location.replace(url);
      }

      //获得用户信息
      async function getUserInfo() {
        let userToken = (urlParams && urlParams.token) || null;
        if (!userToken) {
          showMessage("用户未登录");
          return;
        }
        if (!this.userInfo) {
          const response = await fetch("https://api.keepwork.com/core/v0/users/profile", {
            headers: {
              Authorization: `Bearer ${userToken}`,
            },
            method: "GET",
          });
          const data = await response.json();
          this.userInfo = data;
        }
        if (this.userInfo) {
          const accountIframe = document.getElementById("accountIframe");
          if (accountIframe) {
            accountIframe.contentWindow.postMessage(
              {
                type: "userInfoResponse",
                userInfo: this.userInfo,
              },
              "*"
            );
          }
        }
      }

      // 检查实名认证状态
      function checkIdentityVerification() {
        try {
          const storedData = localStorage.getItem('identityVerified');
          if (storedData) {
            const identityData = JSON.parse(storedData);
            if (identityData && identityData.verified) {
              console.log('用户已完成实名认证:', identityData);
              return true;
            }
          }
        } catch (error) {
          console.error('读取认证状态失败:', error);
        }
        return false;
      }

      // 实名认证功能
      function showIdentityModal() {
        const modal = document.getElementById('identityModal');
        const closeBtn = modal.querySelector('.identity-modal-close');
        
        modal.classList.add('show');
        modal.style.display = 'flex';
        
        // 根据实名认证状态控制关闭按钮的显示
        if (!checkIdentityVerification()) {
          // 未实名时隐藏关闭按钮
          closeBtn.style.display = 'none';
        } else {
          // 已实名时显示关闭按钮
          closeBtn.style.display = 'flex';
        }
        
        // 清空表单
        document.getElementById('realNameInput').value = '';
        document.getElementById('idCardInput').value = '';
        document.getElementById('nameError').textContent = '';
        document.getElementById('idCardError').textContent = '';
      }

      function closeIdentityModal() {
        // 检查实名认证状态，如果未认证则不允许关闭
        if (!checkIdentityVerification()) {
          alert('请完成实名认证后再关闭');
          return;
        }
        
        const modal = document.getElementById('identityModal');
        modal.classList.remove('show');
        modal.style.display = 'none';
      }

      // 验证姓名格式
      function validateName(name) {
        if (!name || name.trim().length === 0) {
          return '请输入真实姓名';
        }
        if (name.trim().length < 2) {
          return '姓名至少需要2个字符';
        }
        if (name.trim().length > 20) {
          return '姓名不能超过20个字符';
        }
        // 检查是否只包含中文字符
        const nameRegex = /^[\u4e00-\u9fa5]+$/;
        if (!nameRegex.test(name.trim())) {
          return '姓名只能包含中文字符';
        }
        return '';
      }

      // 验证身份证号码格式
      function validateIdCard(idCard) {
        if (!idCard || idCard.trim().length === 0) {
          return '请输入身份证号码';
        }
        
        const cleanIdCard = idCard.trim().toUpperCase();
        
        // 检查长度
        if (cleanIdCard.length !== 18) {
          return '身份证号码必须是18位';
        }
        
        // 检查格式：前17位数字，最后一位数字或X
        const idCardRegex = /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
        if (!idCardRegex.test(cleanIdCard)) {
          return '身份证号码格式不正确';
        }
        
        // 验证校验码
        const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
        const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
        
        let sum = 0;
        for (let i = 0; i < 17; i++) {
          sum += parseInt(cleanIdCard[i]) * weights[i];
        }
        
        const checkCode = checkCodes[sum % 11];
        if (cleanIdCard[17] !== checkCode) {
          return '身份证号码校验失败';
        }
        
        return '';
      }

      // 从身份证号码中提取姓名相关信息（这里是模拟验证）
      function validateNameIdCardMatch(name, idCard) {
        // 这里是一个简化的验证逻辑
        // 在实际应用中，需要调用公安部门的接口进行真实验证
        
        const cleanName = name.trim();
        const cleanIdCard = idCard.trim().toUpperCase();
        
        // 模拟一些常见的不匹配情况
        const mockDatabase = {};
        
        // 如果在模拟数据库中找到匹配
        if (mockDatabase[cleanIdCard]) {
          if (mockDatabase[cleanIdCard] === cleanName) {
            return { success: true, message: '实名认证成功' };
          } else {
            return { success: false, message: '姓名与身份证号码不匹配' };
          }
        }
        
        // 对于其他身份证号码，进行基本的逻辑验证
        // 这里只是示例，实际应用需要真实的API验证
        if (cleanName.length >= 2 && cleanIdCard.length === 18) {
          // 模拟验证成功（在实际应用中这里应该调用真实的验证接口）
          return { success: true, message: '实名认证成功' };
        }
        
        return { success: false, message: '验证失败，请检查信息是否正确' };
      }

      // 确认实名认证
      function confirmIdentity() {
        const nameInput = document.getElementById('realNameInput');
        const idCardInput = document.getElementById('idCardInput');
        const nameError = document.getElementById('nameError');
        const idCardError = document.getElementById('idCardError');
        const confirmBtn = document.querySelector('.identity-btn-confirm');
        const agreementCheckbox = document.getElementById('agreementCheckbox');
        
        // 检查是否同意协议
        if (!agreementCheckbox.checked) {
          alert('请先阅读并同意相关协议');
          return;
        }
        
        // 清空之前的错误信息
        nameError.textContent = '';
        idCardError.textContent = '';
        
        const name = nameInput.value;
        const idCard = idCardInput.value;
        
        // 验证姓名
        const nameValidation = validateName(name);
        if (nameValidation) {
          nameError.textContent = nameValidation;
          nameInput.focus();
          return;
        }
        
        // 验证身份证
        const idCardValidation = validateIdCard(idCard);
        if (idCardValidation) {
          idCardError.textContent = idCardValidation;
          idCardInput.focus();
          return;
        }
        
        // 禁用按钮，显示加载状态
        confirmBtn.disabled = true;
        confirmBtn.textContent = '验证中...';
        
        // 模拟API调用延迟
        setTimeout(() => {
          // 验证姓名和身份证是否匹配
          const matchResult = validateNameIdCardMatch(name, idCard);
          
          if (matchResult.success) {
            // 验证成功，保存到本地存储
            const identityData = {
              name: name.trim(),
              idCard: idCard.trim(),
              verifiedAt: new Date().toISOString(),
              verified: true
            };
            localStorage.setItem('identityVerified', JSON.stringify(identityData));
            
            // 认证成功后显示关闭按钮
            const modal = document.getElementById('identityModal');
            const closeBtn = modal.querySelector('.identity-modal-close');
            closeBtn.style.display = 'flex';
            
            alert('✅ ' + matchResult.message);
            closeIdentityModal();
            
            console.log('实名认证成功并已保存:', identityData);
          } else {
            // 验证失败
            idCardError.textContent = matchResult.message;
          }
          
          // 恢复按钮状态
          confirmBtn.disabled = false;
          confirmBtn.textContent = '确定';
        }, 1500);
      }

      // 点击弹框外部关闭
      document.getElementById('identityModal').addEventListener('click', function(e) {
        if (e.target === this) {
          // 检查实名认证状态，如果未认证则不允许关闭
          if (!checkIdentityVerification()) {
            alert('请完成实名认证后再关闭');
            return;
          }
          closeIdentityModal();
        }
      });

      // 输入框实时验证
      document.getElementById('realNameInput').addEventListener('input', function() {
        const nameError = document.getElementById('nameError');
        const validation = validateName(this.value);
        nameError.textContent = validation;
      });

      document.getElementById('idCardInput').addEventListener('input', function() {
        const idCardError = document.getElementById('idCardError');
        // 只允许输入数字和X
        this.value = this.value.replace(/[^0-9Xx]/g, '').toUpperCase();
        
        const validation = validateIdCard(this.value);
        idCardError.textContent = validation;
      });

      // ESC键关闭抽屉和弹框
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeDownloadDrawer();
          closeAccountDrawer();
          // 对于实名认证弹框，需要检查认证状态
          if (document.getElementById('identityModal').style.display === 'flex') {
            if (!checkIdentityVerification()) {
              alert('请完成实名认证后再关闭');
              return;
            }
          }
          closeIdentityModal();
        }
      });
      // 窗口大小改变处理
      window.addEventListener("resize", function () {
        // 防抖处理
        clearTimeout(window.resizeTimeout);
        window.resizeTimeout = setTimeout(function () {
          // Only reinitialize slider if it has already been initialized (i.e., we're in MS Planet mode)
          if (slideImages.length > 0) {
            const newImages = getFilteredImages();
            if (newImages.length !== slideImages.length) {
              stopSlideshow();
              initSlider();
            }
          }
        }, 300);
      });
      // 页面加载时初始化认证状态
      function initIdentityVerification() {
        // 如果正在加载中，不弹出实名认证框
        if (isLoading) {
          console.log('页面正在加载中，跳过实名认证流程');
          return;
        }
        
        if (!checkIdentityVerification()) {
          // 如果未认证，检查平台是否为小米
          if (window.platform == 'xiaomi') {
            console.log('小米平台用户未完成实名认证，显示认证框');
            setTimeout(() => {
              showIdentityModal();
            }, 1000); // 延迟1秒弹出，让页面完全加载
          } else {
            console.log('用户未完成实名认证，但暂时不弹出认证框');
          }
        } else {
          console.log('用户已完成实名认证，跳过认证流程');
        }
      }

      // Markdown转HTML函数
      function markdownToHtml(markdown) {
        let html = markdown
          .replace(/^### (.*$)/gim, '<h3>$1</h3>')
          .replace(/^## (.*$)/gim, '<h2>$1</h2>')
          .replace(/^# (.*$)/gim, '<h1>$1</h1>')
          .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/gim, '<em>$1</em>')
          .replace(/\n\n/gim, '</p><p>')
          .replace(/\n/gim, '<br>');

        if (html.trim() !== '') {
          html = "<p>" + html + "</p>";
        }

        return html;
      }

      // 打开认证服务协议弹窗
      async function openIdentityModal() {
        const modal = document.getElementById("identityServiceModal");
        const content = document.getElementById("identityContent");

        modal.style.display = "block";
        content.innerHTML = '<div class="modal-loading">正在加载认证服务协议...</div>';

        try {
          const response = await fetch("https://cross.keepwork.com/api/raw/maisi/maisi/docs/identity");
          const markdown = await response.text();
          const html = markdownToHtml(markdown);
          content.innerHTML = html;
        } catch (error) {
          console.error("加载认证服务协议失败:", error);
          content.innerHTML = '<p style="color: #ef4444;">加载失败，请稍后重试</p>';
        }
      }

      // 打开隐私政策弹窗
      async function openPrivacyModal() {
        const modal = document.getElementById("privacyModal");
        const content = document.getElementById("privacyContent");

        modal.style.display = "block";
        content.innerHTML = '<div class="modal-loading">正在加载隐私政策...</div>';

        try {
          const response = await fetch("https://cross.keepwork.com/api/raw/maisi/maisi/docs/privacy");
          const markdown = await response.text();
          const html = markdownToHtml(markdown);
          content.innerHTML = html;
        } catch (error) {
          console.error("加载隐私政策失败:", error);
          content.innerHTML = '<p style="color: #ef4444;">加载失败，请稍后重试</p>';
        }
      }

      // 打开用户协议弹窗
      async function openLicenseModal() {
        const modal = document.getElementById("licenseModal");
        const content = document.getElementById("licenseContent");

        modal.style.display = "block";
        content.innerHTML = '<div class="modal-loading">正在加载用户协议...</div>';

        try {
          const response = await fetch("https://cross.keepwork.com/api/raw/maisi/maisi/docs/license");
          const markdown = await response.text();
          const html = markdownToHtml(markdown);
          content.innerHTML = html;
        } catch (error) {
          console.error("加载用户协议失败:", error);
          content.innerHTML = '<p style="color: #ef4444;">加载失败，请稍后重试</p>';
        }
      }

      // 关闭弹窗
      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      // 点击弹窗外部关闭
      window.onclick = function(event) {
        const identityServiceModal = document.getElementById('identityServiceModal');
        const privacyModal = document.getElementById('privacyModal');
        const licenseModal = document.getElementById('licenseModal');
        
        if (event.target === identityServiceModal) {
          identityServiceModal.style.display = 'none';
        }
        if (event.target === privacyModal) {
          privacyModal.style.display = 'none';
        }
        if (event.target === licenseModal) {
          licenseModal.style.display = 'none';
        }
      }

      getParentUrlParams();
      setExternalDocumentTitle();
      initPlanetNameClick();
      updateBetaBubbleVisibility();
    </script>
  </body>
</html>
