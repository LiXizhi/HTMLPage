<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>éº¦æ€æ˜Ÿçƒ - æ¸¸æˆåŠ è½½ä¸­</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Microsoft YaHei", sans-serif;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 75%, #c850c0 100%);
        position: relative;
      }

      /* æµ®åŠ¨çš„å¡é€šäº‘æœµèƒŒæ™¯ */
      .cloud {
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
        opacity: 0.6;
        animation: float 6s ease-in-out infinite;
      }

      .cloud:before {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
      }

      .cloud:after {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
      }

      .cloud1 {
        width: 80px;
        height: 30px;
        top: 10%;
        left: 10%;
        animation-delay: 0s;
      }

      .cloud1:before {
        width: 30px;
        height: 30px;
        top: -15px;
        left: 10px;
      }

      .cloud1:after {
        width: 40px;
        height: 40px;
        top: -20px;
        right: 10px;
      }

      .cloud2 {
        width: 100px;
        height: 40px;
        top: 20%;
        right: 15%;
        animation-delay: 2s;
      }

      .cloud2:before {
        width: 40px;
        height: 40px;
        top: -20px;
        left: 15px;
      }

      .cloud2:after {
        width: 50px;
        height: 50px;
        top: -25px;
        right: 15px;
      }

      .cloud3 {
        width: 60px;
        height: 25px;
        bottom: 20%;
        left: 20%;
        animation-delay: 4s;
      }

      .cloud3:before {
        width: 25px;
        height: 25px;
        top: -12px;
        left: 8px;
      }

      .cloud3:after {
        width: 30px;
        height: 30px;
        top: -15px;
        right: 8px;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) translateX(0px);
        }

        25% {
          transform: translateY(-10px) translateX(5px);
        }

        50% {
          transform: translateY(-5px) translateX(-5px);
        }

        75% {
          transform: translateY(-15px) translateX(3px);
        }
      }

      /* é—ªçƒæ˜Ÿæ˜Ÿ */
      .star {
        position: absolute;
        background: #ffd700;
        /* Webkit prefix for better iOS compatibility */
        -webkit-clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        animation: twinkle 2s ease-in-out infinite alternate;
      }

      /* Fallback for browsers without clip-path support */
      @supports not (clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)) {
        .star {
          /* Simple circle fallback */
          border-radius: 50%;
          transform: rotate(45deg);
        }
      }

      .star1 {
        width: 15px;
        height: 15px;
        top: 15%;
        left: 80%;
        animation-delay: 0s;
      }

      .star2 {
        width: 12px;
        height: 12px;
        top: 30%;
        left: 5%;
        animation-delay: 0.5s;
      }

      .star3 {
        width: 18px;
        height: 18px;
        bottom: 25%;
        right: 10%;
        animation-delay: 1s;
      }

      @keyframes twinkle {
        0% {
          opacity: 0.4;
          transform: scale(0.8);
        }

        100% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      /* ä¸»å®¹å™¨ */
      .main-container {
        /* display: flex; */
        display: none;
        flex-direction: column;
        height: 100vh;
        position: relative;
        z-index: 10;
        box-sizing: border-box;
        /* ç¡®ä¿paddingè®¡ç®—æ­£ç¡® */
      }

      /* é¡¶éƒ¨æ ‡é¢˜ */
      .game-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        margin-top: 20px;
        text-align: center;
        animation: bounce 2s ease-in-out infinite;
        min-height: 10vh;
        /* âœ“ Already set */
        display: flex;
        align-items: center;
        justify-content: center;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }

        40% {
          transform: translateY(-10px);
        }

        60% {
          transform: translateY(-5px);
        }
      }

      /* è½®æ’­å›¾å®¹å™¨ */
      .slider-container-parent {
        position: relative;
        width: 100%;
        height: 70vh;
        max-height: min(70vh, calc(90vw * 9 / 16 + 40px));
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 0;
      }

      .slider-container {
        position: relative;
        width: auto;
        height: 100%;
        /* Fallback for browsers without aspect-ratio support */
        width: calc(100vh * 0.7 * 16 / 9);
        max-width: 90vw;
        /* Modern aspect-ratio for supported browsers */
        aspect-ratio: 16/9;
        /* Fallback background for browsers without backdrop-filter */
        background: rgba(255, 255, 255, 0.25);
        border-radius: 30px;
        /* Enhanced background with backdrop-filter */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 20px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        border: 3px solid rgba(255, 255, 255, 0.3);
      }

      /* Feature detection fallback for aspect-ratio */
      @supports not (aspect-ratio: 16/9) {
        .slider-container {
          width: calc(100vh * 0.7 * 16 / 9);
          max-width: 90vw;
        }
      }

      /* Fallback for browsers without backdrop-filter support */
      @supports not (backdrop-filter: blur(10px)) {
        .slider-container {
          background: rgba(255, 255, 255, 0.3);
        }
      }

      .slider-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 20px;
        overflow: hidden;
      }

      .slide-image {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 20px;
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.8s ease-in-out;
      }

      .slide-image.active {
        opacity: 1;
        transform: scale(1);
      }

      /* è½®æ’­æŒ‡ç¤ºå™¨ */
      .slider-dots {
        position: absolute;
        bottom: -40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 5;
      }

      .slider-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(255, 255, 255, 0.7);
      }

      .slider-dot.active {
        background: linear-gradient(45deg, #667eea, #f093fb);
        transform: scale(1.3);
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.6);
      }

      /* åº•éƒ¨loadingåŒºåŸŸ */
      .loading-area {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
        height: auto;
        min-height: 20vh;
        /* âœ“ Already set */
        justify-content: center;
        padding-top: 60px;
      }

      /* åŠ è½½æç¤ºæ–‡å­— */
      .loading-text {
        font-size: 1.5rem;
        color: #fff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        animation: pulse 2s ease-in-out infinite;
        text-align: center;
        gap: 15px;
        padding: 0 20px;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.8;
        }

        50% {
          opacity: 1;
        }
      }

      /* è¿›åº¦æ¡å®¹å™¨ */
      .progress-container {
        width: 80%;
        max-width: 500px;
        height: 20px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.5);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #c850c0, #667eea);
        background-size: 400% 100%;
        border-radius: 25px;
        animation: progressGlow 3s ease-in-out infinite, progressMove 8s linear infinite;
        transition: width 0.5s ease;
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
      }

      @keyframes progressGlow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        25% {
          box-shadow: 0 0 20px rgba(118, 75, 162, 0.5);
        }

        50% {
          box-shadow: 0 0 20px rgba(240, 147, 251, 0.5);
        }

        75% {
          box-shadow: 0 0 20px rgba(200, 80, 192, 0.5);
        }
      }

      @keyframes progressMove {
        0% {
          background-position: 0% 50%;
        }

        100% {
          background-position: 100% 50%;
        }
      }

      /* ç™¾åˆ†æ¯”æ–‡å­— */
      .progress-text {
        color: #fff;
        font-size: 1.2rem;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        margin-top: 10px;
      }

      /* ä»¥ä¸‹æ˜¯é¢„è·³è½¬é¡µé¢çš„æ ·å¼ */
      .ui-container {
        /* display: none; */
        display: block;
        position: relative;
        background: transparent;
        border-radius: 8px;
        width: 100vw;
        height: 100vh;
        padding: 60px 20px 20px 20px;
        /* ç®€åŒ–çš„å•å±‚æ¸å˜æ•ˆæœ */
        background: radial-gradient(
          ellipse at center 15%,
          rgba(236, 72, 153, 0.3) 0%,
          /* ç²‰è‰²ä¸­å¿ƒ */ rgba(147, 51, 234, 0.2) 40%,
          /* ç´«è‰²è¿‡æ¸¡ */ rgba(0, 0, 0, 0.1) 80%,
          /* æš—è‰²è¾¹ç¼˜ */ rgba(0, 0, 0, 0.2) 100% /* æ›´æš—çš„è¾¹ç¼˜ */
        );
      }

      /* æ¬¢è¿ç•Œé¢æ ·å¼ */
      .welcome-prompt {
        text-align: center;
        color: white;
        position: relative;
        z-index: 2;
      }

      .welcome-prompt h1 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 2rem;
        line-height: 1.4;
      }

      /* å½©è‰²æ–‡å­—æ ·å¼ */
      .planet-name {
        color: #40ce74;
        /* ç»¿è‰² */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .shine-text {
        color: #fbbf24;
        /* é»„è‰² */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      /* å·¦ä¾§ç»¿è‰²æŒ‰é’® - å¼€å§‹è¿›å…¥ä»»åŠ¡ */
      .task-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        color: #fff;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 8px 16px rgba(16, 185, 129, 0.4);
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        margin: 0 8px;
      }

      .task-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(16, 185, 129, 0.6);
      }

      /* å³ä¾§é»„è‰²æŒ‰é’® - è¿›å…¥éº¦æ€æ˜Ÿçƒ */
      .enter-btn {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #fff;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 8px 16px rgba(251, 191, 36, 0.4);
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        margin: 0 8px;
        position: relative; /* ä¸ºæ°”æ³¡å®šä½åšå‡†å¤‡ */
      }

      .enter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(251, 191, 36, 0.6);
      }

      /* æµ‹è¯•ç‰ˆæ°”æ³¡æ ·å¼ */
      .beta-bubble {
        position: absolute;
        top: -40px;
        right: -50px;
        background: white;
        color: #3b82f6;
        border: 2px solid #3b82f6;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 300;
        text-shadow: none;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        z-index: 10;
        animation: bubblePulse 2s ease-in-out infinite;
      }

      .beta-bubble::after {
        content: "";
        position: absolute;
        bottom: -7px;
        left: 20%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 6px solid #3b82f6;
      }

      @keyframes bubblePulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.9;
        }
        50% {
          transform: scale(1.05);
          opacity: 1;
        }
      }

      /* è´¦å·ç®¡ç†æŒ‰é’® - å·¦ä¸‹è§’å›ºå®šä½ç½® */
      .account-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: #fff;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        z-index: 1000;
        opacity: 0.9;
      }

      .account-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        opacity: 1;
      }

      /* æŒ‰é’®å®¹å™¨ */
      .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
        align-items: center;
      }

      /* èƒŒæ™¯å›¾ç‰‡å®¹å™¨ */
      .background-image-container {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        /* æ”¹ä¸ºä½¿ç”¨è§†çª—å®½åº¦è®¡ç®—ï¼Œé¿å…åœ¨å°å±å¹•ä¸Šè¿‡çª„ */
        width: min(calc(60vh * 16 / 10), 85vw);
        max-width: 85vw;
        /* Modern aspect-ratio for supported browsers */
        aspect-ratio: 16/10;
        height: auto;
        min-height: 40vh;
        max-height: 60vh;
        overflow: hidden;
      }

      /* Feature detection fallback for aspect-ratio */
      @supports not (aspect-ratio: 16/10) {
        .background-image-container {
          width: min(calc(60vh * 16 / 10), 85vw);
          max-width: 85vw;
          height: calc(85vw * 10 / 16);
          max-height: 60vh;
        }
      }

      .background-image {
        width: 100%;
        height: 100%;
        /* æ”¹ä¸ºcoveré¿å…å›¾ç‰‡å˜å½¢ï¼Œä¿æŒåŸå§‹æ¯”ä¾‹ */
        object-fit: cover;
        object-position: center bottom;
        /* Webkit mask for better iOS compatibility - must come first */
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.3) 15%, rgba(0, 0, 0, 0.8) 25%, rgba(0, 0, 0, 1) 35%, rgba(0, 0, 0, 1) 100%),
          linear-gradient(
            to right,
            transparent 0%,
            rgba(0, 0, 0, 0.3) 10%,
            rgba(0, 0, 0, 0.7) 20%,
            rgba(0, 0, 0, 1) 30%,
            rgba(0, 0, 0, 1) 70%,
            rgba(0, 0, 0, 0.7) 80%,
            rgba(0, 0, 0, 0.3) 90%,
            transparent 100%
          );
        -webkit-mask-composite: source-in;

        /* Standard mask for modern browsers */
        mask-image: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.3) 15%, rgba(0, 0, 0, 0.8) 25%, rgba(0, 0, 0, 1) 35%, rgba(0, 0, 0, 1) 100%),
          linear-gradient(
            to right,
            transparent 0%,
            rgba(0, 0, 0, 0.3) 10%,
            rgba(0, 0, 0, 0.7) 20%,
            rgba(0, 0, 0, 1) 30%,
            rgba(0, 0, 0, 1) 70%,
            rgba(0, 0, 0, 0.7) 80%,
            rgba(0, 0, 0, 0.3) 90%,
            transparent 100%
          );
        mask-composite: intersect;
      }

      /* å¢å¼ºæè¿°æ¡†çš„è§†è§‰æ•ˆæœ */
      .description-box {
        /* Fallback background for browsers without backdrop-filter */
        background: rgba(255, 255, 255, 0.25);
        /* Enhanced background with backdrop-filter */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      /* Fallback for browsers without backdrop-filter support */
      @supports not (backdrop-filter: blur(10px)) {
        .description-box {
          background: rgba(255, 255, 255, 0.3);
        }
      }

      /* æ¶ˆæ¯æç¤º */
      .toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        z-index: 1000;
        font-size: 14px;
        /* border: 1px solid rgba(0, 200, 255, 0.5); */
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      }

      /* ä¸‹è½½APPå®¹å™¨ */
      .download-app-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: none;
        /* é»˜è®¤éšè— */
        flex-direction: column;
        align-items: center;
        z-index: 100;
        cursor: pointer;
      }

      /* å¼€å‘æ¨¡å¼ä¸‹æ˜¾ç¤º */
      .download-app-container.dev-mode {
        display: flex;
      }

      /* ä¸‹è½½APPå›¾æ ‡ */
      .download-app-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        object-fit: cover;
      }

      .download-app-container:hover .download-app-icon {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(102, 126, 234, 0.6);
      }

      /* ä¸‹è½½APPæ–‡å­— */
      .download-app-text {
        margin-top: 8px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 6px 8px;
        border-radius: 8px;
        font-size: 10px;
        font-weight: bold;
        text-align: center;
        line-height: 1.2;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        max-width: 120px;
      }

      .download-app-text .support-text {
        font-size: 8px;
        opacity: 0.9;
        margin-top: 2px;
      }

      /* æŠ½å±‰å¼å¼¹çª— */
      .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .drawer-overlay.open {
        opacity: 1;
        visibility: visible;
      }

      .drawer-content {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 90vh;
        background: white;
        border-radius: 20px 20px 0 0;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
      }

      .drawer-overlay.open .drawer-content {
        transform: translateY(0);
      }

      /* è´¦å·ç®¡ç†å¼¹æ¡†æ ·å¼ - ç®€æ´å¼¹å‡ºæ¡† */
      #accountDrawer .drawer-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 500px;
        height: 600px;
        max-width: 90vw;
        max-height: 95vh;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        background: #fff;
        padding: 1px;
      }

      #accountDrawer.open .drawer-content {
        transform: translate(-50%, -50%);
      }

      /* è´¦å·å¼¹æ¡†çš„æ ‡é¢˜æ æ ·å¼ */
      #accountDrawer .drawer-header {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 0;
        border-bottom: none;
        height: 32px;
        flex-shrink: 0;
      }

      /* è´¦å·å¼¹æ¡†çš„å…³é—­æŒ‰é’®æ ·å¼ */
      #accountDrawer .drawer-close {
        background: none;
        border: none;
        font-size: 2.5rem;
        cursor: pointer;
        color: #666;
        padding: 8px 16px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      #accountDrawer .drawer-close:hover {
        color: #333;
      }

      /* è´¦å·å¼¹æ¡†çš„iframeæ ·å¼ */
      #accountDrawer .drawer-iframe {
        border-radius: 8px;
        overflow: hidden;
        height: calc(100% - 32px);
      }

      .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
        flex-shrink: 0;
      }

      .drawer-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .drawer-close {
        width: 32px;
        height: 32px;
        border: none;
        background: #f0f0f0;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #666;
        transition: background 0.2s ease;
      }

      .drawer-close:hover {
        background: #e0e0e0;
      }

      .drawer-iframe {
        flex: 1;
        border: none;
        width: 100%;
      }

      /* å®åè®¤è¯å¼¹æ¡†æ ·å¼ */
      .identity-modal {
        display: none;
        position: fixed;
        z-index: 3000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.3s ease;
      }

      .identity-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .identity-modal-content {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 20px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        width: 90%;
        max-width: 480px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: slideIn 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .identity-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px 24px 12px;
        border-bottom: 2px solid #f1f5f9;
      }

      .identity-modal-header h3 {
        margin: 0;
        font-size: 22px;
        font-weight: 700;
        color: #1e293b;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .identity-modal-close {
        background: none;
        border: none;
        font-size: 26px;
        cursor: pointer;
        color: #64748b;
        padding: 6px;
        border-radius: 50%;
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .identity-modal-close:hover {
        background: #f1f5f9;
        color: #334155;
        transform: scale(1.1);
      }

      .identity-modal-body {
        padding: 16px 24px 24px;
      }

      .identity-form {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .identity-input-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .identity-input-label {
        font-size: 15px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 3px;
      }

      .identity-input {
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 16px;
        color: #1e293b;
        background: #ffffff;
        transition: all 0.3s ease;
        outline: none;
      }

      .identity-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        transform: translateY(-1px);
      }

      .identity-input::placeholder {
        color: #94a3b8;
      }

      .identity-input-error {
        font-size: 12px;
        color: #ef4444;
        margin-top: 3px;
        min-height: 16px;
        font-weight: 500;
      }

      .identity-form-buttons {
        display: flex;
        gap: 12px;
        margin-top: 12px;
      }

      .identity-btn {
        flex: 1;
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .identity-btn-cancel {
        background: #f8fafc;
        color: #64748b;
        border: 2px solid #e2e8f0;
      }

      .identity-btn-cancel:hover {
        background: #f1f5f9;
        color: #475569;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .identity-btn-confirm {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 2px solid transparent;
      }

      .identity-btn-confirm:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .identity-btn-confirm:active {
        transform: translateY(0);
      }

      .identity-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .identity-description {
        margin-bottom: 16px;
      }

      .identity-description p {
        font-size: 13px;
        color: #64748b;
        line-height: 1.5;
        margin: 0;
        text-align: left;
      }

      .identity-agreement {
        margin-top: 12px;
        text-align: center;
      }

      .agreement-checkbox {
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 11px;
        color: #94a3b8;
        line-height: 1.4;
      }

      .agreement-checkbox input[type="checkbox"] {
        display: none;
      }

      .checkmark {
        width: 14px;
        height: 14px;
        border: 1px solid #d1d5db;
        border-radius: 3px;
        margin-right: 6px;
        position: relative;
        background: #ffffff;
        transition: all 0.2s ease;
        flex-shrink: 0;
      }

      .agreement-checkbox input[type="checkbox"]:checked + .checkmark {
        background: #667eea;
        border-color: #667eea;
      }

      .agreement-checkbox input[type="checkbox"]:checked + .checkmark::after {
        content: '';
        position: absolute;
        left: 4px;
        top: 1px;
        width: 4px;
        height: 8px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      .agreement-text {
        margin: 0;
      }

      .agreement-link {
        color: #667eea;
        text-decoration: none;
      }

      .agreement-link:hover {
        text-decoration: underline;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* å¼¹çª—æ ·å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: #ffffff;
        margin: 5% auto;
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        animation: modalSlideIn 0.3s ease-out;
        display: flex;
        flex-direction: column;
      }

      .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px 12px 0 0;
      }

      .modal-title {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
      }

      .modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
        line-height: 1.6;
      }

      .modal-loading {
        text-align: center;
        color: #6b7280;
        padding: 40px 0;
      }

      .close {
        color: rgba(255, 255, 255, 0.8);
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .close:hover {
        color: white;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-50px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 640px) {
        .identity-modal-content {
          width: 75%;
          margin: 8px;
          max-width: 300px;
        }

        .identity-modal-header {
          padding: 10px 14px 6px;
        }

        .identity-modal-header h3 {
          font-size: 16px;
        }

        .identity-modal-body {
          padding: 6px 14px 14px;
        }

        .identity-description p {
          font-size: 11px;
        }

        .agreement-checkbox {
          font-size: 9px;
        }

        .checkmark {
          width: 12px;
          height: 12px;
          margin-right: 4px;
        }

        .agreement-checkbox input[type="checkbox"]:checked + .checkmark::after {
          left: 3px;
          top: 0px;
          width: 3px;
          height: 6px;
        }

        .identity-input {
          padding: 10px 12px;
          font-size: 15px;
        }

        .identity-btn {
          padding: 12px 18px;
          font-size: 15px;
        }

        .identity-form-buttons {
          flex-direction: column;
          gap: 10px;
        }

        .modal-content {
          width: 95%;
          margin: 10% auto;
          max-height: 85vh;
        }

        .modal-header {
          padding: 16px 20px;
        }

        .modal-title {
          font-size: 16px;
        }

        .modal-body {
          padding: 20px;
          font-size: 14px;
        }

        .close {
          font-size: 20px;
        }
      }
    </style>
  </head>

  <body>
    <!-- å®åè®¤è¯å¼¹æ¡† -->
    <div id="identityModal" class="identity-modal">
      <div class="identity-modal-content">
        <div class="identity-modal-header">
          <h3>å®åè®¤è¯</h3>
          <span class="identity-modal-close" onclick="closeIdentityModal()">&times;</span>
        </div>
        <div class="identity-modal-body">
          <div class="identity-form">
            <div class="identity-description">
              <p>æ ¹æ®å›½å®¶æ–°é¢å¸ƒæ”¿ç­–ã€Šå…³äºé˜²æ­¢æœªæˆå¹´äººæ²‰è¿·ç½‘ç»œæ¸¸æˆçš„é€šçŸ¥ã€‹è¦æ±‚ï¼Œè¯·å®Œæˆå®åè®¤è¯ã€‚è¯¥ä¿¡æ¯ä»…ç”¨äºå®åè®¤è¯ï¼Œä¸ä¼šæ³„éœ²ç»™ä»»ä½•ç¬¬ä¸‰æ–¹ã€‚</p>
            </div>
            <div class="identity-input-group">
              <label class="identity-input-label">çœŸå®å§“å</label>
              <input type="text" class="identity-input" id="realNameInput" placeholder="è¯·è¾“å…¥çœŸå®å§“å" maxlength="20" />
              <div class="identity-input-error" id="nameError"></div>
            </div>
            <div class="identity-input-group">
              <label class="identity-input-label">èº«ä»½è¯å·ç </label>
              <input type="text" class="identity-input" id="idCardInput" placeholder="è¯·è¾“å…¥èº«ä»½è¯å·ç " maxlength="18" />
              <div class="identity-input-error" id="idCardError"></div>
            </div>
            <div class="identity-form-buttons">
              <button class="identity-btn identity-btn-confirm" onclick="confirmIdentity()">ç«‹å³è®¤è¯</button>
            </div>
            <div class="identity-agreement">
              <label class="agreement-checkbox">
                <input type="checkbox" id="agreementCheckbox" />
                <span class="checkmark"></span>
                <span class="agreement-text">å·²é˜…è¯»å¹¶åŒæ„ <a href="#" class="agreement-link" onclick="openIdentityModal()">è®¤è¯æœåŠ¡åè®®</a>ã€<a href="#" class="agreement-link" onclick="openPrivacyModal()">éšç§åè®®</a> åŠ <a href="#" class="agreement-link" onclick="openLicenseModal()">ç”¨æˆ·åè®®</a></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è®¤è¯æœåŠ¡åè®®å¼¹çª— -->
    <div id="identityServiceModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">è®¤è¯æœåŠ¡åè®®</div>
          <span class="close" onclick="closeModal('identityServiceModal')">&times;</span>
        </div>
        <div class="modal-body" id="identityContent">
          <div class="modal-loading">æ­£åœ¨åŠ è½½è®¤è¯æœåŠ¡åè®®...</div>
        </div>
      </div>
    </div>

    <!-- éšç§æ”¿ç­–å¼¹çª— -->
    <div id="privacyModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">éšç§æ”¿ç­–</div>
          <span class="close" onclick="closeModal('privacyModal')">&times;</span>
        </div>
        <div class="modal-body" id="privacyContent">
          <div class="modal-loading">æ­£åœ¨åŠ è½½éšç§æ”¿ç­–...</div>
        </div>
      </div>
    </div>

    <!-- ç”¨æˆ·åè®®å¼¹çª— -->
    <div id="licenseModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">ç”¨æˆ·åè®®</div>
          <span class="close" onclick="closeModal('licenseModal')">&times;</span>
        </div>
        <div class="modal-body" id="licenseContent">
          <div class="modal-loading">æ­£åœ¨åŠ è½½ç”¨æˆ·åè®®...</div>
        </div>
      </div>
    </div>

    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div>
    <div class="star star1"></div>
    <div class="star star2"></div>
    <div class="star star3"></div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
      <!-- æ¸¸æˆæ ‡é¢˜ -->
      <div class="game-title">ğŸŒŸ éº¦æ€æ˜Ÿçƒ ğŸŒŸ</div>

      <!-- è½®æ’­å›¾åŒºåŸŸ -->
      <div class="slider-container-parent">
        <div class="slider-container">
          <div class="slider-wrapper" id="sliderWrapper">
            <!-- è½®æ’­å›¾ç‰‡å°†åŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
          </div>
          <div class="slider-dots" id="sliderDots">
            <!-- æŒ‡ç¤ºå™¨å°†åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨åŠ è½½åŒºåŸŸ -->
      <div class="loading-area">
        <div class="loading-text" id="loadingText">æ­£åœ¨åŠ è½½ç²¾å½©å†…å®¹...</div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
      </div>
    </div>

    <div class="ui-container">
      <div class="background-image-container">
        <img src="https://api.keepwork.com/ts-storage/siteFiles/46296/raw" alt="æ–°æ‰‹å¼•å¯¼" class="background-image" loading="lazy" />
      </div>
      <div class="welcome-prompt">
        <h1>ğŸŒŸ<span class="planet-name">éº¦æ€æ˜Ÿçƒ</span>ï¼šè®©æ¯ä¸ªå­©å­åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œ<span class="shine-text">è‡ªç”±å‘å…‰</span>ğŸŒŸ</h1>
        <div class="text-center">
          <div id="welcomeMessage" class="text-lg mb-6">æ¬¢è¿æ¥åˆ°éº¦æ€æ˜Ÿçƒï¼</div>
          <div class="button-container">
            <button class="task-btn hidden" onclick="startTodayTask()">å¼€å§‹ä»Šæ—¥ä»»åŠ¡</button>
            <button class="enter-btn hidden" onclick="enterMSPlanet()">
              è¿›å…¥éº¦æ€æ˜Ÿçƒ
              <span class="beta-bubble" id="betaBubble">æµ‹è¯•ç‰ˆ</span>
            </button>
          </div>
        </div>

        <!-- æè¿°å†…å®¹ -->
        <div class="mt-8 text-left max-w-xl mx-auto">
          <div class="description-box rounded-lg p-4">
            <p class="text-lg font-semibold text-center">ğŸ¯ é¢å‘5-16å²ç”¨æˆ·ï¼Œåœ¨çº¿èƒ½åŠ›æå‡è®­ç»ƒ</p>
            <div class="mt-4 text-center">
              <p class="text-base font-medium">â° å¼€æ”¾æ—¶é—´ï¼šæ¯æ—¥ 8:00 - 22:00</p>
              <p class="text-base font-medium mt-1">âŒ› å»ºè®®è®­ç»ƒæ—¶é•¿ï¼šæ¯æ—¥30åˆ†é’Ÿ</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸‹è½½APPå®¹å™¨ -->
    <div class="download-app-container" id="downloadAppContainer" onclick="openDownloadDrawer()">
      <img class="download-app-icon" src="https://qiniu-public.keepwork.com/paracraft-cdn-resource/Texture/Aries/Paracraft/Mod/MaiSi/maseai_icon_128x128.jpg" alt="ä¸‹è½½APP" loading="lazy" />
      <div class="download-app-text">
        ä¸‹è½½éº¦æ€æ˜ŸçƒAPP<br />è·å¾—æœ€ä½³ä½“éªŒ
        <div class="support-text">æ”¯æŒPC/Android/IOS</div>
      </div>
    </div>

    <!-- æŠ½å±‰å¼å¼¹çª— -->
    <div class="drawer-overlay" id="downloadDrawer" onclick="closeDownloadDrawer(event)">
      <div class="drawer-content" onclick="event.stopPropagation()">
        <div class="drawer-header">
          <div class="drawer-title">ä¸‹è½½éº¦æ€æ˜ŸçƒAPP</div>
          <button class="drawer-close" onclick="closeDownloadDrawer()">Ã—</button>
        </div>
        <iframe sandbox="allow-scripts allow-same-origin allow-downloads allow-forms allow-popups" class="drawer-iframe" data-src="https://keepwork.com/api/raw/maisi/maisi/webgames/data/download" title="ä¸‹è½½éº¦æ€æ˜ŸçƒAPP"> </iframe>
      </div>
    </div>

    <!-- å›ºå®šåœ¨å·¦ä¸‹è§’çš„è´¦å·ç®¡ç†æŒ‰é’® -->
    <button class="account-btn" onclick="openAccountDrawer()" style="display: none">è´¦å·ç®¡ç†</button>

    <!-- è´¦å·ç®¡ç†æŠ½å±‰å¼å¼¹çª— -->
    <div class="drawer-overlay" id="accountDrawer" onclick="closeAccountDrawer(event)">
      <div class="drawer-content" onclick="event.stopPropagation()">
        <div class="drawer-header">
          <button class="drawer-close" onclick="closeAccountDrawer()">Ã—</button>
        </div>
        <iframe class="drawer-iframe" id="accountIframe" title="è´¦å·ç®¡ç†"> </iframe>
      </div>
    </div>

    <script>
      // å¹³å°æ£€æµ‹å‡½æ•°
      function detectPlatform() {
        const hasTouchSupport = "ontouchstart" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
        const userAgent = navigator.userAgent.toLowerCase();
        const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
        const isTouchDevice = hasTouchSupport || isMobileUA;
        const isDesktopWithTouch = window.innerWidth > 1024 && window.innerHeight > 768 && !isMobileUA;

        if (isDesktopWithTouch && !isMobileUA) {
          return "pc";
        }
        return isTouchDevice ? "mobile" : "pc";
      }

      // æ£€æµ‹æ˜¯å¦ä¸ºOpenHarmonyç³»ç»Ÿ
      function isOpenHarmony() {
        const userAgent = navigator.userAgent;
        return userAgent.includes('OpenHarmony');
      }

      // å›¾ç‰‡é…ç½®
      const baseGuideImages = [
        { imgurl: "https://cdn.keepwork.com/maisi/launcher/launcher01.jpg", platform: "all" },
        { imgurl: "https://cdn.keepwork.com/maisi/launcher/launcher02.jpg", platform: "all" },
        { imgurl: "https://cdn.keepwork.com/maisi/launcher/launcher03.jpg", platform: "all" },
      ];

      function getFilteredImages() {
        const currentPlatform = detectPlatform();
        return baseGuideImages.filter((config) => config.platform === "all" || config.platform === currentPlatform);
      }
      const miniGameProxyVersion = "11"; // æ¯å½“miniGameProxyå‘ç‰ˆæ—¶ï¼Œç‰ˆæœ¬å·è¯·åŠ 1ï¼›lastUpdated: 2025/08/15
      let currentSlide = 0;
      let slideImages = [];
      let slideInterval;
      let loadingProgress1 = 0;
      let loadingProgress2 = 0;
      let loadingComplete = false;
      let urlParams = {};
      let planetNameClickCount = 0;
      let planetNameClickTimer = null;
      let shineTextClickCount = 0;
      let shineTextClickTimer = null;
      let devModeUnlocked = false;
      let isEnterButtonShown = false;
      let isLoading = false;

      // åŠ è½½æç¤ºæ–‡å­—æ•°ç»„
      const loadingTexts = ["æ­£åœ¨åŠ è½½ç²¾å½©å†…å®¹...", "å‡†å¤‡å¼€å¯æ€ç»´è®­ç»ƒ...", "æ„å»ºå­¦ä¹ ç¯å¢ƒä¸­...", "å³å°†è¿›å…¥éº¦æ€æ˜Ÿçƒ...", "åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹ï¼"];

      // åˆå§‹åŒ–è½®æ’­å›¾
      function initSlider() {
        const filteredImages = getFilteredImages();
        slideImages = filteredImages;

        const sliderWrapper = document.getElementById("sliderWrapper");
        const sliderDots = document.getElementById("sliderDots");

        // æ¸…ç©ºç°æœ‰å†…å®¹
        sliderWrapper.innerHTML = "";
        sliderDots.innerHTML = "";

        // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
        slideImages.forEach((config, index) => {
          const img = document.createElement("img");
          img.src = config.imgurl;
          img.className = `slide-image ${index === 0 ? "active" : ""}`;
          img.alt = `å¼•å¯¼å›¾ç‰‡ ${index + 1}`;
          sliderWrapper.appendChild(img);

          // åˆ›å»ºæŒ‡ç¤ºå™¨
          const dot = document.createElement("div");
          dot.className = `slider-dot ${index === 0 ? "active" : ""}`;
          dot.onclick = () => goToSlide(index);
          sliderDots.appendChild(dot);
        });

        // å¼€å§‹è‡ªåŠ¨è½®æ’­
        startSlideshow();
      }

      // åˆ‡æ¢åˆ°æŒ‡å®šå¹»ç¯ç‰‡
      function goToSlide(index) {
        const slides = document.querySelectorAll(".slide-image");
        const dots = document.querySelectorAll(".slider-dot");

        // ç§»é™¤å½“å‰æ´»åŠ¨çŠ¶æ€
        slides[currentSlide].classList.remove("active");
        dots[currentSlide].classList.remove("active");

        // è®¾ç½®æ–°çš„æ´»åŠ¨çŠ¶æ€
        currentSlide = index;
        slides[currentSlide].classList.add("active");
        dots[currentSlide].classList.add("active");
      }

      // ä¸‹ä¸€å¼ å¹»ç¯ç‰‡
      function nextSlide() {
        const nextIndex = (currentSlide + 1) % slideImages.length;
        goToSlide(nextIndex);
      }

      // å¼€å§‹è‡ªåŠ¨è½®æ’­
      function startSlideshow() {
        slideInterval = setInterval(nextSlide, 4000);
      }

      // åœæ­¢è‡ªåŠ¨è½®æ’­
      function stopSlideshow() {
        if (slideInterval) {
          clearInterval(slideInterval);
        }
      }

      function showTaskButton() {
        const taskButton = document.querySelector(".task-btn");
        if (taskButton) {
          taskButton.classList.remove("hidden");
        }
      }
      function showEnterButton() {
        const enterButton = document.querySelector(".enter-btn");
        if (enterButton) {
          enterButton.classList.remove("hidden");
          isEnterButtonShown = true;
        }
      }

      // æ§åˆ¶æµ‹è¯•ç‰ˆæ°”æ³¡æ˜¾ç¤º
      function updateBetaBubbleVisibility() {
        const betaBubble = document.getElementById("betaBubble");
        if (betaBubble && isOpenHarmony()) {
          betaBubble.style.display = "none";
        }
      }

      function showDownloadAppButton() {
        const downloadContainer = document.getElementById("downloadAppContainer");
        if (downloadContainer) {
          downloadContainer.classList.add("dev-mode");
        }
      }

      function showAccountButton() {
        const accountButton = document.querySelector(".account-btn");
        if (accountButton) {
          accountButton.style.display = "block";
        }
      }

      window.addEventListener("message", function (event) {
        switch (event.data.type) {
          case "loadingProgress1":
            const progress1 = Math.max(0, Math.min(100, event.data.progress));
            loadingProgress1 = progress1;
            updateProgress();
            break;
          case "loadingProgress2":
            const progress2 = Math.max(0, Math.min(100, event.data.progress));
            loadingProgress2 = progress2;
            updateProgress();
            break;
          case "urlParams":
            urlParams = event.data.params; // è¿™é‡Œæ˜¯æ‰€æœ‰ç”±webparacraftä¼ é€’è¿‡æ¥çš„urlå‚æ•°
            console.log("æ¥æ”¶åˆ°çš„URLå‚æ•°:", urlParams);
            if (urlParams.autoStartParacraft === "true") {
              startParacraft(urlParams.cmdline);
            }
            UpdateButtonsByUrlParams(urlParams);
            break;
          case "deleteAccount":
            navigateToLogin();
            break;
          case "logout":
            navigateToLogin();
            break;
          case "getUserInfo":
            getUserInfo();
            break;
          case "initIdentityVerification":
            if (event.data.platform) {
              window.platform = event.data.platform;
            }
            initIdentityVerification();
            break;
        }
      });

      function UpdateButtonsByUrlParams(urlParams) {
        if (!urlParams) {
          const currentUrl = new URL(window.location.href);
          const currentUrlParams = new URLSearchParams(currentUrl.search);
          devMode = currentUrlParams.get("dev");
          paracraftPlatform = currentUrlParams.get("paracraftPlatform");
          isMaisiTestCompleted = currentUrlParams.get("isMaisiTestCompleted") === "true";
          isLoading = currentUrlParams.get("isLoading") === "true";
        } else {
          devMode = urlParams.dev;
          paracraftPlatform = urlParams.paracraftPlatform || paracraftPlatform;
          isMaisiTestCompleted = urlParams.isMaisiTestCompleted === "true";
          isLoading = urlParams.isLoading === "true";
          updateTaskButtonDisplay(urlParams.taskTime);
        }
        
        // æ ¹æ®isLoadingå‚æ•°æ§åˆ¶å®¹å™¨æ˜¾ç¤º
        const mainContainer = document.querySelector(".main-container");
        const uiContainer = document.querySelector(".ui-container");
        
        if (isLoading) {
          // å¦‚æœURLä¸­æœ‰isLoading=trueï¼Œæ˜¾ç¤ºmain-containerï¼ˆåŠ è½½ç•Œé¢ï¼‰
          mainContainer.style.display = "flex";
          uiContainer.style.display = "none";
          // åˆå§‹åŒ–è½®æ’­å›¾å’Œç›¸å…³åŠŸèƒ½
          initSlider();
          initSliderHover();
        } else {
          // å¦åˆ™æ˜¾ç¤ºui-containerï¼ˆæ¬¢è¿ç•Œé¢ï¼‰
          mainContainer.style.display = "none";
          uiContainer.style.display = "block";
        }
        
        if (devMode === "true") {
          showTaskButton();
          showEnterButton();
          showDownloadAppButton();
          showAccountButton();
        }
        if (paracraftPlatform == "android" || paracraftPlatform == "ios" || paracraftPlatform == "harmony") {
          showEnterButton();
          showAccountButton();
          // showDownloadAppButton();
          if (isMaisiTestCompleted) {
            showTaskButton();
          }
        } else {
          // web version currently disables the enter button by default.
          showTaskButton();
        }
      }

      function updateTaskButtonDisplay(taskTime) {
        try {
          const today = new Date();
          const taskDate = new Date(taskTime ? Number(taskTime) : Date.now());

          // åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¤©
          const isToday = today.toDateString() === taskDate.toDateString();

          let titleText;
          if (isToday) {
            titleText = "ä»Šæ—¥ä»»åŠ¡";
          } else {
            const month = taskDate.getMonth() + 1;
            const day = taskDate.getDate();
            titleText = `${month}æœˆ${day}æ—¥ä»»åŠ¡`;
          }

          // æ›´æ–°é¦–é¡µçš„ä»»åŠ¡æ ‡é¢˜
          const taskButton = document.querySelector(".task-btn");
          if (taskButton) {
            taskButton.textContent = titleText;
          }
        } catch (error) {
          console.error("æ›´æ–°ä»»åŠ¡æ ‡é¢˜å¤±è´¥:", error);
        }
      }

      function getParentUrlParams() {
        UpdateButtonsByUrlParams();
        window.parent.postMessage({ type: "getUrlParams" }, "*");
      }

      function getiOSVersion() {
        var ua = navigator.userAgent;
        var match = ua.match(/OS (\d+)_(\d+)_?(\d+)?/);
        if (match) {
          var major = parseInt(match[1], 10);
          var minor = parseInt(match[2], 10);
          var patch = match[3] ? parseInt(match[3], 10) : 0;
          return {
            major,
            minor,
            patch,
            versionString: major + "." + minor + "." + patch,
          };
        }
        return null;
      }

      // è§¦å‘webparacraftåŠ è½½
      function startParacraft(cmdline) {
        window.parent.postMessage(
          {
            type: "startParacraft",
            cmdline,
          },
          "*"
        );
      }

      // å¼€å§‹åŠ è½½è¿›åº¦
      function updateProgress() {
        const iosVersion = getiOSVersion();
        if (iosVersion && iosVersion.major === 18 && iosVersion.minor === 3) {
          document.getElementById("loadingText").textContent = "æŠ±æ­‰ï¼šå½“å‰iOSç³»ç»Ÿç‰ˆæœ¬è¿‡ä½ï¼Œè¯·å‡çº§ç³»ç»Ÿç‰ˆæœ¬åé‡æ–°è®¿é—®ï¼";
          loadingComplete = true;
        }

        if (loadingComplete) return;

        const progress = Math.floor(loadingProgress1 * 0.7 + loadingProgress2 * 0.3);
        if (progress >= 100) {
          loadingComplete = true;
          setTimeout(() => {
            window.parent.postMessage(
              {
                type: "customLoader",
                data: { name: "remove" },
              },
              "*"
            );
          }, 2000);
        }

        // æ›´æ–°è¿›åº¦æ¡
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById("progressText").textContent = Math.round(progress) + "%";

        // æ›´æ–°åŠ è½½æ–‡å­—
        const textIndex = Math.floor(progress / 20);
        if (textIndex < loadingTexts.length) {
          document.getElementById("loadingText").textContent = loadingTexts[textIndex];
        }
      }

      // åŠ è½½å®Œæˆ
      function completeLoading() {
        document.getElementById("loadingText").textContent = "åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹ï¼";

        setTimeout(() => {
          // è¿™é‡Œå¯ä»¥æ·»åŠ è·³è½¬åˆ°æ¸¸æˆä¸»ç•Œé¢çš„é€»è¾‘
          alert("ğŸ‰ æ¬¢è¿æ¥åˆ°éº¦æ€æ˜Ÿçƒï¼å³å°†å¼€å§‹æ‚¨çš„æ€ç»´è®­ç»ƒä¹‹æ—…ï¼");
          // ä¾‹å¦‚ï¼šwindow.location.href = 'game.html';
        }, 1000);
      }

      // é¼ æ ‡æ‚¬åœæš‚åœè½®æ’­
      function initSliderHover() {
        const sliderContainer = document.querySelector(".slider-container");
      }

      // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
      let touchStartX = 0;
      let touchEndX = 0;

      document.addEventListener("touchstart", function (e) {
        touchStartX = e.changedTouches[0].screenX;
      });

      document.addEventListener("touchend", function (e) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      });

      function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            // å‘å·¦æ»‘åŠ¨ï¼Œä¸‹ä¸€å¼ 
            nextSlide();
          } else {
            // å‘å³æ»‘åŠ¨ï¼Œä¸Šä¸€å¼ 
            const prevIndex = (currentSlide - 1 + slideImages.length) % slideImages.length;
            goToSlide(prevIndex);
          }
        }
      }

      function showMessage(message) {
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
          document.body.removeChild(toast);
        }, 2000);
      }
      function startTodayTask() {
        showMessage("è·³è½¬ä¸­...");
        let filename = "miniGameProxy";
        let gameName = "ms_games";
        if (urlParams && urlParams.dev === "true") {
          filename = "miniGameProxyDev";
          gameName = "ms_games_dev";
        }
        let url = `https://keepwork.com/public/resource/${filename}.html?projectPath=maisi/maisi/webgames/data&gameName=${gameName}`;
        if (urlParams && Object.keys(urlParams).length > 0) {
          const params = new URLSearchParams();
          for (const [key, value] of Object.entries(urlParams)) {
            params.append(key, value);
          }
          url += "&" + params.toString();
          url += `&version=${miniGameProxyVersion}`;
        } else {
          url += `&version=${miniGameProxyVersion}`;
        }

        if (devModeUnlocked && (!urlParams || urlParams.dev !== "true")) {
          url += "&dev=true";
        }
        if (urlParams && urlParams.isUseMaisiDevServer === "true") {
          url += "&from=dev";
        }
        if (isEnterButtonShown) {
          url += "&gobackurl=true";
        }

        window.parent.postMessage(
          {
            type: "navigate",
            url,
          },
          "*"
        );
      }
      function enterMSPlanet() {
        if (window.parent) {
          let projectId = (urlParams && urlParams.pid) || 4108584;
          let userToken = (urlParams && urlParams.token) || null;
          let data = `protocol="paracraft"  themecolor="light"  usertoken="${userToken}" cmd/loadworld ${projectId}`;
          window.parent.postMessage(
            {
              type: "launch3DEngine",
              target: "external",
              cmdline: `paracraft://${encodeURIComponent(data)}`,
            },
            "*"
          );
        }

        // Hide download and account buttons when entering MS Planet
        const downloadAppContainer = document.querySelector(".download-app-container");
        const accountButton = document.querySelector(".account-btn");
        if (downloadAppContainer) {
          downloadAppContainer.style.display = "none";
        }
        if (accountButton) {
          accountButton.style.display = "none";
        }

        document.querySelector(".ui-container").style.display = "none";
        const mainContainer = document.querySelector(".main-container");
        mainContainer.style.opacity = "0";
        mainContainer.style.transition = "opacity 0.5s ease-in-out, visibility 0.5s ease-in-out";
        mainContainer.style.display = "flex";

        // Initialize slider and preload images only when entering MS Planet
        initSlider();
        initSliderHover();

        setTimeout(() => {
          mainContainer.style.opacity = "1";
          mainContainer.style.visibility = "visible";
        }, 500);
        startParacraft();
      }
      function setExternalDocumentTitle() {
        window.parent.postMessage(
          {
            type: "setDocumentTitle",
            target: "external",
            title: "éº¦æ€æ˜Ÿçƒ",
          },
          "*"
        );
      }

      function initPlanetNameClick() {
        const planetNameElement = document.querySelector(".planet-name");
        if (planetNameElement) {
          planetNameElement.style.cursor = "pointer";
          planetNameElement.addEventListener("click", function () {
            planetNameClickCount++;

            if (planetNameClickTimer) {
              clearTimeout(planetNameClickTimer);
            }

            planetNameClickTimer = setTimeout(() => {
              planetNameClickCount = 0;
            }, 5000);

            // å¦‚æœè¿ç»­ç‚¹å‡»5æ¬¡ï¼Œæ˜¾ç¤ºéšè—åŠŸèƒ½
            if (planetNameClickCount >= 5) {
              showEnterButton();
              showDownloadAppButton();
              showAccountButton();
              showMessage("ğŸ‰ æ­å–œï¼å·²è§£é”éšè—åŠŸèƒ½ï¼");
              planetNameClickCount = 0; // é‡ç½®è®¡æ•°å™¨
              if (planetNameClickTimer) {
                clearTimeout(planetNameClickTimer);
                planetNameClickTimer = null;
              }
            }
          });
        }

        const shineTextElement = document.querySelector(".shine-text");
        if (shineTextElement) {
          shineTextElement.style.cursor = "pointer";
          shineTextElement.addEventListener("click", function () {
            shineTextClickCount++;

            if (shineTextClickTimer) {
              clearTimeout(shineTextClickTimer);
            }

            shineTextClickTimer = setTimeout(() => {
              shineTextClickCount = 0;
            }, 5000);

            // å¦‚æœè¿ç»­ç‚¹å‡»5æ¬¡ï¼Œè§£é”å¼€å‘æ¨¡å¼
            if (shineTextClickCount >= 5) {
              showEnterButton();
              showDownloadAppButton();
              showAccountButton();
              devModeUnlocked = true;
              showMessage("ğŸ‰ å¼€å‘æ¨¡å¼å·²è§£é”ï¼");
              shineTextClickCount = 0; // é‡ç½®è®¡æ•°å™¨
              if (shineTextClickTimer) {
                clearTimeout(shineTextClickTimer);
                shineTextClickTimer = null;
              }
            }
          });
        }
      } // æ‰“å¼€ä¸‹è½½æŠ½å±‰
      function openDownloadDrawer() {
        const drawer = document.getElementById("downloadDrawer");
        const iframe = drawer.querySelector(".drawer-iframe");

        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ‰“å¼€ï¼ŒåŠ è½½iframeå†…å®¹
        if (!iframe.src && iframe.dataset.src) {
          iframe.src = iframe.dataset.src;
        }

        drawer.classList.add("open");
        // é˜»æ­¢bodyæ»šåŠ¨
        document.body.style.overflow = "hidden";
      }

      // å…³é—­ä¸‹è½½æŠ½å±‰
      function closeDownloadDrawer(event) {
        // å¦‚æœäº‹ä»¶å­˜åœ¨ä¸”ç‚¹å‡»çš„æ˜¯æŠ½å±‰å†…å®¹ï¼Œä¸å…³é—­
        if (event && event.target.closest(".drawer-content")) {
          return;
        }

        const drawer = document.getElementById("downloadDrawer");
        drawer.classList.remove("open");
        // æ¢å¤bodyæ»šåŠ¨
        document.body.style.overflow = "";
      }

      // æ‰“å¼€è´¦å·ç®¡ç†æŠ½å±‰
      function openAccountDrawer() {
        const drawer = document.getElementById("accountDrawer");
        const iframe = document.getElementById("accountIframe");

        // åŠ è½½è´¦å·ç®¡ç†é¡µé¢å†…å®¹
        iframe.src = "https://cross.keepwork.com/api/raw/maisi/maisi/webgames/data/ms_games_account";

        drawer.classList.add("open");
        // é˜»æ­¢bodyæ»šåŠ¨
        document.body.style.overflow = "hidden";
      }

      // å…³é—­è´¦å·ç®¡ç†æŠ½å±‰
      function closeAccountDrawer(event) {
        // å¦‚æœäº‹ä»¶å­˜åœ¨ä¸”ç‚¹å‡»çš„æ˜¯æŠ½å±‰å†…å®¹ï¼Œä¸å…³é—­
        if (event && event.target.closest(".drawer-content")) {
          return;
        }

        const drawer = document.getElementById("accountDrawer");
        drawer.classList.remove("open");
        // æ¢å¤bodyæ»šåŠ¨
        document.body.style.overflow = "";
      }

      // é€€å‡ºç™»å½•é¡µé¢
      function navigateToLogin() {
        showMessage("è·³è½¬ä¸­...");
        let url = `https://keepwork.com/public/resource/miniGameProxy.html?projectPath=maisi/maisi/webgames/data`;
        const newUrlParams = new URLSearchParams();
        newUrlParams.set("gameName", "ms_games_login");
        if (urlParams && Object.keys(urlParams).length > 0) {
          if (urlParams.orientation) {
            newUrlParams.set("orientation", urlParams.orientation);
          }
        }
        url += "&" + newUrlParams.toString();
        url += "&showType=logout";
        url += `&version=${miniGameProxyVersion}`;

        window.location.replace(url);
      }

      //è·å¾—ç”¨æˆ·ä¿¡æ¯
      async function getUserInfo() {
        let userToken = (urlParams && urlParams.token) || null;
        if (!userToken) {
          showMessage("ç”¨æˆ·æœªç™»å½•");
          return;
        }
        if (!this.userInfo) {
          const response = await fetch("https://api.keepwork.com/core/v0/users/profile", {
            headers: {
              Authorization: `Bearer ${userToken}`,
            },
            method: "GET",
          });
          const data = await response.json();
          this.userInfo = data;
        }
        if (this.userInfo) {
          const accountIframe = document.getElementById("accountIframe");
          if (accountIframe) {
            accountIframe.contentWindow.postMessage(
              {
                type: "userInfoResponse",
                userInfo: this.userInfo,
              },
              "*"
            );
          }
        }
      }

      // æ£€æŸ¥å®åè®¤è¯çŠ¶æ€
      function checkIdentityVerification() {
        try {
          const storedData = localStorage.getItem('identityVerified');
          if (storedData) {
            const identityData = JSON.parse(storedData);
            if (identityData && identityData.verified) {
              console.log('ç”¨æˆ·å·²å®Œæˆå®åè®¤è¯:', identityData);
              return true;
            }
          }
        } catch (error) {
          console.error('è¯»å–è®¤è¯çŠ¶æ€å¤±è´¥:', error);
        }
        return false;
      }

      // å®åè®¤è¯åŠŸèƒ½
      function showIdentityModal() {
        const modal = document.getElementById('identityModal');
        const closeBtn = modal.querySelector('.identity-modal-close');
        
        modal.classList.add('show');
        modal.style.display = 'flex';
        
        // æ ¹æ®å®åè®¤è¯çŠ¶æ€æ§åˆ¶å…³é—­æŒ‰é’®çš„æ˜¾ç¤º
        if (!checkIdentityVerification()) {
          // æœªå®åæ—¶éšè—å…³é—­æŒ‰é’®
          closeBtn.style.display = 'none';
        } else {
          // å·²å®åæ—¶æ˜¾ç¤ºå…³é—­æŒ‰é’®
          closeBtn.style.display = 'flex';
        }
        
        // æ¸…ç©ºè¡¨å•
        document.getElementById('realNameInput').value = '';
        document.getElementById('idCardInput').value = '';
        document.getElementById('nameError').textContent = '';
        document.getElementById('idCardError').textContent = '';
      }

      function closeIdentityModal() {
        // æ£€æŸ¥å®åè®¤è¯çŠ¶æ€ï¼Œå¦‚æœæœªè®¤è¯åˆ™ä¸å…è®¸å…³é—­
        if (!checkIdentityVerification()) {
          alert('è¯·å®Œæˆå®åè®¤è¯åå†å…³é—­');
          return;
        }
        
        const modal = document.getElementById('identityModal');
        modal.classList.remove('show');
        modal.style.display = 'none';
      }

      // éªŒè¯å§“åæ ¼å¼
      function validateName(name) {
        if (!name || name.trim().length === 0) {
          return 'è¯·è¾“å…¥çœŸå®å§“å';
        }
        if (name.trim().length < 2) {
          return 'å§“åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦';
        }
        if (name.trim().length > 20) {
          return 'å§“åä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦';
        }
        // æ£€æŸ¥æ˜¯å¦åªåŒ…å«ä¸­æ–‡å­—ç¬¦
        const nameRegex = /^[\u4e00-\u9fa5]+$/;
        if (!nameRegex.test(name.trim())) {
          return 'å§“ååªèƒ½åŒ…å«ä¸­æ–‡å­—ç¬¦';
        }
        return '';
      }

      // éªŒè¯èº«ä»½è¯å·ç æ ¼å¼
      function validateIdCard(idCard) {
        if (!idCard || idCard.trim().length === 0) {
          return 'è¯·è¾“å…¥èº«ä»½è¯å·ç ';
        }
        
        const cleanIdCard = idCard.trim().toUpperCase();
        
        // æ£€æŸ¥é•¿åº¦
        if (cleanIdCard.length !== 18) {
          return 'èº«ä»½è¯å·ç å¿…é¡»æ˜¯18ä½';
        }
        
        // æ£€æŸ¥æ ¼å¼ï¼šå‰17ä½æ•°å­—ï¼Œæœ€åä¸€ä½æ•°å­—æˆ–X
        const idCardRegex = /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
        if (!idCardRegex.test(cleanIdCard)) {
          return 'èº«ä»½è¯å·ç æ ¼å¼ä¸æ­£ç¡®';
        }
        
        // éªŒè¯æ ¡éªŒç 
        const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
        const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
        
        let sum = 0;
        for (let i = 0; i < 17; i++) {
          sum += parseInt(cleanIdCard[i]) * weights[i];
        }
        
        const checkCode = checkCodes[sum % 11];
        if (cleanIdCard[17] !== checkCode) {
          return 'èº«ä»½è¯å·ç æ ¡éªŒå¤±è´¥';
        }
        
        return '';
      }

      // ä»èº«ä»½è¯å·ç ä¸­æå–å§“åç›¸å…³ä¿¡æ¯ï¼ˆè¿™é‡Œæ˜¯æ¨¡æ‹ŸéªŒè¯ï¼‰
      function validateNameIdCardMatch(name, idCard) {
        // è¿™é‡Œæ˜¯ä¸€ä¸ªç®€åŒ–çš„éªŒè¯é€»è¾‘
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦è°ƒç”¨å…¬å®‰éƒ¨é—¨çš„æ¥å£è¿›è¡ŒçœŸå®éªŒè¯
        
        const cleanName = name.trim();
        const cleanIdCard = idCard.trim().toUpperCase();
        
        // æ¨¡æ‹Ÿä¸€äº›å¸¸è§çš„ä¸åŒ¹é…æƒ…å†µ
        const mockDatabase = {};
        
        // å¦‚æœåœ¨æ¨¡æ‹Ÿæ•°æ®åº“ä¸­æ‰¾åˆ°åŒ¹é…
        if (mockDatabase[cleanIdCard]) {
          if (mockDatabase[cleanIdCard] === cleanName) {
            return { success: true, message: 'å®åè®¤è¯æˆåŠŸ' };
          } else {
            return { success: false, message: 'å§“åä¸èº«ä»½è¯å·ç ä¸åŒ¹é…' };
          }
        }
        
        // å¯¹äºå…¶ä»–èº«ä»½è¯å·ç ï¼Œè¿›è¡ŒåŸºæœ¬çš„é€»è¾‘éªŒè¯
        // è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨éœ€è¦çœŸå®çš„APIéªŒè¯
        if (cleanName.length >= 2 && cleanIdCard.length === 18) {
          // æ¨¡æ‹ŸéªŒè¯æˆåŠŸï¼ˆåœ¨å®é™…åº”ç”¨ä¸­è¿™é‡Œåº”è¯¥è°ƒç”¨çœŸå®çš„éªŒè¯æ¥å£ï¼‰
          return { success: true, message: 'å®åè®¤è¯æˆåŠŸ' };
        }
        
        return { success: false, message: 'éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¿¡æ¯æ˜¯å¦æ­£ç¡®' };
      }

      // ç¡®è®¤å®åè®¤è¯
      function confirmIdentity() {
        const nameInput = document.getElementById('realNameInput');
        const idCardInput = document.getElementById('idCardInput');
        const nameError = document.getElementById('nameError');
        const idCardError = document.getElementById('idCardError');
        const confirmBtn = document.querySelector('.identity-btn-confirm');
        const agreementCheckbox = document.getElementById('agreementCheckbox');
        
        // æ£€æŸ¥æ˜¯å¦åŒæ„åè®®
        if (!agreementCheckbox.checked) {
          alert('è¯·å…ˆé˜…è¯»å¹¶åŒæ„ç›¸å…³åè®®');
          return;
        }
        
        // æ¸…ç©ºä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
        nameError.textContent = '';
        idCardError.textContent = '';
        
        const name = nameInput.value;
        const idCard = idCardInput.value;
        
        // éªŒè¯å§“å
        const nameValidation = validateName(name);
        if (nameValidation) {
          nameError.textContent = nameValidation;
          nameInput.focus();
          return;
        }
        
        // éªŒè¯èº«ä»½è¯
        const idCardValidation = validateIdCard(idCard);
        if (idCardValidation) {
          idCardError.textContent = idCardValidation;
          idCardInput.focus();
          return;
        }
        
        // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'éªŒè¯ä¸­...';
        
        // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
        setTimeout(() => {
          // éªŒè¯å§“åå’Œèº«ä»½è¯æ˜¯å¦åŒ¹é…
          const matchResult = validateNameIdCardMatch(name, idCard);
          
          if (matchResult.success) {
            // éªŒè¯æˆåŠŸï¼Œä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const identityData = {
              name: name.trim(),
              idCard: idCard.trim(),
              verifiedAt: new Date().toISOString(),
              verified: true
            };
            localStorage.setItem('identityVerified', JSON.stringify(identityData));
            
            // è®¤è¯æˆåŠŸåæ˜¾ç¤ºå…³é—­æŒ‰é’®
            const modal = document.getElementById('identityModal');
            const closeBtn = modal.querySelector('.identity-modal-close');
            closeBtn.style.display = 'flex';
            
            alert('âœ… ' + matchResult.message);
            closeIdentityModal();
            
            console.log('å®åè®¤è¯æˆåŠŸå¹¶å·²ä¿å­˜:', identityData);
          } else {
            // éªŒè¯å¤±è´¥
            idCardError.textContent = matchResult.message;
          }
          
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'ç¡®å®š';
        }, 1500);
      }

      // ç‚¹å‡»å¼¹æ¡†å¤–éƒ¨å…³é—­
      document.getElementById('identityModal').addEventListener('click', function(e) {
        if (e.target === this) {
          // æ£€æŸ¥å®åè®¤è¯çŠ¶æ€ï¼Œå¦‚æœæœªè®¤è¯åˆ™ä¸å…è®¸å…³é—­
          if (!checkIdentityVerification()) {
            alert('è¯·å®Œæˆå®åè®¤è¯åå†å…³é—­');
            return;
          }
          closeIdentityModal();
        }
      });

      // è¾“å…¥æ¡†å®æ—¶éªŒè¯
      document.getElementById('realNameInput').addEventListener('input', function() {
        const nameError = document.getElementById('nameError');
        const validation = validateName(this.value);
        nameError.textContent = validation;
      });

      document.getElementById('idCardInput').addEventListener('input', function() {
        const idCardError = document.getElementById('idCardError');
        // åªå…è®¸è¾“å…¥æ•°å­—å’ŒX
        this.value = this.value.replace(/[^0-9Xx]/g, '').toUpperCase();
        
        const validation = validateIdCard(this.value);
        idCardError.textContent = validation;
      });

      // ESCé”®å…³é—­æŠ½å±‰å’Œå¼¹æ¡†
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeDownloadDrawer();
          closeAccountDrawer();
          // å¯¹äºå®åè®¤è¯å¼¹æ¡†ï¼Œéœ€è¦æ£€æŸ¥è®¤è¯çŠ¶æ€
          if (document.getElementById('identityModal').style.display === 'flex') {
            if (!checkIdentityVerification()) {
              alert('è¯·å®Œæˆå®åè®¤è¯åå†å…³é—­');
              return;
            }
          }
          closeIdentityModal();
        }
      });
      // çª—å£å¤§å°æ”¹å˜å¤„ç†
      window.addEventListener("resize", function () {
        // é˜²æŠ–å¤„ç†
        clearTimeout(window.resizeTimeout);
        window.resizeTimeout = setTimeout(function () {
          // Only reinitialize slider if it has already been initialized (i.e., we're in MS Planet mode)
          if (slideImages.length > 0) {
            const newImages = getFilteredImages();
            if (newImages.length !== slideImages.length) {
              stopSlideshow();
              initSlider();
            }
          }
        }, 300);
      });
      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è®¤è¯çŠ¶æ€
      function initIdentityVerification() {
        // å¦‚æœæ­£åœ¨åŠ è½½ä¸­ï¼Œä¸å¼¹å‡ºå®åè®¤è¯æ¡†
        if (isLoading) {
          console.log('é¡µé¢æ­£åœ¨åŠ è½½ä¸­ï¼Œè·³è¿‡å®åè®¤è¯æµç¨‹');
          return;
        }
        
        if (!checkIdentityVerification()) {
          // å¦‚æœæœªè®¤è¯ï¼Œæ£€æŸ¥å¹³å°æ˜¯å¦ä¸ºå°ç±³
          if (window.platform == 'xiaomi') {
            console.log('å°ç±³å¹³å°ç”¨æˆ·æœªå®Œæˆå®åè®¤è¯ï¼Œæ˜¾ç¤ºè®¤è¯æ¡†');
            setTimeout(() => {
              showIdentityModal();
            }, 1000); // å»¶è¿Ÿ1ç§’å¼¹å‡ºï¼Œè®©é¡µé¢å®Œå…¨åŠ è½½
          } else {
            console.log('ç”¨æˆ·æœªå®Œæˆå®åè®¤è¯ï¼Œä½†æš‚æ—¶ä¸å¼¹å‡ºè®¤è¯æ¡†');
          }
        } else {
          console.log('ç”¨æˆ·å·²å®Œæˆå®åè®¤è¯ï¼Œè·³è¿‡è®¤è¯æµç¨‹');
        }
      }

      // Markdownè½¬HTMLå‡½æ•°
      function markdownToHtml(markdown) {
        let html = markdown
          .replace(/^### (.*$)/gim, '<h3>$1</h3>')
          .replace(/^## (.*$)/gim, '<h2>$1</h2>')
          .replace(/^# (.*$)/gim, '<h1>$1</h1>')
          .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/gim, '<em>$1</em>')
          .replace(/\n\n/gim, '</p><p>')
          .replace(/\n/gim, '<br>');

        if (html.trim() !== '') {
          html = "<p>" + html + "</p>";
        }

        return html;
      }

      // æ‰“å¼€è®¤è¯æœåŠ¡åè®®å¼¹çª—
      async function openIdentityModal() {
        const modal = document.getElementById("identityServiceModal");
        const content = document.getElementById("identityContent");

        modal.style.display = "block";
        content.innerHTML = '<div class="modal-loading">æ­£åœ¨åŠ è½½è®¤è¯æœåŠ¡åè®®...</div>';

        try {
          const response = await fetch("https://cross.keepwork.com/api/raw/maisi/maisi/docs/identity");
          const markdown = await response.text();
          const html = markdownToHtml(markdown);
          content.innerHTML = html;
        } catch (error) {
          console.error("åŠ è½½è®¤è¯æœåŠ¡åè®®å¤±è´¥:", error);
          content.innerHTML = '<p style="color: #ef4444;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>';
        }
      }

      // æ‰“å¼€éšç§æ”¿ç­–å¼¹çª—
      async function openPrivacyModal() {
        const modal = document.getElementById("privacyModal");
        const content = document.getElementById("privacyContent");

        modal.style.display = "block";
        content.innerHTML = '<div class="modal-loading">æ­£åœ¨åŠ è½½éšç§æ”¿ç­–...</div>';

        try {
          const response = await fetch("https://cross.keepwork.com/api/raw/maisi/maisi/docs/privacy");
          const markdown = await response.text();
          const html = markdownToHtml(markdown);
          content.innerHTML = html;
        } catch (error) {
          console.error("åŠ è½½éšç§æ”¿ç­–å¤±è´¥:", error);
          content.innerHTML = '<p style="color: #ef4444;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>';
        }
      }

      // æ‰“å¼€ç”¨æˆ·åè®®å¼¹çª—
      async function openLicenseModal() {
        const modal = document.getElementById("licenseModal");
        const content = document.getElementById("licenseContent");

        modal.style.display = "block";
        content.innerHTML = '<div class="modal-loading">æ­£åœ¨åŠ è½½ç”¨æˆ·åè®®...</div>';

        try {
          const response = await fetch("https://cross.keepwork.com/api/raw/maisi/maisi/docs/license");
          const markdown = await response.text();
          const html = markdownToHtml(markdown);
          content.innerHTML = html;
        } catch (error) {
          console.error("åŠ è½½ç”¨æˆ·åè®®å¤±è´¥:", error);
          content.innerHTML = '<p style="color: #ef4444;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>';
        }
      }

      // å…³é—­å¼¹çª—
      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      window.onclick = function(event) {
        const identityServiceModal = document.getElementById('identityServiceModal');
        const privacyModal = document.getElementById('privacyModal');
        const licenseModal = document.getElementById('licenseModal');
        
        if (event.target === identityServiceModal) {
          identityServiceModal.style.display = 'none';
        }
        if (event.target === privacyModal) {
          privacyModal.style.display = 'none';
        }
        if (event.target === licenseModal) {
          licenseModal.style.display = 'none';
        }
      }

      getParentUrlParams();
      setExternalDocumentTitle();
      initPlanetNameClick();
      updateBetaBubbleVisibility();
    </script>
  </body>
</html>
