<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>青少年用户画像</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            width: 100%;
            height: 100vh;
            overflow: hidden;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .profile-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin: 10px;
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .profile-container.loaded {
            opacity: 1;
        }
        
        .header {
            background: linear-gradient(135deg, #6fa8dc 0%, #9fc5e8 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 12px 12px 0 0;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-title {
            display: inline-block;
        }
        
        .content {
            flex: 1;
            display: flex;
            padding: 15px;
            gap: 15px;
        }
        
        .left-panel {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .personal-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: box-shadow 0.3s ease;
        }
        
        .personal-info:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }
        
        .nickName {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .userName {
            color: #636e72;
            font-size: 13px;
            margin-bottom: 12px;
        }
        
        .radar-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #e9ecef;
            flex: 1;
            transition: box-shadow 0.3s ease;
        }
        
        .radar-container:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .radar-title {
            text-align: center;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .radar-chart-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
            position: relative;
        }
        
        .radar-chart {
            width: 100% !important;
            height: 100% !important;
            max-width: min(100%, 300px);
            max-height: min(100%, 300px);
        }
        
        /* Canvas高DPI优化 */
        #radarChart {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            -ms-interpolation-mode: nearest-neighbor;
            image-rendering: optimizeQuality;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }
        
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .ability-section {
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            overflow: hidden;
            margin-bottom: 1vh;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .section-header {
            background: #a8d8ea;
            color: #2d3436;
            padding: 1vh 2vw;
            font-weight: bold;
            font-size: clamp(12px, 2vw, 16px);
            text-align: center;
        }
        
        .section-header:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }
        
        .section-content {
            flex: 1;
            display: flex;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 2px;
            background: #e9ecef;
            height: 100%;
        }
        
        .ability-item {
            background: white;
            padding: 8px;
            text-align: center;
            font-size: 11px;
            transition: all 0.2s ease;
            cursor: pointer;
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-left: -1px;
        }
        
        .ability-item:hover {
            background-color: #f8f9fa;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        .ability-item:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .ability-label {
            color: #636e72;
            margin-bottom: 2px;
        }
        
        .ability-value {
            font-weight: bold;
            color: #2d3436;
            font-size: 13px;
        }
        
        .ability-score-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .ability-emoji {
            font-size: 16px;
            line-height: 1;
        }
        
        .ability-value.empty {
            color: #ddd;
        }
        
        .cognitive-section .section-header {
            background: #a8d8ea;
        }
        
        .strategy-section .section-header {
            background: #a8d8ea;
        }
        
        .motivation-section .section-header {
            background: #a8d8ea;
        }
        
        .emotion-section .section-header {
            background: #a8d8ea;
        }
        
        .quality-section .section-header {
            background: #a8d8ea;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: clamp(14px, 3vw, 20px);
            color: #636e72;
        }
        
        /* Modal样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            animation: slideIn 0.3s ease;
            position: relative;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #6fa8dc 0%, #9fc5e8 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 40px;
            font-weight: bold;
        }
        
        .close {
            color: white;
            font-size: 4rem;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s ease;
        }
        
        .close:hover {
            color: #f0f0f0;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .ability-info {
            text-align: left;
        }
        
        .ability-name {
            font-size: 40px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .ability-description {
            font-size: 30px;
            line-height: 1.6;
            color: #636e72;
            text-align: justify;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="profile-container" id="profileContainer">
        <div class="header">
            <span class="header-title">个人信息</span>
        </div>
        
        <div class="content">
            <div class="left-panel">
                <!-- 个人信息卡片 -->
                <div class="personal-info">
                    <div class="avatar">👤</div>
                    <div class="nickName">用户昵称：</div>
                    <div class="userName">账号：</div>
                    <div class="user-info-extra" style="display: none;"></div>
                </div>
                <!-- 雷达图 -->
                <div class="radar-container">
                    <div class="radar-title">综合能力</div>
                    <div class="radar-chart-container">
                        <canvas id="radarChart" class="radar-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <!-- 认知能力 -->
                <div class="ability-section cognitive-section">
                    <div class="section-header">认知能力</div>
                    <div class="section-content">
                        <div class="ability-item">
                            <div class="ability-label">集中性注意力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="focusedAttention">-</div>
                                <div class="ability-emoji" id="focusedAttention-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">选择性注意力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="selectiveAttention">-</div>
                                <div class="ability-emoji" id="selectiveAttention-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">转移性注意力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="shiftingAttention">-</div>
                                <div class="ability-emoji" id="shiftingAttention-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">分配性注意力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="distributedAttention">-</div>
                                <div class="ability-emoji" id="distributedAttention-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">视觉记忆</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="visualMemory">-</div>
                                <div class="ability-emoji" id="visualMemory-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">听觉记忆</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="auditoryMemory">-</div>
                                <div class="ability-emoji" id="auditoryMemory-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">工作记忆</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="workingMemory">-</div>
                                <div class="ability-emoji" id="workingMemory-emoji"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 思维能力 -->
                <div class="ability-section cognitive-section">
                    <div class="section-header">思维能力</div>
                    <div class="section-content">
                        <div class="ability-item">
                            <div class="ability-label">归纳推理能力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="inductiveReasoning">-</div>
                                <div class="ability-emoji" id="inductiveReasoning-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">演绎推理能力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="deductiveReasoning">-</div>
                                <div class="ability-emoji" id="deductiveReasoning-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">类比推理能力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="analogicalReasoning">-</div>
                                <div class="ability-emoji" id="analogicalReasoning-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">言语理解能力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="verbalComprehension">-</div>
                                <div class="ability-emoji" id="verbalComprehension-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">抽象推理能力</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="abstractReasoning">-</div>
                                <div class="ability-emoji" id="abstractReasoning-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">视觉空间智能</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="visualSpatialIntelligence">-</div>
                                <div class="ability-emoji" id="visualSpatialIntelligence-emoji"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 学习策略 -->
                <div class="ability-section strategy-section">
                    <div class="section-header">学习策略</div>
                    <div class="section-content">
                        <div class="ability-item">
                            <div class="ability-label">复述策略</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="elaborationStrategy">-</div>
                                <div class="ability-emoji" id="elaborationStrategy-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">精细加工策略</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="detailedProcessingStrategy">-</div>
                                <div class="ability-emoji" id="detailedProcessingStrategy-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">组织策略</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="organizationalStrategy">-</div>
                                <div class="ability-emoji" id="organizationalStrategy-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">元认知计划</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="metacognitivePlanning">-</div>
                                <div class="ability-emoji" id="metacognitivePlanning-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">元认知监控</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="metacognitiveMonitoring">-</div>
                                <div class="ability-emoji" id="metacognitiveMonitoring-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">元认知调节</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="metacognitiveRegulation">-</div>
                                <div class="ability-emoji" id="metacognitiveRegulation-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">努力管理</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="effortManagement">-</div>
                                <div class="ability-emoji" id="effortManagement-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">时间管理</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="timeManagement">-</div>
                                <div class="ability-emoji" id="timeManagement-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">外界资源利用</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="externalResourceUtilization">-</div>
                                <div class="ability-emoji" id="externalResourceUtilization-emoji"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 学习动机 -->
                <div class="ability-section motivation-section">
                    <div class="section-header">学习动机</div>
                    <div class="section-content">
                        <div class="ability-item">
                            <div class="ability-label">成长</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="growth">-</div>
                                <div class="ability-emoji" id="growth-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">自主</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="autonomy">-</div>
                                <div class="ability-emoji" id="autonomy-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">互动</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="interaction">-</div>
                                <div class="ability-emoji" id="interaction-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">兴趣</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="interest">-</div>
                                <div class="ability-emoji" id="interest-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">认可</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="recognition">-</div>
                                <div class="ability-emoji" id="recognition-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">竞争</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="competition">-</div>
                                <div class="ability-emoji" id="competition-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">物质奖励</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="materialReward">-</div>
                                <div class="ability-emoji" id="materialReward-emoji"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 情绪智力 -->
                <div class="ability-section emotion-section">
                    <div class="section-header">情绪智力</div>
                    <div class="section-content">
                        <div class="ability-item">
                            <div class="ability-label">情绪感知理解</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="emotionalAwareness">-</div>
                                <div class="ability-emoji" id="emotionalAwareness-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">情绪调节表达</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="emotionalRegulation">-</div>
                                <div class="ability-emoji" id="emotionalRegulation-emoji"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 学习品质 -->
                <div class="ability-section quality-section">
                    <div class="section-header">学习品质</div>
                    <div class="section-content">
                        <div class="ability-item">
                            <div class="ability-label">责任心</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="responsibility">-</div>
                                <div class="ability-emoji" id="responsibility-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">严谨性</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="seriousness">-</div>
                                <div class="ability-emoji" id="seriousness-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">坚毅性</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="perseverance">-</div>
                                <div class="ability-emoji" id="perseverance-emoji"></div>
                            </div>
                        </div>
                        <div class="ability-item">
                            <div class="ability-label">创新性</div>
                            <div class="ability-score-container">
                                <div class="ability-value" id="creativity">-</div>
                                <div class="ability-emoji" id="creativity-emoji"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal弹框 -->
    <div id="abilityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">能力详情</h3>
                <span class="close" onclick="closeAbilityModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="ability-info">
                    <div class="ability-name" id="modalAbilityName"></div>
                    <div class="ability-description" id="modalAbilityDescription"></div>
                </div>
                <div class="game-info" id="gameInfo" style="margin-top: 40px; padding-top: 40px; border-top: 2px solid #eee; display: none;">
                    <h4 style="margin-bottom: 20px; color: #333; font-size: 32px;">相关游戏</h4>
                    <div class="game-name" id="modalGameName" style="color: #007bff; cursor: pointer; text-decoration: underline; font-weight: bold; font-size: 28px;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let radarChart;
        let profileData = {};
        let userInfoData = {};
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        const isLandscape = () => window.innerWidth > window.innerHeight;
        const getScreenSize = () => ({
            width: window.innerWidth,
            height: window.innerHeight,
            ratio: window.devicePixelRatio || 1
        });
        
        // 监听来自父页面的消息
        window.addEventListener('message', function(event) {
            console.log("收到消息",event.data)
            if (event.data && event.data.type === 'setGameConfig') {
                profileData = event.data.data.profileData;
                userInfoData = event.data.data.userInfoData;
                profileData && updateProfile(profileData);
                userInfoData && updateUserInfo(userInfoData);
            }
        });
        
        // 页面加载完成后发送消息
        window.addEventListener('load', function() {
            // 通知父页面页面已加载
            window.parent.postMessage({
                type: 'pageLoaded'
            }, '*');
            
            // 请求数据
            window.parent.postMessage({
                type: 'requestProfileData'
            }, '*');
            
            // 性能优化：使用 requestAnimationFrame
            requestAnimationFrame(() => {
                initRadarChart();
                // adjustLayout();
                if (isTouch) {
                    addTouchEvents();
                }
                
                // 初始化能力项点击事件
                initAbilityItemEvents();
                
                // 添加加载完成的视觉反馈
                const container = document.getElementById('profileContainer');
                container.classList.add('loaded');
                
                // 预加载优化
                preloadOptimizations();
            });
        });
        
        // 预设置一些样式以避免闪烁
        const container = document.getElementById('profileContainer');
        if (container) {
            container.style.visibility = 'visible';
        }
        
        // 添加加载指示器
        showLoadingIndicator();
        
        // 预加载优化
        function preloadOptimizations() {
            // 预计算一些值以提高性能
            const screenSize = getScreenSize();
            
            // 缓存DOM元素
            window.cachedElements = {
                container: document.getElementById('profileContainer'),
                content: document.querySelector('.content'),
                leftPanel: document.querySelector('.left-panel'),
                rightPanel: document.querySelector('.right-panel'),
                radarContainer: document.querySelector('.radar-container')
            };
            
            // 移除加载指示器
            hideLoadingIndicator();
        }
        
        // 显示加载指示器
        function showLoadingIndicator() {
            const loadingDiv = document.querySelector('.loading');
            if (loadingDiv) {
                loadingDiv.style.display = 'flex';
            }
        }
        
        // 隐藏加载指示器
        function hideLoadingIndicator() {
            const loadingDiv = document.querySelector('.loading');
            if (loadingDiv) {
                loadingDiv.style.opacity = '0';
                setTimeout(() => {
                    loadingDiv.style.display = 'none';
                }, 300);
            }
        }
            
        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 能力配置数据
        const abilityConfig = {
            // 认知能力
            focusedAttention: {
                id: 'focusedAttention',
                label: '集中性注意力',
                description: '指在一定时间内专注于特定任务或刺激的能力。这种能力帮助学习者在学习过程中保持专注，不被外界干扰分散注意力，从而提高学习效率和质量。集中性注意力强的学习者能够更好地完成需要持续专注的任务，如阅读、听讲和解题。'
            },
            selectiveAttention: {
                id: 'selectiveAttention',
                label: '选择性注意力',
                description: '指从多个刺激中选择性地关注重要信息，忽略无关信息的能力。这种能力帮助学习者在复杂的学习环境中筛选出关键信息，提高信息处理的效率。选择性注意力强的学习者能够在嘈杂的环境中专注学习，快速识别重点内容。'
            },
            shiftingAttention: {
                id: 'shiftingAttention',
                label: '转移性注意力',
                description: '指根据任务需要灵活转换注意力焦点的能力。这种能力帮助学习者在不同学习任务间快速切换，适应多任务学习环境。转移性注意力强的学习者能够更好地处理复合型学习任务，在不同学科间灵活转换思维模式。'
            },
            distributedAttention: {
                id: 'distributedAttention',
                label: '分配性注意力',
                description: '指同时关注多个任务或信息源的能力。这种能力帮助学习者在多任务环境中保持效率，合理分配认知资源。分配性注意力强的学习者能够在听讲的同时做笔记，或者同时处理多个学习任务而不降低质量。'
            },
            visualMemory: {
                id: 'visualMemory',
                label: '视觉记忆',
                description: '指对视觉信息进行编码、存储和提取的能力。这种能力帮助学习者记住图表、图像、文字布局等视觉材料。视觉记忆强的学习者在学习几何、地理、艺术等需要视觉想象的学科时具有优势，能够更好地理解和记忆空间关系。'
            },
            auditoryMemory: {
                id: 'auditoryMemory',
                label: '听觉记忆',
                description: '指对听觉信息进行编码、存储和提取的能力。这种能力帮助学习者记住语言、音乐、声音等听觉材料。听觉记忆强的学习者在语言学习、音乐学习等方面表现突出，能够更好地记住老师的讲解和音频材料。'
            },
            workingMemory: {
                id: 'workingMemory',
                label: '工作记忆',
                description: '指在执行认知任务时临时存储和操作信息的能力。这种能力是学习和思维的核心，影响理解、推理和问题解决。工作记忆强的学习者能够在心理上同时保持多个信息，进行复杂的思维操作，在数学计算和逻辑推理中表现优异。'
            },
            inductiveReasoning: {
                id: 'inductiveReasoning',
                label: '归纳推理能力',
                description: '指从具体事例中总结出一般规律的思维能力。这种能力帮助学习者发现模式、总结规律，形成概念和理论。归纳推理能力强的学习者善于从实例中抽象出原理，在科学研究和创新思维中具有优势。'
            },
            deductiveReasoning: {
                id: 'deductiveReasoning',
                label: '演绎推理能力',
                description: '指从一般原理推导出具体结论的思维能力。这种能力帮助学习者运用已知规律解决新问题，进行逻辑推理。演绎推理能力强的学习者善于运用理论知识分析实际问题，在数学证明和逻辑分析中表现突出。'
            },
            analogicalReasoning: {
                id: 'analogicalReasoning',
                label: '类比推理能力',
                description: '指通过比较不同事物间的相似性来进行推理的能力。这种能力帮助学习者运用已有知识理解新概念，促进知识迁移。类比推理能力强的学习者善于发现事物间的内在联系，能够快速理解抽象概念。'
            },
            verbalComprehension: {
                id: 'verbalComprehension',
                label: '言语理解能力',
                description: '指理解和运用语言的能力，包括词汇理解、语法掌握和语义分析。这种能力是学习的基础，影响阅读理解和表达能力。言语理解能力强的学习者在语文、外语等语言类学科中表现优异，能够准确理解复杂的文本内容。'
            },
            abstractReasoning: {
                id: 'abstractReasoning',
                label: '抽象推理能力',
                description: '指处理抽象概念和符号关系的思维能力。这种能力帮助学习者理解复杂的理论概念，进行高层次的思维活动。抽象推理能力强的学习者在数学、物理、哲学等需要抽象思维的学科中具有优势。'
            },
            visualSpatialIntelligence: {
                id: 'visualSpatialIntelligence',
                label: '视觉空间智能',
                description: '指感知、理解和操作视觉空间信息的能力。这种能力帮助学习者理解几何关系、空间结构和视觉模式。视觉空间智能强的学习者在几何、工程、艺术设计等领域表现突出，能够很好地进行空间想象和操作。'
            },
            // 学习策略
            elaborationStrategy: {
                id: 'elaborationStrategy',
                label: '复述策略',
                description: '指通过重复练习来巩固记忆的学习方法。这种策略帮助学习者加强记忆痕迹，提高信息保持率。善用复述策略的学习者能够通过有效的重复练习掌握基础知识，为进一步学习打下坚实基础。'
            },
            detailedProcessingStrategy: {
                id: 'detailedProcessingStrategy',
                label: '精细加工策略',
                description: '指通过深入分析、联想和整合来理解和记忆信息的学习方法。这种策略帮助学习者建立知识间的联系，形成深层理解。善用精细加工策略的学习者能够将新知识与已有知识有机结合，提高学习的深度和质量。'
            },
            organizationalStrategy: {
                id: 'organizationalStrategy',
                label: '组织策略',
                description: '指通过分类、归纳、构建框架等方式整理学习材料的方法。这种策略帮助学习者形成系统化的知识结构，提高学习效率。善用组织策略的学习者能够将复杂的信息有序化，便于理解和记忆。'
            },
            metacognitivePlanning: {
                id: 'metacognitivePlanning',
                label: '元认知计划',
                description: '指对学习过程进行预先规划和设计的能力。这种能力帮助学习者制定合理的学习目标和策略，提高学习的针对性。元认知计划能力强的学习者能够根据任务特点和自身情况制定有效的学习计划。'
            },
            metacognitiveMonitoring: {
                id: 'metacognitiveMonitoring',
                label: '元认知监控',
                description: '指对学习过程进行实时监察和评估的能力。这种能力帮助学习者及时发现学习中的问题，调整学习策略。元认知监控能力强的学习者能够准确判断自己的学习状态，及时纠正错误。'
            },
            metacognitiveRegulation: {
                id: 'metacognitiveRegulation',
                label: '元认知调节',
                description: '指根据学习情况调整学习策略和方法的能力。这种能力帮助学习者优化学习过程，提高学习效果。元认知调节能力强的学习者能够灵活运用不同的学习策略，适应各种学习情境。'
            },
            effortManagement: {
                id: 'effortManagement',
                label: '努力管理',
                description: '指合理分配和调节学习努力程度的能力。这种能力帮助学习者在不同任务间合理分配精力，保持持续的学习动力。努力管理能力强的学习者能够在困难面前坚持不懈，同时避免过度疲劳。'
            },
            timeManagement: {
                id: 'timeManagement',
                label: '时间管理',
                description: '指有效规划和利用学习时间的能力。这种能力帮助学习者提高学习效率，平衡各项学习任务。时间管理能力强的学习者能够制定合理的时间安排，避免拖延，充分利用有限的时间。'
            },
            externalResourceUtilization: {
                id: 'externalResourceUtilization',
                label: '外界资源利用',
                description: '指有效寻找和利用外部学习资源的能力。这种能力帮助学习者扩展学习渠道，获得更丰富的学习支持。善于利用外界资源的学习者能够主动寻求帮助，充分利用图书馆、网络、同伴等各种学习资源。'
            },
            // 学习动机
            growth: {
                id: 'growth',
                label: '成长',
                description: '指追求个人能力提升和自我发展的内在动机。这种动机驱动学习者不断挑战自己，追求进步。具有强烈成长动机的学习者将学习视为自我完善的过程，能够从挫折中学习，持续提升自己的能力。'
            },
            autonomy: {
                id: 'autonomy',
                label: '自主',
                description: '指追求学习自主权和独立性的动机。这种动机帮助学习者发展自主学习能力，培养独立思考的习惯。具有强烈自主动机的学习者喜欢自己掌控学习过程，能够主动探索和发现知识。'
            },
            interaction: {
                id: 'interaction',
                label: '互动',
                description: '指通过与他人交流合作来获得学习满足感的动机。这种动机促进学习者积极参与群体学习活动，发展社交技能。具有强烈互动动机的学习者喜欢讨论交流，能够在合作中学习和成长。'
            },
            interest: {
                id: 'interest',
                label: '兴趣',
                description: '指对学习内容本身的好奇心和喜爱程度。这种动机是最持久的学习驱动力，能够维持长期的学习热情。具有强烈兴趣动机的学习者对知识充满好奇，能够主动深入探索感兴趣的领域。'
            },
            recognition: {
                id: 'recognition',
                label: '认可',
                description: '指寻求他人肯定和赞扬的动机。这种动机帮助学习者获得成就感，增强学习信心。具有强烈认可动机的学习者重视他人的评价，能够通过获得认可来维持学习动力。'
            },
            competition: {
                id: 'competition',
                label: '竞争',
                description: '指通过与他人比较来激发学习动力的动机。这种动机能够推动学习者努力超越他人，追求卓越表现。具有强烈竞争动机的学习者喜欢挑战，能够在竞争中激发潜能。'
            },
            materialReward: {
                id: 'materialReward',
                label: '物质奖励',
                description: '指通过获得物质回报来维持学习动力的动机。这种动机能够提供短期的学习激励，但需要与内在动机相结合。受物质奖励动机驱动的学习者能够为了获得奖励而努力学习。'
            },
            // 情绪智力
            emotionalAwareness: {
                id: 'emotionalAwareness',
                label: '情绪感知理解',
                description: '指识别、理解自己和他人情绪的能力。这种能力帮助学习者更好地管理学习过程中的情绪波动，建立良好的人际关系。情绪感知理解能力强的学习者能够准确识别情绪信号，理解情绪对学习的影响。'
            },
            emotionalRegulation: {
                id: 'emotionalRegulation',
                label: '情绪调节表达',
                description: '指有效管理和表达情绪的能力。这种能力帮助学习者在学习中保持积极的情绪状态，合理表达自己的感受。情绪调节表达能力强的学习者能够控制负面情绪，保持学习的积极性和专注度。'
            },
            // 学习品质
            responsibility: {
                id: 'responsibility',
                label: '责任心',
                description: '指对学习任务和目标承担责任的品质。这种品质帮助学习者认真对待学习，履行学习义务。具有强烈责任心的学习者能够自觉完成学习任务，对自己的学习成果负责。'
            },
            seriousness: {
                id: 'seriousness',
                label: '严谨性',
                description: '指在学习过程中保持严格、细致态度的品质。这种品质帮助学习者避免粗心错误，提高学习质量。具有严谨性的学习者注重细节，能够进行深入细致的思考和分析。'
            },
            perseverance: {
                id: 'perseverance',
                label: '坚毅性',
                description: '指面对困难和挫折时坚持不懈的品质。这种品质帮助学习者克服学习中的障碍，实现长期目标。具有坚毅性的学习者能够在困难面前不轻易放弃，通过持续努力达成目标。'
            },
            creativity: {
                id: 'creativity',
                label: '创新性',
                description: '指产生新颖、独特想法和解决方案的品质。这种品质帮助学习者突破常规思维，发现新的学习方法和知识联系。具有创新性的学习者善于独立思考，能够提出原创性的见解和解决方案。'
            }
        };

        function OnClickProfileItem(abilityId) {
            const config = abilityConfig[abilityId];
            if (config) {
                // 获取对应的game信息
                const fieldData = profileData[abilityId];
                const gameInfo = fieldData && fieldData.game ? fieldData.game : null;
                showAbilityModal(config, gameInfo);
            }
        }
        
        // 显示能力详情弹框
        function showAbilityModal(config, gameInfo = null) {
            const modal = document.getElementById('abilityModal');
            const modalAbilityName = document.getElementById('modalAbilityName');
            const modalAbilityDescription = document.getElementById('modalAbilityDescription');
            const gameInfoDiv = document.getElementById('gameInfo');
            const modalGameName = document.getElementById('modalGameName');
            
            modalAbilityName.textContent = config.label;
            modalAbilityDescription.textContent = config.description;
            
            // 处理game信息
            if (gameInfo && gameInfo.game_name) {
                try {
                    // 解码后再编码，确保一致性
                    const decodedGameName = decodeURIComponent(escape(atob(gameInfo.game_name)));

                    modalGameName.textContent = decodedGameName;
                    
                    // 添加点击事件
                    modalGameName.onclick = function() {
                        // 关闭modal
                        closeAbilityModal();
                        
                        // 发送postMessage
                        window.parent.postMessage({
                            type: 'gameNameClicked',
                            gameInfo: {...gameInfo, decodeName: decodedGameName}
                        }, '*');
                    };
                    
                    gameInfoDiv.style.display = 'block';
                } catch (e) {
                    console.error('Base64解码失败:', e);
                    gameInfoDiv.style.display = 'none';
                }
            } else {
                gameInfoDiv.style.display = 'none';
            }
            
            modal.classList.add('show');
            modal.style.display = 'flex';
            
        }
        
        // 关闭能力详情弹框
        function closeAbilityModal() {
            const modal = document.getElementById('abilityModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
        
        }
        
        // 点击背景关闭弹框
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('abilityModal');
            if (event.target === modal) {
                closeAbilityModal();
            }
        });
        
        // ESC键关闭弹框
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAbilityModal();
            }
        });
        
        // 初始化能力项点击事件
        function initAbilityItemEvents() {
            const abilityItems = document.querySelectorAll('.ability-item');
            abilityItems.forEach(item => {
                const abilityValueElement = item.querySelector('.ability-value');
                if (abilityValueElement && abilityValueElement.id) {
                    const abilityId = abilityValueElement.id;
                    item.addEventListener('click', function() {
                        OnClickProfileItem(abilityId);
                    });
                    
                    // 添加视觉反馈
                    item.style.cursor = 'pointer';
                }
            });
        }
        
        // 触摸事件处理（优化版本）
        function addTouchEvents() {
            const abilityItems = document.querySelectorAll('.ability-item');
            const sectionHeaders = document.querySelectorAll('.section-header');
            
            // 为能力项添加触摸事件
            abilityItems.forEach(item => {
                let touchStartTime = 0;
                
                item.addEventListener('touchstart', function(e) {
                    touchStartTime = Date.now();
                    this.style.backgroundColor = '#e3f2fd';
                    this.style.transform = 'scale(0.98)';
                    
                    // 添加触觉反馈（如果支持）
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                }, { passive: true });
                
                item.addEventListener('touchend', function(e) {
                    const touchDuration = Date.now() - touchStartTime;
                    const delay = touchDuration < 100 ? 150 : 50;
                    
                    setTimeout(() => {
                        this.style.backgroundColor = 'white';
                        this.style.transform = '';
                    }, delay);
                }, { passive: true });
                
                item.addEventListener('touchcancel', function(e) {
                    this.style.backgroundColor = 'white';
                    this.style.transform = '';
                }, { passive: true });
            });
            
            // 为节标题添加触摸事件
            sectionHeaders.forEach(header => {
                header.addEventListener('touchstart', function(e) {
                    this.style.transform = 'translateY(-1px) scale(0.99)';
                }, { passive: true });
                
                header.addEventListener('touchend', function(e) {
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 100);
                }, { passive: true });
            });
        }
        
        // 动态调整布局（优化版本）
        function adjustLayout() {
            const elements = window.cachedElements || {
                container: document.getElementById('profileContainer'),
                content: document.querySelector('.content'),
                leftPanel: document.querySelector('.left-panel'),
                rightPanel: document.querySelector('.right-panel'),
                radarContainer: document.querySelector('.radar-container')
            };
            
            const screenSize = getScreenSize();
            
            // 根据屏幕尺寸调整布局
            if (screenSize.width < 768) {
                elements.content.style.flexDirection = 'column';
                elements.leftPanel.style.width = '100%';
                elements.rightPanel.style.width = '100%';
            } else {
                elements.content.style.flexDirection = 'row';
                elements.leftPanel.style.width = '';
                elements.rightPanel.style.width = '';
            }
            
            // 调整雷达图大小并重新优化Canvas分辨率
            if (elements.radarContainer && radarChart) {
                // 使用 requestAnimationFrame 优化性能
                requestAnimationFrame(() => {
                    const canvas = document.getElementById('radarChart');
                    if (canvas) {
                        // 重新优化Canvas高DPI显示
                        optimizeCanvasForHighDPI(canvas);
                        // 调整图表大小
                        radarChart.resize();
                        // 强制重绘以确保清晰度
                        radarChart.update('none');
                    }
                });
            }
        }
        
        // 防止双击缩放
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });
        
        // 优化Canvas高DPI显示
        function optimizeCanvasForHighDPI(canvas) {
            const ctx = canvas.getContext('2d');
            const devicePixelRatio = window.devicePixelRatio || 1;
            const backingStoreRatio = ctx.webkitBackingStorePixelRatio ||
                                    ctx.mozBackingStorePixelRatio ||
                                    ctx.msBackingStorePixelRatio ||
                                    ctx.oBackingStorePixelRatio ||
                                    ctx.backingStorePixelRatio || 1;
            
            const ratio = devicePixelRatio / backingStoreRatio;
            
            if (devicePixelRatio !== backingStoreRatio) {
                const oldWidth = canvas.width;
                const oldHeight = canvas.height;
                
                canvas.width = oldWidth * ratio;
                canvas.height = oldHeight * ratio;
                
                canvas.style.width = oldWidth + 'px';
                canvas.style.height = oldHeight + 'px';
                
                ctx.scale(ratio, ratio);
            }
            
            return ratio;
        }
        
        function initRadarChart() {
            const canvas = document.getElementById('radarChart');
            const ctx = canvas.getContext('2d');
            
            // 优化Canvas高DPI显示
            // const pixelRatio = optimizeCanvasForHighDPI(canvas);
            const pixelRatio = 1
            
            // 设置Canvas抗锯齿
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['认知能力', '学习策略', '学习动机', '情绪智力', '学习品质'],
                    datasets: [{
                        label: '60分基准线',
                        data: [60, 60, 60, 60, 60],
                        backgroundColor: 'transparent',
                        borderColor: '#ffcc00',
                        borderWidth: 2 * pixelRatio,
                        borderDash: [5 * pixelRatio, 5 * pixelRatio],
                        pointRadius: 0,
                        pointHoverRadius: 0
                    }, {
                        label: '90分基准线',
                        data: [90, 90, 90, 90, 90],
                        backgroundColor: 'transparent',
                        borderColor: '#00cc00',
                        borderWidth: 2 * pixelRatio,
                        borderDash: [5 * pixelRatio, 5 * pixelRatio],
                        pointRadius: 0,
                        pointHoverRadius: 0
                    }, {
                        label: '我的能力',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(116, 185, 255, 0.2)',
                        borderColor: 'rgba(116, 185, 255, 1)',
                        borderWidth: 2 * pixelRatio,
                        pointBackgroundColor: 'rgba(116, 185, 255, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(116, 185, 255, 1)',
                        pointRadius: 4 * pixelRatio,
                        pointHoverRadius: 6 * pixelRatio
                    }]
                },
                options: {
                    responsive: true,
                    devicePixelRatio: window.devicePixelRatio || 1,
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: Math.max(10 * pixelRatio, 10)
                                },
                                padding: 10 * pixelRatio,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: Math.max(10 * pixelRatio, 10)
                                },
                                backdropPadding: 2 * pixelRatio
                            },
                            pointLabels: {
                                font: {
                                    size: Math.max((isMobile ? 10 : 11) * pixelRatio, isMobile ? 10 : 11),
                                    family: 'Arial, sans-serif'
                                },
                                padding: (isMobile ? 15 : 20) * pixelRatio,
                                color: '#333'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1 * pixelRatio
                            },
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1 * pixelRatio
                            }
                        }
                    },
                }
            });
            
            // 存储pixelRatio供后续使用
            window.canvasPixelRatio = pixelRatio;
        }
        
        function updateUserInfo(data) {
            // 更新用户信息
            const fields = ['nickName', 'userName'];
            fields.forEach(field => {
                const element = document.querySelector(`.${field}`);
                if (element) {
                    const value = data[field];
                    if (value !== undefined && value !== null && value !== '') {
                        if (field == 'nickName'){
                            element.textContent = '用户昵称：' + decodeURIComponent(escape(atob(value)));
                        }else if(field == 'userName'){
                            element.textContent = '账号：' + value;
                        }
                    } else {
                        element.textContent = '-';
                    }
                }
            });
        }

        function updateProfile(data) {
            // 更新各项能力值
            const fields = [
                'focusedAttention', 'selectiveAttention', 'shiftingAttention', 'distributedAttention',
                'visualMemory', 'auditoryMemory', 'workingMemory',
                'inductiveReasoning', 'deductiveReasoning', 'analogicalReasoning', 
                'verbalComprehension', 'abstractReasoning', 'visualSpatialIntelligence',
                'elaborationStrategy', 'detailedProcessingStrategy', 'organizationalStrategy',
                'metacognitivePlanning', 'metacognitiveMonitoring', 'metacognitiveRegulation',
                'effortManagement', 'timeManagement', 'externalResourceUtilization',
                'growth', 'autonomy', 'interaction', 'interest', 'recognition', 'competition', 'materialReward',
                'emotionalAwareness', 'emotionalRegulation',
                'responsibility', 'seriousness', 'perseverance', 'creativity'
            ];
           
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    const fieldData = data[field];
                    if (fieldData && typeof fieldData === 'object') {
                        // 新数据格式：包含score和test_score
                        const score = fieldData.score;
                        const testScore = fieldData.test_score;
                        if (score !== undefined && score !== null && score !== '' && score !== '0' && score !== 0) {
                            if(score !== testScore){
                                element.innerHTML = `${score}<span style="color: #888; font-size: 0.9em;">(${testScore})</span>`;
                            }else{
                                element.textContent = `${score}`;
                            }
                            element.classList.remove('empty');
                            
                            // 更新emoji图标
                            updateEmojiForAbility(field, Number(score));
                        } else {
                            element.textContent = '-';
                            element.classList.add('empty');
                            
                            // 清空emoji
                            updateEmojiForAbility(field, null);
                        }
                    } else {
                        // 兼容旧数据格式
                        const value = fieldData;
                        if (value !== undefined && value !== null && value !== '' && value !== '0' && value !== 0) {
                            element.textContent = value;
                            element.classList.remove('empty');
                            
                            // 更新emoji图标
                            updateEmojiForAbility(field, Number(value));
                        } else {
                            element.textContent = '-';
                            element.classList.add('empty');
                            
                            // 清空emoji
                            updateEmojiForAbility(field, null);
                        }
                    }
                }
            });
            
            // 更新雷达图
            updateRadarChart(data);
        }
        
        function updateEmojiForAbility(abilityId, score) {
              const emojiElement = document.querySelector(`#${abilityId}`).parentElement.querySelector('.ability-emoji');
              if (emojiElement) {
                  if (score === null || score === undefined) {
                      emojiElement.innerHTML = '';
                  } else if (score < 60) {
                      emojiElement.innerHTML = '<span style="color: #e74c3c; font-weight: bold; font-size: 14px;">⬇</span>'; // 红色向下箭头 - 待提升
                  } else if (score >= 60 && score < 80) {
                      emojiElement.innerHTML = '<span style="color: #f39c12; font-weight: bold; font-size: 14px;">➡</span>'; // 橙色向右箭头 - 良好
                  } else if (score >= 80) {
                      emojiElement.innerHTML = '<span style="color: #27ae60; font-weight: bold; font-size: 14px;">⬆</span>'; // 绿色向上箭头 - 优异
                  }
              }
          }
        function updateRadarChart(data) {
            if (!radarChart) return;
            
            // 计算各维度平均值
            const cognitiveAvg = calculateAverage(data, [
                'focusedAttention', 'selectiveAttention', 'shiftingAttention', 'distributedAttention',
                'visualMemory', 'auditoryMemory', 'workingMemory',
                'inductiveReasoning', 'deductiveReasoning', 'analogicalReasoning', 
                'verbalComprehension', 'abstractReasoning', 'visualSpatialIntelligence'
            ]);
            
            const strategyAvg = calculateAverage(data, [
                'elaborationStrategy', 'detailedProcessingStrategy', 'organizationalStrategy',
                'metacognitivePlanning', 'metacognitiveMonitoring', 'metacognitiveRegulation',
                'effortManagement', 'timeManagement', 'externalResourceUtilization'
            ]);
            
            const motivationAvg = calculateAverage(data, [
                'growth', 'autonomy', 'interaction', 'interest', 'recognition', 'competition', 'materialReward'
            ]);
            
            const emotionAvg = calculateAverage(data, [
                'emotionalAwareness', 'emotionalRegulation'
            ]);
            
            const qualityAvg = calculateAverage(data, [
                'responsibility', 'seriousness', 'perseverance', 'creativity'
            ]);
            
            radarChart.data.datasets[2].data = [cognitiveAvg, strategyAvg, motivationAvg, emotionAvg, qualityAvg];
            radarChart.update();
        }
        
        function calculateAverage(data, fields) {
            const validValues = fields
                .map(field => data[field])
                .filter(value => value !== undefined && value !== null && value !== '' && !isNaN(value))
                .map(value => Number(value));
            
            if (validValues.length === 0) return 0;
            return Math.round(validValues.reduce((sum, value) => sum + value, 0) / validValues.length);
        }
    </script>
</body>
</html>
