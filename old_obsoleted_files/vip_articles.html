
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业育儿咨询 - 付费阅读</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入二维码生成库 -->
    <script src="https://cdnproxy.keepwork.com/jsdelivr/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'parenting-blue': '#2563eb',
                        'parenting-green': '#059669',
                        'parenting-purple': '#7c3aed',
                        'warm-orange': '#ea580c'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
    <div class="relative z-10 container mx-auto px-4 py-8 max-w-4xl">
        <!-- 头部标题 -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                👨‍👩‍👧‍👦 付费咨询
            </h1>
            <!-- 统计信息 -->
            <div class="grid grid-cols-3 gap-4 mb-8 max-w-md mx-auto">
                <div class="bg-white/80 backdrop-blur-md rounded-xl p-4 border border-gray-200 shadow-sm">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-parenting-blue mb-1">10+</div>
                        <div class="text-gray-600 font-medium text-sm">专题文章</div>
                    </div>
                </div>
                <div class="bg-white/80 backdrop-blur-md rounded-xl p-4 border border-gray-200 shadow-sm">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-parenting-green mb-1">5000+</div>
                        <div class="text-gray-600 font-medium text-sm">家长受益</div>
                    </div>
                </div>
                <div class="bg-white/80 backdrop-blur-md rounded-xl p-4 border border-gray-200 shadow-sm">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-warm-orange mb-1">95%</div>
                        <div class="text-gray-600 font-medium text-sm">好评率</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文章列表 -->
        <div class="space-y-4 mb-8">
            <!-- 文章1 -->
            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article1">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">1</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-parenting-blue transition-colors">
                            3-6岁孩子的"为什么"阶段：如何回答让亲子关系更亲密
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            深入解析孩子好奇心背后的心理需求，提供科学有效的回应策略，让每一次"为什么"都成为增进亲子感情的机会。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：8分钟</span>
                                <span>👁️ 已购买：1,234人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-parenting-blue to-purple-500 text-white font-bold py-2 px-6 rounded-lg hover:from-purple-500 hover:to-parenting-blue transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文章2 -->
            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article2">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">2</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-parenting-green transition-colors">
                            青春期孩子不愿沟通？这5个技巧让你重新走进他们的内心
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            专业心理咨询师分享青春期沟通秘籍，帮助家长理解孩子内心世界，重建信任桥梁。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：10分钟</span>
                                <span>👁️ 已购买：2,156人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-parenting-green to-blue-500 text-white font-bold py-2 px-6 rounded-lg hover:from-blue-500 hover:to-parenting-green transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文章3 -->
            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article3">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">3</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-parenting-purple transition-colors">
                            从"吼叫式育儿"到"温和而坚定"：改变从父母的情绪管理开始
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            学会控制情绪，掌握正面管教技巧，让育儿过程更加和谐，孩子更加自信独立。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：12分钟</span>
                                <span>👁️ 已购买：3,421人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-parenting-purple to-pink-500 text-white font-bold py-2 px-6 rounded-lg hover:from-pink-500 hover:to-parenting-purple transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文章4 -->
            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article4">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">4</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-warm-orange transition-colors">
                            孩子沉迷手机游戏怎么办？聪明家长都在用这3个方法
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            数字时代育儿难题的系统解决方案，帮助孩子建立健康的数字使用习惯。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：9分钟</span>
                                <span>👁️ 已购买：1,876人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-warm-orange to-red-500 text-white font-bold py-2 px-6 rounded-lg hover:from-red-500 hover:to-warm-orange transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文章5 -->
            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article5">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">5</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-teal-600 transition-colors">
                            培养孩子自主学习能力：告别"陪写作业到崩溃"的日子
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            科学的学习习惯培养方法，让孩子主动学习，家长轻松陪伴。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：11分钟</span>
                                <span>👁️ 已购买：2,543人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:from-cyan-500 hover:to-teal-500 transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文章6-10 继续类似结构 -->
            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article6">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-pink-400 to-rose-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">6</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-pink-600 transition-colors">
                            二胎家庭如何平衡？让两个孩子都感受到爱的实用指南
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            二胎家庭的爱与平衡艺术，让每个孩子都感受到独特的爱意。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：10分钟</span>
                                <span>👁️ 已购买：1,987人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold py-2 px-6 rounded-lg hover:from-rose-500 hover:to-pink-500 transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article7">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">7</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-yellow-600 transition-colors">
                            孩子说谎不可怕，可怕的是父母不知道背后的真正原因
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            理解孩子说谎行为的心理动机，用正确方法引导诚实品格的培养。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：9分钟</span>
                                <span>👁️ 已购买：1,654人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white font-bold py-2 px-6 rounded-lg hover:from-orange-500 hover:to-yellow-500 transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article8">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">8</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-indigo-600 transition-colors">
                            从小培养孩子的财商：5个年龄段的金钱教育方案
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            分年龄段的财商教育体系，让孩子从小建立正确的金钱观念。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：13分钟</span>
                                <span>👁️ 已购买：2,234人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold py-2 px-6 rounded-lg hover:from-purple-500 hover:to-indigo-500 transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article9">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">9</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-emerald-600 transition-colors">
                            孩子内向不合群？其实你可能误解了内向型性格
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            深度解析内向性格特质，帮助内向孩子发挥自身优势，建立自信。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：8分钟</span>
                                <span>👁️ 已购买：1,543人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold py-2 px-6 rounded-lg hover:from-teal-500 hover:to-emerald-500 transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white/90 backdrop-blur-md rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer group" data-article="article10">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-violet-400 to-indigo-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg font-bold">10</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-violet-600 transition-colors">
                            忙碌父母的高质量陪伴：每天30分钟胜过3小时的无效陪伴
                        </h3>
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                            时间管理与高质量陪伴的秘诀，让有限时间发挥最大效用。
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>⏱️ 阅读时长：10分钟</span>
                                <span>👁️ 已购买：3,187人</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl font-bold text-warm-orange">¥10</span>
                                <button class="bg-gradient-to-r from-violet-500 to-indigo-500 text-white font-bold py-2 px-6 rounded-lg hover:from-indigo-500 hover:to-violet-500 transition-all duration-300 group-hover:scale-105">
                                    立即购买
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 服务保障 -->
        <div class="bg-white/80 backdrop-blur-md rounded-2xl p-6 md:p-8 border border-gray-200 shadow-sm">
            <div class="text-center mb-6">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">🛡️ 服务保障</h2>
                <p class="text-gray-600">专业内容，贴心服务</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="flex items-start space-x-3 p-4 bg-blue-50 rounded-xl border border-blue-100">
                    <div class="flex-shrink-0 w-8 h-8 bg-parenting-blue rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-bold">✓</span>
                    </div>
                    <div>
                        <h3 class="text-gray-800 font-semibold mb-1">专家原创内容</h3>
                        <p class="text-gray-600 text-sm">资深育儿专家亲自撰写，内容专业可靠</p>
                    </div>
                </div>

                <div class="flex items-start space-x-3 p-4 bg-green-50 rounded-xl border border-green-100">
                    <div class="flex-shrink-0 w-8 h-8 bg-parenting-green rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-bold">💬</span>
                    </div>
                    <div>
                        <h3 class="text-gray-800 font-semibold mb-1">专家在线答疑</h3>
                        <p class="text-gray-600 text-sm">购买后可享受专家一对一答疑服务</p>
                    </div>
                </div>

                <div class="flex items-start space-x-3 p-4 bg-purple-50 rounded-xl border border-purple-100">
                    <div class="flex-shrink-0 w-8 h-8 bg-parenting-purple rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-bold">📱</span>
                    </div>
                    <div>
                        <h3 class="text-gray-800 font-semibold mb-1">随时随地阅读</h3>
                        <p class="text-gray-600 text-sm">支持手机、平板、电脑多端同步阅读</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 二维码弹窗 -->
        <div id="qrModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center p-4">
            <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-auto">
                <div class="text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-2" id="modalTitle">扫码支付</h3>
                    <p class="text-gray-600 text-sm mb-4" id="modalSubtitle">购买文章阅读权限</p>
                    <div class="bg-gray-50 p-4 rounded-lg shadow-inner mb-4">
                        <canvas id="qrcode" class="mx-auto"></canvas>
                    </div>
                    <p class="text-gray-600 text-sm mb-6">请使用微信/支付宝扫描二维码完成支付</p>
                    <div class="space-y-3">
                        <button id="paymentCompleteBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300">
                            我已完成支付
                        </button>
                        <button id="closeModalBtn" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-2 px-4 rounded-lg transition-all duration-300">
                            取消
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部说明 -->
        <div class="text-center mt-8 text-gray-500 text-sm">
            <p>购买即表示同意《服务条款》和《隐私政策》</p>
            <p class="mt-2">如有疑问，请联系客服微信：parenting-help</p>
        </div>
    </div>

    <script>
        // 文章支付链接配置
        const articlePaymentLinks = {
            'article1': 'https://keepwork.com/p/vb/articlePayOrder?articleId=1&price=10',
            'article2': 'https://keepwork.com/p/vb/articlePayOrder?articleId=2&price=10',
            'article3': 'https://keepwork.com/p/vb/articlePayOrder?articleId=3&price=10',
            'article4': 'https://keepwork.com/p/vb/articlePayOrder?articleId=4&price=10',
            'article5': 'https://keepwork.com/p/vb/articlePayOrder?articleId=5&price=10',
            'article6': 'https://keepwork.com/p/vb/articlePayOrder?articleId=6&price=10',
            'article7': 'https://keepwork.com/p/vb/articlePayOrder?articleId=7&price=10',
            'article8': 'https://keepwork.com/p/vb/articlePayOrder?articleId=8&price=10',
            'article9': 'https://keepwork.com/p/vb/articlePayOrder?articleId=9&price=10',
            'article10': 'https://keepwork.com/p/vb/articlePayOrder?articleId=10&price=10'
        };

        // 文章标题映射
        const articleTitles = {
            'article1': '3-6岁孩子的"为什么"阶段：如何回答让亲子关系更亲密',
            'article2': '青春期孩子不愿沟通？这5个技巧让你重新走进他们的内心',
            'article3': '从"吼叫式育儿"到"温和而坚定"：改变从父母的情绪管理开始',
            'article4': '孩子沉迷手机游戏怎么办？聪明家长都在用这3个方法',
            'article5': '培养孩子自主学习能力：告别"陪写作业到崩溃"的日子',
            'article6': '二胎家庭如何平衡？让两个孩子都感受到爱的实用指南',
            'article7': '孩子说谎不可怕，可怕的是父母不知道背后的真正原因',
            'article8': '从小培养孩子的财商：5个年龄段的金钱教育方案',
            'article9': '孩子内向不合群？其实你可能误解了内向型性格',
            'article10': '忙碌父母的高质量陪伴：每天30分钟胜过3小时的无效陪伴'
        };

        let currentArticle = '';

        // 检测是否为微信浏览器
        function isWeChatBrowser() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.includes('micromessenger');
        }

        // 生成二维码
        function generateQRCode(url) {
            const canvas = document.getElementById('qrcode');
            
            // 清空画布
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 使用qrcode@1.5.1的API
            QRCode.toCanvas(canvas, url, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                },
                errorCorrectionLevel: 'M'
            }, function (error) {
                if (error) {
                    console.error('二维码生成失败:', error);
                    // 显示错误提示
                    ctx.fillStyle = '#ff0000';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('二维码生成失败', canvas.width/2, canvas.height/2);
                } else {
                    console.log('二维码生成成功');
                }
            });
        }

        // 显示二维码弹窗
        function showQRModal(url, articleId) {
            currentArticle = articleId;
            const title = articleTitles[articleId];
            document.getElementById('modalTitle').textContent = '购买文章阅读权限';
            document.getElementById('modalSubtitle').textContent = `《${title.substring(0, 30)}...》- ¥10`;
            
            generateQRCode(url);
            document.getElementById('qrModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 隐藏二维码弹窗
        function hideQRModal() {
            document.getElementById('qrModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            currentArticle = '';
        }

        // 支付完成回调
        function onPaymentComplete() {
            hideQRModal();
            
            // 向父窗口发送消息
            window.parent.postMessage({ 
                type: 'articlePayResult', 
                articleId: currentArticle,
                success: true 
            }, '*');
            
            // 显示成功提示（可选）
            // alert('支付完成！您现在可以阅读这篇文章了。');
        }

        function initializePage() {
            // 为所有文章卡片添加点击事件
            document.querySelectorAll('[data-article]').forEach(card => {
                const button = card.querySelector('button');
                if (button) {
                    button.addEventListener('click', async function(e) {
                        e.stopPropagation();
                        
                        const articleId = card.getAttribute('data-article');
                        let paymentUrl = articlePaymentLinks[articleId];
                        
                        if (paymentUrl) {
                            // 尝试获取用户信息
                            let userId = null;
                            try {
                                // 从父窗口URL获取参数
                                const parentUrl = window.parent.location.href;
                                const urlParams = new URLSearchParams(new URL(parentUrl).search);
                                userId = urlParams.get('userId');
                            } catch (e) {
                                // 如果无法访问父窗口URL，尝试从当前窗口URL获取
                                const urlParams = new URLSearchParams(window.location.search);
                                userId = urlParams.get('userId');
                            }
                            
                            if (!userId) {
                                // 尝试从父窗口获取cookie中的userName
                                let userName = null;
                                try {
                                    const parentCookies = window.parent.document.cookie;
                                    const userNameMatch = parentCookies.match(/userName=([^;]+)/);
                                    if (userNameMatch) {
                                        userName = decodeURIComponent(userNameMatch[1]);
                                    }
                                } catch (e) {
                                    // 如果无法访问父窗口cookie，尝试从当前窗口cookie获取
                                    const currentCookies = document.cookie;
                                    const userNameMatch = currentCookies.match(/userName=([^;]+)/);
                                    if (userNameMatch) {
                                        userName = decodeURIComponent(userNameMatch[1]);
                                    }
                                }

                                if (!userName) {
                                    console.log('用户信息获取失败，请重新登录后再试。');
                                    return;
                                }

                                try {
                                    const encodedUserId = btoa(JSON.stringify({ username: userName }));
                                    const response = await fetch(`https://api.keepwork.com/core/v0/users/kp${encodedUserId}/detail`, {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        }
                                    });
                                    const data = await response.json();
                                    userId = data.id;
                                } catch (error) {
                                    console.error('API调用失败:', error);
                                    return;
                                }
                            }

                            if (!userId) {
                                console.log('用户信息获取失败，请重新登录后再试。');
                                return;
                            }

                            // 将userId拼接到支付URL
                            const urlObj = new URL(paymentUrl);
                            urlObj.searchParams.set('userId', userId);
                            paymentUrl = urlObj.toString();
                            
                            console.log('支付链接:', paymentUrl);
                            
                            if (isWeChatBrowser()) {
                                // 微信浏览器直接跳转
                                window.parent.location.href = paymentUrl;
                            } else {
                                // 其他浏览器显示二维码弹窗
                                showQRModal(paymentUrl, articleId);
                            }
                        } else {
                            console.log('支付链接配置错误，请联系客服');
                        }
                    });
                }
            });

            // 绑定弹窗按钮事件
            document.getElementById('paymentCompleteBtn').addEventListener('click', onPaymentComplete);
            document.getElementById('closeModalBtn').addEventListener('click', hideQRModal);
            
            // 点击弹窗背景关闭
            document.getElementById('qrModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideQRModal();
                }
            });
        }

        // 添加卡片悬停效果
        document.querySelectorAll('.group').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // 页面加载完成后初始化
        initializePage();
    </script>
</body>
</html>
