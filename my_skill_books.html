<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆé•¿æ‰‹å†Œ</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 10px;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: 
                "PingFang SC", "PingFang TC",
                "-apple-system", "BlinkMacSystemFont", "SF Pro Text", "SF Pro Display",
                "Noto Sans SC", "Noto Sans CJK SC",
                "Roboto",
                "Helvetica Neue", "Arial", "Microsoft YaHei", "å¾®è½¯é›…é»‘",
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        .book-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .book-card:hover {
            transform: translateY(-0.8rem);
            box-shadow: 0 1.2rem 2.4rem rgba(0, 0, 0, 0.15);
        }

        .book-icon {
            font-size: 4.8rem;
            margin-bottom: 1.5rem;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(3rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-md" style="padding: 1rem 2rem;">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center" style="gap: 1rem;">
                    <h1 style="font-size: 2.6rem; font-weight: 700;" class="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        æˆé•¿æ‰‹å†Œ
                    </h1>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1" style="padding: 3rem 3rem;">
            <div class="max-w-7xl mx-auto">
                <div id="booksContainer" class="grid grid-cols-3" style="gap: 2.4rem;">
                    <!-- Books will be generated dynamically -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // Books configuration
        const booksConfig = [
            {
                id: 'home',
                icon: 'ğŸ¡',
                title: 'å®¶å›­æ‰‹å†Œ',
                description: 'å­¦ä¹ å»ºè®¾å’Œç®¡ç†ä½ çš„å®¶å›­',
                gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                textColor: 'text-white',
                descColor: 'text-white',
                url: 'my_skill_book_homeland' 
            },
            {
                id: 'planting',
                icon: 'ğŸŒ±',
                title: 'ç§æ¤æ‰‹å†Œ',
                description: 'äº†è§£å†œä½œç‰©çš„ç§æ¤æŠ€å·§',
                gradient: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                textColor: 'text-white',
                descColor: 'text-white',
                url: '' // æ²¡æœ‰é…ç½®åˆ™æ˜¾ç¤º"æ•¬è¯·æœŸå¾…"
            },
            {
                id: 'fishing',
                icon: 'ğŸ£',
                title: 'æ•é±¼æ‰‹å†Œ',
                description: 'æ¢ç´¢é’“é±¼çš„ä¹è¶£ä¸æŠ€å·§',
                gradient: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                textColor: 'text-white',
                descColor: 'text-white',
                url: '' // æ²¡æœ‰é…ç½®åˆ™æ˜¾ç¤º"æ•¬è¯·æœŸå¾…"
            },
            {
                id: 'cooking',
                icon: 'ğŸ‘¨â€ğŸ³',
                title: 'çƒ¹é¥ªæ‰‹å†Œ',
                description: 'æŒæ¡å„ç§ç¾å‘³æ–™ç†çš„åˆ¶ä½œ',
                gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                textColor: 'text-white',
                descColor: 'text-white',
                url: '' // æ²¡æœ‰é…ç½®åˆ™æ˜¾ç¤º"æ•¬è¯·æœŸå¾…"
            },
            {
                id: 'dragon_wiki',
                icon: 'ğŸ“–',
                title: 'æŠ±æŠ±é¾™ç™¾ç§‘æ‰‹å†Œ',
                description: 'å’ŒæŠ±æŠ±é¾™ä¸€èµ·äº†è§£ä¸‡ç‰©è¿è½¬çš„ç§˜å¯†',
                gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                textColor: 'text-white',
                descColor: 'text-white',
                url: 'wiki_dashboard'
            },
            {
                id: 'animation',
                icon: 'ğŸ’»',
                title: 'åŠ¨ç”»ä¸ç¼–ç¨‹æ‰‹å†Œ',
                description: 'å­¦ä¹ åˆ›ä½œåŠ¨ç”»å’Œç¼–ç¨‹',
                gradient: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                textColor: 'text-gray-800',
                descColor: 'text-gray-700',
                url: 'paracraft_tips'
            }
        ];

        // Generate books from config
        function generateBooks() {
            const container = document.getElementById('booksContainer');
            
            booksConfig.forEach((book, index) => {
                const bookCard = document.createElement('div');
                bookCard.className = `book-card shadow-lg flex flex-col items-center justify-center animate-fade-in-up ${book.textColor}`;
                bookCard.style.cssText = `border-radius: 2rem; padding: 3rem 2rem; animation-delay: ${(index + 1) * 0.1}s; background: ${book.gradient}; position: relative;`;
                bookCard.onclick = () => openBook(book);
                
                bookCard.innerHTML = `
                    <div class="book-icon" style="text-shadow: 0 0.2rem 0.4rem rgba(0, 0, 0, 0.2);">${book.icon}</div>
                    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 1rem; text-shadow: 0 0.2rem 0.4rem rgba(0, 0, 0, 0.3);" class="${book.textColor}">${book.title}</h2>
                    <p style="font-size: 1.4rem; text-shadow: 0 0.1rem 0.3rem rgba(0, 0, 0, 0.2);" class="${book.descColor} text-center opacity-90">${book.description}</p>
                    ${!book.url ? '<div style="position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.9); color: #666; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 1.2rem; font-weight: 600;">æ•¬è¯·æœŸå¾…</div>' : ''}
                `;
                
                container.appendChild(bookCard);
            });
        }

        // Auto font-size scaling function
        function adjustRootFontSize() {
            // æ¸¸æˆä¸»å®¹å™¨çš„è®¾è®¡å°ºå¯¸
            const DESIGN_WIDTH = 800;
            const DESIGN_HEIGHT = 600;
            
            // è·å–è§†å£å°ºå¯¸
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            // è®¡ç®—åŸºäºå®½åº¦å’Œé«˜åº¦çš„ç¼©æ”¾æ¯”ä¾‹
            const scaleByWidth = viewportWidth / DESIGN_WIDTH;
            const scaleByHeight = viewportHeight / DESIGN_HEIGHT;
            
            // å–è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œç¡®ä¿å†…å®¹å®Œå…¨å¯è§ï¼ˆç­‰æ¯”ä¾‹ç¼©æ”¾ï¼‰
            const scale = Math.min(scaleByWidth, scaleByHeight);
            
            // è®¾ç½®æ ¹å…ƒç´ çš„ font-size
            // å‡è®¾è®¾è®¡ç¨¿åŸºå‡†æ˜¯ 1rem = 10pxï¼Œåˆ™è°ƒæ•´åçš„ font-size = 10 * scale
            const baseFontSize = 10; // è®¾è®¡ç¨¿åŸºå‡†
            const finalFontSize = baseFontSize * scale;
            
            document.documentElement.style.fontSize = `${finalFontSize}px`;
        }

        // åˆå§‹è°ƒæ•´
        adjustRootFontSize();

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', adjustRootFontSize);

        // Generate books on page load
        generateBooks();

        // Send gameLoaded message to parent
        window.parent.postMessage({ type: 'gameLoaded' }, '*');

        function openBook(book) {
            console.log('Opening book:', book.id);
            
            // å¦‚æœæ²¡æœ‰é…ç½®URLï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ˜¾ç¤º"æ•¬è¯·æœŸå¾…"ï¼‰
            if (!book.url) {
                console.log('Book URL not configured yet');
                return;
            }
            
            // è·å–å½“å‰é¡µé¢çš„æ‰€æœ‰URLå‚æ•°
            const currentParams = new URLSearchParams(window.location.search);
            
            let targetUrl;
            
            // åˆ¤æ–­URLæ˜¯å¦ä»¥https://å¼€å¤´
            if (book.url.startsWith('https://') || book.url.startsWith('http://')) {
                // ç»å¯¹URLï¼šç›´æ¥ä½¿ç”¨
                targetUrl = new URL(book.url);
            } else {
                // ç›¸å¯¹URLï¼šæ›¿æ¢å½“å‰é¡µé¢çš„æ–‡ä»¶å
                const currentUrl = new URL(window.location.href);
                const currentPath = currentUrl.pathname;
                
                // è·å–å½“å‰æ–‡ä»¶åå’Œæ‰©å±•å
                const pathParts = currentPath.split('/');
                const currentFile = pathParts[pathParts.length - 1];
                const dotIndex = currentFile.lastIndexOf('.');
                
                let newFileName;
                if (dotIndex > 0) {
                    // å½“å‰æ–‡ä»¶æœ‰æ‰©å±•åï¼ˆå¦‚ books.htmlï¼‰
                    const extension = currentFile.substring(dotIndex); // åŒ…å«ç‚¹å·ï¼Œå¦‚ .html
                    // æ£€æŸ¥book.urlæ˜¯å¦å·²ç»æœ‰æ‰©å±•å
                    if (book.url.includes('.')) {
                        newFileName = book.url;
                    } else {
                        newFileName = book.url + extension;
                    }
                } else {
                    // å½“å‰æ–‡ä»¶æ²¡æœ‰æ‰©å±•åï¼ˆå¦‚ booksï¼‰
                    newFileName = book.url;
                }
                
                // æ›¿æ¢æ–‡ä»¶å
                pathParts[pathParts.length - 1] = newFileName;
                currentUrl.pathname = pathParts.join('/');
                targetUrl = currentUrl;
            }
            
            // æ·»åŠ æ‰€æœ‰å½“å‰URLå‚æ•°
            currentParams.forEach((value, key) => {
                targetUrl.searchParams.set(key, value);
            });
            
            // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
            window.parent.postMessage({ 
                type: 'bookSelected', 
                data: { 
                    bookType: book.id,
                    url: targetUrl.toString()
                } 
            }, '*');
            
            // ç›´æ¥è·³è½¬åˆ°ç›®æ ‡URL
            window.location.href = targetUrl.toString();
        }

        // Listen for messages from parent
        window.addEventListener('message', function(e) {
            if (e.data.type === 'setGameConfig') {
                console.log('Received config:', e.data.data);
            }
        });
    </script>
</body>
</html>
