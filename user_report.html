<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ„è§åé¦ˆä¸­å¿ƒ</title>
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <script src="https://cdn.keepwork.com/sdk/keepworkSDK.iife.js?v=1.0.3"></script>
    <style>
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block !important;
      }
      .tab-button {
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
      }
      .tab-button.active {
        background-color: #3b82f6 !important;
        color: white !important;
        border-bottom-color: #1d4ed8 !important;
      }
      .tab-button:hover:not(.active) {
        background-color: #f3f4f6;
        color: #3b82f6;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto p-4">
      <!-- Tab Navigation -->
      <div class="bg-white rounded-lg shadow-sm mb-6">        <div class="flex border-b">
          <button id="tab-content" class="tab-button flex-1 py-4 px-6 text-center font-medium text-gray-600" onclick="showTab('content')">
            <span class="block text-lg mb-1">ğŸ“¢</span>
            å†…å®¹ä¸¾æŠ¥
          </button>
          <button id="tab-bug" class="tab-button flex-1 py-4 px-6 text-center font-medium text-gray-600" onclick="showTab('bug')">
            <span class="block text-lg mb-1">ğŸ›</span>
            BUGæ±‡æŠ¥
          </button>
          <button id="tab-feedback" class="tab-button flex-1 py-4 px-6 text-center font-medium text-gray-600" onclick="showTab('feedback')">
            <span class="block text-lg mb-1">ğŸ’¡</span>
            ç”¨æˆ·æ„è§
          </button>
          <button id="tab-report-history" class="tab-button flex-1 py-4 px-6 text-center font-medium text-gray-600" onclick="showTab('report-history')">
            <span class="block text-lg mb-1">ğŸ“‹</span>
            æäº¤å†å²
          </button>
        </div>
      </div>      <!-- Tab Contents -->
      <div class="bg-white rounded-lg shadow-sm p-6">
        <!-- å†…å®¹ä¸¾æŠ¥ Tab -->
        <div id="content" class="tab-content">
          <form id="content-form" class="space-y-6" onsubmit="submitForm(event, 'content')">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ä¸¾æŠ¥ç±»å‹ *</label>
              <select name="report-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">è¯·é€‰æ‹©ä¸¾æŠ¥ç±»å‹</option>
                <option value="ai-content">AIç”Ÿæˆå†…å®¹</option>
                <option value="product-content">äº§å“å†…å®¹</option>
                <option value="online-player">åœ¨çº¿ç©å®¶</option>
                <option value="inappropriate-content">ä¸å½“å†…å®¹</option>
                <option value="spam">åƒåœ¾ä¿¡æ¯</option>
                <option value="copyright">ç‰ˆæƒä¾µçŠ¯</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰</label>
              <input name="user-id" type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="è¯·è¾“å…¥ç›¸å…³ç”¨æˆ·ID" />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ä¸¾æŠ¥å†…å®¹ *</label>
              <textarea
                name="report-content"
                rows="6"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="è¯·è¯¦ç»†æè¿°ä¸¾æŠ¥å†…å®¹ï¼ŒåŒ…æ‹¬å…·ä½“çš„è¿è§„è¡Œä¸ºã€æ—¶é—´ã€åœ°ç‚¹ç­‰ä¿¡æ¯"
                required
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">è”ç³»æ–¹å¼ï¼ˆå¯é€‰ï¼‰</label>
              <input
                name="contact"
                type="text"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="é‚®ç®±æˆ–æ‰‹æœºå·ï¼Œæ–¹ä¾¿æˆ‘ä»¬è”ç³»æ‚¨"
              />
            </div>

            <button type="submit" class="w-full bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition-colors font-medium">æäº¤ä¸¾æŠ¥</button>
          </form>
        </div>        <!-- BUGæ±‡æŠ¥ Tab -->
        <div id="bug" class="tab-content">
          <form id="bug-form" class="space-y-6" onsubmit="submitForm(event, 'bug')">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">BUGç±»å‹ *</label>
              <select name="bug-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">è¯·é€‰æ‹©BUGç±»å‹</option>
                <option value="functional">åŠŸèƒ½å¼‚å¸¸</option>
                <option value="ui">ç•Œé¢æ˜¾ç¤ºé—®é¢˜</option>
                <option value="performance">æ€§èƒ½é—®é¢˜</option>
                <option value="compatibility">å…¼å®¹æ€§é—®é¢˜</option>
                <option value="crash">ç¨‹åºå´©æºƒ</option>
                <option value="data">æ•°æ®é”™è¯¯</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ä¸¥é‡ç¨‹åº¦ *</label>
              <div class="flex gap-4">
                <label class="flex items-center">
                  <input type="radio" name="severity" value="low" class="mr-2" required />
                  <span class="text-green-600">è½»å¾®</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="severity" value="medium" class="mr-2" />
                  <span class="text-yellow-600">ä¸€èˆ¬</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="severity" value="high" class="mr-2" />
                  <span class="text-orange-600">ä¸¥é‡</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="severity" value="critical" class="mr-2" />
                  <span class="text-red-600">ç´§æ€¥</span>
                </label>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">è®¾å¤‡ä¿¡æ¯</label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input name="os" type="text" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="æ“ä½œç³»ç»Ÿ (å¦‚: iOS 15.0)" />
                <input name="device" type="text" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="è®¾å¤‡å‹å· (å¦‚: iPhone 13)" />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">BUGæè¿° *</label>
              <textarea
                name="bug-description"
                rows="6"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="è¯·è¯¦ç»†æè¿°BUGçš„å…·ä½“è¡¨ç°ã€å¤ç°æ­¥éª¤ã€é¢„æœŸç»“æœå’Œå®é™…ç»“æœ"
                required
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">å¤ç°æ­¥éª¤</label>
              <textarea
                name="reproduce-steps"
                rows="4"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="1. æ‰“å¼€åº”ç”¨&#10;2. ç‚¹å‡»æŸä¸ªæŒ‰é’®&#10;3. å‘ç”Ÿé”™è¯¯&#10;è¯·æŒ‰æ­¥éª¤è¯¦ç»†è¯´æ˜"
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">è”ç³»é‚®ç®±</label>
              <input name="email" type="email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="your@email.com" />
            </div>

            <button type="submit" class="w-full bg-orange-600 text-white py-3 px-6 rounded-lg hover:bg-orange-700 transition-colors font-medium">æäº¤BUGæŠ¥å‘Š</button>
          </form>
        </div>

        <!-- ç”¨æˆ·æ„è§ Tab -->
        <div id="feedback" class="tab-content">
          <form id="feedback-form" class="space-y-6" onsubmit="submitForm(event, 'feedback')">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">æ„è§ç±»å‹ *</label>
              <select name="feedback-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">è¯·é€‰æ‹©æ„è§ç±»å‹</option>
                <option value="feature-request">åŠŸèƒ½å»ºè®®</option>
                <option value="improvement">æ”¹è¿›å»ºè®®</option>
                <option value="complaint">æŠ•è¯‰</option>
                <option value="compliment">è¡¨æ‰¬</option>
                <option value="question">å’¨è¯¢</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">å…·ä½“æ„è§ *</label>
              <textarea
                name="feedback-content"
                rows="6"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„æ„è§æˆ–å»ºè®®ï¼Œæˆ‘ä»¬ä¼šè®¤çœŸè€ƒè™‘æ‚¨çš„æ¯ä¸€æ¡åé¦ˆ"
                required
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ä½¿ç”¨é¢‘ç‡</label>
              <select name="usage-frequency" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">è¯·é€‰æ‹©ä½¿ç”¨é¢‘ç‡</option>
                <option value="daily">æ¯å¤©</option>
                <option value="weekly">æ¯å‘¨</option>
                <option value="monthly">æ¯æœˆ</option>
                <option value="rarely">å¶å°”</option>
                <option value="first-time">ç¬¬ä¸€æ¬¡ä½¿ç”¨</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">è”ç³»æ–¹å¼ï¼ˆå¯é€‰ï¼‰</label>
              <input
                name="contact-info"
                type="text"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="å¦‚éœ€å›å¤ï¼Œè¯·ç•™ä¸‹é‚®ç®±æˆ–æ‰‹æœºå·"
              />
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium">æäº¤æ„è§</button>
          </form>
        </div>

        <!-- æäº¤å†å² Tab -->
        <div id="report-history" class="tab-content">
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-semibold text-gray-900">æäº¤å†å²</h3>
              <button onclick="loadReportHistory()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">åˆ·æ–°</button>
            </div>
            <div id="report-history-content" class="space-y-4">
              <div class="text-center text-gray-500 py-8">æ­£åœ¨åŠ è½½å†å²è®°å½•...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div id="success-message" class="hidden bg-green-50 border border-green-200 rounded-lg p-4 mt-6">
        <div class="flex items-center">
          <span class="text-green-600 mr-2">âœ…</span>
          <p class="text-green-800">æäº¤æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†æ‚¨çš„åé¦ˆï¼Œæ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼</p>
        </div>
      </div>
    </div>
    <script>
      // Initialize SDK
      const sdk = new KeepworkSDK({
        timeout: 30000,
      });      // å…¨å±€å˜é‡
      let currentTab = "content"; // Tabåˆ‡æ¢å‡½æ•°
      function showTab(tabName) {
        console.log("Switching to tab:", tabName);

        // éšè—æ‰€æœ‰tabå†…å®¹
        const allTabs = ["content", "bug", "feedback", "report-history"];
        allTabs.forEach((tab) => {
          const tabElement = document.getElementById(tab);
          const tabButton = document.getElementById("tab-" + tab);

          if (tabElement) {
            tabElement.classList.remove("active");
            tabElement.style.display = "none";
          }
          if (tabButton) {
            tabButton.classList.remove("active");
          }
        });

        // æ˜¾ç¤ºé€‰ä¸­çš„tab
        const activeTab = document.getElementById(tabName);
        const activeButton = document.getElementById("tab-" + tabName);

        if (activeTab) {
          activeTab.classList.add("active");
          activeTab.style.display = "block";
        }
        if (activeButton) {
          activeButton.classList.add("active");
        }

        // æ›´æ–°å½“å‰tab
        currentTab = tabName;

        // å¦‚æœåˆ‡æ¢åˆ°å†å²è®°å½•é¡µé¢ï¼Œåˆ™åŠ è½½æ•°æ®
        if (tabName === "report-history") {
          loadReportHistory();
        }

        // æ›´æ–°URLå‚æ•°
        const url = new URL(window.location);
        url.searchParams.set("tab", tabName);
        window.history.replaceState({}, "", url);

        console.log("Tab switched successfully to:", tabName);
      }

      // ç”Ÿæˆäººç±»å¯è¯»çš„æäº¤æ–‡æœ¬
      function generateReadableText(formData, formType) {
        const now = new Date();
        const timestamp = now.toLocaleString("zh-CN");        let text = "";

        if (formType === "content") {
          const typeMap = {
            "ai-content": "AIç”Ÿæˆå†…å®¹",
            "product-content": "äº§å“å†…å®¹",
            "online-player": "åœ¨çº¿ç©å®¶",
            "inappropriate-content": "ä¸å½“å†…å®¹",
            spam: "åƒåœ¾ä¿¡æ¯",
            copyright: "ç‰ˆæƒä¾µçŠ¯",
            other: "å…¶ä»–",
          };

          text =
            `ã€å†…å®¹ä¸¾æŠ¥ã€‘\n` +
            `æäº¤æ—¶é—´: ${timestamp}\n` +
            `ä¸¾æŠ¥ç±»å‹: ${typeMap[formData.get("report-type")] || formData.get("report-type")}\n` +
            `ç”¨æˆ·ID: ${formData.get("user-id") || "æœªæä¾›"}\n` +
            `ä¸¾æŠ¥å†…å®¹: ${formData.get("report-content")}\n` +
            `è”ç³»æ–¹å¼: ${formData.get("contact") || "æœªæä¾›"}\n`;
        } else if (formType === "bug") {
          const bugTypeMap = {
            functional: "åŠŸèƒ½å¼‚å¸¸",
            ui: "ç•Œé¢æ˜¾ç¤ºé—®é¢˜",
            performance: "æ€§èƒ½é—®é¢˜",
            compatibility: "å…¼å®¹æ€§é—®é¢˜",
            crash: "ç¨‹åºå´©æºƒ",
            data: "æ•°æ®é”™è¯¯",
            other: "å…¶ä»–",
          };

          const severityMap = {
            low: "è½»å¾®",
            medium: "ä¸€èˆ¬",
            high: "ä¸¥é‡",
            critical: "ç´§æ€¥",
          };

          text =
            `ã€BUGæ±‡æŠ¥ã€‘\n` +
            `æäº¤æ—¶é—´: ${timestamp}\n` +
            `BUGç±»å‹: ${bugTypeMap[formData.get("bug-type")] || formData.get("bug-type")}\n` +
            `ä¸¥é‡ç¨‹åº¦: ${severityMap[formData.get("severity")] || formData.get("severity")}\n` +
            `æ“ä½œç³»ç»Ÿ: ${formData.get("os") || "æœªæä¾›"}\n` +
            `è®¾å¤‡å‹å·: ${formData.get("device") || "æœªæä¾›"}\n` +
            `BUGæè¿°: ${formData.get("bug-description")}\n` +
            `å¤ç°æ­¥éª¤: ${formData.get("reproduce-steps") || "æœªæä¾›"}\n` +
            `è”ç³»é‚®ç®±: ${formData.get("email") || "æœªæä¾›"}\n`;
        } else if (formType === "feedback") {
          const feedbackTypeMap = {
            "feature-request": "åŠŸèƒ½å»ºè®®",
            improvement: "æ”¹è¿›å»ºè®®",
            compliment: "è¡¨æ‰¬",
            complaint: "æŠ•è¯‰",
            question: "å’¨è¯¢",
            other: "å…¶ä»–",
          };

          const frequencyMap = {
            daily: "æ¯å¤©",
            weekly: "æ¯å‘¨",
            monthly: "æ¯æœˆ",
            rarely: "å¶å°”",
            "first-time": "ç¬¬ä¸€æ¬¡ä½¿ç”¨",
          };

          text =
            `ã€ç”¨æˆ·æ„è§ã€‘\n` +
            `æäº¤æ—¶é—´: ${timestamp}\n` +
            `æ„è§ç±»å‹: ${feedbackTypeMap[formData.get("feedback-type")] || formData.get("feedback-type")}\n` +
            `å…·ä½“æ„è§: ${formData.get("feedback-content")}\n` +
            `ä½¿ç”¨é¢‘ç‡: ${frequencyMap[formData.get("usage-frequency")] || formData.get("usage-frequency") || "æœªæä¾›"}\n` +
            `è”ç³»æ–¹å¼: ${formData.get("contact-info") || "æœªæä¾›"}\n`;
        }

        return text;
      } // è¡¨å•æäº¤å‡½æ•°
      async function submitForm(event, formType) {
        event.preventDefault();

        // æ”¶é›†è¡¨å•æ•°æ®
        const formData = new FormData(event.target);

        // ç”Ÿæˆäººç±»å¯è¯»æ–‡æœ¬
        const readableText = generateReadableText(formData, formType);

        // åœ¨æ§åˆ¶å°è¾“å‡º
        console.log("=== æäº¤å†…å®¹ ===");
        console.log(readableText);

        try {
          // ç”Ÿæˆå­˜å‚¨é”®ï¼ˆæŠ¥å‘Šç±»å‹ + æ—¥æœŸï¼‰
          const now = new Date();
          const dateStr = now.toISOString().split("T")[0].replace(/-/g, ""); // YYYYMMDDæ ¼å¼
          const timeStr = now.toTimeString().split(" ")[0].replace(/:/g, ""); // HHMMSSæ ¼å¼
          const storageKey = `reports.${formType}-${dateStr}`;

          // ä¿å­˜åˆ°SDK personalPageStore
          await sdk.personalPageStore.savePageData("maisi_user_report", storageKey, readableText, true);

          console.log(`æŠ¥å‘Šå·²ä¿å­˜åˆ°: maisi_user_report/${storageKey}`);
          console.log("=== æäº¤å®Œæˆ ===");

          // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
          const successMessage = document.getElementById("success-message");
          successMessage.classList.remove("hidden");

          // æ»šåŠ¨åˆ°æˆåŠŸæ¶ˆæ¯
          successMessage.scrollIntoView({ behavior: "smooth" });          // é‡ç½®è¡¨å•
          event.target.reset();

          // æ ¹æ®APIæ–‡æ¡£æ ¼å¼åŒ–è¯·æ±‚å‚æ•°
          const feedbackData = {
            source: 0, // 0: keepwork
            objectType: 10, // 10: æ¶ˆæ¯
            type: 0, // 0: å…¶å®ƒï¼ˆé»˜è®¤å€¼ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´ï¼‰
            content: {
              formType: formType,
              readableText: readableText,
              timestamp: new Date().toISOString()
            },
            description: readableText.split('\n').slice(0, 2).join(' ') // ä½¿ç”¨å‰ä¸¤è¡Œä½œä¸ºç®€è¦è¯´æ˜
          };

          await sdk.post("/feedbacks", feedbackData);

          // 3ç§’åéšè—æˆåŠŸæ¶ˆæ¯
          setTimeout(() => {
            successMessage.classList.add("hidden");
          }, 3000);
        } catch (error) {
          console.error("ä¿å­˜æŠ¥å‘Šå¤±è´¥:", error);
        }
      } // åŠ è½½æäº¤å†å²
      async function loadReportHistory() {
        const historyContent = document.getElementById("report-history-content");

        try {
          historyContent.innerHTML = '<div class="text-center text-gray-500 py-8">æ­£åœ¨åŠ è½½å†å²è®°å½•...</div>';          // è·å–æ‰€æœ‰ä¿å­˜çš„æŠ¥å‘Šæ•°æ® - ä½¿ç”¨loadPageDataè€Œä¸æ˜¯loadAllPageData
          const allDataRaw = await sdk.personalPageStore.loadPageData("maisi_user_report", "reports");
          console.log("Raw data loaded:", allDataRaw);

          let allData = {};
          if (allDataRaw && typeof allDataRaw === "object") {
            allData = allDataRaw;
          } else {
            // å¦‚æœæ²¡æœ‰æ•°æ®æˆ–æ ¼å¼ä¸æ­£ç¡®ï¼Œå°è¯•æ„å»ºæ•°æ®ç»“æ„
            console.log("No existing data structure found, creating empty structure");
          }

          console.log("Processed data:", allData);
          console.log("Data keys:", Object.keys(allData));

          if (!allData || Object.keys(allData).length === 0) {
            historyContent.innerHTML = '<div class="text-center text-gray-500 py-8">æš‚æ— æäº¤è®°å½•</div>';
            return;
          }// ç”ŸæˆHTML
          let html = "";
          Object.entries(allData).forEach(([key, content]) => {
            const reportInfo = parseReportKey(key);
            const displayTime = formatDateTime(extractTimeFromKey(key));

            html += `
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-medium px-2 py-1 rounded-full ${getTypeColor(reportInfo.type)}">
                                        ${getTypeLabel(reportInfo.type)}
                                    </span>
                                    <span class="text-sm text-gray-500">${displayTime}</span>
                                </div>
                                <button onclick="deleteReport('${key}')" class="text-red-500 hover:text-red-700 text-sm">
                                    åˆ é™¤
                                </button>
                            </div>
                            <pre class="text-sm text-gray-700 whitespace-pre-wrap font-mono bg-white p-3 rounded border">${content}</pre>
                        </div>
                    `;
          });

          historyContent.innerHTML = html;
        } catch (error) {
          console.error("åŠ è½½å†å²è®°å½•å¤±è´¥:", error);
          historyContent.innerHTML = '<div class="text-center text-red-500 py-8">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
        }
      } // åˆ é™¤æŠ¥å‘Š
      async function deleteReport(key) {
        try {
            // ä¿å­˜æ›´æ–°åçš„æ•°æ®ç»“æ„
            await sdk.personalPageStore.deletePageData("maisi_user_report", `reports.${key}`, true);

            console.log(`å·²åˆ é™¤æŠ¥å‘Š: ${key}`);
            loadReportHistory(); // é‡æ–°åŠ è½½åˆ—è¡¨
          
        } catch (error) {
          console.error("åˆ é™¤æŠ¥å‘Šå¤±è´¥:", error);
        }
      }      // è¾…åŠ©å‡½æ•°ï¼šä»å­˜å‚¨é”®ä¸­æå–æ—¶é—´æˆ³
      function extractTimeFromKey(key) {
        console.log("Extracting time from key:", key);
        
        // Remove "reports." prefix if it exists
        const cleanKey = key.startsWith("reports.") ? key.substring(8) : key;
        console.log("Clean key:", cleanKey);
        
        const parts = cleanKey.split("-");
        console.log("Key parts:", parts);
        
        if (parts.length >= 2) {
          const dateStr = parts[1]; // YYYYMMDD
          console.log("Date string:", dateStr);
          
          if (dateStr && dateStr.length >= 8) {
            const year = parseInt(dateStr.substring(0, 4));
            const month = parseInt(dateStr.substring(4, 6)) - 1; // æœˆä»½ä»0å¼€å§‹
            const day = parseInt(dateStr.substring(6, 8));
            
            console.log("Parsed date parts:", { year, month, day });
            
            if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {
              const timestamp = new Date(year, month, day).getTime();
              console.log("Generated timestamp:", timestamp);
              return timestamp;
            }
          }
        }
        
        console.log("Failed to parse date, returning current time");
        return Date.now(); // è¿”å›å½“å‰æ—¶é—´ä½œä¸ºå¤‡ç”¨
      }

      // è¾…åŠ©å‡½æ•°ï¼šè§£æå­˜å‚¨é”®
      function parseReportKey(key) {
        console.log("Parsing report key:", key);
        
        // Remove "reports." prefix if it exists
        const cleanKey = key.startsWith("reports.") ? key.substring(8) : key;
        console.log("Clean key for parsing:", cleanKey);
        
        const parts = cleanKey.split("-");
        console.log("Parsed key parts:", parts);
        
        const result = {
          type: parts[0] || "unknown",
          date: parts[1] || "",
        };
        
        console.log("Parsed result:", result);
        return result;
      }      // è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
      function formatDateTime(timestamp) {
        if (!timestamp || timestamp === 0) {
          return "æœªçŸ¥æ—¶é—´";
        }
        
        try {
          const date = new Date(timestamp);
          if (isNaN(date.getTime())) {
            return "æ— æ•ˆæ—¥æœŸ";
          }
          
          return date.toLocaleString("zh-CN", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
        } catch (error) {
          console.error("Error formatting date:", error);
          return "æ—¥æœŸæ ¼å¼é”™è¯¯";
        }
      }// è¾…åŠ©å‡½æ•°ï¼šè·å–æŠ¥å‘Šç±»å‹é¢œè‰²
      function getTypeColor(type) {
        switch (type) {
          case "content":
            return "bg-red-100 text-red-800";
          case "bug":
            return "bg-orange-100 text-orange-800";
          case "feedback":
            return "bg-blue-100 text-blue-800";
          default:
            return "bg-gray-100 text-gray-800";
        }
      }

      // è¾…åŠ©å‡½æ•°ï¼šè·å–æŠ¥å‘Šç±»å‹æ ‡ç­¾
      function getTypeLabel(type) {
        switch (type) {
          case "content":
            return "å†…å®¹ä¸¾æŠ¥";
          case "bug":
            return "BUGæ±‡æŠ¥";
          case "feedback":
            return "ç”¨æˆ·æ„è§";
          default:
            return "æœªçŸ¥ç±»å‹";
        }
      }// é¡µé¢åˆå§‹åŒ–
      
      // ä»URLè·å–tabå‚æ•°
      const urlParams = new URLSearchParams(window.location.search);
      const tabParam = urlParams.get("tab");        // è®¾ç½®åˆå§‹tab
      const initialTab = tabParam && ["content", "bug", "feedback", "report-history"].includes(tabParam) ? tabParam : "content";

      showTab(initialTab);
    </script>
  </body>
</html>
