<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>éº¦æ€AIè®¤çŸ¥èƒ½åŠ›æµ‹è¯„</title>
    <link rel="icon" type="image/jpeg" href="https://qiniu-public.keepwork.com/paracraft-cdn-resource/Texture/Aries/Paracraft/Mod/MaiSi/maseai_icon_128x128.jpg" />
    <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 10px;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        overflow: hidden;
        font-family: 
          "PingFang SC", "PingFang TC",
          "-apple-system", "BlinkMacSystemFont", "SF Pro Text", "SF Pro Display",
          "Noto Sans SC", "Noto Sans CJK SC",
          "Roboto",
          "Helvetica Neue", "Arial", "Microsoft YaHei", "å¾®è½¯é›…é»‘",
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      .container {
        width: 100%;
        height: 100vh;
        padding: 0;
        margin: 0;
        position: relative;
      }

      /* æ¬¢è¿é¡µé¢æ ·å¼ */
      .welcome-screen {
        background: white;
        padding: 2rem 4rem;
        text-align: center;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow-y: auto;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      .welcome-content {
        width: 100%;
        padding: 0 2rem;
      }

      .welcome-title {
        font-size: 3.6rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 1.5rem;
      }

      .welcome-subtitle {
        font-size: 2rem;
        color: #666;
        margin-bottom: 2rem;
        line-height: 2.8rem;
      }

      .test-info {
        background: #f8f9fa;
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        text-align: center;
      }

      .test-info-item {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        font-size: 1.6rem;
      }

      .test-info-item:last-child {
        margin-bottom: 0;
      }

      .test-info-icon {
        width: 2.4rem;
        height: 2.4rem;
        margin-right: 1rem;
        color: #667eea;
      }

      .age-selection {
        display: flex;
        gap: 1.5rem;
        justify-content: center;
        margin-bottom: 2rem;
      }

      .age-option {
        flex: 1;
        max-width: 24rem;
        background: white;
        border: 0.3rem solid #e0e0e0;
        border-radius: 1.2rem;
        padding: 1.5rem 1.5rem;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
      }

      .age-option:hover {
        border-color: #667eea;
        transform: translateY(-0.5rem);
        box-shadow: 0 0.8rem 2rem rgba(102, 126, 234, 0.2);
      }

      .age-option.selected {
        border-color: #667eea;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        box-shadow: 0 0.4rem 1.6rem rgba(102, 126, 234, 0.3);
      }

      .age-icon {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }

      .age-label {
        font-size: 2rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 0.5rem;
      }

      .age-desc {
        font-size: 1.2rem;
        color: #666;
        line-height: 1.6rem;
      }

      .start-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 1rem;
        padding: 1.8rem 4.5rem;
        font-size: 2.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
        box-shadow: 0 0.4rem 1.2rem rgba(102, 126, 234, 0.4);
      }

      .start-btn:hover:not(:disabled) {
        transform: translateY(-0.2rem);
        box-shadow: 0 0.6rem 1.6rem rgba(102, 126, 234, 0.5);
      }

      .start-btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .start-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* æµ‹è¯„è¿›è¡Œä¸­æ ·å¼ */
      .testing-screen {
        display: none;
        width: 100%;
        height: 100vh;
        background: white;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      /* å·¦ä¾§è¿›åº¦æ¡åŒºåŸŸ - ç³–è‘«èŠ¦æ ·å¼ */
      .progress-sidebar {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 12rem;
        background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 3rem 1rem;
        box-shadow: 0.2rem 0 1rem rgba(0, 0, 0, 0.1);
        z-index: 100;
      }

      .progress-title {
        color: white;
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 2rem;
        text-align: center;
      }

      .progress-steps {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        position: relative;
        width: 100%;
        padding: 2rem 0;
      }

      /* ç³–è‘«èŠ¦çš„ç«¹ç­¾ - è¿æ¥çº¿ */
      .progress-line {
        position: absolute;
        left: 50%;
        top: 2rem;
        bottom: 2rem;
        width: 0.3rem;
        background: rgba(255, 255, 255, 0.3);
        transform: translateX(-50%);
        z-index: 1;
      }

      .progress-line-fill {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: white;
        transition: height 0.5s ease;
        height: 0%;
      }

      /* ç³–è‘«èŠ¦çš„æ¯é¢—ç³–çƒ */
      .progress-step {
        position: relative;
        z-index: 2;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }

    .progress-circle {
      width: 5rem;
      height: 5rem;
      border-radius: 50%;
      background: #d8d4e8;
      border: 0.3rem solid #c5bdd9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: #8b84a3;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-bottom: 0.5rem;
    }

    .progress-step.active .progress-circle {
      background: #f5f3fa;
      color: #667eea;
      border-color: #e8e4f3;
      transform: scale(1.1);
      box-shadow: 0 0 2rem #e0dcf0;
    }

      .progress-step.completed .progress-circle {
        background: #4caf50;
        border-color: #4caf50;
        color: white;
      }

      .progress-step.completed .progress-circle::before {
        content: "âœ“";
        font-size: 2.5rem;
      }

      .progress-label {
        font-size: 1.4rem;
        color: rgba(255, 255, 255, 0.5);
        text-align: center;
        line-height: 1.6rem;
        max-width: 9rem;
        word-break: break-word;
      }

      .progress-step.active .progress-label {
        color: white;
        font-weight: 600;
      }

      .progress-step.completed .progress-label {
        color: rgba(255, 255, 255, 0.9);
      }

      .testing-header {
        display: none; /* éšè—åŸæ¥çš„é¡¶éƒ¨header */
      }

      .progress-container {
        display: none; /* éšè—åŸæ¥çš„è¿›åº¦æ¡ */
      }

      .progress-bar-bg {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 1rem;
        height: 1rem;
        overflow: hidden;
      }

      .progress-bar {
        background: white;
        height: 100%;
        border-radius: 1rem;
        transition: width 0.5s ease;
      }

      .progress-text {
        margin-top: 1rem;
        font-size: 1.4rem;
        opacity: 0.9;
      }

      .game-container {
        position: absolute;
        left: 12rem;
        top: 0;
        right: 0;
        bottom: 0;
        background: #f8f9fa;
      }

      .game-iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .game-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        z-index: 10;
      }

      .game-overlay.hidden {
        display: none;
      }

      .game-title {
        font-size: 4.2rem;
        font-weight: 700;
        margin-bottom: 2rem;
      }

      .game-desc {
        font-size: 2.4rem;
        width: 90%;
        text-align: center;
        line-height: 3.4rem;
        margin-bottom: 3rem;
        opacity: 0.9;
      }

      .game-start-btn {
        background: #667eea;
        color: white;
        border: none;
        border-radius: 1rem;
        padding: 1.6rem 4rem;
        font-size: 2.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .game-start-btn:hover {
        background: #5568d3;
        transform: translateY(-0.2rem);
      }

      /* ç»“æœé¡µé¢æ ·å¼ */
      .result-screen {
        display: none;
        background: white;
        padding: 2rem 3rem;
        width: 100%;
        height: 100vh;
        overflow-y: auto;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      .result-title {
        font-size: 2.4rem;
        font-weight: 700;
        color: #667eea;
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .result-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 1.2rem;
        padding: 1.5rem 2rem;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .overall-score {
        font-size: 4rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }

      .score-label {
        font-size: 1.4rem;
        opacity: 0.9;
      }

      .result-main-content {
        display: flex;
        gap: 2rem;
        margin-bottom: 1.5rem;
      }

      .radar-chart-container {
        flex: 0 0 35rem;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 1rem;
      }

      .abilities-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .ability-card {
        background: #f8f9fa;
        border-radius: 0.8rem;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }

      .ability-name {
        font-size: 1.4rem;
        font-weight: 600;
        color: #333;
        min-width: 8rem;
      }

      .ability-score-compact {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        min-width: 4rem;
      }

      .ability-bar-container {
        flex: 1;
      }

      .ability-bar-bg {
        background: #e0e0e0;
        border-radius: 0.5rem;
        height: 0.6rem;
        overflow: hidden;
      }

      .ability-bar {
        height: 100%;
        border-radius: 0.5rem;
        transition: width 0.5s ease;
      }

      .recommendations {
        background: #fff8e1;
        border-left: 0.3rem solid #ffc107;
        border-radius: 0.5rem;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
      }

      .recommendations-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #f57c00;
        margin-bottom: 0.8rem;
      }

      .recommendations-list {
        list-style: none;
      }

      .recommendations-list li {
        font-size: 1.3rem;
        color: #666;
        line-height: 1.8rem;
        margin-bottom: 0.5rem;
        padding-left: 1.8rem;
        position: relative;
      }

      .recommendations-list li::before {
        content: "ğŸ’¡";
        position: absolute;
        left: 0;
        font-size: 1.2rem;
      }

      .action-buttons {
        display: flex;
        gap: 2rem;
        justify-content: center;
        margin-top: 3rem;
      }

      .btn {
        padding: 1.4rem 3rem;
        border-radius: 1rem;
        font-size: 1.6rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-secondary {
        background: white;
        color: #667eea;
        border: 0.2rem solid #667eea;
      }

      .btn:hover {
        transform: translateY(-0.2rem);
        box-shadow: 0 0.4rem 1.2rem rgba(0, 0, 0, 0.15);
      }

      .hidden {
        display: none !important;
      }

      /* åŠ è½½åŠ¨ç”» */
      .loading {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        border: 0.3rem solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Toast é€šçŸ¥æ ·å¼ */
      .toast {
        position: fixed;
        top: 2rem;
        left: 50%;
        transform: translateX(-50%) translateY(-10rem);
        background: white;
        color: #333;
        padding: 1.5rem 3rem;
        border-radius: 1rem;
        box-shadow: 0 0.4rem 1.2rem rgba(0, 0, 0, 0.15);
        font-size: 1.6rem;
        font-weight: 600;
        z-index: 10000;
        opacity: 0;
        transition: all 0.3s ease;
        pointer-events: none;
      }

      .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }

      .toast.success {
        background: #4caf50;
        color: white;
      }

      .toast.error {
        background: #f44336;
        color: white;
      }

      .toast.warning {
        background: #ff9800;
        color: white;
      }

      .toast.info {
        background: #2196f3;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container" style="max-width: none !important; width: 100% !important">
      <!-- æ¬¢è¿é¡µé¢ -->
      <div id="welcomeScreen" class="welcome-screen" style="max-width: none !important; width: 100% !important">
        <div class="welcome-content" style="max-width: none !important">
          <h1 class="welcome-title">ğŸ§  éº¦æ€AIèƒ½åŠ›æµ‹è¯„</h1>
          <p class="welcome-subtitle">ä¸“ä¸º 4-16 å²è®¾è®¡çš„è®¤çŸ¥èƒ½åŠ›è¯„ä¼°ä¸è®­ç»ƒ</p>

          <div class="test-info">
            <div class="test-info-item">
              <span><strong>è¯·é€‰æ‹©å¹´é¾„æ®µï¼š</strong>ä¸åŒå¹´é¾„æ®µæµ‹è¯„éš¾åº¦å’Œå†…å®¹ä¸åŒ</span>
            </div>
          </div>

          <div class="age-selection">
            <div class="age-option" onclick="selectAge('4-7')" id="age-4-7">
              <div class="age-label">4-7 å²</div>
            </div>
            <div class="age-option" onclick="selectAge('8-16')" id="age-8-16">
              <div class="age-label">8-16 å²</div>
            </div>
          </div>

          <div class="test-info" id="testInfoDetail" style="display: none;">
            <div class="test-info-item">
              <span class="test-info-icon">ğŸ“‹</span>
              <span><strong>æµ‹è¯„é¡¹ç›®ï¼š</strong><span id="gameCount">5</span> ä¸ªè®¤çŸ¥èƒ½åŠ›æ¸¸æˆ</span>
            </div>
            <div class="test-info-item">
              <span class="test-info-icon">â±ï¸</span>
              <span><strong>é¢„è®¡æ—¶é•¿ï¼š</strong><span id="estimatedTime">15-20</span> åˆ†é’Ÿ</span>
            </div>
            <div class="test-info-item">
              <span class="test-info-icon">ğŸ¯</span>
              <span><strong>è¯„ä¼°ç»´åº¦ï¼š</strong><span id="assessmentDimensions">è§†è§‰è®°å¿†ã€ç©ºé—´æ€ç»´ã€å·¥ä½œè®°å¿†ã€å½’çº³æ¨ç†ã€æ³¨æ„åŠ›</span></span>
            </div>
            <div class="test-info-item">
              <span class="test-info-icon">ğŸ’¡</span>
              <span><strong>æ¸©é¦¨æç¤ºï¼š</strong>è¯·åœ¨å®‰é™ç¯å¢ƒä¸‹å®Œæˆæµ‹è¯„ï¼Œç¡®ä¿æµ‹è¯„ç»“æœå‡†ç¡®</span>
            </div>
          </div>

          <button class="start-btn" onclick="startTest()" id="startTestBtn" disabled>å¼€å§‹æµ‹è¯„</button>
        </div>
      </div>

      <!-- æµ‹è¯„è¿›è¡Œä¸­ -->
      <div id="testingScreen" class="testing-screen" style="max-width: none !important; width: 100% !important">
        <!-- å·¦ä¾§è¿›åº¦æ¡ -->
        <div class="progress-sidebar">
          <div class="progress-title">æµ‹è¯„è¿›åº¦</div>
          <div class="progress-steps">
            <div class="progress-line">
              <div class="progress-line-fill" id="progressLineFill"></div>
            </div>
            <div class="progress-step" id="step0">
              <div class="progress-circle">1</div>
              <div class="progress-label">æ—‹è½¬å®«æ®¿</div>
            </div>
            <div class="progress-step" id="step1">
              <div class="progress-circle">2</div>
              <div class="progress-label">å½±å­éª‘å£«</div>
            </div>
            <div class="progress-step" id="step2">
              <div class="progress-circle">3</div>
              <div class="progress-label">è„‘åŠ›åŒè½¨æˆ˜</div>
            </div>
            <div class="progress-step" id="step3">
              <div class="progress-circle">4</div>
              <div class="progress-label">å›¾å½¢æ‰¾èŒ¬</div>
            </div>
            <div class="progress-step" id="step4">
              <div class="progress-circle">5</div>
              <div class="progress-label">ä¸‰å¿ƒäºŒæ„</div>
            </div>
            <div class="progress-step" id="step5" onclick="handleReportButtonClick()" style="cursor: pointer;">
              <div class="progress-circle">ğŸ“Š</div>
              <div class="progress-label">æµ‹è¯„æŠ¥å‘Š</div>
            </div>
          </div>
        </div>

        <div class="testing-header">
          <h2 id="currentGameTitle" style="font-size: 2.4rem; font-weight: 600">æ­£åœ¨åŠ è½½...</h2>
          <div class="progress-container">
            <div class="progress-bar-bg">
              <div id="progressBar" class="progress-bar" style="width: 0%"></div>
            </div>
            <p class="progress-text" id="progressText">è¿›åº¦ï¼š0/5</p>
          </div>
        </div>

        <div class="game-container">
          <iframe id="gameIframe" class="game-iframe" src=""></iframe>
          <div id="gameOverlay" class="game-overlay">
            <h2 class="game-title" id="overlayTitle">å‡†å¤‡å¼€å§‹</h2>
            <p class="game-desc" id="overlayDesc">æ¸¸æˆè¯´æ˜åŠ è½½ä¸­...</p>
            <button class="game-start-btn" onclick="startCurrentGame()">å¼€å§‹æ¸¸æˆ</button>
          </div>
        </div>
      </div>

      <!-- ç»“æœé¡µé¢ -->
      <div id="resultScreen" class="result-screen" style="max-width: none !important; width: 100% !important">
        <div class="result-summary">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 1.5rem;">
              <span style="font-size: 2.4rem; font-weight: 700;">ğŸ‰ æµ‹è¯„å®Œæˆï¼ç»¼åˆè®¤çŸ¥èƒ½åŠ›å¾—åˆ†ï¼š</span>
              <span class="overall-score" id="overallScore">85</span>
            </div>
            <div style="display: flex; gap: 1rem;">
              <button class="btn btn-secondary" onclick="location.reload()" style="padding: 1rem 2rem; font-size: 1.6rem;">é‡æ–°æµ‹è¯„</button>
              <button class="btn btn-secondary" onclick="downloadReport()" style="padding: 1rem 2rem; font-size: 1.6rem;">ä¸‹è½½æŠ¥å‘Š</button>
            </div>
          </div>
        </div>

        <div class="result-main-content">
          <div class="radar-chart-container">
            <canvas id="radarChart"></canvas>
          </div>

          <div class="abilities-container" id="abilitiesContainer">
            <!-- åŠ¨æ€ç”Ÿæˆèƒ½åŠ›å¡ç‰‡ -->
          </div>
        </div>

        <div style="display: flex; gap: 2rem; margin-bottom: 1.5rem;">
          <div class="recommendations" style="flex: 1; margin-bottom: 0;">
            <h3 class="recommendations-title">ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h3>
            <ul class="recommendations-list" id="recommendationsList">
              <!-- åŠ¨æ€ç”Ÿæˆå»ºè®® -->
            </ul>
          </div>

          <div class="recommendations" style="flex: 0 0 35rem; margin-bottom: 0; background: #e3f2fd; border-left-color: #2196f3;">
            <div style="text-align: center; padding: 1rem 0;">
              <div style="font-size: 2rem; font-weight: 600; color: #333; margin-bottom: 0.8rem;">ä¸‹è½½ã€Šéº¦æ€æ˜Ÿçƒã€‹App</div>
              <div style="font-size: 1.6rem; color: #666; margin-bottom: 1rem; line-height: 1.8rem;">æ¸¸æˆåŒ–æ€ç»´è®­ç»ƒä¸–ç•Œ</div>
              <a href="https://xq.maseai.com" target="_blank" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.8rem 2rem; border-radius: 0.5rem; text-decoration: none; font-size: 1.6rem; font-weight: 600; transition: transform 0.2s;">
                ç«‹å³è®¿é—®
              </a>
              <div style="font-size: 1.4rem; color: #999; margin-top: 0.8rem;">https://xq.maseai.com</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast" class="toast"></div>

    <script>
      // è°ƒæ•´æ ¹å­—ä½“å¤§å°ä»¥é€‚é…ä¸åŒå±å¹•
      function adjustRootFontSize() {
        // æ¸¸æˆä¸»å®¹å™¨çš„è®¾è®¡å°ºå¯¸
        const DESIGN_WIDTH = 1280;
        const DESIGN_HEIGHT = 720;
        
        // è·å–è§†å£å°ºå¯¸
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        
        // è®¡ç®—åŸºäºå®½åº¦å’Œé«˜åº¦çš„ç¼©æ”¾æ¯”ä¾‹
        const scaleByWidth = viewportWidth / DESIGN_WIDTH;
        const scaleByHeight = viewportHeight / DESIGN_HEIGHT;
        
        // å–è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œç¡®ä¿å†…å®¹å®Œå…¨å¯è§ï¼ˆç­‰æ¯”ä¾‹ç¼©æ”¾ï¼‰
        const scale = Math.min(scaleByWidth, scaleByHeight);
        
        // è®¾ç½®æ ¹å…ƒç´ çš„ font-size
        // å‡è®¾è®¾è®¡ç¨¿åŸºå‡†æ˜¯ 1rem = 10pxï¼Œåˆ™è°ƒæ•´åçš„ font-size = 10 * scale
        const baseFontSize = 10; // è®¾è®¡ç¨¿åŸºå‡†
        const finalFontSize = baseFontSize * scale;
        
        document.documentElement.style.fontSize = `${finalFontSize}px`;
      }
      
      // åˆå§‹åŒ–ç¼©æ”¾
      adjustRootFontSize();
      
      // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¡ç®—ç¼©æ”¾
      window.addEventListener('resize', adjustRootFontSize);
      
      // æµ‹è¯„é…ç½® - 8-16å²æ ‡å‡†ç‰ˆ
      const TEST_CONFIG_STANDARD = {
        ageGroup: '8-16',
        games: [
          {
            id: "visual_rotate_mem",
            name: "æ—‹è½¬å®«æ®¿",
            file: "visual_rotate_mem",
            description: "è®°å¿†æ ¼å­çŸ©é˜µä¸­äº®èµ·æ–¹å—çš„ä½ç½®ï¼Œåœ¨çŸ©é˜µæ—‹è½¬åï¼Œæ‰¾åˆ°äº®èµ·è¿‡æ ¼å­çš„å¯¹åº”ä½ç½®",
            ability: "è§†è§‰è®°å¿†",
            config: { difficultyLevel: 12 }, // é€‚åˆ8-16å²çš„éš¾åº¦
            weight: 1.0,
            timeLimit: 180, // 3åˆ†é’Ÿ
          },
          {
            id: "guess_cubes",
            name: "å½±å­éª‘å£«",
            file: "guess_cubes",
            description: "æ ¹æ®ä¸¤ä¸ªæ–¹å‘çš„æŠ•å½±ï¼Œå®Œæˆå¯¹åº”çš„ä¸‰ç»´æ¨¡å‹ï¼Œé”»ç‚¼æ‚¨çš„ç©ºé—´æ€ç»´èƒ½åŠ›",
            ability: "ç©ºé—´æ€ç»´",
            config: { difficultyLevel: 3 },
            weight: 1.0,
            timeLimit: 180,
          },
          {
            id: "dual_n_back",
            name: "è„‘åŠ›åŒè½¨æˆ˜",
            file: "dual_n_back",
            description: "è®°ä¸‹çŸ©é˜µä¸­é—ªçƒæ–¹å—çš„é¢œè‰²ä¸ä½ç½®ï¼Œåœ¨è¯¥ä½ç½®é‡å¤é—ªçƒæ—¶ï¼Œåšå‡ºå¯¹åº”çš„ç­”æ¡ˆé€‰æ‹©",
            ability: "å·¥ä½œè®°å¿†",
            config: { difficultyLevel: 2 },
            weight: 1.0,
            timeLimit: 180,
          },
          {
            id: "graph_analogy",
            name: "å›¾å½¢æ‰¾èŒ¬",
            file: "graph_analogy",
            description: "è§‚å¯Ÿå›¾å½¢åºåˆ—çš„å˜åŒ–è§„å¾‹ï¼Œæ‰¾å‡ºéšè—çš„æ¨¡å¼å¹¶æ¨ç†å‡ºæ­£ç¡®ç­”æ¡ˆ",
            ability: "å½’çº³æ¨ç†",
            config: { difficultyLevel: 3 },
            weight: 1.0,
            timeLimit: 180,
          },
          {
            id: "attention_game",
            name: "ä¸‰å¿ƒäºŒæ„",
            file: "attention_game",
            description: "åŒæ—¶å…³æ³¨å¹¶å®Œæˆä¸¤ä¾§ä»»åŠ¡ï¼Œè®­ç»ƒåˆ†é…æ³¨æ„åŠ›",
            ability: "æ³¨æ„åŠ›",
            config: { difficultyLevel: 2 },
            weight: 1.0,
            timeLimit: 180,
          },
        ],
      };

      // æµ‹è¯„é…ç½® - 4-7å²ç®€åŒ–ç‰ˆ
      const TEST_CONFIG_YOUNG = {
        ageGroup: '4-7',
        games: [
          {
            id: "visual_rotate_mem",
            name: "æ—‹è½¬å®«æ®¿",
            file: "visual_rotate_mem",
            description: "è®°ä½äº®èµ·çš„æ–¹å—ä½ç½®ï¼Œè½¬ä¸€è½¬åæ‰¾åˆ°å®ƒä»¬",
            ability: "è§†è§‰è®°å¿†",
            config: { difficultyLevel: 1 }, // æ›´ç®€å•çš„éš¾åº¦
            weight: 1.0,
            timeLimit: 240, // 4åˆ†é’Ÿï¼Œç»™æ›´å¤šæ—¶é—´
            hasVoice: true,
          },
          {
            id: "count_shapes",
            name: "æ•°å›¾å½¢",
            file: "count_shapes",
            description: "æ•°ä¸€æ•°å±å¹•ä¸Šæœ‰å¤šå°‘ä¸ªå›¾å½¢",
            ability: "è§‚å¯ŸåŠ›",
            config: { difficultyLevel: 1 },
            weight: 1.0,
            timeLimit: 180,
            hasVoice: true,
          },
          {
            id: "attention_game",
            name: "æ‰¾ä¸åŒ",
            file: "attention_game",
            description: "çœ‹çœ‹ä¸¤è¾¹æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹",
            ability: "æ³¨æ„åŠ›",
            config: { difficultyLevel: 1 },
            weight: 1.0,
            timeLimit: 240,
            hasVoice: true,
          },
          {
            id: "parent_question_1",
            name: "å®¶é•¿é—®å·",
            file: "parent_question_1",
            description: "è¯·å®¶é•¿æ ¹æ®å­©å­æ—¥å¸¸è¡¨ç°å›ç­”ä»¥ä¸‹é—®é¢˜",
            ability: "ç»¼åˆè¯„ä¼°",
            config: {},
            weight: 1.0,
            timeLimit: 300,
            isParentQuestion: true,
          },
        ],
      };

      // å½“å‰ä½¿ç”¨çš„æµ‹è¯„é…ç½®
      let TEST_CONFIG = TEST_CONFIG_STANDARD;
      let selectedAgeGroup = null;

      // å…¨å±€çŠ¶æ€
      let currentGameIndex = 0;
      let gameResults = [];
      let currentGameStartTime = 0;
      let gameTimeoutTimer = null;
      
      // å¿«æ·æŸ¥çœ‹æŠ¥å‘ŠåŠŸèƒ½
      let reportButtonClickCount = 0;
      let reportButtonClickTimer = null;

      // Toast é€šçŸ¥å‡½æ•°
      function showToast(message, type = 'info', duration = 3000) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = 'toast ' + type;
        
        // æ˜¾ç¤º toast
        setTimeout(() => {
          toast.classList.add('show');
        }, 100);
        
        // è‡ªåŠ¨éšè—
        setTimeout(() => {
          toast.classList.remove('show');
        }, duration);
      }

      // é€‰æ‹©å¹´é¾„æ®µ
      function selectAge(ageGroup) {
        selectedAgeGroup = ageGroup;
        
        // æ›´æ–°UIé€‰ä¸­çŠ¶æ€
        document.getElementById('age-4-7').classList.remove('selected');
        document.getElementById('age-8-16').classList.remove('selected');
        document.getElementById(`age-${ageGroup}`).classList.add('selected');
        
        // æ ¹æ®å¹´é¾„æ®µé€‰æ‹©é…ç½®
        if (ageGroup === '4-7') {
          TEST_CONFIG = TEST_CONFIG_YOUNG;
          document.getElementById('gameCount').textContent = '4';
          document.getElementById('estimatedTime').textContent = '20-25';
          document.getElementById('assessmentDimensions').textContent = 'è§†è§‰è®°å¿†ã€è§‚å¯ŸåŠ›ã€æ³¨æ„åŠ› + å®¶é•¿è¯„ä¼°';
        } else {
          TEST_CONFIG = TEST_CONFIG_STANDARD;
          document.getElementById('gameCount').textContent = '5';
          document.getElementById('estimatedTime').textContent = '15-20';
          document.getElementById('assessmentDimensions').textContent = 'è§†è§‰è®°å¿†ã€ç©ºé—´æ€ç»´ã€å·¥ä½œè®°å¿†ã€å½’çº³æ¨ç†ã€æ³¨æ„åŠ›';
        }
        
        // æ˜¾ç¤ºæµ‹è¯„è¯¦æƒ…
        document.getElementById('testInfoDetail').style.display = 'block';
        
        // å¯ç”¨å¼€å§‹æŒ‰é’®
        document.getElementById('startTestBtn').disabled = false;
      }

      // å¤„ç†æŠ¥å‘ŠæŒ‰é’®ç‚¹å‡»ï¼ˆå¿«æ·æŸ¥çœ‹åŠŸèƒ½ï¼‰
      function handleReportButtonClick() {
        reportButtonClickCount++;
        
        console.log(`æŠ¥å‘ŠæŒ‰é’®ç‚¹å‡»æ¬¡æ•°: ${reportButtonClickCount}/5`);
        
        // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
        if (reportButtonClickTimer) {
          clearTimeout(reportButtonClickTimer);
        }
        
        // 5ç§’å†…é‡ç½®è®¡æ•°
        reportButtonClickTimer = setTimeout(() => {
          reportButtonClickCount = 0;
          console.log('ç‚¹å‡»è®¡æ•°å·²é‡ç½®');
        }, 5000);
        
        // å¦‚æœç‚¹å‡»5æ¬¡ï¼Œç›´æ¥æ˜¾ç¤ºæŠ¥å‘Š
        if (reportButtonClickCount >= 5) {
          reportButtonClickCount = 0;
          console.log('è§¦å‘å¿«æ·æŸ¥çœ‹æŠ¥å‘Š');
          showToast('æ­£åœ¨ç”Ÿæˆæ¨¡æ‹ŸæŠ¥å‘Š...', 'info', 1500);
          showMockResults();
        } else {
          // æ˜¾ç¤ºè¿›åº¦æç¤º
          // showToast(`å†ç‚¹å‡» ${5 - reportButtonClickCount} æ¬¡æŸ¥çœ‹æ¼”ç¤ºæŠ¥å‘Š`, 'info', 1500);
        }
      }
      
      // å¡«å……ç¼ºå¤±çš„æ¸¸æˆç»“æœæ•°æ®
      function generateMockResults() {
        // æ£€æŸ¥æ¯ä¸ªæ¸¸æˆæ˜¯å¦å·²æœ‰ç»“æœ
        TEST_CONFIG.games.forEach((game, index) => {
          // æŸ¥æ‰¾æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªæ¸¸æˆçš„ç»“æœ
          const existingResult = gameResults.find(r => r.gameId === game.id);
          
          if (!existingResult) {
            // å¦‚æœæ²¡æœ‰ç»“æœï¼Œç”Ÿæˆ65-95ä¹‹é—´çš„éšæœºåˆ†æ•°
            const baseScore = 65 + Math.random() * 30;
            const score = Math.round(baseScore);
            const accuracy = Math.round(65 + Math.random() * 30);
            const timeUsed = Math.round(game.timeLimit * (0.5 + Math.random() * 0.4));
            
            gameResults.push({
              gameId: game.id,
              gameName: game.name,
              ability: game.ability,
              score: score,
              maxScore: 100,
              accuracy: accuracy,
              timeUsed: timeUsed,
              isParentQuestion: game.isParentQuestion || false,
            });
            
            console.log(`ä¸º ${game.name} ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®: ${score}åˆ†`);
          } else {
            console.log(`${game.name} å·²æœ‰çœŸå®æ•°æ®: ${existingResult.score}åˆ†`);
          }
        });
        
        console.log('æµ‹è¯„æ•°æ®å®Œæ•´ï¼Œå·²ç”Ÿæˆç»“æœ:', gameResults);
      }
      
      // æ˜¾ç¤ºæ¨¡æ‹Ÿç»“æœ
      function showMockResults() {
        // å¦‚æœè¿˜æ²¡é€‰æ‹©å¹´é¾„æ®µï¼Œå…ˆé€‰æ‹©é»˜è®¤çš„8-16å²
        if (!selectedAgeGroup) {
          selectAge('8-16');
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        generateMockResults();
        
        // éšè—æ¬¢è¿é¡µé¢
        document.getElementById("welcomeScreen").classList.add("hidden");
        
        // æ˜¾ç¤ºæµ‹è¯„é¡µé¢ï¼ˆä¸ºäº†è®©è¿›åº¦æ¡å¯è§ï¼‰
        document.getElementById("testingScreen").style.display = "block";
        
        // æ›´æ–°è¿›åº¦æ¡åˆ°æœ€å
        updateProgressSteps(TEST_CONFIG.games.length);
        
        // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºç»“æœ
        setTimeout(() => {
          showResults();
        }, 300);
      }

      // å¼€å§‹æµ‹è¯„
      function startTest() {
        if (!selectedAgeGroup) {
          showToast('è¯·å…ˆé€‰æ‹©å¹´é¾„æ®µ', 'warning');
          return;
        }
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜
        document.title = `è®¤çŸ¥èƒ½åŠ›æµ‹è¯„ç³»ç»Ÿ - ${selectedAgeGroup}å²`;
        
        // æ›´æ–°è¿›åº¦æ¡æ­¥éª¤
        updateProgressStepsLayout();
        
        document.getElementById("welcomeScreen").classList.add("hidden");
        document.getElementById("testingScreen").style.display = "block";
        loadGame(0);
      }

      // æ›´æ–°è¿›åº¦æ¡å¸ƒå±€
      function updateProgressStepsLayout() {
        const progressSteps = document.querySelector('.progress-steps');
        progressSteps.innerHTML = `
          <div class="progress-line">
            <div class="progress-line-fill" id="progressLineFill"></div>
          </div>
        `;
        
        // æ·»åŠ æ¸¸æˆæ­¥éª¤
        TEST_CONFIG.games.forEach((game, index) => {
          const stepDiv = document.createElement('div');
          stepDiv.className = 'progress-step';
          stepDiv.id = `step${index}`;
          stepDiv.innerHTML = `
            <div class="progress-circle">${index + 1}</div>
            <div class="progress-label">${game.name}</div>
          `;
          progressSteps.appendChild(stepDiv);
        });
        
        // æ·»åŠ æŠ¥å‘Šæ­¥éª¤ï¼ˆå¸¦ç‚¹å‡»äº‹ä»¶ï¼‰
        const reportStep = document.createElement('div');
        reportStep.className = 'progress-step';
        reportStep.id = `step${TEST_CONFIG.games.length}`;
        reportStep.style.cursor = 'pointer';
        reportStep.innerHTML = `
          <div class="progress-circle">ğŸ“Š</div>
          <div class="progress-label">æµ‹è¯„æŠ¥å‘Š</div>
        `;
        reportStep.onclick = handleReportButtonClick;
        progressSteps.appendChild(reportStep);
      }

      // åŠ è½½æ¸¸æˆ
      function loadGame(index) {
        if (index >= TEST_CONFIG.games.length) {
          showResults();
          return;
        }

        currentGameIndex = index;
        const game = TEST_CONFIG.games[index];

        // æ›´æ–°ç³–è‘«èŠ¦è¿›åº¦æ¡
        updateProgressSteps(index);

        // éšè—æ¸¸æˆè¯´æ˜è¦†ç›–å±‚ï¼Œç›´æ¥å¼€å§‹æ¸¸æˆ
        document.getElementById("gameOverlay").classList.add("hidden");

        // åŠ è½½iframe
        const iframe = document.getElementById("gameIframe");
        const currentUrl = new URL(window.location.href);
        const pathParts = currentUrl.pathname.split("/");
        const currentFilename = pathParts[pathParts.length - 1];
        const extensionMatch = currentFilename.match(/\.[^.]+$/);
        const extension = extensionMatch ? extensionMatch[0] : "";
        pathParts[pathParts.length - 1] = game.file + extension;
        const newUrl = currentUrl.origin + pathParts.join("/");
        iframe.src = newUrl;

        // è‡ªåŠ¨å¼€å§‹æ¸¸æˆ
        setTimeout(() => {
          iframe.contentWindow.postMessage(
            {
              type: "setGameConfig",
              config: JSON.stringify(game.config),
            },
            "*"
          );
        }, 500);

        // è®¾ç½®è¶…æ—¶
        currentGameStartTime = Date.now();
        if (gameTimeoutTimer) clearTimeout(gameTimeoutTimer);
        gameTimeoutTimer = setTimeout(() => {
          handleGameTimeout();
        }, game.timeLimit * 1000);
      }

      // æ›´æ–°ç³–è‘«èŠ¦è¿›åº¦æ˜¾ç¤º
      function updateProgressSteps(currentIndex) {
        const totalSteps = TEST_CONFIG.games.length + 1; // æ¸¸æˆæ•° + æŠ¥å‘Š
        
        // æ›´æ–°æ¯ä¸€æ­¥çš„çŠ¶æ€
        for (let i = 0; i < totalSteps; i++) {
          const step = document.getElementById(`step${i}`);
          if (!step) continue;

          step.classList.remove("active", "completed");

          if (i < currentIndex) {
            step.classList.add("completed");
          } else if (i === currentIndex) {
            step.classList.add("active");
          }
        }

        // æ›´æ–°è¿æ¥çº¿çš„å¡«å……é«˜åº¦
        const progressPercentage = (currentIndex / totalSteps) * 100;
        const lineFill = document.getElementById("progressLineFill");
        if (lineFill) {
          lineFill.style.height = progressPercentage + "%";
        }
      }

      // å¼€å§‹å½“å‰æ¸¸æˆ
      function startCurrentGame() {
        const game = TEST_CONFIG.games[currentGameIndex];
        document.getElementById("gameOverlay").classList.add("hidden");

        // ç­‰å¾…æ¸¸æˆåŠ è½½å®Œæˆåå‘é€é…ç½®
        setTimeout(() => {
          const iframe = document.getElementById("gameIframe");
          iframe.contentWindow.postMessage(
            {
              type: "setGameConfig",
              config: JSON.stringify(game.config),
            },
            "*"
          );
        }, 500);

        // è®¾ç½®è¶…æ—¶
        currentGameStartTime = Date.now();
        if (gameTimeoutTimer) clearTimeout(gameTimeoutTimer);
        gameTimeoutTimer = setTimeout(() => {
          handleGameTimeout();
        }, game.timeLimit * 1000);
      }

      // æ¸¸æˆè¶…æ—¶å¤„ç†
      function handleGameTimeout() {
        const game = TEST_CONFIG.games[currentGameIndex];
        gameResults.push({
          gameId: game.id,
          gameName: game.name,
          ability: game.ability,
          score: 0,
          maxScore: 100,
          accuracy: 0,
          timeUsed: game.timeLimit,
          timeout: true,
        });

        // åŠ è½½ä¸‹ä¸€ä¸ªæ¸¸æˆ
        loadGame(currentGameIndex + 1);
      }

      // ç›‘å¬æ¸¸æˆæ¶ˆæ¯
      window.addEventListener("message", function (e) {
        const data = e.data;

        switch (data.type) {
          case "gameLoaded":
            console.log("æ¸¸æˆåŠ è½½å®Œæˆ");
            break;

          case "gameStarted":
            console.log("æ¸¸æˆå¼€å§‹");
            currentGameStartTime = Date.now();
            break;

          case "gameFinished":
            handleGameFinished(data.data);
            break;

          case "gameClosed":
            // å¦‚æœç”¨æˆ·ä¸­é€”é€€å‡ºæ¸¸æˆ
            if (currentGameIndex < TEST_CONFIG.games.length) {
              loadGame(currentGameIndex + 1);
            }
            break;
        }
      });

      // å¤„ç†æ¸¸æˆå®Œæˆ
      function handleGameFinished(gameData) {
        if (gameTimeoutTimer) clearTimeout(gameTimeoutTimer);

        const game = TEST_CONFIG.games[currentGameIndex];
        const timeUsed = (Date.now() - currentGameStartTime) / 1000;

        // è®¡ç®—æ ‡å‡†åŒ–åˆ†æ•° (0-100)
        let normalizedScore = 0;
        if (gameData.score !== undefined) {
          // æ ¹æ®ä¸åŒæ¸¸æˆçš„å¾—åˆ†æœºåˆ¶è¿›è¡Œæ ‡å‡†åŒ–
          normalizedScore = Math.min(100, Math.max(0, gameData.score / 10)); // å‡è®¾åŸå§‹åˆ†æ•°èŒƒå›´0-1000
        }

        // è®¡ç®—å‡†ç¡®ç‡
        let accuracy = 0;
        if (gameData.accuracy !== undefined) {
          accuracy = gameData.accuracy;
        } else if (gameData.correctCount !== undefined && gameData.totalCount !== undefined) {
          accuracy = gameData.totalCount > 0 ? (gameData.correctCount / gameData.totalCount) * 100 : 0;
        }

        gameResults.push({
          gameId: game.id,
          gameName: game.name,
          ability: game.ability,
          score: normalizedScore,
          maxScore: 100,
          accuracy: accuracy,
          timeUsed: timeUsed,
          rawData: gameData,
          isParentQuestion: game.isParentQuestion || false,
        });

        console.log("æ¸¸æˆå®Œæˆ:", gameResults[gameResults.length - 1]);

        // å»¶è¿ŸåŠ è½½ä¸‹ä¸€ä¸ªæ¸¸æˆ
        setTimeout(() => {
          loadGame(currentGameIndex + 1);
        }, 1000);
      }

      // æ˜¾ç¤ºç»“æœ
      function showResults() {
        // æ›´æ–°è¿›åº¦åˆ°æœ€åä¸€æ­¥ï¼ˆæŠ¥å‘Šï¼‰
        updateProgressSteps(TEST_CONFIG.games.length);

        // å»¶è¿Ÿä¸€ä¸‹å†åˆ‡æ¢åˆ°ç»“æœé¡µé¢ï¼Œè®©ç”¨æˆ·çœ‹åˆ°è¿›åº¦å®Œæˆ
        setTimeout(() => {
          document.getElementById("testingScreen").style.display = "none";
          document.getElementById("resultScreen").style.display = "block";

          // è®¡ç®—ç»¼åˆå¾—åˆ†å’Œå„é¡¹èƒ½åŠ›å¾—åˆ†
          const abilities = calculateAbilities();
          const overallScore = Math.round(abilities.overall);

          // æ˜¾ç¤ºç»¼åˆå¾—åˆ†
          document.getElementById("overallScore").textContent = overallScore;

          // åˆ›å»ºé›·è¾¾å›¾
          createRadarChart(abilities);

          // åˆ›å»ºèƒ½åŠ›å¡ç‰‡
          createAbilityCards(abilities);

          // ç”Ÿæˆå»ºè®®
          generateRecommendations(abilities);
        }, 1000);
      }

      // è®¡ç®—å„é¡¹èƒ½åŠ›å¾—åˆ†
      function calculateAbilities() {
        // åŠ¨æ€è·å–å½“å‰é…ç½®ä¸­çš„æ‰€æœ‰èƒ½åŠ›ç»´åº¦
        const abilityScores = {};
        const abilityCounts = {};
        
        // ä»å½“å‰æµ‹è¯„é…ç½®ä¸­æå–æ‰€æœ‰èƒ½åŠ›ç»´åº¦
        TEST_CONFIG.games.forEach(game => {
          if (!abilityScores[game.ability]) {
            abilityScores[game.ability] = 0;
            abilityCounts[game.ability] = 0;
          }
        });

        // æ±‡æ€»å„æ¸¸æˆå¾—åˆ†
        gameResults.forEach((result) => {
          if (abilityScores[result.ability] !== undefined) {
            abilityScores[result.ability] += result.score;
            abilityCounts[result.ability]++;
          }
        });

        // è®¡ç®—å¹³å‡åˆ†
        const abilities = {};
        for (let ability in abilityScores) {
          abilities[ability] = abilityCounts[ability] > 0 ? abilityScores[ability] / abilityCounts[ability] : 0;
        }

        // è®¡ç®—ç»¼åˆå¾—åˆ†ï¼ˆåªè®¡ç®—æœ‰å¾—åˆ†çš„èƒ½åŠ›ï¼‰
        const scores = Object.values(abilities).filter(score => score > 0);
        abilities.overall = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;

        return abilities;
      }

      // åˆ›å»ºé›·è¾¾å›¾
      function createRadarChart(abilities) {
        const ctx = document.getElementById("radarChart").getContext("2d");

        // åŠ¨æ€ç”Ÿæˆæ ‡ç­¾å’Œæ•°æ®ï¼ˆæ’é™¤ overallï¼‰
        const labels = [];
        const data = [];
        
        for (let ability in abilities) {
          if (ability !== 'overall') {
            labels.push(ability);
            data.push(abilities[ability]);
          }
        }

        new Chart(ctx, {
          type: "radar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "è®¤çŸ¥èƒ½åŠ›è¯„åˆ†",
                data: data,
                backgroundColor: "rgba(102, 126, 234, 0.2)",
                borderColor: "rgba(102, 126, 234, 1)",
                borderWidth: 2,
                pointBackgroundColor: "rgba(102, 126, 234, 1)",
                pointBorderColor: "#fff",
                pointHoverBackgroundColor: "#fff",
                pointHoverBorderColor: "rgba(102, 126, 234, 1)",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
              r: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  stepSize: 20,
                  font: {
                    size: 12,
                  },
                },
                pointLabels: {
                  font: {
                    size: 14,
                    weight: "600",
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
            },
          },
        });
      }

      // åˆ›å»ºèƒ½åŠ›å¡ç‰‡
      function createAbilityCards(abilities) {
        const container = document.getElementById("abilitiesContainer");
        container.innerHTML = "";

        const abilityColors = {
          è§†è§‰è®°å¿†: "#8A83FF",
          ç©ºé—´æ€ç»´: "#4E9DFC",
          å·¥ä½œè®°å¿†: "#96C944",
          å½’çº³æ¨ç†: "#FF9A00",
          æ³¨æ„åŠ›: "#FF6B9D",
          è§‚å¯ŸåŠ›: "#FF6B9D",
          ç»¼åˆè¯„ä¼°: "#9C27B0",
        };

        for (let ability in abilities) {
          if (ability === "overall") continue;

          const score = Math.round(abilities[ability]);
          const percentage = score;

          const card = document.createElement("div");
          card.className = "ability-card";
          card.innerHTML = `
            <div class="ability-name">${ability}</div>
            <div class="ability-score-compact">${score}</div>
            <div class="ability-bar-container">
              <div class="ability-bar-bg">
                <div class="ability-bar" style="width: ${percentage}%; background-color: ${abilityColors[ability] || '#667eea'}"></div>
              </div>
            </div>
          `;
          container.appendChild(card);
        }
      }

      // ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
      function generateRecommendations(abilities) {
        const recommendations = [];

        // æ‰¾å‡ºæœ€å¼ºå’Œæœ€å¼±çš„èƒ½åŠ›
        const abilityArray = [];
        for (let ability in abilities) {
          if (ability !== "overall") {
            abilityArray.push({ name: ability, score: abilities[ability] });
          }
        }
        abilityArray.sort((a, b) => b.score - a.score);

        const strongest = abilityArray[0];
        const weakest = abilityArray[abilityArray.length - 1];

        // åŸºäºç»¼åˆå¾—åˆ†ç»™å»ºè®®
        if (abilities.overall >= 80) {
          recommendations.push("æ•´ä½“è®¤çŸ¥èƒ½åŠ›ä¼˜ç§€ï¼å»ºè®®ç»§ç»­ä¿æŒï¼Œå¯ä»¥å°è¯•æ›´æœ‰æŒ‘æˆ˜æ€§çš„å­¦ä¹ ä»»åŠ¡");
        } else if (abilities.overall >= 60) {
          recommendations.push("æ•´ä½“è®¤çŸ¥èƒ½åŠ›è‰¯å¥½ï¼Œè¿˜æœ‰æå‡ç©ºé—´ï¼Œå»ºè®®é’ˆå¯¹æ€§åœ°åŠ å¼ºè–„å¼±ç¯èŠ‚");
        } else {
          recommendations.push("å»ºè®®åŠ å¼ºè®¤çŸ¥èƒ½åŠ›è®­ç»ƒï¼Œå¯ä»¥ä»æ„Ÿå…´è¶£çš„æ¸¸æˆå¼€å§‹ï¼Œå¾ªåºæ¸è¿›åœ°æå‡");
        }

        // åŸºäºæœ€å¼±èƒ½åŠ›ç»™å»ºè®®
        if (weakest && weakest.score < 70) {
          const suggestions = {
            è§†è§‰è®°å¿†: "å»ºè®®å¤šåšè®°å¿†ç±»æ¸¸æˆï¼Œå¦‚è®°å¿†å¡ç‰‡ã€æ‰¾ä¸åŒç­‰",
            ç©ºé—´æ€ç»´: "å»ºè®®å¤šç©ç§¯æœ¨ã€æ‹¼å›¾ç±»æ¸¸æˆï¼ŒåŸ¹å…»ç©ºé—´æƒ³è±¡åŠ›",
            å·¥ä½œè®°å¿†: "å»ºè®®ç»ƒä¹ å¿ƒç®—ã€å¤šä»»åŠ¡å¤„ç†è®­ç»ƒ",
            å½’çº³æ¨ç†: "å»ºè®®å¤šåšé€»è¾‘æ¨ç†é¢˜ï¼ŒåŸ¹å…»è§‚å¯Ÿè§„å¾‹çš„èƒ½åŠ›",
            æ³¨æ„åŠ›: "å»ºè®®è¿›è¡Œä¸“æ³¨åŠ›è®­ç»ƒï¼Œå¦‚èˆ’å°”ç‰¹æ–¹æ ¼ç­‰",
            è§‚å¯ŸåŠ›: "å»ºè®®å¤šç©æ‰¾ä¸åŒã€æ•°å›¾å½¢ç­‰æ¸¸æˆ",
            ç»¼åˆè¯„ä¼°: "å»ºè®®å¤šä¸å­©å­äº’åŠ¨ï¼ŒåŸ¹å…»æ—¥å¸¸ç”Ÿæ´»ä¸­çš„è®¤çŸ¥èƒ½åŠ›",
          };
          if (suggestions[weakest.name]) {
            recommendations.push(`${weakest.name}æœ‰æå‡ç©ºé—´ï¼Œ${suggestions[weakest.name]}`);
          }
        }

        // å¹´é¾„æ®µç‰¹å®šå»ºè®®
        if (selectedAgeGroup === '4-7') {
          recommendations.push("å»ºè®®æ¯å‘¨2-3æ¬¡è®­ç»ƒï¼Œæ¯æ¬¡10-15åˆ†é’Ÿï¼Œå®¶é•¿é™ªä¼´æ•ˆæœæ›´ä½³");
        } else {
          recommendations.push("å»ºè®®æ¯å‘¨2-3æ¬¡è®­ç»ƒï¼Œæ¯æ¬¡15-20åˆ†é’Ÿï¼ŒæŒç»­è®­ç»ƒæ•ˆæœæ›´ä½³");
        }

        // æ˜¾ç¤ºå»ºè®®ï¼ˆæœ€å¤šæ˜¾ç¤º3æ¡ï¼‰
        const list = document.getElementById("recommendationsList");
        list.innerHTML = "";
        recommendations.slice(0, 3).forEach((rec) => {
          const li = document.createElement("li");
          li.textContent = rec;
          list.appendChild(li);
        });
      }

      // ä¸‹è½½æŠ¥å‘Š
      function downloadReport() {
        // ç”ŸæˆæŠ¥å‘Šå†…å®¹
        const abilities = calculateAbilities();
        const date = new Date().toLocaleDateString("zh-CN");

        let reportText = `è®¤çŸ¥èƒ½åŠ›æµ‹è¯„æŠ¥å‘Š\n`;
        reportText += `æµ‹è¯„æ—¥æœŸï¼š${date}\n`;
        reportText += `é€‚ç”¨å¹´é¾„ï¼š${selectedAgeGroup}å²\n\n`;
        reportText += `ç»¼åˆå¾—åˆ†ï¼š${Math.round(abilities.overall)}/100\n\n`;
        reportText += `å„é¡¹èƒ½åŠ›å¾—åˆ†ï¼š\n`;

        for (let ability in abilities) {
          if (ability !== "overall") {
            reportText += `  ${ability}ï¼š${Math.round(abilities[ability])}/100\n`;
          }
        }

        reportText += `\næ¸¸æˆè¯¦æƒ…ï¼š\n`;
        gameResults.forEach((result, index) => {
          reportText += `${index + 1}. ${result.gameName} (${result.ability})\n`;
          reportText += `   å¾—åˆ†ï¼š${Math.round(result.score)}/100\n`;
          if (!result.isParentQuestion) {
            reportText += `   å‡†ç¡®ç‡ï¼š${result.accuracy.toFixed(1)}%\n`;
          }
          reportText += `   ç”¨æ—¶ï¼š${result.timeUsed.toFixed(1)}ç§’\n\n`;
        });

        // åˆ›å»ºä¸‹è½½é“¾æ¥
        const blob = new Blob([reportText], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `è®¤çŸ¥èƒ½åŠ›æµ‹è¯„æŠ¥å‘Š_${selectedAgeGroup}å²_${date}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showToast("æŠ¥å‘Šå·²ä¸‹è½½ï¼", "success");
      }

    </script>
  </body>
</html>
