<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ±æŠ±é¾™æˆé•¿ä»»åŠ¡</title>
      <script src="https://cdn.keepwork.com/keepwork/cdn/tailwindcss@3.4.16.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            height: 100vh;
            
        }
        
        .dragon-container {
            width: 100%;
            max-width: 1280px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            overflow: hidden;
        }
        
        .task-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
        }
        
        .dragon-avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            animation: float 3s ease-in-out infinite; 
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* æŠ±æŠ±é¾™èº«ä½“ */
        .dragon-body {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
        }
        
        /* çœ¼ç› */
        .dragon-eye {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dragon-pupil {
            width: 40px;
            height: 40px;
            background: #1f2937;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .dragon-highlight {
            width: 15px;
            height: 15px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            left: 8px;
        }
        
        /* çœ¨çœ¼åŠ¨ç”» */
        .dragon-eye.blink {
            animation: blink 0.15s ease-in-out;
        }
        
        @keyframes blink {
            0%, 100% { height: 60px; }
            50% { height: 6px; }
        }
        
        /* å˜´å·´ */
        .dragon-mouth {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 8px;
            border: 2px solid #6b7280;
            border-top: none;
            border-radius: 0 0 20px 20px;
            background: transparent;
        }
        
        /* è¯´è¯åŠ¨ç”» */
        .dragon-body.speaking {
            animation: speaking 0.6s ease-in-out infinite;
        }
        
        @keyframes speaking {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* é¾™æµ®åŠ¨åŠ¨ç”» */
        .dragon-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .progress-ring {
            width: 80px;
            height: 80px;
            position: relative;
        }
        
        .progress-ring svg {
            transform: rotate(-90deg);
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 6;
        }
        
        .progress-bg {
            stroke: #e5e7eb;
        }
        
        .progress-bar {
            stroke: #4ade80;
            stroke-linecap: round;
            transition: stroke-dasharray 0.3s ease;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #92400e;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .task-button {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.3);
        }
        
        .task-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.4);
        }
        
        .task-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending { background: #fbbf24; }
        .status-active { background: #10b981; animation: pulse 2s infinite; }
        .status-completed { background: #6366f1; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .main-task {
            border: 3px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        .reward-item {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .reward-item:hover {
            transform: scale(1.05);
        }
        
        /* ä»»åŠ¡åˆ—è¡¨æ ·å¼ */
        .task-list {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .task-list-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .task-list-item:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .task-list-item.active {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transform: translateX(8px);
        }
        
        .task-list-item.completed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669);
        }
        
        .task-list-item.in-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffd700, #f59e0b);
        }
        
        .task-list-item.locked {
            opacity: 0.6;
            cursor: pointer;
        }
        
        .task-list-item.locked:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .task-detail {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow-y: auto;
            height: 100%;
        }
        
        .task-detail::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 600px) {
            .dragon-container {
                padding: 20px;
            }
            
            .task-grid {
                gap: 20px;
            }
            
            .dragon-avatar {
                width: 100px;
                height: 100px;
                font-size: 50px;
            }
            
            header {
                padding: 16px 24px;
            }
            
            .task-card {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="dragon-container">
        <!-- å¤´éƒ¨ä¿¡æ¯ -->
        <header class="flex items-center justify-between p-4 text-white flex-shrink-0">
            <div class="flex items-center space-x-4">
                <div class="dragon-float">
                    <div class="dragon-body">
                        <div class="dragon-eye">
                            <div class="dragon-pupil">
                                <div class="dragon-highlight"></div>
                            </div>
                        </div>
                        <div class="dragon-mouth"></div>
                    </div>
                </div>
                <div>
                    <h1 class="text-3xl font-bold mb-2">æŠ±æŠ±é¾™çš„æˆé•¿ä¹‹æ—…</h1>
                    <div class="flex items-center space-x-4">
                        <div class="level-badge">Lv.3 æ™ºæ…§é¾™</div>
                        <div class="flex items-center space-x-2">
                            <span class="text-yellow-300">ğŸ’</span>
                            <span class="font-semibold">ç»éªŒå€¼: 1250/2000</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ€»è¿›åº¦ -->
            <div class="text-center">
                <div class="progress-ring mx-auto mb-2">
                    <svg width="80" height="80">
                        <circle class="progress-bg" cx="40" cy="40" r="36"></circle>
                        <circle class="progress-bar" cx="40" cy="40" r="36" 
                                stroke-dasharray="67.8 226.2" stroke-dashoffset="0"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-lg font-bold text-white">30%</span>
                    </div>
                </div>
                <p class="text-sm opacity-90">æ€»ä½“è¿›åº¦</p>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="flex-1 px-4 pb-4 overflow-hidden min-h-0">
            <div class="grid grid-cols-4 gap-4 h-full max-h-full">
                
                <!-- å·¦ä¾§ä»»åŠ¡åˆ—è¡¨ -->
                <div class="task-list p-4">
                    <h2 class="text-lg font-bold text-white mb-4">ğŸ—‚ï¸ ä»»åŠ¡åˆ—è¡¨</h2>
                    
                    <!-- ä»»åŠ¡é¡¹ -->
                    <div class="task-list-item in-progress active" data-task="0">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-800">ğŸ¥š å¤©èµ‹è§‰é†’</h3>
                            <div class="flex items-center">
                                <div class="status-indicator status-active"></div>
                                <span class="text-xs text-gray-600">è¿›è¡Œä¸­</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">å­µåŒ–é¾™è›‹ï¼Œè§£é”æŠ±æŠ±é¾™</p>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 30%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">è¿›åº¦: 2/7å¤©</div>
                    </div>
                    
                    <div class="task-list-item locked" data-task="1">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-500">ğŸš€ é£ç¿”çš„å¿ƒ</h3>
                            <div class="flex items-center">
                                <div class="status-indicator status-pending"></div>
                                <span class="text-xs text-gray-500">å¾…å¼€å¯</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mb-2">è§£é”é£è¡Œèƒ½åŠ›</p>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gray-300 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-400 mt-1">ï¿½ éœ€è®¤çŸ¥èƒ½åŠ›60åˆ†</div>
                    </div>
                    
                    <div class="task-list-item locked" data-task="2">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-500">ğŸ”ï¸ é¾™ä¹‹è°·</h3>
                            <div class="flex items-center">
                                <div class="status-indicator status-pending"></div>
                                <span class="text-xs text-gray-500">å¾…å¼€å¯</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mb-2">è§£é”å®¶å›­ç³»ç»Ÿ</p>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gray-300 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-400 mt-1">ğŸ”’ éœ€å®Œæˆé£ç¿”çš„å¿ƒ</div>
                    </div>
                </div>

                <!-- å³ä¾§ä»»åŠ¡è¯¦æƒ… -->
                <div class="col-span-3 task-detail p-6" id="taskDetail">
                    <!-- ä»»åŠ¡è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // æ¸¸æˆé…ç½®å’Œç»Ÿè®¡
        let game_config = '';
        let gameStats = {
            score: 1250,
            difficulty: 2, // 1~3
            level: 3,
            tasksCompleted: 1,
            totalTasks: 3,
            cognitiveScore: 45,
            activeDays: 7
        };

        // Host communication logic
        window.addEventListener('message', function (e) {
            switch (e.data.type) {
                case 'setGameConfig':
                    game_config = e.data.data; // this is markdown or text string
                    console.log('Game config updated:', game_config);
                    // Update config logic - could be used to modify game parameters
                    break;
                case 'getGameStats':
                    window.parent.postMessage({ 
                        type: 'gameStats', 
                        data: {
                            score: gameStats.score,
                            difficulty: gameStats.difficulty,
                            level: gameStats.level,
                            tasksCompleted: gameStats.tasksCompleted,
                            totalTasks: gameStats.totalTasks,
                            cognitiveScore: gameStats.cognitiveScore,
                            activeDays: gameStats.activeDays
                        }
                    }, '*');
                    break;
            }
        });

        // æ¸¸æˆé€»è¾‘
        class DragonTaskManager {
            constructor() {
                this.currentTask = 0;
                this.taskTemplates = this.initTaskTemplates();
                this.initializeEvents();
                this.updateProgress();
                this.startBlinking();
                this.loadTaskDetail(0); // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªä»»åŠ¡
                this.sendGameLoaded();
            }

            initTaskTemplates() {
                return {
                    0: { // å¤©èµ‹è§‰é†’
                        title: 'ğŸ¥š å¤©èµ‹è§‰é†’ï¼ˆå­µåŒ–é¾™è›‹ï¼‰',
                        status: 'è¿›è¡Œä¸­',
                        content: `
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">ğŸ¥š å¤©èµ‹è§‰é†’ï¼ˆå­µåŒ–é¾™è›‹ï¼‰</h2>
                                <div class="flex items-center">
                                    <div class="status-indicator status-active"></div>
                                    <span class="text-sm text-gray-600">è¿›è¡Œä¸­</span>
                                </div>
                            </div>
                            
                            <div class="space-y-6">
                                <!-- é¾™è›‹çŠ¶æ€ -->
                                <div class="bg-purple-50 rounded-lg p-6">
                                    <h3 class="font-semibold text-purple-700 mb-4 text-lg">ğŸ”® è§‰é†’ç¥æ®¿</h3>
                                    <div class="text-center mb-4">
                                        <div class="text-8xl mb-3">ğŸ¥š</div>
                                        <p class="text-purple-600">ç¥ç§˜é¾™è›‹æ­£åœ¨ç­‰å¾…è§‰é†’</p>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                            <span class="font-medium">âœ… ç¬¬1å¤©ï¼šæ³¨æ„åŠ›æµ‹è¯•</span>
                                            <span class="text-sm text-green-600 font-semibold">å·²å®Œæˆ</span>
                                        </div>
                                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border-2 border-blue-200">
                                            <span class="font-medium">ğŸ”„ ç¬¬2å¤©ï¼šè®°å¿†åŠ›æµ‹è¯•</span>
                                            <span class="text-sm text-blue-600 font-semibold">è¿›è¡Œä¸­</span>
                                        </div>
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <span class="font-medium text-gray-600">â³ ç¬¬3-7å¤©ï¼šèƒ½åŠ›æµ‹è¯•</span>
                                            <span class="text-sm text-gray-500">å¾…å¼€å¯</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- è¿›åº¦æ¡ -->
                                <div class="bg-white rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="font-semibold text-gray-700">å­µåŒ–è¿›åº¦</span>
                                        <span class="text-sm text-gray-600">30%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-4">
                                        <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-4 rounded-full" style="width: 30%"></div>
                                    </div>
                                    <div class="flex justify-between text-sm text-gray-600 mt-2">
                                        <span>è¿›åº¦: 2/7å¤©</span>
                                        <span>é¢„è®¡5å¤©å®Œæˆ</span>
                                    </div>
                                </div>
                                
                                <!-- å­µåŒ–å¥–åŠ± -->
                                <div class="bg-yellow-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-yellow-800 mb-3">ğŸ å­µåŒ–å¥–åŠ±</h4>
                                    <div class="grid grid-cols-3 gap-3">
                                        <div class="reward-item">
                                            <div class="text-2xl mb-2">ğŸ‰</div>
                                            <div class="text-sm font-medium">å¹¼å¹´æŠ±æŠ±é¾™</div>
                                        </div>
                                        <div class="reward-item">
                                            <div class="text-2xl mb-2">ğŸ®</div>
                                            <div class="text-sm font-medium">äº’åŠ¨åŠŸèƒ½</div>
                                        </div>
                                        <div class="reward-item">
                                            <div class="text-2xl mb-2">â¤ï¸</div>
                                            <div class="text-sm font-medium">é™ªä¼´æ¨¡å¼</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button class="task-button w-full text-lg py-4">ç»§ç»­æµ‹è¯•</button>
                            </div>
                        `
                    },
                    1: { // é£ç¿”çš„å¿ƒ
                        title: 'ğŸš€ é£ç¿”çš„å¿ƒ',
                        status: 'å¾…å¼€å¯',
                        content: `
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">ğŸš€ é£ç¿”çš„å¿ƒ</h2>
                                <div class="flex items-center">
                                    <div class="status-indicator status-pending"></div>
                                    <span class="text-sm text-gray-600">å¾…å¼€å¯</span>
                                </div>
                            </div>
                            
                            <div class="space-y-6">
                                <!-- è§£é”æ¡ä»¶ -->
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                    <h3 class="font-semibold text-blue-800 mb-3 text-lg">ğŸ”’ è§£é”æ¡ä»¶</h3>
                                    <p class="text-blue-700 mb-4">è®¤çŸ¥èƒ½åŠ›è¾¾åˆ°60åˆ†ä¸”å®Œæˆé¾™è›‹å­µåŒ–</p>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium">è®¤çŸ¥èƒ½åŠ›:</span>
                                            <span class="text-sm font-semibold">45/60åˆ†</span>
                                        </div>
                                        <div class="w-full bg-blue-200 rounded-full h-3">
                                            <div class="bg-blue-500 h-3 rounded-full" style="width: 75%"></div>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium">é¾™è›‹å­µåŒ–:</span>
                                            <span class="text-sm font-semibold text-orange-600">30% è¿›è¡Œä¸­</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ä»»åŠ¡é¢„è§ˆ -->
                                <div class="bg-gray-50 rounded-lg p-6 opacity-75">
                                    <h3 class="font-semibold text-gray-700 mb-4 text-lg">ğŸ—¼ æ˜Ÿå…‰å¡”æ¢é™©</h3>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">ğŸƒ</span>
                                            <span class="font-medium text-gray-600">è·‘é…·æŒ‘æˆ˜</span>
                                        </div>
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">ğŸ”§</span>
                                            <span class="font-medium text-gray-600">æœºå…³è°œé¢˜</span>
                                        </div>
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">ğŸ’</span>
                                            <span class="font-medium text-gray-600">æ”¶é›†å¿ƒä¹‹ç¢ç‰‡(7ä¸ª)</span>
                                        </div>
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">âœ¨</span>
                                            <span class="font-medium text-gray-600">å¿ƒçµè¿æ¥ä»ªå¼</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- é£è¡Œå¥–åŠ± -->
                                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border-2 border-blue-200">
                                    <h4 class="font-semibold text-blue-800 mb-3">ğŸ é£ç¿”å¥–åŠ±</h4>
                                    <div class="grid grid-cols-3 gap-3">
                                        <div class="reward-item">
                                            <div class="text-2xl mb-2">ğŸš€</div>
                                            <div class="text-sm font-medium">é£è¡Œèƒ½åŠ›</div>
                                        </div>
                                        <div class="reward-item">
                                            <div class="text-2xl mb-2">ğŸ²</div>
                                            <div class="text-sm font-medium">æˆå¹´å½¢æ€</div>
                                        </div>
                                        <div class="reward-item">
                                            <div class="text-2xl mb-2">ğŸ†</div>
                                            <div class="text-sm font-medium">å¾æœè€…ç§°å·</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button class="task-button w-full text-lg py-4" disabled>éœ€è¦è§£é”</button>
                            </div>
                        `
                    },
                    2: { // é¾™ä¹‹è°·
                        title: 'ğŸ”ï¸ é¾™ä¹‹è°·',
                        status: 'å¾…å¼€å¯',
                        content: `
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">ğŸ”ï¸ é¾™ä¹‹è°·</h2>
                                <div class="flex items-center">
                                    <div class="status-indicator status-pending"></div>
                                    <span class="text-sm text-gray-600">å¾…å¼€å¯</span>
                                </div>
                            </div>
                            
                            <div class="space-y-6">
                                <!-- è§£é”æ¡ä»¶ -->
                                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                    <h3 class="font-semibold text-green-800 mb-3 text-lg">ğŸ”’ è§£é”æ¡ä»¶</h3>
                                    <p class="text-green-700 mb-4">å®Œæˆ"é£ç¿”çš„å¿ƒ"ä»»åŠ¡</p>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium">å‰ç½®ä»»åŠ¡:</span>
                                            <span class="text-sm font-semibold text-red-600">æœªå®Œæˆ</span>
                                        </div>
                                        <div class="w-full bg-green-200 rounded-full h-3">
                                            <div class="bg-green-500 h-3 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å®¶å›­æ¨¡æ¿é¢„è§ˆ -->
                                <div class="bg-gray-50 rounded-lg p-6 opacity-75">
                                    <h3 class="font-semibold text-gray-700 mb-4 text-lg">ğŸï¸ å®¶å›­æ¨¡æ¿é€‰æ‹©</h3>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">ğŸŒ…</span>
                                            <span class="font-medium text-gray-600">æ™¨æ›¦èŠ±å›­</span>
                                        </div>
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">ğŸŒ™</span>
                                            <span class="font-medium text-gray-600">æ˜Ÿå¤œæ£®æ—</span>
                                        </div>
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">â˜ï¸</span>
                                            <span class="font-medium text-gray-600">äº‘æµ·å³¡è°·</span>
                                        </div>
                                        <div class="flex items-center p-3 bg-white rounded-lg">
                                            <span class="text-2xl mr-3">ğŸŒ±</span>
                                            <span class="font-medium text-gray-600">ç§èœå…»æˆç³»ç»Ÿ</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å®¶å›­å¥–åŠ± -->
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border-2 border-green-200">
                                    <h4 class="font-semibold text-green-800 mb-3">ğŸŒŸ å®¶å›­å¥–åŠ±</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="reward-item bg-gradient-to-r from-green-100 to-emerald-100">
                                            <div class="text-2xl mb-2">ğŸ </div>
                                            <div class="text-sm font-medium">ä¸“å±å®¶å›­</div>
                                        </div>
                                        <div class="reward-item bg-gradient-to-r from-yellow-100 to-green-100">
                                            <div class="text-2xl mb-2">ğŸ¨</div>
                                            <div class="text-sm font-medium">è£…é¥°åŠŸèƒ½</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button class="task-button w-full text-lg py-4" disabled>æš‚æœªè§£é”</button>
                            </div>
                        `
                    }
                };
            }

            loadTaskDetail(taskIndex) {
                const taskDetail = document.getElementById('taskDetail');
                const template = this.taskTemplates[taskIndex];
                
                if (template) {
                    taskDetail.innerHTML = template.content;
                    
                    // é‡æ–°ç»‘å®šæŒ‰é’®äº‹ä»¶
                    const button = taskDetail.querySelector('.task-button');
                    if (button && !button.disabled) {
                        button.addEventListener('click', () => this.handleTaskAction(taskIndex));
                    }
                }
            }

            sendGameLoaded() {
                // Send game loaded event to host
                window.parent.postMessage({ type: 'gameLoaded' }, '*');
            }

            sendGameStarted() {
                // Send game started event to host
                window.parent.postMessage({ type: 'gameStarted' }, '*');
            }

            sendGameFinished(results = {}) {
                // Send game finished event to host with results
                const finishData = {
                    score: gameStats.score,
                    level: gameStats.level,
                    tasksCompleted: gameStats.tasksCompleted,
                    cognitiveScore: gameStats.cognitiveScore,
                    ...results
                };
                window.parent.postMessage({ 
                    type: 'gameFinished', 
                    data: finishData 
                }, '*');
            }

            updateGameStats(updates) {
                // Update game statistics
                Object.assign(gameStats, updates);
            }
            
            initializeEvents() {
                // ä»»åŠ¡åˆ—è¡¨ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.task-list-item').forEach((item, index) => {
                    item.addEventListener('click', () => {
                        // Allow all tasks to be clicked and shown, even locked ones
                        this.selectTask(index);
                    });
                });
            }
            
            selectTask(taskIndex) {
                // æ›´æ–°ä»»åŠ¡åˆ—è¡¨é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.task-list-item').forEach((item, index) => {
                    if (index === taskIndex) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // åŠ è½½ä»»åŠ¡è¯¦æƒ…
                this.currentTask = taskIndex;
                this.loadTaskDetail(taskIndex);
            }
            
            handleTaskAction(taskIndex) {
                switch(taskIndex) {
                    case 0: // å¤©èµ‹è§‰é†’ï¼ˆå­µåŒ–é¾™è›‹ï¼‰
                        this.startDragonEggHatching();
                        break;
                    case 1: // é£ç¿”çš„å¿ƒ
                        if (this.checkCognitiveScore(60)) {
                            this.startFlyingHeartQuest();
                        } else {
                            this.showUnlockMessage('éœ€è¦è®¤çŸ¥èƒ½åŠ›è¾¾åˆ°60åˆ†æ‰èƒ½è§£é”æ­¤ä»»åŠ¡ï¼');
                        }
                        break;
                    case 2: // é¾™ä¹‹è°·
                        this.showDragonValleyLocked();
                        break;
                }
            }
            
            startDragonEggHatching() {
                console.log('å¼€å§‹å¤©èµ‹è§‰é†’ä»»åŠ¡');
                this.sendGameStarted();
                this.startSpeaking();
                alert('ğŸ¥š è¿›å…¥è§‰é†’ç¥æ®¿ï¼Œå¼€å§‹ä»Šæ—¥çš„èƒ½åŠ›æµ‹è¯•ï¼');
                this.stopSpeaking();
                
                // Update stats when task is started
                this.updateGameStats({ 
                    score: gameStats.score + 50,
                    cognitiveScore: gameStats.cognitiveScore + 5 
                });
                
                // Simulate task completion after some time
                setTimeout(() => {
                    this.updateGameStats({ 
                        tasksCompleted: gameStats.tasksCompleted + 1 
                    });
                    this.sendGameFinished({ taskCompleted: 'dragonEggHatching' });
                }, 3000);
                
                // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°å…·ä½“çš„æµ‹è¯•é¡µé¢
            }
            
            startFlyingHeartQuest() {
                console.log('å¼€å§‹é£ç¿”çš„å¿ƒä»»åŠ¡');
                this.sendGameStarted();
                this.startSpeaking();
                alert('ğŸš€ æŠ±æŠ±é¾™æ¸´æœ›é£ç¿”ï¼å‰å¾€æ˜Ÿå…‰å¡”å¯»æ‰¾é£ç¿”çš„å¿ƒï¼');
                this.stopSpeaking();
                
                // Update stats when quest is started
                this.updateGameStats({ 
                    difficulty: 3, // Increase difficulty for this quest
                    score: gameStats.score + 100 
                });
                
                // Simulate quest completion
                setTimeout(() => {
                    this.updateGameStats({ 
                        level: gameStats.level + 1,
                        tasksCompleted: gameStats.tasksCompleted + 1 
                    });
                    this.sendGameFinished({ questCompleted: 'flyingHeart' });
                }, 5000);
            }
            
            checkCognitiveScore(requiredScore) {
                // æ¨¡æ‹Ÿæ£€æŸ¥è®¤çŸ¥èƒ½åŠ›åˆ†æ•°
                const currentScore = 45; // å½“å‰åˆ†æ•°
                return currentScore >= requiredScore;
            }
            
            showUnlockMessage(message) {
                alert(`ğŸ”’ ${message}`);
            }
            
            showDragonValleyLocked() {
                alert('ğŸ”ï¸ é¾™ä¹‹è°·éœ€è¦å®Œæˆé£ç¿”çš„å¿ƒä»»åŠ¡æ‰èƒ½è§£é”ï¼');
            }
            
            updateProgress() {
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                const progressRing = document.querySelector('.progress-bar');
                const totalProgress = 30; // æ€»è¿›åº¦30%
                const circumference = 2 * Math.PI * 36; // åœ†å‘¨é•¿
                const offset = circumference * (1 - totalProgress / 100);
                
                if (progressRing) {
                    progressRing.style.strokeDasharray = `${circumference * totalProgress / 100} ${circumference}`;
                }
            }
            
            // æŠ±æŠ±é¾™åŠ¨ç”»
            blinkEye() {
                const dragonEye = document.querySelector('.dragon-eye');
                if (dragonEye) {
                    dragonEye.classList.add('blink');
                    setTimeout(() => {
                        dragonEye.classList.remove('blink');
                    }, 150);
                }
            }

            startBlinking() {
                setInterval(() => {
                    if (Math.random() < 0.3) { // 30% chance to blink
                        this.blinkEye();
                    }
                }, 2000);
            }

            startSpeaking() {
                const dragonBody = document.querySelector('.dragon-body');
                if (dragonBody) {
                    dragonBody.classList.add('speaking');
                }
            }

            stopSpeaking() {
                const dragonBody = document.querySelector('.dragon-body');
                if (dragonBody) {
                    dragonBody.classList.remove('speaking');
                }
            }
        }
        
        // åˆå§‹åŒ–æ¸¸æˆç®¡ç†å™¨
        new DragonTaskManager();
    </script>
</body>
</html>
